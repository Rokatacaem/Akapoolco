[{"filePath":"C:\\Users\\rokat\\OneDrive\\Proyectos\\Akapoolco\\eslint.config.mjs","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\rokat\\OneDrive\\Proyectos\\Akapoolco\\next.config.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'NextConfig' is defined but never used.","line":1,"column":15,"nodeType":"Identifier","messageId":"unusedVar","endLine":1,"endColumn":25,"suggestions":[{"messageId":"removeUnusedImportDeclaration","data":{"varName":"NextConfig"},"fix":{"range":[0,39],"text":""},"desc":"Remove unused import declaration."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import type { NextConfig } from \"next\";\r\n\r\nconst nextConfig = {\r\n  /* config options here */\r\n  images: {\r\n    remotePatterns: [\r\n      {\r\n        protocol: 'https',\r\n        hostname: '*.public.blob.vercel-storage.com',\r\n      },\r\n      {\r\n        protocol: 'https',\r\n        hostname: 'lh3.googleusercontent.com', // Google Auth pictures\r\n      }\r\n    ],\r\n  },\r\n  experimental: {\r\n    serverActions: {\r\n      bodySizeLimit: '5mb',\r\n    },\r\n  },\r\n};\r\n\r\nexport default nextConfig;\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\rokat\\OneDrive\\Proyectos\\Akapoolco\\postcss.config.mjs","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\rokat\\OneDrive\\Proyectos\\Akapoolco\\prisma\\seed-admin.ts","messages":[{"ruleId":"@typescript-eslint/ban-ts-comment","severity":2,"message":"Include a description after the \"@ts-expect-error\" directive to explain why the @ts-expect-error is necessary. The description must be 3 characters or longer.","line":161,"column":17,"nodeType":"Line","messageId":"tsDirectiveCommentRequiresDescription","endLine":161,"endColumn":36}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { PrismaClient } from '@prisma/client'\r\nimport bcrypt from 'bcryptjs'\r\n\r\nconst prisma = new PrismaClient()\r\n\r\nasync function main() {\r\n    const password = await bcrypt.hash('TaCaEmMi0929', 10)\r\n\r\n    console.log('Seeding Akapoolco Data...')\r\n\r\n    // 1. Admin User\r\n    await prisma.user.upsert({\r\n        where: { email: 'admin@akapoolco.cl' },\r\n        update: { password, systemAccess: true, role: 'SUPERUSER' },\r\n        create: {\r\n            name: 'Admin Akapoolco',\r\n            email: 'admin@akapoolco.cl',\r\n            password,\r\n            systemAccess: true,\r\n            role: 'SUPERUSER',\r\n            type: 'SOCIO'\r\n        }\r\n    })\r\n\r\n    // 2. Tables (8 Pool Tables)\r\n    // 4 mesas con 2 cámaras (T1-T4)\r\n    for (let i = 1; i <= 4; i++) {\r\n        await prisma.table.upsert({\r\n            where: { name: `Mesa ${i}` },\r\n            update: { type: 'POOL', cameraTopUrl: `http://cam-top-${i}`, cameraFrontUrl: `http://cam-front-${i}` },\r\n            create: {\r\n                name: `Mesa ${i}`,\r\n                type: 'POOL',\r\n                hourlyRate: 6000,\r\n                cameraTopUrl: `http://cam-top-${i}`,\r\n                cameraFrontUrl: `http://cam-front-${i}`\r\n            }\r\n        })\r\n    }\r\n\r\n    // 4 mesas con 1 cámara (T5-T8)\r\n    for (let i = 5; i <= 8; i++) {\r\n        await prisma.table.upsert({\r\n            where: { name: `Mesa ${i}` },\r\n            update: { type: 'POOL', cameraTopUrl: `http://cam-top-${i}` },\r\n            create: {\r\n                name: `Mesa ${i}`,\r\n                type: 'POOL',\r\n                hourlyRate: 5000,\r\n                cameraTopUrl: `http://cam-top-${i}`\r\n            }\r\n        })\r\n    }\r\n\r\n    // 3. Arcade Machines - REMOVED (No gestionables en este sistema)\r\n    // await prisma.table.upsert({\r\n    //     where: { name: 'Arcade Street Fighter' },\r\n    //     update: { type: 'ARCADE' },\r\n    //     create: { name: 'Arcade Street Fighter', type: 'ARCADE', hourlyRate: 0 } \r\n    // })\r\n\r\n    // 4. Kitchen Ingredients (Initial Stock)\r\n    const ingredients = [\r\n        { name: 'Pan Frica', unit: 'un', cost: 200, stock: 100 },\r\n        { name: 'Vienesa', unit: 'un', cost: 300, stock: 100 },\r\n        { name: 'Tomate', unit: 'kg', cost: 1500, stock: 10 },\r\n        { name: 'Palta', unit: 'kg', cost: 5000, stock: 5 },\r\n        { name: 'Mayonesa', unit: 'kg', cost: 4000, stock: 5 },\r\n        { name: 'Carne Hamburguesa', unit: 'un', cost: 500, stock: 50 },\r\n        { name: 'Queso', unit: 'kg', cost: 4000, stock: 5 },\r\n        { name: 'Papas Prefritas', unit: 'kg', cost: 1500, stock: 20 },\r\n        { name: 'Aceite', unit: 'lt', cost: 1200, stock: 20 },\r\n        { name: 'Lomo Liso', unit: 'kg', cost: 8000, stock: 10 },\r\n        { name: 'Cebolla', unit: 'kg', cost: 800, stock: 10 },\r\n        { name: 'Reineta', unit: 'kg', cost: 6000, stock: 5 },\r\n        { name: 'Limón', unit: 'kg', cost: 1000, stock: 5 },\r\n    ]\r\n\r\n    for (const ing of ingredients) {\r\n        const existing = await prisma.ingredient.findFirst({ where: { name: ing.name } })\r\n        if (!existing) {\r\n            await prisma.ingredient.create({\r\n                data: {\r\n                    name: ing.name,\r\n                    unit: ing.unit,\r\n                    cost: ing.cost,\r\n                    currentStock: ing.stock\r\n                }\r\n            })\r\n        }\r\n    }\r\n\r\n    // 5. Kitchen Products (Carta)\r\n    console.log('Seeding Products...')\r\n    const products = [\r\n        {\r\n            name: 'Completo Chileno',\r\n            category: 'Cocina',\r\n            priceClient: 4500,\r\n            priceMember: 4000,\r\n            image: '/images/products/completo-chileno.png',\r\n            printCategory: 'KITCHEN'\r\n        },\r\n        {\r\n            name: 'Hamburguesa de la Casa',\r\n            category: 'Cocina',\r\n            priceClient: 6500,\r\n            priceMember: 5500,\r\n            image: '/images/products/hamburguesa.png',\r\n            printCategory: 'KITCHEN'\r\n        },\r\n        {\r\n            name: 'Chorrillana',\r\n            category: 'Cocina',\r\n            priceClient: 12000,\r\n            priceMember: 10000,\r\n            image: '/images/products/chorrillana.png',\r\n            printCategory: 'KITCHEN'\r\n        },\r\n        {\r\n            name: 'Lomo Saltado',\r\n            category: 'Cocina',\r\n            priceClient: 10000,\r\n            priceMember: 8500,\r\n            image: '/images/products/lomo-saltado.png',\r\n            printCategory: 'KITCHEN'\r\n        },\r\n        {\r\n            name: 'Cebiche de Pescado',\r\n            category: 'Cocina',\r\n            priceClient: 9000,\r\n            priceMember: 7500,\r\n            image: '/images/products/cebiche-pescado.png',\r\n            printCategory: 'KITCHEN'\r\n        },\r\n        {\r\n            name: 'Papas Fritas',\r\n            category: 'Cocina',\r\n            priceClient: 4000,\r\n            priceMember: 3500,\r\n            image: '/images/products/papas-fritas.png',\r\n            printCategory: 'KITCHEN'\r\n        }\r\n    ]\r\n\r\n    for (const prod of products) {\r\n        await prisma.product.upsert({\r\n            where: { id: prod.name.toLowerCase().replace(/\\s+/g, '-') }, // Simple ID generation for seed\r\n            update: {\r\n                image: prod.image,\r\n                priceClient: prod.priceClient,\r\n                priceMember: prod.priceMember\r\n            },\r\n            create: {\r\n                id: prod.name.toLowerCase().replace(/\\s+/g, '-'),\r\n                name: prod.name,\r\n                category: prod.category,\r\n                priceClient: prod.priceClient,\r\n                priceMember: prod.priceMember,\r\n                image: prod.image,\r\n                // @ts-expect-error\r\n                printCategory: prod.printCategory\r\n            }\r\n        })\r\n    }\r\n\r\n    console.log('Akapoolco Seeded Successfully.')\r\n}\r\n\r\nmain()\r\n    .then(async () => {\r\n        await prisma.$disconnect()\r\n    })\r\n    .catch(async (e) => {\r\n        console.error(e)\r\n        await prisma.$disconnect()\r\n        process.exit(1)\r\n    })\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\rokat\\OneDrive\\Proyectos\\Akapoolco\\prisma\\seed-members.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'UserRole' is defined but never used.","line":1,"column":24,"nodeType":"Identifier","messageId":"unusedVar","endLine":1,"endColumn":32,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"UserRole"},"fix":{"range":[21,31],"text":""},"desc":"Remove unused variable \"UserRole\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'UserType' is defined but never used.","line":1,"column":34,"nodeType":"Identifier","messageId":"unusedVar","endLine":1,"endColumn":42,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"UserType"},"fix":{"range":[31,41],"text":""},"desc":"Remove unused variable \"UserType\"."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { PrismaClient, UserRole, UserType } from '@prisma/client'\r\nimport bcrypt from 'bcryptjs'\r\n\r\nconst prisma = new PrismaClient()\r\n\r\nasync function main() {\r\n    const password = await bcrypt.hash('123456', 10)\r\n\r\n    // 1. Members (Socios)\r\n    const members = [\r\n        { name: 'Juan Perez', email: 'juan@example.com', debt: false },\r\n        { name: 'Maria Gonzalez', email: 'maria@example.com', debt: true },\r\n        { name: 'Carlos Rodriguez', email: 'carlos@example.com', debt: false },\r\n        { name: 'Ana Lopez', email: 'ana@example.com', debt: false },\r\n        { name: 'Pedro Martinez', email: 'pedro@example.com', debt: true },\r\n    ]\r\n\r\n    console.log('Seeding Members...')\r\n\r\n    for (const m of members) {\r\n        await prisma.user.upsert({\r\n            where: { email: m.email },\r\n            update: {},\r\n            create: {\r\n                name: m.name,\r\n                email: m.email,\r\n                password, // Shared password for demo\r\n                role: 'STAFF', // Regular user treated as Staff/User in this simplified model or create new role\r\n                type: 'SOCIO',\r\n                debtStatus: m.debt\r\n            }\r\n        })\r\n    }\r\n\r\n    console.log('Seeding completed')\r\n}\r\n\r\nmain()\r\n    .then(async () => {\r\n        await prisma.$disconnect()\r\n    })\r\n    .catch(async (e) => {\r\n        console.error(e)\r\n        await prisma.$disconnect()\r\n        process.exit(1)\r\n    })\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\rokat\\OneDrive\\Proyectos\\Akapoolco\\prisma\\seed-products.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\rokat\\OneDrive\\Proyectos\\Akapoolco\\prisma\\seed.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\rokat\\OneDrive\\Proyectos\\Akapoolco\\src\\app\\api\\auth\\[...nextauth]\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\rokat\\OneDrive\\Proyectos\\Akapoolco\\src\\app\\api\\debug-billar\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":41,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":41,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1322,1325],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1322,1325],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\r\nimport { NextResponse } from 'next/server';\r\nimport { prisma } from '@/lib/prisma';\r\n\r\nexport async function GET() {\r\n    try {\r\n        const table = await prisma.table.findFirst({\r\n            where: { name: 'Billar 1' },\r\n            include: {\r\n                currentSession: {\r\n                    include: {\r\n                        sessionPlayers: {\r\n                            include: {\r\n                                user: true,\r\n                                member: true\r\n                            }\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n        });\r\n\r\n        if (!table || !table.currentSession) {\r\n            return NextResponse.json({ success: false, error: 'No active session' });\r\n        }\r\n\r\n        return NextResponse.json({\r\n            success: true,\r\n            session: {\r\n                id: table.currentSession.id,\r\n                playersJSON: table.currentSession.players,\r\n                sessionPlayers: table.currentSession.sessionPlayers.map(p => ({\r\n                    id: p.id,\r\n                    guestName: p.guestName,\r\n                    memberName: p.member?.name,\r\n                    userName: p.user?.name,\r\n                    status: p.status\r\n                }))\r\n            }\r\n        });\r\n    } catch (error: any) {\r\n        return NextResponse.json({ success: false, error: error.message }, { status: 500 });\r\n    }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\rokat\\OneDrive\\Proyectos\\Akapoolco\\src\\app\\dashboard\\cockpit\\cockpit-client-v2.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'TabsContent' is defined but never used.","line":7,"column":39,"nodeType":"Identifier","messageId":"unusedVar","endLine":7,"endColumn":50,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"TabsContent"},"fix":{"range":[270,283],"text":""},"desc":"Remove unused variable \"TabsContent\"."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":16,"column":13,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":16,"endColumn":16,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[497,500],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[497,500],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport { useState } from \"react\";\r\nimport { useSearchParams } from \"next/navigation\";\r\nimport { TableCard } from \"@/components/tables/TableCard\";\r\nimport { NewTableDialog } from \"@/components/tables/NewTableDialog\";\r\nimport { Tabs, TabsList, TabsTrigger, TabsContent } from \"@/components/ui/tabs\";\r\nimport { cn } from \"@/lib/utils\";\r\n\r\nconst CATEGORIES = [\r\n    { id: 'ALL', label: 'TODAS' },\r\n    { id: 'POOL', label: 'POOL' },\r\n];\r\n\r\ninterface CockpitClientProps {\r\n    tables: any[];\r\n    userRole: string | undefined;\r\n    userName: string | undefined;\r\n}\r\n\r\nexport function CockpitClient({ tables, userRole, userName }: CockpitClientProps) {\r\n    const [activeTab, setActiveTab] = useState('ALL');\r\n    const searchParams = useSearchParams();\r\n    const openTableId = searchParams.get('openTable');\r\n\r\n    // Filter tables: only show POOL tables, and apply tabs\r\n    const visibleTables = tables.filter(t => t.type === 'POOL');\r\n\r\n    const filteredTables = visibleTables.filter(table => {\r\n        if (activeTab === 'ALL') return true;\r\n        return table.type === activeTab;\r\n    });\r\n\r\n    return (\r\n        <div className=\"min-h-screen bg-slate-950 p-6 md:p-8 overflow-y-auto relative\">\r\n            <div className=\"absolute inset-0 bg-[radial-gradient(ellipse_at_top,_var(--tw-gradient-stops))] from-blue-900/20 via-slate-950 to-slate-950 pointer-events-none\" />\r\n\r\n            <header className=\"relative z-10 flex flex-col md:flex-row justify-between items-start md:items-center mb-8 gap-4\">\r\n                <div>\r\n                    <h1 className=\"text-3xl font-bold bg-gradient-to-r from-emerald-400 to-blue-500 bg-clip-text text-transparent\">\r\n                        Panel de Control (Mesas)\r\n                    </h1>\r\n                    <p className=\"text-slate-400 text-sm\">Consola de Operaciones en Tiempo Real</p>\r\n                </div>\r\n\r\n                <div className=\"flex items-center gap-4\">\r\n                    <div className=\"text-right hidden sm:block\">\r\n                        <p className=\"text-sm font-bold text-white\">{userName}</p>\r\n                        <p className=\"text-xs text-emerald-400\">Caja ABIERTA</p>\r\n                    </div>\r\n                    {(userRole === 'ADMIN' || userRole === 'SUPERUSER') && (\r\n                        <NewTableDialog />\r\n                    )}\r\n                    <div className=\"w-10 h-10 rounded-full bg-blue-900/30 border border-blue-500/50 flex items-center justify-center text-blue-400 font-bold\">\r\n                        {userName ? userName.substring(0, 2).toUpperCase() : 'U'}\r\n                    </div>\r\n                </div>\r\n            </header>\r\n\r\n            <div className=\"relative z-10 mb-6\">\r\n                <Tabs defaultValue=\"ALL\" value={activeTab} onValueChange={setActiveTab} className=\"w-full\">\r\n                    <TabsList className=\"bg-slate-900/50 border border-white/10 p-1 mb-4 h-auto flex-wrap justify-start\">\r\n                        {CATEGORIES.map(cat => (\r\n                            <TabsTrigger\r\n                                key={cat.id}\r\n                                value={cat.id}\r\n                                className={cn(\r\n                                    \"px-4 py-2 text-sm font-medium transition-all data-[state=active]:bg-emerald-600 data-[state=active]:text-white data-[state=active]:shadow-lg rounded-md text-slate-400 hover:text-white hover:bg-white/5\",\r\n                                    activeTab === cat.id && \"bg-emerald-600 text-white\"\r\n                                )}\r\n                            >\r\n                                {cat.label}\r\n                            </TabsTrigger>\r\n                        ))}\r\n                    </TabsList>\r\n                </Tabs>\r\n            </div>\r\n\r\n            <div className=\"relative z-10 grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6 animate-in fade-in duration-500\">\r\n                {filteredTables.map(table => (\r\n                    <TableCard\r\n                        key={table.id}\r\n                        userRole={userRole}\r\n                        table={table}\r\n                        autoOpen={openTableId === table.id}\r\n                    />\r\n                ))}\r\n                {filteredTables.length === 0 && (\r\n                    <div className=\"col-span-full py-20 text-center text-slate-500 border border-dashed border-slate-800 rounded-lg\">\r\n                        <p>No hay mesas de tipo {CATEGORIES.find(c => c.id === activeTab)?.label} disponibles.</p>\r\n                    </div>\r\n                )}\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\rokat\\OneDrive\\Proyectos\\Akapoolco\\src\\app\\dashboard\\cockpit\\cockpit-client.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\rokat\\OneDrive\\Proyectos\\Akapoolco\\src\\app\\dashboard\\cockpit\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":25,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":25,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[747,750],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[747,750],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { auth } from \"@/auth\"\r\nimport { redirect } from \"next/navigation\"\r\nimport { CockpitClient } from \"./cockpit-client-v2\"\r\nimport { getTables } from \"@/app/lib/actions-tables\"\r\n\r\n// This is a Server Component that fetches initial data\r\nexport const dynamic = \"force-dynamic\"\r\n\r\nexport default async function CockpitPage() {\r\n    const session = await auth()\r\n    if (!session) redirect(\"/login\")\r\n\r\n    const userRole = session.user?.role;\r\n\r\n    try {\r\n        const serializedTables = await getTables();\r\n\r\n        return (\r\n            <CockpitClient\r\n                tables={serializedTables}\r\n                userRole={userRole}\r\n                userName={session.user?.name || 'Usuario'}\r\n            />\r\n        )\r\n    } catch (error: any) {\r\n        console.error(\"Cockpit Error:\", error);\r\n        return (\r\n            <div className=\"p-10 text-red-500\">\r\n                <h2 className=\"text-2xl font-bold\">Error Cargar Panel de Mesas</h2>\r\n                <pre className=\"mt-4 bg-slate-900 p-4 rounded text-xs overflow-auto\">\r\n                    {error.message}\r\n                </pre>\r\n            </div>\r\n        )\r\n    }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\rokat\\OneDrive\\Proyectos\\Akapoolco\\src\\app\\dashboard\\kiosk-links\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Copy' is defined but never used.","line":4,"column":24,"nodeType":"Identifier","messageId":"unusedVar","endLine":4,"endColumn":28,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"Copy"},"fix":{"range":[208,214],"text":""},"desc":"Remove unused variable \"Copy\"."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":62,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":62,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2581,2584],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2581,2584],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { getTables } from \"@/app/lib/actions-tables\";\r\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { ExternalLink, Copy, QrCode } from \"lucide-react\";\r\nimport Link from \"next/link\";\r\nimport { Badge } from \"@/components/ui/badge\";\r\n\r\nexport const metadata = {\r\n    title: \"Enlaces de Kiosco (Tablets) | Club Santiago\",\r\n    description: \"Accesos directos para configurar los tablets de las mesas\",\r\n};\r\n\r\nexport default async function KioskLinksPage() {\r\n    const tables = await getTables();\r\n\r\n    // Group tables by type\r\n    const groupedTables = tables.reduce((acc, table) => {\r\n        const type = table.type;\r\n        if (!acc[type]) acc[type] = [];\r\n        acc[type].push(table);\r\n        return acc;\r\n    }, {} as Record<string, typeof tables>);\r\n\r\n    // Order of types\r\n    const typeOrder = ['CARAMBOLA', 'NINE_BALL', 'POOL_CHILENO', 'POOL', 'SNOOKER', 'CARDS'];\r\n\r\n    return (\r\n        <div className=\"p-8 max-w-7xl mx-auto space-y-8\">\r\n            <div className=\"flex items-center gap-4 border-b border-slate-800 pb-6\">\r\n                <div className=\"bg-purple-600/20 p-3 rounded-xl\">\r\n                    <QrCode className=\"w-8 h-8 text-purple-400\" />\r\n                </div>\r\n                <div>\r\n                    <h1 className=\"text-3xl font-black text-white tracking-tight\">Enlaces de Kiosco</h1>\r\n                    <p className=\"text-slate-400\">Utiliza estos enlaces para configurar los tablets en cada mesa.</p>\r\n                </div>\r\n            </div>\r\n\r\n            <div className=\"grid gap-8\">\r\n                {typeOrder.map((type) => {\r\n                    const group = groupedTables[type];\r\n                    if (!group || group.length === 0) return null;\r\n\r\n                    return (\r\n                        <div key={type} className=\"space-y-4\">\r\n                            <h2 className=\"text-xl font-bold text-slate-300 border-l-4 border-purple-500 pl-3\">\r\n                                {type.replace('_', ' ')}\r\n                            </h2>\r\n                            <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4\">\r\n                                {group.map((table) => (\r\n                                    <KioskLinkCard key={table.id} table={table} />\r\n                                ))}\r\n                            </div>\r\n                        </div>\r\n                    );\r\n                })}\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n\r\nfunction KioskLinkCard({ table }: { table: any }) {\r\n    // Construct URL (assuming env var or hardcoded for now based on text file)\r\n    // Using window.location in client is easiest, but here we are server.\r\n    // We'll use a relative link for the \"Open\" button, or construct absolute if we know the base.\r\n    // Based on user's text file: https://club-santiago-bsm.vercel.app/table/...\r\n\r\n    // We'll use a client component wrapper or just simple links. \r\n    // Since we don't know the exact domain dynamically on server without headers (which is fine in page), \r\n    // we'll pass the ID and let a Client Component handle the \"Copy\" logic.\r\n\r\n    return (\r\n        <Card className=\"bg-slate-900 border-slate-800 hover:border-purple-500/50 transition-colors group\">\r\n            <CardHeader className=\"pb-2\">\r\n                <CardTitle className=\"text-lg font-bold text-white flex justify-between items-center\">\r\n                    {table.name}\r\n                    <Badge variant=\"outline\" className=\"text-[10px] border-slate-700\">{table.status}</Badge>\r\n                </CardTitle>\r\n            </CardHeader>\r\n            <CardContent>\r\n                <div className=\"flex gap-2 mt-2\">\r\n                    <Button asChild variant=\"default\" size=\"sm\" className=\"w-full bg-blue-600 hover:bg-blue-500\">\r\n                        <Link href={`/table/${table.id}`} target=\"_blank\" prefetch={false}>\r\n                            <ExternalLink className=\"w-4 h-4 mr-2\" /> Abrir\r\n                        </Link>\r\n                    </Button>\r\n                    <CopyButton path={`/table/${table.id}`} />\r\n                </div>\r\n            </CardContent>\r\n        </Card>\r\n    );\r\n}\r\n\r\nimport { CopyButton } from \"@/components/admin/CopyButton\"; // I need to create this or inline it. \r\n// I'll assume I need to create it to be safe.\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\rokat\\OneDrive\\Proyectos\\Akapoolco\\src\\app\\dashboard\\kitchen\\ingredients-manager.tsx","messages":[{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\nC:\\Users\\rokat\\OneDrive\\Proyectos\\Akapoolco\\src\\app\\dashboard\\kitchen\\ingredients-manager.tsx:44:9\n  42 |\n  43 |     useEffect(() => {\n> 44 |         setMounted(true)\n     |         ^^^^^^^^^^ Avoid calling setState() directly within an effect\n  45 |     }, [])\n  46 |\n  47 |     const filteredIngredients = initialIngredients.filter(i =>","line":44,"column":9,"nodeType":null,"endLine":44,"endColumn":19}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client'\r\n\r\nimport { RecipeManager } from \"./recipe-manager\"\r\n\r\nimport { useState, useEffect } from \"react\"\r\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\"\r\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\"\r\nimport { Button } from \"@/components/ui/button\"\r\nimport { Input } from \"@/components/ui/input\"\r\nimport { Label } from \"@/components/ui/label\"\r\nimport { Table, TableBody, TableCell, TableHead, TableHeader, TableRow } from \"@/components/ui/table\"\r\nimport { Dialog, DialogContent, DialogDescription, DialogFooter, DialogHeader, DialogTitle, DialogTrigger } from \"@/components/ui/dialog\"\r\nimport { createIngredient } from \"@/app/lib/actions-kitchen\"\r\nimport { toast } from \"sonner\"\r\nimport { Plus, Search } from \"lucide-react\"\r\n\r\ninterface Ingredient {\r\n    id: string\r\n    name: string\r\n    unit: string\r\n    cost: number\r\n    lossPercentage: number\r\n    currentStock: number\r\n}\r\n\r\ninterface Props {\r\n    initialIngredients: Ingredient[]\r\n}\r\n\r\nexport function IngredientsManager({ initialIngredients }: Props) {\r\n    // const [ingredients, setIngredients] = useState(initialIngredients) // Unused\r\n    const [searchTerm, setSearchTerm] = useState(\"\")\r\n    const [isCreateOpen, setIsCreateOpen] = useState(false)\r\n\r\n    // Form Stats\r\n    const [mounted, setMounted] = useState(false)\r\n    const [newName, setNewName] = useState(\"\")\r\n    const [newUnit, setNewUnit] = useState(\"un\")\r\n    const [newCost, setNewCost] = useState(\"\")\r\n    const [newStock, setNewStock] = useState(\"\")\r\n    const [newLoss, setNewLoss] = useState(\"0\")\r\n\r\n    useEffect(() => {\r\n        setMounted(true)\r\n    }, [])\r\n\r\n    const filteredIngredients = initialIngredients.filter(i =>\r\n        i.name.toLowerCase().includes(searchTerm.toLowerCase())\r\n    )\r\n\r\n    async function handleCreate() {\r\n        if (!newName || !newCost || !newStock) return\r\n\r\n        const res = await createIngredient({\r\n            name: newName,\r\n            unit: newUnit,\r\n            cost: parseFloat(newCost),\r\n            stock: parseFloat(newStock),\r\n            lossPercentage: parseFloat(newLoss)\r\n        })\r\n\r\n        if (res.success) {\r\n            toast.success(\"Ingrediente creado correctamente\")\r\n            setIsCreateOpen(false)\r\n            setNewName(\"\")\r\n            setNewCost(\"\")\r\n            setNewStock(\"\")\r\n            // Router refresh handles the update, but we could accept new list if action returned it\r\n        } else {\r\n            toast.error(\"Error al crear ingrediente\")\r\n        }\r\n    }\r\n\r\n    if (!mounted) return null\r\n\r\n    return (\r\n        <Tabs defaultValue=\"stock\" className=\"space-y-4\">\r\n            <TabsList>\r\n                <TabsTrigger value=\"stock\">Stock de Ingredientes</TabsTrigger>\r\n                <TabsTrigger value=\"recipes\">Recetas y Escandallos</TabsTrigger>\r\n            </TabsList>\r\n\r\n            <TabsContent value=\"stock\" className=\"space-y-4\">\r\n                <div className=\"flex items-center justify-between\">\r\n                    <div className=\"flex items-center space-x-2\">\r\n                        <div className=\"relative\">\r\n                            <Search className=\"absolute left-2 top-2.5 h-4 w-4 text-muted-foreground\" />\r\n                            <Input\r\n                                placeholder=\"Buscar ingrediente...\"\r\n                                value={searchTerm}\r\n                                onChange={(e) => setSearchTerm(e.target.value)}\r\n                                className=\"pl-8 w-[300px]\"\r\n                            />\r\n                        </div>\r\n                    </div>\r\n\r\n                    <Dialog open={isCreateOpen} onOpenChange={setIsCreateOpen}>\r\n                        <DialogTrigger asChild>\r\n                            <Button><Plus className=\"mr-2 h-4 w-4\" /> Nuevo Ingrediente</Button>\r\n                        </DialogTrigger>\r\n                        <DialogContent>\r\n                            <DialogHeader>\r\n                                <DialogTitle>Crear Nuevo Ingrediente</DialogTitle>\r\n                                <DialogDescription>\r\n                                    Añade un insumo para el control de stock de cocina.\r\n                                </DialogDescription>\r\n                            </DialogHeader>\r\n                            <div className=\"grid gap-4 py-4\">\r\n                                <div className=\"grid grid-cols-4 items-center gap-4\">\r\n                                    <Label className=\"text-right\">Nombre</Label>\r\n                                    <Input value={newName} onChange={e => setNewName(e.target.value)} className=\"col-span-3\" placeholder=\"Ej: Pan Frica\" />\r\n                                </div>\r\n                                <div className=\"grid grid-cols-4 items-center gap-4\">\r\n                                    <Label className=\"text-right\">Unidad</Label>\r\n                                    <Input value={newUnit} onChange={e => setNewUnit(e.target.value)} className=\"col-span-3\" placeholder=\"un, kg, lt\" />\r\n                                </div>\r\n                                <div className=\"grid grid-cols-4 items-center gap-4\">\r\n                                    <Label className=\"text-right\">Costo Unit.</Label>\r\n                                    <Input type=\"number\" value={newCost} onChange={e => setNewCost(e.target.value)} className=\"col-span-3\" placeholder=\"0\" />\r\n                                </div>\r\n                                <div className=\"grid grid-cols-4 items-center gap-4\">\r\n                                    <Label className=\"text-right\">Stock Inicial</Label>\r\n                                    <Input type=\"number\" value={newStock} onChange={e => setNewStock(e.target.value)} className=\"col-span-3\" placeholder=\"0\" />\r\n                                </div>\r\n                                <div className=\"grid grid-cols-4 items-center gap-4\">\r\n                                    <Label className=\"text-right\">Merma (%)</Label>\r\n                                    <Input type=\"number\" value={newLoss} onChange={e => setNewLoss(e.target.value)} className=\"col-span-3\" placeholder=\"0\" />\r\n                                </div>\r\n                            </div>\r\n                            <DialogFooter>\r\n                                <Button onClick={handleCreate}>Guardar Ingrediente</Button>\r\n                            </DialogFooter>\r\n                        </DialogContent>\r\n                    </Dialog>\r\n                </div>\r\n\r\n                <Card>\r\n                    <CardHeader>\r\n                        <CardTitle>Inventario Actual</CardTitle>\r\n                        <CardDescription>Gestión de insumos de cocina.</CardDescription>\r\n                    </CardHeader>\r\n                    <CardContent>\r\n                        <Table>\r\n                            <TableHeader>\r\n                                <TableRow>\r\n                                    <TableHead>Nombre</TableHead>\r\n                                    <TableHead>Unidad</TableHead>\r\n                                    <TableHead>Costo Unit.</TableHead>\r\n                                    <TableHead>Merma (%)</TableHead>\r\n                                    <TableHead>Stock Actual</TableHead>\r\n                                    <TableHead className=\"text-right\">Valor Total</TableHead>\r\n                                </TableRow>\r\n                            </TableHeader>\r\n                            <TableBody>\r\n                                {filteredIngredients.map((item) => (\r\n                                    <TableRow key={item.id}>\r\n                                        <TableCell className=\"font-medium\">{item.name}</TableCell>\r\n                                        <TableCell>{item.unit}</TableCell>\r\n                                        <TableCell>${item.cost.toLocaleString()}</TableCell>\r\n                                        <TableCell>{Number(item.lossPercentage)}%</TableCell>\r\n                                        <TableCell>{item.currentStock}</TableCell>\r\n                                        <TableCell className=\"text-right\">\r\n                                            ${(item.cost * item.currentStock).toLocaleString()}\r\n                                        </TableCell>\r\n                                    </TableRow>\r\n                                ))}\r\n                            </TableBody>\r\n                        </Table>\r\n                    </CardContent>\r\n                </Card>\r\n            </TabsContent>\r\n\r\n            <TabsContent value=\"recipes\">\r\n                <RecipeManager ingredients={initialIngredients} />\r\n            </TabsContent>\r\n        </Tabs>\r\n    )\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\rokat\\OneDrive\\Proyectos\\Akapoolco\\src\\app\\dashboard\\kitchen\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\rokat\\OneDrive\\Proyectos\\Akapoolco\\src\\app\\dashboard\\kitchen\\recipe-manager.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'loading' is assigned a value but never used.","line":41,"column":12,"nodeType":"Identifier","messageId":"unusedVar","endLine":41,"endColumn":19}],"suppressedMessages":[{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\nC:\\Users\\rokat\\OneDrive\\Proyectos\\Akapoolco\\src\\app\\dashboard\\kitchen\\recipe-manager.tsx:63:9\n  61 |     useEffect(() => {\n  62 |         // eslint-disable-next-line react-hooks/set-state-in-effect\n> 63 |         loadProducts()\n     |         ^^^^^^^^^^^^ Avoid calling setState() directly within an effect\n  64 |     }, [])\n  65 |\n  66 |     useEffect(() => {","line":63,"column":9,"nodeType":null,"endLine":63,"endColumn":21,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\nC:\\Users\\rokat\\OneDrive\\Proyectos\\Akapoolco\\src\\app\\dashboard\\kitchen\\recipe-manager.tsx:69:13\n  67 |         if (selectedProductId) {\n  68 |             // eslint-disable-next-line react-hooks/set-state-in-effect\n> 69 |             loadRecipe(selectedProductId)\n     |             ^^^^^^^^^^ Avoid calling setState() directly within an effect\n  70 |         } else {\n  71 |             setRecipeItems([])\n  72 |         }","line":69,"column":13,"nodeType":null,"endLine":69,"endColumn":23,"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client'\r\n\r\nimport { useState, useEffect } from \"react\"\r\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\"\r\nimport { Button } from \"@/components/ui/button\"\r\nimport { Input } from \"@/components/ui/input\"\r\nimport { Label } from \"@/components/ui/label\"\r\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\"\r\nimport { Table, TableBody, TableCell, TableHead, TableHeader, TableRow } from \"@/components/ui/table\"\r\nimport { toast } from \"sonner\"\r\nimport { Plus, Trash, Calculator, Search } from \"lucide-react\"\r\nimport { getProducts, getRecipeIngredients, addIngredientToRecipe, removeIngredientFromRecipe } from \"@/app/lib/actions-kitchen\"\r\n\r\ninterface Product {\r\n    id: string\r\n    name: string\r\n}\r\n\r\ninterface Ingredient {\r\n    id: string\r\n    name: string\r\n    unit: string\r\n    cost: number\r\n    lossPercentage: number\r\n}\r\n\r\ninterface RecipeItem {\r\n    id: string\r\n    ingredient: Ingredient\r\n    quantity: number // This is the GROSS quantity stored in DB\r\n}\r\n\r\ninterface Props {\r\n    ingredients: Ingredient[]\r\n}\r\n\r\nexport function RecipeManager({ ingredients }: Props) {\r\n    const [products, setProducts] = useState<Product[]>([])\r\n    const [selectedProductId, setSelectedProductId] = useState<string>(\"\")\r\n    const [recipeItems, setRecipeItems] = useState<RecipeItem[]>([])\r\n    const [loading, setLoading] = useState(false)\r\n\r\n    // Form for Adding Ingredient\r\n    const [selectedIngredientId, setSelectedIngredientId] = useState<string>(\"\")\r\n    const [netQuantity, setNetQuantity] = useState<string>(\"\")\r\n    // calculatedGross is now derived\r\n    const [searchTerm, setSearchTerm] = useState(\"\")\r\n\r\n    async function loadProducts() {\r\n        const res = await getProducts()\r\n        setProducts(res)\r\n    }\r\n\r\n    async function loadRecipe(id: string) {\r\n        setLoading(true)\r\n        const res = await getRecipeIngredients(id) as unknown as RecipeItem[]\r\n        setRecipeItems(res || [])\r\n        setLoading(false)\r\n    }\r\n\r\n    useEffect(() => {\r\n        // eslint-disable-next-line react-hooks/set-state-in-effect\r\n        loadProducts()\r\n    }, [])\r\n\r\n    useEffect(() => {\r\n        if (selectedProductId) {\r\n            // eslint-disable-next-line react-hooks/set-state-in-effect\r\n            loadRecipe(selectedProductId)\r\n        } else {\r\n            setRecipeItems([])\r\n        }\r\n    }, [selectedProductId])\r\n\r\n    // Derived calculation\r\n    const selectedIngredient = ingredients.find(i => i.id === selectedIngredientId)\r\n    const currentProduct = products.find(p => p.id === selectedProductId)\r\n    const filteredProducts = products.filter(p => p.name.toLowerCase().includes(searchTerm.toLowerCase()))\r\n\r\n    let calculatedGross = 0\r\n    if (selectedIngredientId && netQuantity && !isNaN(parseFloat(netQuantity))) {\r\n        const net = parseFloat(netQuantity)\r\n        const ingredient = ingredients.find(i => i.id === selectedIngredientId)\r\n        if (ingredient) {\r\n            const lossFactor = 1 - (Number(ingredient.lossPercentage) / 100)\r\n            if (lossFactor <= 0) {\r\n                calculatedGross = net\r\n            } else {\r\n                calculatedGross = net / lossFactor\r\n            }\r\n        }\r\n    }\r\n\r\n\r\n\r\n    async function handleAddIngredient() {\r\n        if (!selectedProductId || !selectedIngredientId || !calculatedGross) return\r\n\r\n        const res = await addIngredientToRecipe(selectedProductId, selectedIngredientId, calculatedGross)\r\n\r\n        if (res.success) {\r\n            toast.success(\"Ingrediente agregado a la receta\")\r\n            loadRecipe(selectedProductId)\r\n            setNetQuantity(\"\")\r\n\r\n            // Do not clear ingredient to allow rapid entry if needed, or clear it if preferred\r\n            // setCalculatedGross(0) // Logic effect will handle this\r\n        } else {\r\n            toast.error(\"Error al agregar ingrediente\")\r\n        }\r\n    }\r\n\r\n    async function handleRemoveIngredient(recipeId: string) {\r\n        // if (!confirm(\"¿Estás seguro de quitar este ingrediente?\")) return\r\n\r\n        const res = await removeIngredientFromRecipe(recipeId)\r\n        if (res.success) {\r\n            toast.success(\"Ingrediente removido\")\r\n            loadRecipe(selectedProductId)\r\n        } else {\r\n            toast.error(\"Error al remover ingrediente\")\r\n        }\r\n    }\r\n\r\n\r\n    // Total Cost Calculation\r\n    const totalRecipeCost = recipeItems.reduce((acc, item) => {\r\n        const qty = Number(item.quantity)\r\n        const cost = Number(item.ingredient.cost)\r\n        return acc + (qty * cost)\r\n    }, 0)\r\n\r\n    return (\r\n        <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-6\">\r\n            {/* Left Col: Product Selection */}\r\n            <Card className=\"lg:col-span-1 h-fit\">\r\n                <CardHeader>\r\n                    <CardTitle>1. Seleccionar Producto</CardTitle>\r\n                    <CardDescription>Elige el plato o trago a configurar.</CardDescription>\r\n                </CardHeader>\r\n                <CardContent className=\"space-y-4\">\r\n                    <div className=\"relative\">\r\n                        <Search className=\"absolute left-2 top-2.5 h-4 w-4 text-muted-foreground\" />\r\n                        <Input\r\n                            placeholder=\"Filtrar productos...\"\r\n                            value={searchTerm}\r\n                            onChange={(e) => setSearchTerm(e.target.value)}\r\n                            className=\"pl-8\"\r\n                        />\r\n                    </div>\r\n\r\n                    <div className=\"border rounded-md h-[400px] overflow-y-auto\">\r\n                        {filteredProducts.map(p => (\r\n                            <div\r\n                                key={p.id}\r\n                                className={`p-3 cursor-pointer hover:bg-muted transition-colors border-b last:border-0 ${selectedProductId === p.id ? 'bg-primary/20 border-l-4 border-l-primary' : ''}`}\r\n                                onClick={() => setSelectedProductId(p.id)}\r\n                            >\r\n                                <p className=\"font-medium text-sm\">{p.name}</p>\r\n                            </div>\r\n                        ))}\r\n                        {filteredProducts.length === 0 && (\r\n                            <div className=\"p-4 text-center text-muted-foreground text-sm\">No se encontraron productos</div>\r\n                        )}\r\n                    </div>\r\n                </CardContent>\r\n            </Card>\r\n\r\n            {/* Right Col: Recipe Editor */}\r\n            <Card className=\"lg:col-span-2\">\r\n                <CardHeader>\r\n                    <CardTitle>2. Composición de la Receta</CardTitle>\r\n                    <CardDescription>\r\n                        {selectedProductId\r\n                            ? `Editando receta para: ${currentProduct?.name}`\r\n                            : \"Selecciona un producto del listado para comenzar\"}\r\n                    </CardDescription>\r\n                </CardHeader>\r\n                <CardContent>\r\n                    {selectedProductId ? (\r\n                        <div className=\"space-y-6\">\r\n                            {/* Add Ingredient Form */}\r\n                            <div className=\"p-4 border rounded-lg bg-muted/20 space-y-4\">\r\n                                <h4 className=\"font-semibold flex items-center gap-2 text-sm text-foreground/80\">\r\n                                    <Calculator className=\"w-4 h-4\" /> Calculadora de Insumos\r\n                                </h4>\r\n                                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n                                    <div className=\"space-y-2\">\r\n                                        <Label>Ingrediente</Label>\r\n                                        <Select value={selectedIngredientId} onValueChange={setSelectedIngredientId}>\r\n                                            <SelectTrigger>\r\n                                                <SelectValue placeholder=\"Seleccionar insumo...\" />\r\n                                            </SelectTrigger>\r\n                                            <SelectContent className=\"max-h-[300px]\">\r\n                                                {ingredients.map(i => (\r\n                                                    <SelectItem key={i.id} value={i.id}>\r\n                                                        {i.name} ({i.unit})\r\n                                                    </SelectItem>\r\n                                                ))}\r\n                                            </SelectContent>\r\n                                        </Select>\r\n                                        {selectedIngredient && (\r\n                                            <p className=\"text-xs text-muted-foreground\">\r\n                                                Costo: ${selectedIngredient.cost}/{selectedIngredient.unit} | Merma: <span className=\"text-orange-500 font-bold\">{Number(selectedIngredient.lossPercentage)}%</span>\r\n                                            </p>\r\n                                        )}\r\n                                    </div>\r\n                                    <div className=\"space-y-2\">\r\n                                        <Label>Cantidad Neta (Lo que va en el plato)</Label>\r\n                                        <div className=\"flex items-center gap-2\">\r\n                                            <Input\r\n                                                type=\"number\"\r\n                                                placeholder=\"Ej: 100\"\r\n                                                value={netQuantity}\r\n                                                onChange={e => setNetQuantity(e.target.value)}\r\n                                            />\r\n                                            <span className=\"text-sm text-muted-foreground w-12 font-mono\">\r\n                                                {selectedIngredient?.unit || \"---\"}\r\n                                            </span>\r\n                                        </div>\r\n                                    </div>\r\n                                </div>\r\n\r\n                                {selectedIngredient && calculatedGross > 0 && (\r\n                                    <div className=\"flex flex-col sm:flex-row sm:items-center justify-between bg-background p-3 rounded border border-border mt-2 gap-4\">\r\n\r\n                                        <div className=\"grid grid-cols-2 gap-x-8 gap-y-1 text-sm\">\r\n                                            <div>\r\n                                                <span className=\"text-muted-foreground\">Cantidad Bruta:</span>\r\n                                                <p className=\"text-lg font-bold text-primary\">\r\n                                                    {calculatedGross.toFixed(3)} {selectedIngredient.unit}\r\n                                                </p>\r\n                                            </div>\r\n                                            <div>\r\n                                                <span className=\"text-muted-foreground\">Costo Estimado:</span>\r\n                                                <p className=\"font-mono font-medium\">\r\n                                                    ${(calculatedGross * Number(selectedIngredient.cost)).toLocaleString('es-CL', { maximumFractionDigits: 0 })}\r\n                                                </p>\r\n                                            </div>\r\n                                        </div>\r\n\r\n                                        <Button size=\"sm\" onClick={handleAddIngredient} disabled={calculatedGross <= 0}>\r\n                                            <Plus className=\"w-4 h-4 mr-2\" /> Agregar a Receta\r\n                                        </Button>\r\n                                    </div>\r\n                                )}\r\n                            </div>\r\n\r\n                            {/* Recipe Table */}\r\n                            <div className=\"border rounded-md\">\r\n                                <Table>\r\n                                    <TableHeader>\r\n                                        <TableRow>\r\n                                            <TableHead>Ingrediente</TableHead>\r\n                                            <TableHead className=\"text-right\">Cant. Bruta</TableHead>\r\n                                            <TableHead>Unidad</TableHead>\r\n                                            <TableHead className=\"text-right\">Costo Est.</TableHead>\r\n                                            <TableHead className=\"w-[50px]\"></TableHead>\r\n                                        </TableRow>\r\n                                    </TableHeader>\r\n                                    <TableBody>\r\n                                        {recipeItems.map(item => (\r\n                                            <TableRow key={item.id}>\r\n                                                <TableCell className=\"font-medium\">{item.ingredient.name}</TableCell>\r\n                                                <TableCell className=\"text-right font-mono\">{Number(item.quantity).toFixed(3)}</TableCell>\r\n                                                <TableCell className=\"text-muted-foreground text-xs\">{item.ingredient.unit}</TableCell>\r\n                                                <TableCell className=\"text-right\">\r\n                                                    ${(Number(item.quantity) * Number(item.ingredient.cost)).toLocaleString('es-CL', { maximumFractionDigits: 0 })}\r\n                                                </TableCell>\r\n                                                <TableCell>\r\n                                                    <Button variant=\"ghost\" size=\"icon\" onClick={() => handleRemoveIngredient(item.id)} className=\"h-8 w-8 text-muted-foreground hover:text-destructive\">\r\n                                                        <Trash className=\"w-4 h-4\" />\r\n                                                    </Button>\r\n                                                </TableCell>\r\n                                            </TableRow>\r\n                                        ))}\r\n                                        {recipeItems.length === 0 && (\r\n                                            <TableRow>\r\n                                                <TableCell colSpan={5} className=\"text-center text-muted-foreground py-8 h-32\">\r\n                                                    No hay ingredientes configurados.\r\n                                                </TableCell>\r\n                                            </TableRow>\r\n                                        )}\r\n\r\n                                    </TableBody>\r\n                                </Table>\r\n                                {recipeItems.length > 0 && (\r\n                                    <div className=\"p-4 bg-muted/50 border-t flex justify-between items-center\">\r\n                                        <span className=\"font-bold\">Costo Total Receta</span>\r\n                                        <span className=\"text-xl font-bold text-primary\">\r\n                                            ${totalRecipeCost.toLocaleString('es-CL', { maximumFractionDigits: 0 })}\r\n                                        </span>\r\n                                    </div>\r\n                                )}\r\n                            </div>\r\n                        </div>\r\n                    ) : (\r\n                        <div className=\"flex flex-col items-center justify-center h-[400px] text-muted-foreground border-2 border-dashed rounded-lg\">\r\n                            <Search className=\"w-12 h-12 mb-4 opacity-20\" />\r\n                            <p>Selecciona un producto de la lista izquierda</p>\r\n                            <p>para gestionar su receta.</p>\r\n                        </div>\r\n                    )}\r\n                </CardContent>\r\n            </Card>\r\n        </div>\r\n    )\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\rokat\\OneDrive\\Proyectos\\Akapoolco\\src\\app\\dashboard\\layout.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\rokat\\OneDrive\\Proyectos\\Akapoolco\\src\\app\\dashboard\\marketing\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\rokat\\OneDrive\\Proyectos\\Akapoolco\\src\\app\\dashboard\\members\\[id]\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\rokat\\OneDrive\\Proyectos\\Akapoolco\\src\\app\\dashboard\\members\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\rokat\\OneDrive\\Proyectos\\Akapoolco\\src\\app\\dashboard\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":55,"column":61,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":55,"endColumn":64,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2349,2352],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2349,2352],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { auth } from \"@/auth\"\r\nimport { redirect } from \"next/navigation\"\r\nimport { getDashboardStats, getActiveTablesSummary, getDebtorsWatchlist } from \"@/app/lib/actions-dashboard\"\r\nimport { StatCards } from \"@/components/dashboard/StatCards\"\r\nimport { QuickSaleWidget } from \"@/components/dashboard/QuickSaleWidget\"\r\nimport { ActiveTablesWidget } from \"@/components/dashboard/ActiveTablesWidget\"\r\nimport { DebtorsWidget } from \"@/components/dashboard/DebtorsWidget\"\r\n\r\nexport const dynamic = 'force-dynamic'\r\n\r\nexport default async function DashboardPage() {\r\n    const session = await auth()\r\n\r\n    if (!session) {\r\n        redirect(\"/login\")\r\n    }\r\n\r\n    // Parallel Data Fetching\r\n    const [stats, activeTables, debtors] = await Promise.all([\r\n        getDashboardStats(),\r\n        getActiveTablesSummary(),\r\n        getDebtorsWatchlist()\r\n    ])\r\n\r\n    return (\r\n        <div className=\"min-h-[calc(100vh-4rem)] p-4 md:p-6 flex flex-col bg-slate-950\">\r\n            {/* Header / Stats Row */}\r\n            <div className=\"mb-6 flex-shrink-0\">\r\n                <div className=\"flex justify-between items-center mb-4\">\r\n                    <div>\r\n                        <h1 className=\"text-3xl font-bold bg-gradient-to-r from-emerald-400 to-blue-500 bg-clip-text text-transparent\">\r\n                            Panel Principal\r\n                        </h1>\r\n                        <p className=\"text-slate-400\">Bienvenido, {session.user?.name}</p>\r\n                    </div>\r\n                    <div className=\"text-right hidden md:block\">\r\n                        <div className=\"text-xs text-slate-500 uppercase tracking-widest font-semibold\">Club Santiago</div>\r\n                        <div className=\"text-sm text-emerald-500\">Sistema Operativo</div>\r\n                    </div>\r\n                </div>\r\n\r\n                <StatCards stats={stats} />\r\n            </div>\r\n\r\n            {/* Main Content Grid */}\r\n            <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 lg:gap-6\">\r\n\r\n                {/* 1. Active Tables */}\r\n                <div className=\"h-full\">\r\n                    <ActiveTablesWidget tables={activeTables} />\r\n                </div>\r\n\r\n                {/* 2. Debtors (Cobranza) */}\r\n                <div className=\"h-full\">\r\n                    <DebtorsWidget debtors={debtors.map((d: any) => ({ ...d, currentDebt: Number(d.currentDebt) }))} />\r\n                </div>\r\n\r\n                {/* 3. Quick Sale (POS) */}\r\n                <div className=\"h-full\">\r\n                    <QuickSaleWidget />\r\n                </div>\r\n            </div>\r\n        </div>\r\n    )\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\rokat\\OneDrive\\Proyectos\\Akapoolco\\src\\app\\dashboard\\print-queue\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\rokat\\OneDrive\\Proyectos\\Akapoolco\\src\\app\\dashboard\\products\\page.tsx","messages":[],"suppressedMessages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":34,"column":72,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":34,"endColumn":75,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1411,1414],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1411,1414],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\rokat\\OneDrive\\Proyectos\\Akapoolco\\src\\app\\dashboard\\products\\product-dialog.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":75,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":75,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3018,3021],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3018,3021],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\"\r\n\r\nimport { useState, useEffect } from \"react\"\r\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogFooter } from \"@/components/ui/dialog\"\r\nimport { Button } from \"@/components/ui/button\"\r\nimport { Input } from \"@/components/ui/input\"\r\nimport { Label } from \"@/components/ui/label\"\r\nimport { Switch } from \"@/components/ui/switch\"\r\nimport { createProduct, updateProduct } from \"@/app/lib/actions-products\"\r\nimport { toast } from \"sonner\"\r\nimport { Product } from \"@prisma/client\"\r\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\"\r\n\r\ninterface ProductDialogProps {\r\n    open: boolean\r\n    onOpenChange: (open: boolean) => void\r\n    productToEdit?: Product | null\r\n}\r\n\r\nconst CATEGORIES = [\"Bebidas\", \"Licores\", \"Cervezas\", \"Cocina\", \"Snacks\", \"Otros\"]\r\n\r\nexport function ProductDialog({ open, onOpenChange, productToEdit }: ProductDialogProps) {\r\n    const [isLoading, setIsLoading] = useState(false)\r\n    const [formData, setFormData] = useState({\r\n        name: \"\",\r\n        category: \"Bebidas\",\r\n        priceMember: 0,\r\n        priceClient: 0,\r\n        stockControl: false,\r\n        stock: 0\r\n    })\r\n\r\n    useEffect(() => {\r\n        if (productToEdit) {\r\n            setFormData({\r\n                name: productToEdit.name,\r\n                category: productToEdit.category || \"Otros\",\r\n                priceMember: Number(productToEdit.priceMember),\r\n                priceClient: Number(productToEdit.priceClient),\r\n                stockControl: productToEdit.stockControl,\r\n                stock: productToEdit.stock\r\n            })\r\n        } else {\r\n            setFormData({\r\n                name: \"\",\r\n                category: \"Bebidas\",\r\n                priceMember: 0,\r\n                priceClient: 0,\r\n                stockControl: false,\r\n                stock: 0\r\n            })\r\n        }\r\n    }, [productToEdit, open])\r\n\r\n    const handleSubmit = async (e: React.FormEvent) => {\r\n        e.preventDefault()\r\n        setIsLoading(true)\r\n\r\n        try {\r\n            if (productToEdit) {\r\n                const result = await updateProduct(productToEdit.id, {\r\n                    ...formData,\r\n                    stockControl: formData.stockControl // We don't update 'stock' directly here, only control flag. Stock is via adjustments usually, but let's allow basic edits? No, strict stock usually.\r\n                    // But if toggling stockControl ON, we might want to set initial.\r\n                    // Implementation Plan said: \"Product creation/update with stock_control\".\r\n                })\r\n                if (result.error) throw new Error(result.error)\r\n                toast.success(\"Producto actualizado exitosamente\")\r\n            } else {\r\n                const result = await createProduct(formData)\r\n                if (result.error) throw new Error(result.error)\r\n                toast.success(\"Producto creado exitosamente\")\r\n            }\r\n            onOpenChange(false)\r\n        } catch (error: any) {\r\n            toast.error(error.message)\r\n        } finally {\r\n            setIsLoading(false)\r\n        }\r\n    }\r\n\r\n    return (\r\n        <Dialog open={open} onOpenChange={onOpenChange}>\r\n            <DialogContent className=\"bg-slate-950 border-white/10 text-white sm:max-w-[425px]\">\r\n                <DialogHeader>\r\n                    <DialogTitle>{productToEdit ? \"Editar Producto\" : \"Nuevo Producto\"}</DialogTitle>\r\n                </DialogHeader>\r\n                <form onSubmit={handleSubmit} className=\"space-y-4 py-4\">\r\n                    <div className=\"grid gap-2\">\r\n                        <Label htmlFor=\"name\">Nombre</Label>\r\n                        <Input\r\n                            id=\"name\"\r\n                            value={formData.name}\r\n                            onChange={e => setFormData({ ...formData, name: e.target.value })}\r\n                            className=\"bg-black/20 border-white/10\"\r\n                            required\r\n                        />\r\n                    </div>\r\n                    <div className=\"grid gap-2\">\r\n                        <Label htmlFor=\"category\">Categoría</Label>\r\n                        <Select\r\n                            value={formData.category}\r\n                            onValueChange={(val) => setFormData({ ...formData, category: val })}\r\n                        >\r\n                            <SelectTrigger className=\"bg-black/20 border-white/10\">\r\n                                <SelectValue placeholder=\"Seleccionar\" />\r\n                            </SelectTrigger>\r\n                            <SelectContent className=\"bg-slate-900 border-white/10 text-white\">\r\n                                {CATEGORIES.map(cat => (\r\n                                    <SelectItem key={cat} value={cat}>{cat}</SelectItem>\r\n                                ))}\r\n                            </SelectContent>\r\n                        </Select>\r\n                    </div>\r\n                    <div className=\"grid grid-cols-2 gap-4\">\r\n                        <div className=\"grid gap-2\">\r\n                            <Label htmlFor=\"priceMember\">Precio Socio</Label>\r\n                            <Input\r\n                                id=\"priceMember\"\r\n                                type=\"number\"\r\n                                value={formData.priceMember}\r\n                                onChange={e => setFormData({ ...formData, priceMember: Number(e.target.value) })}\r\n                                className=\"bg-black/20 border-white/10\"\r\n                                min={0}\r\n                            />\r\n                        </div>\r\n                        <div className=\"grid gap-2\">\r\n                            <Label htmlFor=\"priceClient\">Precio Cliente</Label>\r\n                            <Input\r\n                                id=\"priceClient\"\r\n                                type=\"number\"\r\n                                value={formData.priceClient}\r\n                                onChange={e => setFormData({ ...formData, priceClient: Number(e.target.value) })}\r\n                                className=\"bg-black/20 border-white/10\"\r\n                                min={0}\r\n                            />\r\n                        </div>\r\n                    </div>\r\n\r\n                    <div className=\"flex items-center justify-between rounded-lg border border-white/10 p-3 bg-white/5\">\r\n                        <div className=\"space-y-0.5\">\r\n                            <Label className=\"text-base\">Control de Stock</Label>\r\n                            <div className=\"text-sm text-muted-foreground\">\r\n                                Habilitar inventario\r\n                            </div>\r\n                        </div>\r\n                        <Switch\r\n                            checked={formData.stockControl}\r\n                            onCheckedChange={(checked) => setFormData({ ...formData, stockControl: checked })}\r\n                        />\r\n                    </div>\r\n\r\n                    {((formData.stockControl && !productToEdit) || (formData.stockControl && productToEdit && !productToEdit.stockControl)) && (\r\n                        /* Show initial stock input ONLY if creating NEW product OR enabling stock control for first time */\r\n                        <div className=\"grid gap-2 animate-in fade-in slide-in-from-top-2\">\r\n                            <Label htmlFor=\"stock\">Stock Inicial</Label>\r\n                            <Input\r\n                                id=\"stock\"\r\n                                type=\"number\"\r\n                                value={formData.stock}\r\n                                onChange={e => setFormData({ ...formData, stock: Number(e.target.value) })}\r\n                                className=\"bg-black/20 border-white/10\"\r\n                                min={0}\r\n                            />\r\n                        </div>\r\n                    )}\r\n\r\n                    <DialogFooter>\r\n                        <Button type=\"submit\" disabled={isLoading} className=\"w-full bg-primary hover:bg-primary/90 text-primary-foreground\">\r\n                            {isLoading ? \"Guardando...\" : \"Guardar\"}\r\n                        </Button>\r\n                    </DialogFooter>\r\n                </form>\r\n            </DialogContent>\r\n        </Dialog>\r\n    )\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\rokat\\OneDrive\\Proyectos\\Akapoolco\\src\\app\\dashboard\\products\\products-client.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'products' is assigned a value but never used.","line":33,"column":12,"nodeType":"Identifier","messageId":"unusedVar","endLine":33,"endColumn":20}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\"\r\n\r\nimport { useState } from \"react\"\r\nimport { Product, StockMovement } from \"@prisma/client\"\r\nimport { Button } from \"@/components/ui/button\"\r\nimport { Input } from \"@/components/ui/input\"\r\nimport {\r\n    Table,\r\n    TableBody,\r\n    TableCell,\r\n    TableHead,\r\n    TableHeader,\r\n    TableRow\r\n} from \"@/components/ui/table\"\r\nimport { Plus, Search, Edit, ArrowRightLeft } from \"lucide-react\"\r\nimport { Badge } from \"@/components/ui/badge\"\r\nimport { ProductDialog } from \"./product-dialog\"\r\nimport { StockDialog } from \"./stock-dialog\"\r\n\r\n// Extended Product interface for Client Side (numbers instead of Decimal)\r\ninterface ClientProduct extends Omit<Product, 'priceMember' | 'priceClient'> {\r\n    priceMember: number\r\n    priceClient: number\r\n    stockMovements: StockMovement[]\r\n}\r\n\r\ninterface ProductsClientProps {\r\n    initialProducts: ClientProduct[]\r\n}\r\n\r\nexport function ProductsClient({ initialProducts }: ProductsClientProps) {\r\n    const [searchTerm, setSearchTerm] = useState(\"\")\r\n    const [products] = useState(initialProducts)\r\n\r\n    const [isCreateOpen, setIsCreateOpen] = useState(false)\r\n    const [isStockOpen, setIsStockOpen] = useState(false)\r\n    const [selectedProduct, setSelectedProduct] = useState<ClientProduct | null>(null)\r\n    const [editingProduct, setEditingProduct] = useState<ClientProduct | null>(null)\r\n\r\n    const filteredProducts = initialProducts.filter(p =>\r\n        p.name.toLowerCase().includes(searchTerm.toLowerCase()) ||\r\n        (p.category && p.category.toLowerCase().includes(searchTerm.toLowerCase()))\r\n    )\r\n\r\n    return (\r\n        <div className=\"space-y-4\">\r\n            <div className=\"flex items-center justify-between\">\r\n                <div className=\"relative w-72\">\r\n                    <Search className=\"absolute left-2 top-2.5 h-4 w-4 text-muted-foreground\" />\r\n                    <Input\r\n                        placeholder=\"Buscar productos...\"\r\n                        className=\"pl-8 bg-black/20 border-white/10 text-white\"\r\n                        value={searchTerm}\r\n                        onChange={(e) => setSearchTerm(e.target.value)}\r\n                    />\r\n                </div>\r\n                <Button onClick={() => setIsCreateOpen(true)} className=\"bg-primary hover:bg-primary/90 text-primary-foreground\">\r\n                    <Plus className=\"mr-2 h-4 w-4\" /> Nuevo Producto\r\n                </Button>\r\n            </div>\r\n\r\n            <div className=\"rounded-md border border-white/10 bg-black/20 backdrop-blur-sm\">\r\n                <Table>\r\n                    <TableHeader>\r\n                        <TableRow className=\"border-white/10 hover:bg-white/5\">\r\n                            <TableHead className=\"text-gray-400\">Nombre</TableHead>\r\n                            <TableHead className=\"text-gray-400\">Categoría</TableHead>\r\n                            <TableHead className=\"text-gray-400 text-right\">Precio Socio</TableHead>\r\n                            <TableHead className=\"text-gray-400 text-right\">Precio Cliente</TableHead>\r\n                            <TableHead className=\"text-gray-400 text-center\">Stock</TableHead>\r\n                            <TableHead className=\"text-gray-400 text-right\">Acciones</TableHead>\r\n                        </TableRow>\r\n                    </TableHeader>\r\n                    <TableBody>\r\n                        {filteredProducts.map((product) => (\r\n                            <TableRow key={product.id} className=\"border-white/10 hover:bg-white/5\">\r\n                                <TableCell className=\"font-medium text-white\">{product.name}</TableCell>\r\n                                <TableCell className=\"text-gray-300\">{product.category || \"-\"}</TableCell>\r\n                                <TableCell className=\"text-right text-emerald-400 font-mono\">\r\n                                    ${product.priceMember.toLocaleString('es-CL')}\r\n                                </TableCell>\r\n                                <TableCell className=\"text-right text-blue-400 font-mono\">\r\n                                    ${product.priceClient.toLocaleString('es-CL')}\r\n                                </TableCell>\r\n                                <TableCell className=\"text-center\">\r\n                                    {product.stockControl ? (\r\n                                        <Badge\r\n                                            variant={product.stock < 10 ? \"destructive\" : \"secondary\"}\r\n                                            className={product.stock < 10 ? \"bg-red-900/50 text-red-200\" : \"bg-emerald-900/30 text-emerald-200\"}\r\n                                        >\r\n                                            {product.stock}\r\n                                        </Badge>\r\n                                    ) : (\r\n                                        <span className=\"text-muted-foreground text-xs\">N/A</span>\r\n                                    )}\r\n                                </TableCell>\r\n                                <TableCell className=\"text-right flex justify-end gap-2\">\r\n                                    {product.stockControl && (\r\n                                        <Button\r\n                                            variant=\"ghost\"\r\n                                            size=\"icon\"\r\n                                            className=\"h-8 w-8 text-yellow-400 hover:text-yellow-300 hover:bg-yellow-900/20\"\r\n                                            title=\"Ajuste de Stock\"\r\n                                            onClick={() => {\r\n                                                setSelectedProduct(product)\r\n                                                setIsStockOpen(true)\r\n                                            }}\r\n                                        >\r\n                                            <ArrowRightLeft className=\"h-4 w-4\" />\r\n                                        </Button>\r\n                                    )}\r\n                                    <Button\r\n                                        variant=\"ghost\"\r\n                                        size=\"icon\"\r\n                                        className=\"h-8 w-8 text-blue-400 hover:text-blue-300 hover:bg-blue-900/20\"\r\n                                        title=\"Editar\"\r\n                                        onClick={() => {\r\n                                            setEditingProduct(product)\r\n                                            setIsCreateOpen(true)\r\n                                        }}\r\n                                    >\r\n                                        <Edit className=\"h-4 w-4\" />\r\n                                    </Button>\r\n                                </TableCell>\r\n                            </TableRow>\r\n                        ))}\r\n                    </TableBody>\r\n                </Table>\r\n            </div>\r\n\r\n            <ProductDialog\r\n                open={isCreateOpen}\r\n                onOpenChange={(open) => {\r\n                    setIsCreateOpen(open)\r\n                    if (!open) setEditingProduct(null)\r\n                }}\r\n                productToEdit={editingProduct as unknown as Product}\r\n            />\r\n\r\n            {selectedProduct && (\r\n                <StockDialog\r\n                    open={isStockOpen}\r\n                    onOpenChange={(open) => {\r\n                        setIsStockOpen(open)\r\n                        if (!open) setSelectedProduct(null)\r\n                    }}\r\n                    product={selectedProduct as unknown as Product}\r\n                />\r\n            )}\r\n        </div>\r\n    )\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\rokat\\OneDrive\\Proyectos\\Akapoolco\\src\\app\\dashboard\\products\\stock-dialog.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":70,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":70,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2750,2753],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2750,2753],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":88,"column":50,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":88,"endColumn":53,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3499,3502],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3499,3502],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\"\r\n\r\nimport { useState } from \"react\"\r\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogFooter } from \"@/components/ui/dialog\"\r\nimport { Button } from \"@/components/ui/button\"\r\nimport { Input } from \"@/components/ui/input\"\r\nimport { Label } from \"@/components/ui/label\"\r\nimport { adjustStock } from \"@/app/lib/actions-products\"\r\nimport { toast } from \"sonner\"\r\nimport { Product } from \"@prisma/client\"\r\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\"\r\nimport { useSession } from \"next-auth/react\"\r\n\r\ninterface StockDialogProps {\r\n    open: boolean\r\n    onOpenChange: (open: boolean) => void\r\n    product: Product\r\n}\r\n\r\nexport function StockDialog({ open, onOpenChange, product }: StockDialogProps) {\r\n    const { data: session } = useSession()\r\n    const [isLoading, setIsLoading] = useState(false)\r\n    const [type, setType] = useState<\"PURCHASE\" | \"ADJUSTMENT\" | \"RETURN\">(\"PURCHASE\")\r\n    const [quantity, setQuantity] = useState(0)\r\n    const [reason, setReason] = useState(\"\")\r\n\r\n    const handleSubmit = async (e: React.FormEvent) => {\r\n        e.preventDefault()\r\n        if (!session?.user?.id) {\r\n            toast.error(\"Usuario no identificado\")\r\n            return\r\n        }\r\n        setIsLoading(true)\r\n\r\n        try {\r\n            // Logic for quantity direction\r\n            // PURCHASE: +\r\n            // RETURN: +\r\n            // ADJUSTMENT: User enters signed value? Or we provide UI for Add/Remove?\r\n            // Let's assume user enters absolute quantity and selects Add/Remove for Adjustment, OR just enters signed.\r\n            // For simplicity, let's treat PURCHASE/RETURN as additions.\r\n            // For ADJUSTMENT, let's trust the input (can be negative).\r\n\r\n            // Wait, UI for \"Ajuste\" usually implies correction.\r\n            // Let's make it simpler:\r\n            // Type PURCHASE -> Add\r\n            // Type RETURN -> Add\r\n            // Type ADJUSTMENT -> Add (if positive) or Remove (if negative in input)\r\n\r\n            // Actually, best to strictly follow \"Movement Type\".\r\n            // PURCHASE is always (+).\r\n            // RETURN is always (+).\r\n            // ADJUSTMENT could be (+/-).\r\n\r\n            const finalQty = quantity // Assuming user types negative for negative adjustment\r\n\r\n            const result = await adjustStock(\r\n                product.id,\r\n                finalQty,\r\n                type,\r\n                reason,\r\n                session.user.id\r\n            )\r\n\r\n            if (result.error) throw new Error(result.error)\r\n            toast.success(\"Movimiento registrado\")\r\n            onOpenChange(false)\r\n            setQuantity(0)\r\n            setReason(\"\")\r\n        } catch (error: any) {\r\n            toast.error(error.message)\r\n        } finally {\r\n            setIsLoading(false)\r\n        }\r\n    }\r\n\r\n    return (\r\n        <Dialog open={open} onOpenChange={onOpenChange}>\r\n            <DialogContent className=\"bg-slate-950 border-white/10 text-white sm:max-w-[425px]\">\r\n                <DialogHeader>\r\n                    <DialogTitle>Movimiento de Stock: {product.name}</DialogTitle>\r\n                </DialogHeader>\r\n                <form onSubmit={handleSubmit} className=\"space-y-4 py-4\">\r\n                    <div className=\"grid gap-2\">\r\n                        <Label>Tipo de Movimiento</Label>\r\n                        <Select\r\n                            value={type}\r\n                            onValueChange={(val: any) => setType(val)}\r\n                        >\r\n                            <SelectTrigger className=\"bg-black/20 border-white/10\">\r\n                                <SelectValue />\r\n                            </SelectTrigger>\r\n                            <SelectContent className=\"bg-slate-900 border-white/10 text-white\">\r\n                                <SelectItem value=\"PURCHASE\">Compra (Ingreso)</SelectItem>\r\n                                <SelectItem value=\"RETURN\">Devolución (Reingreso)</SelectItem>\r\n                                <SelectItem value=\"ADJUSTMENT\">Ajuste (Manual)</SelectItem>\r\n                            </SelectContent>\r\n                        </Select>\r\n                    </div>\r\n\r\n                    <div className=\"grid gap-2\">\r\n                        <Label htmlFor=\"quantity\">\r\n                            Cantidad\r\n                            {type === 'ADJUSTMENT' && <span className=\"text-xs text-muted-foreground ml-2\">(Usar negativo para restar)</span>}\r\n                        </Label>\r\n                        <Input\r\n                            id=\"quantity\"\r\n                            type=\"number\"\r\n                            value={quantity}\r\n                            onChange={e => setQuantity(Number(e.target.value))}\r\n                            className=\"bg-black/20 border-white/10\"\r\n                            required\r\n                        />\r\n                    </div>\r\n\r\n                    <div className=\"grid gap-2\">\r\n                        <Label htmlFor=\"reason\">Razón / Comentario</Label>\r\n                        <Input\r\n                            id=\"reason\"\r\n                            value={reason}\r\n                            onChange={e => setReason(e.target.value)}\r\n                            className=\"bg-black/20 border-white/10\"\r\n                            placeholder=\"Ej. Factura 123, Contéo mensual...\"\r\n                        />\r\n                    </div>\r\n\r\n                    <DialogFooter>\r\n                        <Button type=\"submit\" disabled={isLoading} className=\"w-full bg-primary hover:bg-primary/90 text-primary-foreground\">\r\n                            {isLoading ? \"Procesando...\" : \"Confirmar Movimiento\"}\r\n                        </Button>\r\n                    </DialogFooter>\r\n                </form>\r\n            </DialogContent>\r\n        </Dialog>\r\n    )\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\rokat\\OneDrive\\Proyectos\\Akapoolco\\src\\app\\dashboard\\referee\\[sessionId]\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\rokat\\OneDrive\\Proyectos\\Akapoolco\\src\\app\\dashboard\\referee\\layout.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\rokat\\OneDrive\\Proyectos\\Akapoolco\\src\\app\\dashboard\\referee\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Users' is defined but never used.","line":6,"column":20,"nodeType":"Identifier","messageId":"unusedVar","endLine":6,"endColumn":25,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"Users"},"fix":{"range":[285,292],"text":""},"desc":"Remove unused variable \"Users\"."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { prisma } from \"@/lib/prisma\";\r\nimport Link from \"next/link\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { Card, CardContent, CardHeader, CardTitle, CardDescription } from \"@/components/ui/card\";\r\nimport { Badge } from \"@/components/ui/badge\";\r\nimport { Gamepad2, Users, Clock, ArrowRight } from \"lucide-react\";\r\n\r\nexport const dynamic = 'force-dynamic';\r\n\r\nexport default async function RefereeDashboardPage() {\r\n    // Fetch active sessions\r\n    // We prioritize sessions with status 'ACTIVE'\r\n    const activeSessions = await prisma.session.findMany({\r\n        where: {\r\n            status: 'ACTIVE',\r\n            endTime: null,\r\n            // You might want to filter specific table types or tournament info here\r\n        },\r\n        include: {\r\n            table: true,\r\n            sessionPlayers: {\r\n                include: {\r\n                    member: true,\r\n                    user: true\r\n                }\r\n            }\r\n        },\r\n        orderBy: {\r\n            startTime: 'desc'\r\n        }\r\n    });\r\n\r\n    return (\r\n        <div className=\"flex-1 overflow-auto p-8\">\r\n            <header className=\"mb-8 flex justify-between items-center\">\r\n                <div>\r\n                    <h1 className=\"text-3xl font-black uppercase tracking-tight text-white mb-2\">Panel de Juez</h1>\r\n                    <p className=\"text-zinc-400\">Seleccione un partido activo para arbitrar</p>\r\n                </div>\r\n            </header>\r\n\r\n            {activeSessions.length === 0 ? (\r\n                <div className=\"flex flex-col items-center justify-center p-12 border border-dashed border-zinc-800 rounded-2xl bg-zinc-900/20\">\r\n                    <Gamepad2 className=\"w-16 h-16 text-zinc-700 mb-4\" />\r\n                    <h3 className=\"text-xl font-bold text-zinc-500\">No hay partidos activos</h3>\r\n                    <p className=\"text-zinc-600 mt-2\">Los partidos iniciados aparecerán aquí</p>\r\n                </div>\r\n            ) : (\r\n                <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6\">\r\n                    {activeSessions.map((session) => {\r\n                        const p1 = session.sessionPlayers[0];\r\n                        const p2 = session.sessionPlayers[1];\r\n                        const p1Name = p1?.member?.name || p1?.user?.name || p1?.guestName || \"Jugador 1\";\r\n                        const p2Name = p2?.member?.name || p2?.user?.name || p2?.guestName || \"Jugador 2\";\r\n\r\n                        return (\r\n                            <Link key={session.id} href={`/dashboard/referee/${session.id}`}>\r\n                                <Card className=\"bg-zinc-900 border-zinc-800 hover:border-emerald-500/50 hover:bg-zinc-900/80 transition-all cursor-pointer group\">\r\n                                    <CardHeader className=\"pb-3 border-b border-zinc-800/50\">\r\n                                        <div className=\"flex justify-between items-start\">\r\n                                            <Badge variant=\"outline\" className=\"bg-zinc-950 border-zinc-700 text-zinc-400\">\r\n                                                {session.table.name}\r\n                                            </Badge>\r\n                                            {/* We could check if it has gameState active */}\r\n                                            {session.gameState && (\r\n                                                <Badge className=\"bg-emerald-900/50 text-emerald-400 border-emerald-800 hover:bg-emerald-900\">\r\n                                                    EN JUEGO\r\n                                                </Badge>\r\n                                            )}\r\n                                        </div>\r\n                                        <CardTitle className=\"mt-4 text-xl font-bold text-white flex gap-2 items-center\">\r\n                                            <span className=\"truncate flex-1 text-right\">{p1Name.split(' ')[0]}</span>\r\n                                            <span className=\"text-zinc-600 font-black text-sm\">VS</span>\r\n                                            <span className=\"truncate flex-1\">{p2Name.split(' ')[0]}</span>\r\n                                        </CardTitle>\r\n                                        <CardDescription className=\"text-zinc-500 text-xs uppercase font-mono mt-1 text-center\">\r\n                                            {session.table.type}\r\n                                        </CardDescription>\r\n                                    </CardHeader>\r\n                                    <CardContent className=\"pt-4 flex items-center justify-between\">\r\n                                        <div className=\"flex items-center text-zinc-500 text-sm gap-2\">\r\n                                            <Clock className=\"w-4 h-4\" />\r\n                                            <span>\r\n                                                {new Date(session.startTime).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })}\r\n                                            </span>\r\n                                        </div>\r\n                                        <Button size=\"sm\" className=\"opacity-0 group-hover:opacity-100 transition-opacity bg-emerald-600 text-white hover:bg-emerald-500\">\r\n                                            Arbitrar <ArrowRight className=\"w-4 h-4 ml-1\" />\r\n                                        </Button>\r\n                                    </CardContent>\r\n                                </Card>\r\n                            </Link>\r\n                        );\r\n                    })}\r\n                </div>\r\n            )}\r\n        </div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\rokat\\OneDrive\\Proyectos\\Akapoolco\\src\\app\\dashboard\\shifts\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\rokat\\OneDrive\\Proyectos\\Akapoolco\\src\\app\\dashboard\\shifts\\shift-client.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'useEffect' is defined but never used.","line":3,"column":20,"nodeType":"Identifier","messageId":"unusedVar","endLine":3,"endColumn":29,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"useEffect"},"fix":{"range":[33,44],"text":""},"desc":"Remove unused variable \"useEffect\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'History' is defined but never used.","line":10,"column":36,"nodeType":"Identifier","messageId":"unusedVar","endLine":10,"endColumn":43,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"History"},"fix":{"range":[468,477],"text":""},"desc":"Remove unused variable \"History\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'CreditCard' is defined but never used.","line":10,"column":45,"nodeType":"Identifier","messageId":"unusedVar","endLine":10,"endColumn":55,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"CreditCard"},"fix":{"range":[477,489],"text":""},"desc":"Remove unused variable \"CreditCard\"."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":30,"column":12,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":30,"endColumn":15,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1069,1072],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1069,1072],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":53,"column":31,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":53,"endColumn":34,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1912,1915],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1912,1915],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":69,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":69,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2402,2405],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2402,2405],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":89,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":89,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3115,3118],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3115,3118],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":4,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\"\r\n\r\nimport { useState, useEffect } from \"react\"\r\nimport { Button } from \"@/components/ui/button\"\r\nimport { Input } from \"@/components/ui/input\"\r\nimport { Label } from \"@/components/ui/label\"\r\nimport { Card, CardContent, CardDescription, CardFooter, CardHeader, CardTitle } from \"@/components/ui/card\"\r\nimport { openShift, closeShift, getActiveShiftDetails } from \"@/app/lib/actions-shifts\"\r\nimport { toast } from \"sonner\"\r\nimport { Lock, Unlock, DollarSign, History, CreditCard, Users, Banknote } from \"lucide-react\"\r\nimport { DebtPaymentDialog } from \"@/components/shifts/DebtPaymentDialog\"\r\nimport { MembershipPaymentDialog } from \"@/components/shifts/MembershipPaymentDialog\"\r\nimport { useRouter } from \"next/navigation\"\r\nimport { Separator } from \"@/components/ui/separator\"\r\n\r\ninterface ShiftSummary {\r\n    total: number\r\n    cash: number\r\n    card: number\r\n    transfer: number\r\n    byType: {\r\n        CONSUMPTION: number\r\n        DEBT_PAYMENT: number\r\n        MEMBERSHIP: number\r\n    }\r\n    salesCount: number\r\n}\r\n\r\ninterface ShiftData {\r\n    shift: any\r\n    summary: ShiftSummary\r\n}\r\n\r\ninterface ShiftClientProps {\r\n    initialData: ShiftData | null\r\n    userId: string\r\n}\r\n\r\nexport function ShiftClient({ initialData, userId }: ShiftClientProps) {\r\n    const router = useRouter();\r\n    const [data, setData] = useState<ShiftData | null>(initialData)\r\n    const [isLoading, setIsLoading] = useState(false)\r\n    const [amount, setAmount] = useState<string>(\"\")\r\n\r\n    // Dialog States\r\n    const [showDebtDialog, setShowDebtDialog] = useState(false);\r\n    const [showMembershipDialog, setShowMembershipDialog] = useState(false);\r\n\r\n    const refreshData = async () => {\r\n        const result = await getActiveShiftDetails();\r\n        if (result) {\r\n            // Re-serialize strictly for state match if needed, but JS handles numbers fine usually from actions\r\n            setData(result as any);\r\n        } else {\r\n            setData(null);\r\n        }\r\n    };\r\n\r\n    const handleOpenShift = async () => {\r\n        if (!amount) return toast.error(\"Ingrese monto inicial\")\r\n        setIsLoading(true)\r\n        try {\r\n            const res = await openShift(userId, Number(amount))\r\n            if (res.error) throw new Error(res.error)\r\n\r\n            toast.success(\"Turno abierto exitosamente\")\r\n            await refreshData();\r\n            setAmount(\"\")\r\n        } catch (error: any) {\r\n            toast.error(error.message || \"Error al abrir turno\")\r\n        } finally {\r\n            setIsLoading(false)\r\n        }\r\n    }\r\n\r\n    const handleCloseShift = async () => {\r\n        if (!data?.shift) return;\r\n        if (!amount) return toast.error(\"Ingrese monto final (Arqueo)\")\r\n        if (!confirm(\"¿Está seguro de cerrar el turno?\")) return\r\n\r\n        setIsLoading(true)\r\n        try {\r\n            const res = await closeShift(data.shift.id, userId, Number(amount))\r\n            if (res.error) throw new Error(res.error)\r\n            toast.success(\"Turno cerrado exitosamente\")\r\n            setData(null)\r\n            setAmount(\"\")\r\n            router.refresh();\r\n        } catch (error: any) {\r\n            toast.error(error.message || \"Error al cerrar turno\")\r\n        } finally {\r\n            setIsLoading(false)\r\n        }\r\n    }\r\n\r\n    if (data?.shift) {\r\n        const { shift, summary } = data;\r\n\r\n        return (\r\n            <div className=\"space-y-6\">\r\n                {/* Active Shift Header & Actions */}\r\n                <div className=\"grid gap-6 md:grid-cols-2 lg:grid-cols-3\">\r\n\r\n                    {/* Main Control Card */}\r\n                    <Card className=\"bg-slate-950 border-emerald-900/50 md:col-span-2 lg:col-span-1\">\r\n                        <CardHeader>\r\n                            <CardTitle className=\"flex items-center text-emerald-400\">\r\n                                <Unlock className=\"w-5 h-5 mr-2\" />\r\n                                Turno Activo\r\n                            </CardTitle>\r\n                            <CardDescription>\r\n                                Apertura: {new Date(shift.openedAt).toLocaleString()}\r\n                            </CardDescription>\r\n                        </CardHeader>\r\n                        <CardContent className=\"space-y-4\">\r\n                            <div className=\"flex justify-between items-center p-3 bg-slate-900/50 rounded border border-white/5\">\r\n                                <span className=\"text-slate-400\">Fondo Inicial</span>\r\n                                <span className=\"text-lg font-mono font-bold text-white\">${Number(shift.initialAmount).toLocaleString()}</span>\r\n                            </div>\r\n\r\n                            <div className=\"grid grid-cols-2 gap-2 text-sm\">\r\n                                <div className=\"p-2 bg-slate-900 rounded\">\r\n                                    <div className=\"text-xs text-slate-500\">Efectivo (Ventas)</div>\r\n                                    <div className=\"font-bold text-green-400\">${summary.cash.toLocaleString()}</div>\r\n                                </div>\r\n                                <div className=\"p-2 bg-slate-900 rounded\">\r\n                                    <div className=\"text-xs text-slate-500\">Total (Ventas)</div>\r\n                                    <div className=\"font-bold text-white\">${summary.total.toLocaleString()}</div>\r\n                                </div>\r\n                            </div>\r\n\r\n                            <Separator className=\"bg-white/10\" />\r\n\r\n                            <div className=\"space-y-2\">\r\n                                <Label>Arqueo de Cierre</Label>\r\n                                <div className=\"relative\">\r\n                                    <DollarSign className=\"absolute left-3 top-2.5 h-4 w-4 text-muted-foreground\" />\r\n                                    <Input\r\n                                        type=\"number\"\r\n                                        placeholder=\"Efectivo real en caja...\"\r\n                                        className=\"pl-9 bg-black/20 border-white/10\"\r\n                                        value={amount}\r\n                                        onChange={(e) => setAmount(e.target.value)}\r\n                                    />\r\n                                </div>\r\n                            </div>\r\n                        </CardContent>\r\n                        <CardFooter>\r\n                            <Button\r\n                                className=\"w-full bg-red-900 hover:bg-red-800 text-white\"\r\n                                onClick={handleCloseShift}\r\n                                disabled={isLoading}\r\n                            >\r\n                                <Lock className=\"w-4 h-4 mr-2\" />\r\n                                Cerrar Turno (Z)\r\n                            </Button>\r\n                        </CardFooter>\r\n                    </Card>\r\n\r\n                    {/* Quick Actions & Breakdown */}\r\n                    <div className=\"md:col-span-2 space-y-4\">\r\n                        <div className=\"grid grid-cols-2 gap-4\">\r\n                            <Button\r\n                                variant=\"outline\"\r\n                                className=\"h-20 flex flex-col gap-2 border-white/10 hover:bg-white/5 hover:border-emerald-500/50\"\r\n                                onClick={() => setShowDebtDialog(true)}\r\n                            >\r\n                                <Banknote className=\"h-6 w-6 text-emerald-400\" />\r\n                                <span>Pagar Deuda</span>\r\n                            </Button>\r\n                            <Button\r\n                                variant=\"outline\"\r\n                                className=\"h-20 flex flex-col gap-2 border-white/10 hover:bg-white/5 hover:border-blue-500/50\"\r\n                                onClick={() => setShowMembershipDialog(true)}\r\n                            >\r\n                                <Users className=\"h-6 w-6 text-blue-400\" />\r\n                                <span>Renovar Membresía</span>\r\n                            </Button>\r\n                        </div>\r\n\r\n                        {/* Breakdown Cards */}\r\n                        <div className=\"grid grid-cols-1 sm:grid-cols-3 gap-4\">\r\n                            <Card className=\"bg-slate-900/50 border-white/5\">\r\n                                <CardHeader className=\"pb-2\">\r\n                                    <CardTitle className=\"text-sm font-medium text-slate-400\">Consumo</CardTitle>\r\n                                </CardHeader>\r\n                                <CardContent>\r\n                                    <div className=\"text-2xl font-bold\">${summary.byType.CONSUMPTION.toLocaleString()}</div>\r\n                                    <p className=\"text-xs text-muted-foreground\">Barras y Mesas</p>\r\n                                </CardContent>\r\n                            </Card>\r\n                            <Card className=\"bg-slate-900/50 border-white/5\">\r\n                                <CardHeader className=\"pb-2\">\r\n                                    <CardTitle className=\"text-sm font-medium text-slate-400\">Deudas</CardTitle>\r\n                                </CardHeader>\r\n                                <CardContent>\r\n                                    <div className=\"text-2xl font-bold text-emerald-500\">${summary.byType.DEBT_PAYMENT.toLocaleString()}</div>\r\n                                    <p className=\"text-xs text-muted-foreground\">Pagos de Cta. Cte.</p>\r\n                                </CardContent>\r\n                            </Card>\r\n                            <Card className=\"bg-slate-900/50 border-white/5\">\r\n                                <CardHeader className=\"pb-2\">\r\n                                    <CardTitle className=\"text-sm font-medium text-slate-400\">Membresías</CardTitle>\r\n                                </CardHeader>\r\n                                <CardContent>\r\n                                    <div className=\"text-2xl font-bold text-blue-500\">${summary.byType.MEMBERSHIP.toLocaleString()}</div>\r\n                                    <p className=\"text-xs text-muted-foreground\">Renovaciones</p>\r\n                                </CardContent>\r\n                            </Card>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n\r\n                {/* Dialogs */}\r\n                <DebtPaymentDialog\r\n                    isOpen={showDebtDialog}\r\n                    onClose={() => setShowDebtDialog(false)}\r\n                    onSuccess={refreshData}\r\n                />\r\n                <MembershipPaymentDialog\r\n                    isOpen={showMembershipDialog}\r\n                    onClose={() => setShowMembershipDialog(false)}\r\n                    onSuccess={refreshData}\r\n                />\r\n            </div>\r\n        )\r\n    }\r\n\r\n    // No Active Shift View\r\n    return (\r\n        <div className=\"max-w-md mx-auto mt-10\">\r\n            <Card className=\"bg-slate-950 border-white/10 shadow-2xl\">\r\n                <CardHeader>\r\n                    <CardTitle className=\"text-white flex items-center\">\r\n                        <Lock className=\"w-5 h-5 mr-2 text-slate-400\" />\r\n                        Caja Cerrada\r\n                    </CardTitle>\r\n                    <CardDescription>\r\n                        Debe abrir turno para registrar ventas y movimientos.\r\n                    </CardDescription>\r\n                </CardHeader>\r\n                <CardContent className=\"space-y-4\">\r\n                    <div className=\"space-y-2\">\r\n                        <Label>Fondo Inicial (Sencillo)</Label>\r\n                        <div className=\"relative\">\r\n                            <DollarSign className=\"absolute left-3 top-2.5 h-4 w-4 text-muted-foreground\" />\r\n                            <Input\r\n                                type=\"number\"\r\n                                placeholder=\"0\"\r\n                                className=\"pl-9 bg-black/20 border-white/10\"\r\n                                value={amount}\r\n                                onChange={(e) => setAmount(e.target.value)}\r\n                            />\r\n                        </div>\r\n                    </div>\r\n                </CardContent>\r\n                <CardFooter>\r\n                    <Button\r\n                        className=\"w-full bg-emerald-600 hover:bg-emerald-500 text-white\"\r\n                        onClick={handleOpenShift}\r\n                        disabled={isLoading}\r\n                    >\r\n                        <Unlock className=\"w-4 h-4 mr-2\" />\r\n                        Abrir Turno\r\n                    </Button>\r\n                </CardFooter>\r\n            </Card>\r\n        </div>\r\n    )\r\n}\r\n\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\rokat\\OneDrive\\Proyectos\\Akapoolco\\src\\app\\dashboard\\tables\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\rokat\\OneDrive\\Proyectos\\Akapoolco\\src\\app\\dashboard\\users\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\rokat\\OneDrive\\Proyectos\\Akapoolco\\src\\app\\dashboard\\users\\users-client.tsx","messages":[],"suppressedMessages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":50,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":50,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1375,1378],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1375,1378],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is defined but never used.","line":96,"column":18,"nodeType":"Identifier","messageId":"unusedVar","endLine":96,"endColumn":23,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is defined but never used.","line":113,"column":18,"nodeType":"Identifier","messageId":"unusedVar","endLine":113,"endColumn":23,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is defined but never used.","line":138,"column":18,"nodeType":"Identifier","messageId":"unusedVar","endLine":138,"endColumn":23,"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\rokat\\OneDrive\\Proyectos\\Akapoolco\\src\\app\\dashboard\\waiting-list\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\rokat\\OneDrive\\Proyectos\\Akapoolco\\src\\app\\dashboard\\waiting-list\\waiting-list-client.tsx","messages":[],"suppressedMessages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":63,"column":59,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":63,"endColumn":62,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1928,1931],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1928,1931],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":67,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":67,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2152,2155],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2152,2155],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is defined but never used.","line":78,"column":18,"nodeType":"Identifier","messageId":"unusedVar","endLine":78,"endColumn":23,"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\rokat\\OneDrive\\Proyectos\\Akapoolco\\src\\app\\layout.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\rokat\\OneDrive\\Proyectos\\Akapoolco\\src\\app\\lib\\actions-admin-finance.ts","messages":[],"suppressedMessages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":22,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":22,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[938,941],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[938,941],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":91,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":91,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4313,4316],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4313,4316],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\rokat\\OneDrive\\Proyectos\\Akapoolco\\src\\app\\lib\\actions-ads.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'AdBanner' is defined but never used.","line":6,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":6,"endColumn":18,"suggestions":[{"messageId":"removeUnusedImportDeclaration","data":{"varName":"AdBanner"},"fix":{"range":[145,187],"text":""},"desc":"Remove unused import declaration."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":44,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":44,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1377,1380],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1377,1380],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is defined but never used.","line":63,"column":14,"nodeType":"Identifier","messageId":"unusedVar","endLine":63,"endColumn":19},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is defined but never used.","line":103,"column":14,"nodeType":"Identifier","messageId":"unusedVar","endLine":103,"endColumn":19}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use server';\r\n\r\nimport { put, del } from '@vercel/blob';\r\nimport { prisma } from '@/lib/prisma';\r\nimport { revalidatePath } from 'next/cache';\r\nimport { AdBanner } from '@prisma/client';\r\n\r\n/**\r\n * Uploads an image to Vercel Blob and creates an AdBanner record.\r\n */\r\nexport async function uploadAdBanner(formData: FormData) {\r\n    try {\r\n        const file = formData.get('file') as File;\r\n        const title = formData.get('title') as string;\r\n\r\n        if (!file || !title) {\r\n            return { error: 'Falta archivo o título' };\r\n        }\r\n\r\n        // 1. Upload to Vercel Blob\r\n        // Ensure token is present\r\n        if (!process.env.BLOB_READ_WRITE_TOKEN) {\r\n            console.error(\"Missing BLOB_READ_WRITE_TOKEN\");\r\n            return { error: 'Error de configuración: Falta Token de Blob' };\r\n        }\r\n\r\n        const blob = await put(`ads/${file.name}`, file, {\r\n            access: 'public',\r\n            token: process.env.BLOB_READ_WRITE_TOKEN, // Explicitly pass token\r\n        });\r\n\r\n        // 2. Create DB Record\r\n        const ad = await prisma.adBanner.create({\r\n            data: {\r\n                title,\r\n                imageUrl: blob.url,\r\n                active: true, // Auto-activate on upload\r\n            }\r\n        });\r\n\r\n        revalidatePath('/dashboard/marketing');\r\n        return { success: true, ad };\r\n\r\n    } catch (error: any) {\r\n        console.error('Error uploading ad:', error);\r\n        // Extract inner Vercel Blob error if available\r\n        const msg = error.message || 'Error desconocido';\r\n        return { error: `Error al subir imagen: ${msg}` };\r\n    }\r\n}\r\n\r\n/**\r\n * Toggles the active status of an ad.\r\n */\r\nexport async function toggleAdStatus(id: string, isActive: boolean) {\r\n    try {\r\n        await prisma.adBanner.update({\r\n            where: { id },\r\n            data: { active: isActive }\r\n        });\r\n        revalidatePath('/dashboard/marketing');\r\n        return { success: true };\r\n    } catch (error) {\r\n        return { error: 'Error al actualizar estado' };\r\n    }\r\n}\r\n\r\n/**\r\n * Deletes an ad from DB and Blob storage.\r\n */\r\nexport async function deleteAd(id: string, imageUrl: string) {\r\n    try {\r\n        // 1. Delete from DB\r\n        await prisma.adBanner.delete({\r\n            where: { id }\r\n        });\r\n\r\n        // 2. Delete from Blob (Best effort, don't fail if already gone)\r\n        // Extract relative path or full URL depending on how 'del' expects it. \r\n        // Vercel Blob 'del' usually accepts the full URL.\r\n        await del(imageUrl);\r\n\r\n        revalidatePath('/dashboard/marketing');\r\n        return { success: true };\r\n    } catch (error) {\r\n        console.error('Error deleting ad:', error);\r\n        return { error: 'Error al eliminar anuncio' };\r\n    }\r\n}\r\n\r\n/**\r\n * Fetches all ads ordered by 'order' or creation date.\r\n */\r\nexport async function getAds() {\r\n    try {\r\n        const ads = await prisma.adBanner.findMany({\r\n            orderBy: [\r\n                { order: 'asc' },\r\n                { createdAt: 'desc' }\r\n            ]\r\n        });\r\n        return ads;\r\n    } catch (error) {\r\n        return [];\r\n    }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\rokat\\OneDrive\\Proyectos\\Akapoolco\\src\\app\\lib\\actions-card-tables.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":242,"column":56,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":242,"endColumn":59,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8980,8983],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8980,8983],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use server';\r\n\r\nimport { prisma } from '@/lib/prisma';\r\nimport { TableStatus } from '@prisma/client';\r\nimport { revalidatePath } from 'next/cache';\r\nimport { auth } from '@/auth';\r\nimport { Prisma } from '@prisma/client';\r\n\r\n// Tipos auxiliares\r\ntype PlayerInput = {\r\n    userId?: string;\r\n    guestName?: string;\r\n};\r\n\r\n// Eliminar constante hardcoded\r\n// const HOURLY_RATE_PER_PERSON = 2000; \r\n\r\nexport async function startCardSession(tableId: string, players: PlayerInput[]) {\r\n    const session = await auth();\r\n    if (!session?.user) return { success: false, error: 'No autorizado' };\r\n\r\n    if (players.length < 2) {\r\n        return { success: false, error: 'Se requieren mínimo 2 jugadores para iniciar' };\r\n    }\r\n\r\n    try {\r\n        const table = await prisma.table.findUnique({\r\n            where: { id: tableId },\r\n            include: { currentSession: true }\r\n        });\r\n\r\n        if (!table) return { success: false, error: 'Mesa no encontrada' };\r\n        if (table.currentSession) return { success: false, error: 'Mesa ocupada' };\r\n\r\n        // Obtener IDs de usuarios (ahora Members) registrados para buscar sus tipos\r\n        const memberIds = players.map(p => p.userId).filter(Boolean) as string[];\r\n        const members = await prisma.member.findMany({\r\n            where: { id: { in: memberIds } },\r\n            select: { id: true, type: true, name: true } // Fetch name too\r\n        });\r\n\r\n        // Map para búsqueda rápida de tipo de usuario\r\n        const memberMap = new Map(members.map(m => [m.id, m]));\r\n\r\n        await prisma.$transaction(async (tx) => {\r\n            // 1. Crear Session\r\n            const newSession = await tx.session.create({\r\n                data: {\r\n                    tableId,\r\n                    startTime: new Date(),\r\n                    status: 'ACTIVE',\r\n                    isTraining: false,\r\n                    // Creamos los SessionPlayers iniciales\r\n                    sessionPlayers: {\r\n                        create: players.map(p => {\r\n                            let rate = table.priceClient; // Por defecto Cliente\r\n\r\n                            let memberName = p.guestName;\r\n\r\n                            if (p.userId) {\r\n                                const member = memberMap.get(p.userId);\r\n                                if (member) {\r\n                                    // Si es socio o socio fundador, usa precio socio\r\n                                    if (member.type === 'SOCIO' || member.type === 'SOCIO_FUNDADOR') {\r\n                                        rate = table.priceMember;\r\n                                    }\r\n                                    if (!memberName) memberName = member.name; // Fallback/Snapshot key\r\n                                }\r\n                            }\r\n\r\n                            return {\r\n                                userId: undefined, // Clear legacy User ID\r\n                                memberId: p.userId, // Map input ID to memberId\r\n                                guestName: memberName,\r\n                                startTime: new Date(),\r\n                                status: 'ACTIVE',\r\n                                hourlyRate: rate // Usar precio específico\r\n                            };\r\n                        })\r\n                    }\r\n                }\r\n            });\r\n\r\n            // 2. Ocupar Mesa\r\n            await tx.table.update({\r\n                where: { id: tableId },\r\n                data: {\r\n                    status: TableStatus.OCCUPIED,\r\n                    currentSessionId: newSession.id\r\n                }\r\n            });\r\n        });\r\n\r\n        revalidatePath('/dashboard/tables');\r\n        return { success: true };\r\n    } catch (error) {\r\n        console.error('Error starting card session:', error);\r\n        return { success: false, error: 'Error al iniciar mesa de cartas' };\r\n    }\r\n}\r\n\r\nexport async function joinCardSession(sessionId: string, player: PlayerInput) {\r\n    const session = await auth();\r\n    if (!session?.user) return { success: false, error: 'No autorizado' };\r\n\r\n    try {\r\n        // Necesitamos la mesa para saber los precios\r\n        const activeSession = await prisma.session.findUnique({\r\n            where: { id: sessionId },\r\n            include: { table: true }\r\n        });\r\n\r\n        if (!activeSession || !activeSession.table) return { success: false, error: 'Sesión o mesa no encontrada' };\r\n\r\n        let rate = activeSession.table.priceClient; // Default: precio cliente\r\n\r\n        let guestName = player.guestName;\r\n\r\n        if (player.userId) {\r\n            const member = await prisma.member.findUnique({\r\n                where: { id: player.userId },\r\n                select: { type: true, name: true }\r\n            });\r\n            if (member) {\r\n                if (member.type === 'SOCIO' || member.type === 'SOCIO_FUNDADOR') {\r\n                    rate = activeSession.table.priceMember;\r\n                }\r\n                if (!guestName) guestName = member.name;\r\n            }\r\n        }\r\n\r\n        await prisma.sessionPlayer.create({\r\n            data: {\r\n                sessionId,\r\n                userId: undefined,\r\n                memberId: player.userId, // Link to Member\r\n                guestName: guestName,\r\n                startTime: new Date(),\r\n                status: 'ACTIVE',\r\n                hourlyRate: rate\r\n            }\r\n        });\r\n\r\n        revalidatePath('/dashboard/tables');\r\n        return { success: true };\r\n    } catch (error) {\r\n        console.error('Error joining session:', error);\r\n        return { success: false, error: 'Error al agregar jugador' };\r\n    }\r\n}\r\n\r\nexport async function leaveCardSession(sessionPlayerId: string) {\r\n    const session = await auth();\r\n    if (!session?.user) return { success: false, error: 'No autorizado' };\r\n\r\n    try {\r\n        // 1. Obtener datos del jugador y sesión\r\n        const sPlayer = await prisma.sessionPlayer.findUnique({\r\n            where: { id: sessionPlayerId },\r\n            include: { session: true }\r\n        });\r\n\r\n        if (!sPlayer || sPlayer.endTime) return { success: false, error: 'Jugador no encontrado o ya retirado' };\r\n\r\n        const endTime = new Date();\r\n        const startTime = new Date(sPlayer.startTime);\r\n\r\n        // Cálculo Costo\r\n        const durationMs = endTime.getTime() - startTime.getTime();\r\n        const durationHours = durationMs / 1000 / 60 / 60;\r\n        const rate = Number(sPlayer.hourlyRate);\r\n\r\n        // Regla de Cobro: (Hora Salida - Hora Entrada) * Tarifa\r\n        // Mínimo? Podríamos cobrar mínimo 15 mins o algo, pero la regla dice \"Exactamente lo justo\"\r\n        const cost = Math.ceil(durationHours * rate);\r\n\r\n        // Actualizar SessionPlayer\r\n        await prisma.sessionPlayer.update({\r\n            where: { id: sessionPlayerId },\r\n            data: {\r\n                endTime,\r\n                status: 'LEFT',\r\n                totalCost: new Prisma.Decimal(cost)\r\n            }\r\n        });\r\n\r\n        // Verificar Mínimo de jugadores en mesa\r\n        const activeCount = await prisma.sessionPlayer.count({\r\n            where: {\r\n                sessionId: sPlayer.sessionId,\r\n                status: 'ACTIVE'\r\n            }\r\n        });\r\n\r\n        revalidatePath('/dashboard/tables');\r\n\r\n        return {\r\n            success: true,\r\n            cost,\r\n            warning: activeCount < 2 ? 'ALERTA_MINIMO_JUGADORES' : null\r\n        };\r\n\r\n    } catch (error) {\r\n        console.error('Error leaving session:', error);\r\n        return { success: false, error: 'Error al retirar jugador' };\r\n    }\r\n}\r\n\r\nexport async function addOrderToPlayer(sessionId: string, sessionPlayerId: string, items: { productId: string, name: string, price: number, quantity: number }[]) {\r\n    const session = await auth();\r\n    if (!session?.user) return { success: false, error: 'No autorizado' };\r\n\r\n    try {\r\n        const activeSession = await prisma.session.findUnique({\r\n            where: { id: sessionId },\r\n            select: { orders: true, status: true }\r\n        });\r\n\r\n        if (!activeSession || activeSession.status !== 'ACTIVE') {\r\n            return { success: false, error: 'Sesión no activa' };\r\n        }\r\n\r\n        // 1. Deduct Stock (Always)\r\n        for (const item of items) {\r\n            await prisma.product.update({\r\n                where: { id: item.productId },\r\n                data: { stock: { decrement: item.quantity } }\r\n            });\r\n            // Log Movement\r\n            await prisma.stockMovement.create({\r\n                data: {\r\n                    productId: item.productId,\r\n                    type: 'ADJUSTMENT',\r\n                    quantity: -item.quantity,\r\n                    reason: `Consumo Jugador Mesa Carta (Session ${sessionId})`,\r\n                    userId: session.user.id\r\n                }\r\n            });\r\n        }\r\n\r\n        // 2. Add to Session Orders with Player Tag\r\n        const currentOrders = (activeSession.orders as any[]) || [];\r\n        const newOrders = [\r\n            ...currentOrders,\r\n            ...items.map(item => ({\r\n                ...item,\r\n                sessionPlayerId, // Link to the specific player in the session\r\n                addedAt: new Date().toISOString()\r\n            }))\r\n        ];\r\n\r\n        await prisma.session.update({\r\n            where: { id: sessionId },\r\n            data: { orders: newOrders }\r\n        });\r\n\r\n        revalidatePath('/dashboard/tables');\r\n        return { success: true };\r\n\r\n    } catch (error) {\r\n        console.error('Error adding order to player:', error);\r\n        return { success: false, error: 'Error al agregar consumo' };\r\n    }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\rokat\\OneDrive\\Proyectos\\Akapoolco\\src\\app\\lib\\actions-checkout.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\rokat\\OneDrive\\Proyectos\\Akapoolco\\src\\app\\lib\\actions-cockpit.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\rokat\\OneDrive\\Proyectos\\Akapoolco\\src\\app\\lib\\actions-dashboard.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is defined but never used.","line":57,"column":14,"nodeType":"Identifier","messageId":"unusedVar","endLine":57,"endColumn":19},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":75,"column":29,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":75,"endColumn":32,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2158,2161],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2158,2161],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is defined but never used.","line":83,"column":14,"nodeType":"Identifier","messageId":"unusedVar","endLine":83,"endColumn":19}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use server';\r\n\r\nimport { prisma } from '@/lib/prisma';\r\nimport { unstable_noStore as noStore } from 'next/cache';\r\n\r\nexport async function getDashboardStats() {\r\n    noStore(); // Dynamic data\r\n    try {\r\n        // 1. Shift Stats (Active Shift)\r\n        const activeShift = await prisma.shift.findFirst({\r\n            where: { status: 'OPEN' },\r\n            include: { sales: true }\r\n        });\r\n\r\n        const shiftTotal = activeShift?.sales.reduce((acc, sale) => acc + Number(sale.total), 0) || 0;\r\n\r\n        // 2. Active Tables\r\n        const activeTablesCount = await prisma.session.count({\r\n            where: { status: 'ACTIVE' }\r\n        });\r\n\r\n        const totalTables = await prisma.table.count();\r\n\r\n        // 3. Total Debt\r\n        const debtAgg = await prisma.user.aggregate({\r\n            _sum: { currentDebt: true },\r\n            where: { currentDebt: { gt: 0 } }\r\n        });\r\n\r\n        return {\r\n            shiftTotal,\r\n            activeTables: activeTablesCount,\r\n            totalTables,\r\n            totalDebt: Number(debtAgg._sum.currentDebt || 0)\r\n        };\r\n    } catch (error) {\r\n        console.error('Error fetching dashboard stats:', error);\r\n        return null;\r\n    }\r\n}\r\n\r\nexport async function getDebtorsWatchlist() {\r\n    noStore();\r\n    try {\r\n        const debtors = await prisma.user.findMany({\r\n            where: { currentDebt: { gt: 0 } },\r\n            orderBy: { currentDebt: 'desc' },\r\n            take: 10,\r\n            select: {\r\n                id: true,\r\n                name: true,\r\n                currentDebt: true,\r\n                image: true\r\n            }\r\n        });\r\n        return debtors;\r\n    } catch (error) {\r\n        return [];\r\n    }\r\n}\r\n\r\nexport async function getActiveTablesSummary() {\r\n    noStore();\r\n    try {\r\n        const sessions = await prisma.session.findMany({\r\n            where: { status: 'ACTIVE' },\r\n            include: {\r\n                table: { select: { name: true } },\r\n                sessionPlayers: true // Just count them\r\n            },\r\n            orderBy: { startTime: 'desc' }\r\n        });\r\n\r\n        // Simple summary mapping\r\n        return (sessions as any[]).map(s => ({\r\n            id: s.id,\r\n            tableId: s.tableId,\r\n            tableName: s.table.name,\r\n            startTime: s.startTime.toISOString(), // Serialize for safe transport\r\n            totalAmount: Number(s.totalAmount),\r\n            playerCount: s.sessionPlayers.length\r\n        }));\r\n    } catch (error) {\r\n        return [];\r\n    }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\rokat\\OneDrive\\Proyectos\\Akapoolco\\src\\app\\lib\\actions-kiosk.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":101,"column":37,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":101,"endColumn":40,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3600,3603],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3600,3603],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":116,"column":42,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":116,"endColumn":45,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4158,4161],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4158,4161],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":127,"column":46,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":127,"endColumn":49,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4605,4608],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4605,4608],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is defined but never used.","line":179,"column":14,"nodeType":"Identifier","messageId":"unusedVar","endLine":179,"endColumn":19},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is defined but never used.","line":192,"column":14,"nodeType":"Identifier","messageId":"unusedVar","endLine":192,"endColumn":19},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":197,"column":68,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":197,"endColumn":71,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6683,6686],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6683,6686],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'session' is assigned a value but never used.","line":198,"column":11,"nodeType":"Identifier","messageId":"unusedVar","endLine":198,"endColumn":18},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":221,"column":105,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":221,"endColumn":108,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7978,7981],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7978,7981],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":5,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use server';\r\n\r\nimport { prisma } from '@/lib/prisma';\r\nimport { revalidatePath } from 'next/cache';\r\nimport { PrintCategory, TicketStatus } from '@prisma/client';\r\nimport { auth } from '@/auth';\r\n\r\nexport type CartItem = {\r\n    productId: string;\r\n    quantity: number;\r\n    note?: string;\r\n    price: number;\r\n    name: string;\r\n    printCategory: PrintCategory;\r\n};\r\n\r\n// 1. Get Kiosk State (Lightweight Poller)\r\nexport async function getKioskState(tableId: string) {\r\n    try {\r\n        const table = await prisma.table.findUnique({\r\n            where: { id: tableId },\r\n            include: {\r\n                currentSession: {\r\n                    select: {\r\n                        id: true,\r\n                        startTime: true,\r\n                        status: true,\r\n                        gameState: true,\r\n                        sessionPlayers: {\r\n                            select: {\r\n                                id: true,\r\n                                guestName: true,\r\n                                member: { select: { name: true, image: true } },\r\n                                user: { select: { name: true, image: true } }\r\n                            }\r\n                        }\r\n                    }\r\n                },\r\n                // Fetch active ads only if needed (caching strategy recommended for prod)\r\n                // For now we fetch them if status is AVAILABLE\r\n            }\r\n        });\r\n\r\n        if (!table) return { error: \"Mesa no encontrada\" };\r\n\r\n        let ads: import('@prisma/client').AdBanner[] = [];\r\n        if (table.status === 'AVAILABLE' || table.status === 'RESERVED') {\r\n            ads = await prisma.adBanner.findMany({\r\n                where: { active: true },\r\n                orderBy: { order: 'asc' }\r\n            });\r\n        }\r\n\r\n        return {\r\n            status: table.status,\r\n            tableName: table.name,\r\n            tableType: table.type,\r\n            sessionData: table.currentSession ? {\r\n                ...table.currentSession,\r\n                // Flatten players for UI\r\n                players: table.currentSession.sessionPlayers.map(sp => ({\r\n                    id: sp.id,\r\n                    name: sp.member?.name || sp.user?.name || sp.guestName || \"Jugador\",\r\n                    image: sp.member?.image || sp.user?.image,\r\n                    isMember: !!sp.member\r\n                })),\r\n                // Inject Table Data for ActiveScreen context\r\n                table: {\r\n                    type: table.type,\r\n                    cameraTopUrl: table.cameraTopUrl,\r\n                    cameraFrontUrl: table.cameraFrontUrl\r\n                }\r\n            } : null,\r\n            ads\r\n        };\r\n\r\n    } catch (error) {\r\n        console.error(\"Error fetching kiosk state:\", error);\r\n        return { error: \"Error de servidor\" };\r\n    }\r\n}\r\n\r\n// 2. Submit Order Logic\r\nexport async function submitTableOrder(\r\n    sessionId: string,\r\n    items: CartItem[],\r\n    billedToPlayerId?: string\r\n) {\r\n    if (!items || items.length === 0) return { error: \"Carrito vacío\" };\r\n\r\n    try {\r\n        const total = items.reduce((acc, item) => acc + (item.price * item.quantity), 0);\r\n\r\n        // Transaction: Create Order -> Create Split Tickets\r\n        const result = await prisma.$transaction(async (tx) => {\r\n            // A. Create Main Order\r\n            const order = await tx.tableOrder.create({\r\n                data: {\r\n                    sessionId,\r\n                    billedToPlayerId: billedToPlayerId || null, // If null, it's Table Charge\r\n                    items: items as any, // Cast JSON\r\n                    total: total,\r\n                    status: 'PENDING'\r\n                }\r\n            });\r\n\r\n            // B. Split Logic for Tickets\r\n            const ticketsToCreate = [];\r\n\r\n            // BAR Ticket\r\n            const barItems = items.filter(i => i.printCategory === 'BAR');\r\n            if (barItems.length > 0) {\r\n                ticketsToCreate.push({\r\n                    tableOrderId: order.id,\r\n                    category: 'BAR' as PrintCategory, // Explicit cast\r\n                    content: barItems as any,\r\n                    status: 'PENDING' as TicketStatus\r\n                });\r\n            }\r\n\r\n            // KITCHEN Ticket\r\n            const kitchenItems = items.filter(i => i.printCategory === 'KITCHEN');\r\n            if (kitchenItems.length > 0) {\r\n                ticketsToCreate.push({\r\n                    tableOrderId: order.id,\r\n                    category: 'KITCHEN' as PrintCategory,\r\n                    content: kitchenItems as any,\r\n                    status: 'PENDING' as TicketStatus\r\n                });\r\n            }\r\n\r\n            // Create Tickets\r\n            for (const ticket of ticketsToCreate) {\r\n                await tx.orderTicket.create({ data: ticket });\r\n            }\r\n\r\n            return order;\r\n        });\r\n\r\n        // Revalidate Kiosk and Dashboard\r\n        revalidatePath(`/table/${result.sessionId}`);\r\n        revalidatePath('/dashboard/orders');\r\n\r\n        return { success: true, orderId: result.id };\r\n\r\n    } catch (error) {\r\n        console.error(\"Error submitting order:\", error);\r\n        return { error: \"Error interno al procesar pedido\" };\r\n    }\r\n}\r\n\r\n// 3. Get Pending Tickets (for Local Print Polling)\r\nexport async function getPendingTickets() {\r\n    try {\r\n        const tickets = await prisma.orderTicket.findMany({\r\n            where: { status: 'PENDING' },\r\n            include: {\r\n                tableOrder: {\r\n                    include: {\r\n                        session: {\r\n                            include: { table: true }\r\n                        }\r\n                    }\r\n                }\r\n            },\r\n            orderBy: { createdAt: 'asc' }\r\n        });\r\n\r\n        // Map for simpler consumption\r\n        return tickets.map(t => ({\r\n            id: t.id,\r\n            category: t.category,\r\n            tableName: t.tableOrder.session.table.name,\r\n            items: t.content as CartItem[],\r\n            date: t.createdAt.toISOString(),\r\n            serverName: \"Kiosk/Tablet\" // Could allow kiosk metadata later\r\n        }));\r\n\r\n    } catch (error) {\r\n        return [];\r\n    }\r\n}\r\n\r\n// 4. Mark Ticket as Printed\r\nexport async function markTicketPrinted(ticketId: string) {\r\n    try {\r\n        await prisma.orderTicket.update({\r\n            where: { id: ticketId },\r\n            data: { status: 'PRINTED', printedAt: new Date() }\r\n        });\r\n        return { success: true };\r\n    } catch (error) {\r\n        return { error: \"Failed to update ticket\" };\r\n    }\r\n}\r\n\r\nexport async function updateGameState(sessionId: string, newState: any) {\r\n    const session = await auth();\r\n    // Allow if user is logged in OR if it's a kiosk action (can relax auth if needed for kiosk token, sticking to session for now)\r\n    // Ideally, Kiosk mode might have a specific token or just rely on the session being active/open\r\n    // For now we assume the client checks, but secure it slightly:\r\n\r\n    // NOTE: Kiosk might trigger this often, so we keep it light.\r\n    try {\r\n        await prisma.session.update({\r\n            where: { id: sessionId },\r\n            data: { gameState: newState }\r\n        });\r\n        // We do NOT revalidatePath ideally to avoid full page reloads on every score change if using optimistic UI\r\n        // But for consistency across clients (if multiple screens), we might need to.\r\n        // For a dedicated scoreboard, we rely on local optimistic state + db persistence.\r\n        revalidatePath(`/dashboard/cockpit`); // Update main dashboard if tracking live scores\r\n        return { success: true };\r\n    } catch (error) {\r\n        console.error(\"Error updating game state:\", error);\r\n        return { success: false, error: \"Failed to save score\" };\r\n    }\r\n}\r\n\r\n// 5. Finalize Match (Referee Action)\r\nexport async function finalizeMatch(sessionId: string, winnerId?: string, reason?: string, finalState?: any) {\r\n    try {\r\n        const session = await prisma.session.findUnique({\r\n            where: { id: sessionId },\r\n            include: { schedule: true }\r\n        });\r\n\r\n        if (!session) return { error: \"Sesión no encontrada\" };\r\n\r\n        await prisma.$transaction(async (tx) => {\r\n            // 1. Close Session\r\n            await tx.session.update({\r\n                where: { id: sessionId },\r\n                data: {\r\n                    endTime: new Date(),\r\n                    status: 'COMPLETED',\r\n                    gameState: finalState || undefined // Persist final state if provided\r\n                }\r\n            });\r\n\r\n            // 2. If Tournament Match (linked to Schedule), update Schedule\r\n            if (session.scheduleId) {\r\n                // Here we would update the schedule result, advance winner in bracket, etc.\r\n                // For now, we just mark the schedule as completed if the schema supports it\r\n                // Assuming Schedule has a status or result field. If not, we skip.\r\n            }\r\n\r\n            // 3. Close Table (Make available again)\r\n            await tx.table.update({\r\n                where: { id: session.tableId },\r\n                data: { status: 'AVAILABLE' }\r\n            });\r\n        });\r\n\r\n        revalidatePath('/dashboard/referee');\r\n        revalidatePath(`/dashboard/referee/${sessionId}`);\r\n        return { success: true };\r\n\r\n    } catch (error) {\r\n        console.error(\"Error finalizing match:\", error);\r\n        return { error: \"Error al finalizar partido\" };\r\n    }\r\n}\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\rokat\\OneDrive\\Proyectos\\Akapoolco\\src\\app\\lib\\actions-kitchen.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\rokat\\OneDrive\\Proyectos\\Akapoolco\\src\\app\\lib\\actions-members.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'bcrypt' is defined but never used.","line":9,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":9,"endColumn":14,"suggestions":[{"messageId":"removeUnusedImportDeclaration","data":{"varName":"bcrypt"},"fix":{"range":[220,249],"text":""},"desc":"Remove unused import declaration."}]}],"suppressedMessages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":135,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":135,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5601,5604],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5601,5604],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":136,"column":57,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":136,"endColumn":60,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5663,5666],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5663,5666],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":170,"column":24,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":170,"endColumn":27,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6892,6895],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6892,6895],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":189,"column":33,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":189,"endColumn":36,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7773,7776],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7773,7776],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":215,"column":61,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":215,"endColumn":64,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9062,9065],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9062,9065],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":216,"column":91,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":216,"endColumn":94,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9161,9164],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9161,9164],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":224,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":224,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9452,9455],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9452,9455],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":241,"column":50,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":241,"endColumn":53,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10095,10098],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10095,10098],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":249,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":249,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10402,10405],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10402,10405],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":277,"column":45,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":277,"endColumn":48,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[11450,11453],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[11450,11453],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":297,"column":45,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":297,"endColumn":48,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[12307,12310],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[12307,12310],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":305,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":305,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[12550,12553],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[12550,12553],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":370,"column":32,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":370,"endColumn":35,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[14704,14707],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[14704,14707],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":437,"column":37,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":437,"endColumn":40,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[17138,17141],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[17138,17141],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":587,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":587,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[22156,22159],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[22156,22159],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/* eslint-disable @typescript-eslint/no-explicit-any */\r\n\"use server\"\r\n\r\nimport { put } from \"@vercel/blob\"\r\n\r\nimport { prisma } from \"@/lib/prisma\"\r\nimport { revalidatePath } from \"next/cache\"\r\nimport { z } from \"zod\"\r\nimport bcrypt from \"bcryptjs\"\r\nimport { auth } from \"@/auth\"\r\n\r\nconst CreateMemberSchema = z.object({\r\n    rut: z.string().min(1, \"El RUT es obligatorio\"),\r\n    firstName: z.string().min(2, \"El Nombre es obligatorio\"),\r\n    secondName: z.string().optional(),\r\n    lastNamePat: z.string().min(2, \"El Apellido Paterno es obligatorio\"),\r\n    lastNameMat: z.string().optional(),\r\n    nationality: z.string().optional(),\r\n\r\n    email: z.string().email(\"Email inválido\").optional().or(z.literal(\"\")),\r\n\r\n    type: z.enum([\"SOCIO\", \"CLIENTE\", \"SOCIO_FUNDADOR\"]),\r\n    billingProfile: z.enum([\"ACTIVE\", \"HONORARY\", \"EXCEPTION\", \"DELETED\"]).optional(), // Updated with DELETED if needed, checking schema\r\n    debtLimit: z.coerce.number().min(0, \"El cupo debe ser positivo\"),\r\n    joinDate: z.string().optional(),\r\n    membershipExpiresAt: z.string().optional()\r\n})\r\n\r\n/**\r\n * Crea un nuevo socio o cliente en el sistema\r\n * \r\n * Valida los datos del formulario, verifica unicidad de RUT y email,\r\n * genera hash de contraseña y crea el registro en la base de datos.\r\n * \r\n * @param formData - Datos del formulario con información del usuario\r\n * @param formData.rut - RUT sin puntos, con guión (ej: 12345678-9)\r\n * @param formData.firstName - Primer nombre (requerido, min 2 caracteres)\r\n * @param formData.lastNamePat - Apellido paterno (requerido, min 2 caracteres)\r\n * @param formData.type - Tipo de usuario: SOCIO, SOCIO_FUNDADOR o CLIENTE\r\n * @param formData.systemAccess - Si tiene acceso al sistema como staff\r\n * @param formData.email - Email para login (requerido si systemAccess=true)\r\n * @param formData.password - Contraseña temporal (min 6 chars, requerida si systemAccess=true)\r\n * @param formData.debtLimit - Límite de crédito permitido en pesos\r\n * \r\n * @returns {Promise<{success: true} | {error: object}>}\r\n *          - success: Usuario creado exitosamente, redirige a lista\r\n *          - error: Objeto con errores de validación por campo\r\n * \r\n * @throws No lanza errores, retorna objeto con error en caso de fallo\r\n * \r\n * @security\r\n * - Valida unicidad de RUT y email antes de crear\r\n * - Hash de contraseña usando bcrypt con salt rounds=10\r\n * - Validación de schema con Zod antes de inserción\r\n * - Solo usuarios ADMIN/SUPERUSER pueden ejecutar esta acción\r\n * \r\n * @example\r\n * ```ts\r\n * const result = await createMember(formData)\r\n * if (result.error) {\r\n *   console.error(result.error.rut) // [\"El RUT ya está registrado\"]\r\n * } else {\r\n *   // Usuario creado exitosamente\r\n * }\r\n * ```\r\n */\r\nexport async function createMember(formData: FormData) {\r\n    const rawData = {\r\n        rut: formData.get(\"rut\"),\r\n        firstName: formData.get(\"firstName\"),\r\n        secondName: formData.get(\"secondName\"),\r\n        lastNamePat: formData.get(\"lastNamePat\"),\r\n        lastNameMat: formData.get(\"lastNameMat\"),\r\n        nationality: formData.get(\"nationality\"),\r\n\r\n        email: formData.get(\"email\"),\r\n\r\n        type: formData.get(\"type\"),\r\n        billingProfile: formData.get(\"billingProfile\"),\r\n        debtLimit: formData.get(\"debtLimit\"),\r\n        joinDate: formData.get(\"joinDate\"),\r\n        membershipExpiresAt: formData.get(\"membershipExpiresAt\")\r\n    }\r\n\r\n    const validatedFields = CreateMemberSchema.safeParse(rawData)\r\n\r\n    if (!validatedFields.success) {\r\n        return { error: validatedFields.error.flatten().fieldErrors }\r\n    }\r\n\r\n    const data = validatedFields.data\r\n\r\n    try {\r\n        // Uniqueness Checks for Member\r\n        if (data.rut) {\r\n            const existingRut = await prisma.member.findUnique({ where: { rut: data.rut } })\r\n            if (existingRut) return { error: { rut: [\"El RUT ya está registrado\"] } }\r\n        }\r\n        // Email check optional for members\r\n        if (data.email) {\r\n            // Member email might not be unique in schema? Schema says NO unique on email for Member. \r\n            // But let's check broadly to avoid confusion or just allow it. \r\n            // Logic: Members might share emails (family?). Let's allow unless users complain.\r\n        }\r\n\r\n        // Concatenate Name\r\n        const fullName = [data.firstName, data.secondName, data.lastNamePat, data.lastNameMat]\r\n            .filter(Boolean)\r\n            .join(\" \")\r\n\r\n        // Calculate Membership Expiration\r\n        let membershipExpiresAt = null;\r\n\r\n        if (data.membershipExpiresAt) {\r\n            // Manual Override (Backdating or custom)\r\n            membershipExpiresAt = new Date(data.membershipExpiresAt);\r\n        } else if (data.type === 'SOCIO' || data.type === 'SOCIO_FUNDADOR') {\r\n            // Default: 1 Year from now\r\n            const today = new Date();\r\n            membershipExpiresAt = new Date(today.setFullYear(today.getFullYear() + 1));\r\n        }\r\n\r\n        await prisma.member.create({\r\n            data: {\r\n                rut: data.rut,\r\n                name: fullName,\r\n                // Note: separated name fields are not in Member model based on plan.\r\n                // Member model has just `name`. If we want to keep them, we need to update schema.\r\n                // Plan said: \"Member Model... name String\". So we just store full name.\r\n                // Wait, User model had separated parts. Member model defined in Plan had `name`.\r\n                // Let's stick to storing `name` (full).\r\n\r\n                email: data.email || null,\r\n\r\n                type: data.type as any,\r\n                billingProfile: (data.billingProfile as any) || 'ACTIVE',\r\n                debtLimit: data.debtLimit,\r\n                currentDebt: 0,\r\n\r\n                membershipExpiresAt,\r\n                // joinDate is createdAt usually, but if provided? \r\n                // Schema has `createdAt`. Plan didn't explicitly add `joinDate`. \r\n                // User model had `joinDate`. Member schema I pushed might not have `joinDate`.\r\n                // Let's check schema snippet I pushed... \r\n                // \"createdAt DateTime @default(now())\". No explicit joinDate.\r\n                // We will use createdAt.\r\n            }\r\n        })\r\n\r\n        revalidatePath(\"/dashboard/members\")\r\n        return { success: true }\r\n    } catch (error) {\r\n        console.error(\"Failed to create member:\", error)\r\n        return { error: { root: [\"Error al crear el socio. Inténtalo de nuevo.\"] } }\r\n    }\r\n}\r\n\r\n\r\n\r\n/**\r\n * Updates an existing member.\r\n * Handles duplicate checks (excluding self) and partial updates.\r\n * Supports file uploads for 'image' and 'documentImage'.\r\n */\r\nexport async function updateMember(id: string, formData: FormData) {\r\n    // Basic validations\r\n    if (!id) return { error: { root: [\"El ID es obligatorio\"] } };\r\n\r\n    try {\r\n        const rawData: any = {\r\n            rut: formData.get(\"rut\"),\r\n            name: formData.get(\"name\"),\r\n            email: formData.get(\"email\"),\r\n            type: formData.get(\"type\"),\r\n            billingProfile: formData.get(\"billingProfile\"),\r\n            debtLimit: formData.get(\"debtLimit\"),\r\n        };\r\n\r\n        // Handle File Uploads\r\n        const imageFile = formData.get(\"image\") as File;\r\n        if (imageFile && imageFile.size > 0) {\r\n            if (!process.env.BLOB_READ_WRITE_TOKEN) {\r\n                console.error(\"Missing BLOB_READ_WRITE_TOKEN\");\r\n                return { error: { root: [\"Error de configuración: Falta el token de Vercel Blob (Imágenes).\"] } };\r\n            }\r\n            try {\r\n                const blob = await put(imageFile.name, imageFile, { access: 'public' as const });\r\n                rawData.image = blob.url;\r\n            } catch (blobError: any) {\r\n                console.error(\"Blob Upload Error:\", blobError);\r\n                return { error: { root: [`Error al subir imagen: ${blobError.message}`] } };\r\n            }\r\n        }\r\n\r\n        // Member model doesn't have documentImage in the snippet I added? \r\n        // Let's check schema. I added `image` but not `documentImage` in the Member model snippet (I copied plan). \r\n        // The plan had `image`. It didn't have `documentImage`. \r\n        // So for now I will skip `documentImage` update for Member unless I update Schema again. \r\n        // Let's skip it to be safe with current schema state.\r\n\r\n        // Unique Checks (excluding self)\r\n        if (rawData.rut) {\r\n            const existing = await prisma.member.findUnique({\r\n                where: { rut: rawData.rut as string }\r\n            });\r\n            if (existing && existing.id !== id) return { error: { rut: [\"RUT ya registrado por otro socio\"] } };\r\n        }\r\n\r\n        await prisma.member.update({\r\n            where: { id },\r\n            data: {\r\n                ...(rawData.rut && { rut: rawData.rut }),\r\n                ...(rawData.name && { name: rawData.name }),\r\n                ...(rawData.email && { email: rawData.email }),\r\n                ...(rawData.type && { type: rawData.type as any }),\r\n                ...(rawData.billingProfile && { billingProfile: rawData.billingProfile as any }),\r\n                ...(rawData.debtLimit && { debtLimit: Number(rawData.debtLimit) }),\r\n                ...(rawData.image && { image: rawData.image }),\r\n            }\r\n        });\r\n\r\n        revalidatePath(\"/dashboard/members\");\r\n        return { success: true };\r\n    } catch (error: any) {\r\n        console.error(\"Failed to update member FULL ERROR:\", JSON.stringify(error, null, 2));\r\n\r\n        let errorMessage = error.message || \"Error desconocido\";\r\n        if (error.code === 'P2002') {\r\n            errorMessage = \"Ya existe un socio con ese RUT.\";\r\n        }\r\n        // Vercel Blob errors often have details\r\n        if (errorMessage.includes(\"BLOB\")) {\r\n            errorMessage = \"Error de almacenamiento de imágenes (Vercel Blob). Verifique configuración.\";\r\n        }\r\n\r\n        return { error: { root: [`${errorMessage} (Code: ${error.code})`] } };\r\n    }\r\n}\r\n\r\n\r\nexport async function importMembersBulk(members: any[]) {\r\n    const session = await auth()\r\n    if (session?.user?.role !== 'SUPERUSER' && session?.user?.role !== 'ADMIN') {\r\n        return { success: false, error: 'No autorizado: Se requiere rol de Admin o Super Usuario' }\r\n    }\r\n\r\n    let successCount = 0\r\n    let failureCount = 0\r\n    const errors: any[] = []\r\n\r\n    for (const member of members) {\r\n        try {\r\n            // Basic validation\r\n            if (!member.name) {\r\n                failureCount++\r\n                errors.push({ row: member, error: \"El Nombre es obligatorio\" })\r\n                continue\r\n            }\r\n\r\n            // Normalization\r\n            const type = member.type?.toUpperCase() || 'CLIENTE'\r\n            const mappedType = (type === 'SOCIO FUNDADOR' || type === 'FUNDADOR') ? 'SOCIO_FUNDADOR' : type\r\n\r\n            // Determine unique identifier logic\r\n            // Priority: RUT -> Email\r\n            let existingMember = null\r\n            if (member.rut) {\r\n                existingMember = await prisma.member.findUnique({ where: { rut: member.rut } })\r\n            }\r\n\r\n            if (existingMember) {\r\n                // Update\r\n                await prisma.member.update({\r\n                    where: { id: existingMember.id },\r\n                    data: {\r\n                        name: member.name,\r\n                        type: mappedType as any,\r\n                        email: member.email || existingMember.email,\r\n                        rut: member.rut || existingMember.rut,\r\n                    }\r\n                })\r\n            } else {\r\n\r\n                // Default Expiration for imported members\r\n                let membershipExpiresAt = null;\r\n                if (mappedType === 'SOCIO' || mappedType === 'SOCIO_FUNDADOR') {\r\n                    const today = new Date();\r\n                    membershipExpiresAt = new Date(today.setFullYear(today.getFullYear() + 1));\r\n                }\r\n\r\n                // Create\r\n                await prisma.member.create({\r\n                    data: {\r\n                        name: member.name,\r\n                        rut: member.rut || null,\r\n                        email: member.email || null,\r\n                        type: mappedType as any,\r\n                        debtLimit: 50000,\r\n                        currentDebt: 0,\r\n                        membershipExpiresAt\r\n                    }\r\n                })\r\n            }\r\n            successCount++\r\n        } catch (err: any) {\r\n            console.error(\"Import error for row:\", member, err)\r\n            failureCount++\r\n            errors.push({ row: member, error: err.message })\r\n        }\r\n    }\r\n\r\n    revalidatePath(\"/dashboard/members\")\r\n    return { success: true, count: successCount, failures: failureCount, errors }\r\n}\r\n\r\n/**\r\n * Checks if a member is active based on payment status.\r\n * Returns true if active, false if expired > 30 days (Moroso).\r\n */\r\nexport async function checkMemberStatus(memberId: string) {\r\n    const member = await prisma.member.findUnique({\r\n        where: { id: memberId },\r\n        select: { type: true, membershipExpiresAt: true }\r\n    });\r\n\r\n    if (!member) return false;\r\n    // Clients don't have membership status expiration\r\n    if (member.type === 'CLIENTE') return true;\r\n\r\n    // If no expiration date set, assume active (legacy) or handle as needed\r\n    if (!member.membershipExpiresAt) return true;\r\n\r\n    const now = new Date();\r\n    // Allow 30 days grace period\r\n    const gracePeriodEnd = new Date(member.membershipExpiresAt);\r\n    gracePeriodEnd.setDate(gracePeriodEnd.getDate() + 30);\r\n\r\n    return now <= gracePeriodEnd;\r\n}\r\n\r\nexport async function searchMembers(term: string) {\r\n    if (!term || term.length < 2) return [];\r\n\r\n    try {\r\n        const members = await prisma.member.findMany({\r\n            where: {\r\n                OR: [\r\n                    { name: { contains: term, mode: 'insensitive' } },\r\n                    { rut: { contains: term, mode: 'insensitive' } }\r\n                ]\r\n            },\r\n            take: 10,\r\n            select: {\r\n                id: true,\r\n                name: true,\r\n                type: true,\r\n                rut: true,\r\n                billingProfile: true,\r\n                membershipExpiresAt: true,\r\n                currentDebt: true,\r\n                debtLimit: true,\r\n                status: true,\r\n                image: true\r\n                // Note: User model had customPermissions etc. Member model is cleaner.\r\n            }\r\n        });\r\n\r\n        // Enrich with Status Calculation\r\n        const now = new Date();\r\n        return members.map((u: any) => {\r\n            let status = 'AL_DIA'; // Default\r\n\r\n            if (u.type === 'CLIENTE') {\r\n                status = 'CLIENTE';\r\n            } else if (u.billingProfile === 'HONORARY') {\r\n                status = 'HONORARIO';\r\n            } else if (u.billingProfile === 'EXCEPTION') {\r\n                status = 'CONVENIO';\r\n            } else {\r\n                if (!u.membershipExpiresAt) {\r\n                    status = 'PENDIENTE'; // No data\r\n                } else {\r\n                    const exp = new Date(u.membershipExpiresAt);\r\n                    const diffTime = now.getTime() - exp.getTime();\r\n                    const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));\r\n\r\n                    if (diffDays <= 0) {\r\n                        status = 'AL_DIA';\r\n                    } else if (diffDays <= 60) {\r\n                        status = 'PENDIENTE';\r\n                    } else {\r\n                        status = 'MOROSO';\r\n                    }\r\n                }\r\n            }\r\n\r\n            return { ...u, paymentStatus: status };\r\n        });\r\n    } catch (error) {\r\n        console.error(\"Error searching members:\", error);\r\n        return [];\r\n    }\r\n}\r\n\r\n/**\r\n * Renews a member's membership.\r\n * business logic:\r\n * - If current expiration > today: extend by X months from expiration.\r\n * - If current expiration < today: extend by X months from TODAY.\r\n * - Force status to ACTIVE.\r\n * - Create a sale record.\r\n */\r\nexport async function renewMembership(memberId: string, months: number, amountPaid: number, paymentMethod: string) {\r\n    const session = await auth();\r\n    if (!session?.user?.id) return { error: \"No autorizado\" };\r\n\r\n    try {\r\n        const member = await prisma.member.findUnique({ where: { id: memberId } });\r\n        if (!member) return { error: \"Socio no encontrado\" };\r\n\r\n        const today = new Date();\r\n        let newExpiration = member.membershipExpiresAt ? new Date(member.membershipExpiresAt) : new Date();\r\n\r\n        if (newExpiration < today) {\r\n            // Expired -> Renew from today\r\n            newExpiration = new Date(today);\r\n        }\r\n\r\n        // Add months\r\n        newExpiration.setMonth(newExpiration.getMonth() + months);\r\n\r\n        // Update Member\r\n        await prisma.member.update({\r\n            where: { id: memberId },\r\n            data: {\r\n                membershipExpiresAt: newExpiration,\r\n                status: \"ACTIVE\" as any // Reactivate\r\n            }\r\n        });\r\n\r\n        // Record Sale\r\n        await prisma.sale.create({\r\n            data: {\r\n                userId: undefined,\r\n                memberId: memberId, // Using memberId\r\n                total: amountPaid,\r\n                method: paymentMethod,\r\n                type: \"MEMBERSHIP\",\r\n                items: [{\r\n                    name: `Renovación Membresía (${months} meses)`,\r\n                    price: amountPaid,\r\n                    quantity: 1,\r\n                    productId: \"MEMBERSHIP\"\r\n                }],\r\n                metadata: {\r\n                    renewedUntil: newExpiration.toISOString(),\r\n                    renewedBy: session.user.name\r\n                }\r\n            }\r\n        });\r\n\r\n        revalidatePath(\"/dashboard/members\");\r\n        return { success: true, newExpiration };\r\n    } catch (error) {\r\n        console.error(\"Error renewing membership:\", error);\r\n        return { error: \"Error al renovar la membresía\" };\r\n    }\r\n}\r\n\r\n/**\r\n * Registers a debt payment (Abono).\r\n * - Decrements currentDebt.\r\n * - Creates a sale record of type DEBT_PAYMENT.\r\n */\r\nexport async function registerDebtPayment(memberId: string, amount: number, paymentMethod: string) {\r\n    const session = await auth();\r\n    if (!session?.user?.id) return { error: \"No autorizado\" };\r\n\r\n    try {\r\n        const member = await prisma.member.findUnique({ where: { id: memberId } });\r\n        if (!member) return { error: \"Socio no encontrado\" };\r\n\r\n        if (amount <= 0) return { error: \"El monto debe ser positivo\" };\r\n\r\n        // Update Debt\r\n        await prisma.member.update({\r\n            where: { id: memberId },\r\n            data: {\r\n                currentDebt: { decrement: amount },\r\n            }\r\n        });\r\n\r\n        // Record Transaction\r\n        await prisma.sale.create({\r\n            data: {\r\n                userId: undefined,\r\n                memberId: memberId, // Link to member\r\n                total: amount,\r\n                method: paymentMethod,\r\n                type: \"DEBT_PAYMENT\",\r\n                items: [{\r\n                    name: \"Abono a Deuda\",\r\n                    price: amount,\r\n                    quantity: 1,\r\n                    productId: \"DEBT_PAYMENT\"\r\n                }],\r\n                metadata: {\r\n                    previousDebt: Number(member.currentDebt),\r\n                    newDebt: Number(member.currentDebt) - amount,\r\n                    processedBy: session.user.name\r\n                }\r\n            }\r\n        });\r\n\r\n        revalidatePath(\"/dashboard/members\");\r\n        return { success: true };\r\n    } catch (error) {\r\n        console.error(\"Error registering debt payment:\", error);\r\n        return { error: \"Error al registrar el abono\" };\r\n    }\r\n}\r\n\r\n/**\r\n * DAILY JOB: Checks for expired memberships > 30 days.\r\n * Sets status to INACTIVE.\r\n */\r\nexport async function runDebtMonitor() {\r\n    try {\r\n        const today = new Date();\r\n        const cutoffDate = new Date(today);\r\n        cutoffDate.setDate(cutoffDate.getDate() - 30); // 30 days ago\r\n\r\n        // Find users who are ACTIVE but expired before cutoff\r\n        // logic: membershipExpiresAt < cutoffDate\r\n        // COMMENTED OUT as per new business rule: User status should NOT be set to INACTIVE automatically.\r\n        // Instead, the pricing rules will handle the \"loss of benefits\" dynamically based on expiration date.\r\n\r\n        // const result = await prisma.user.updateMany({\r\n        //     where: {\r\n        //         status: \"ACTIVE\",\r\n        //         membershipExpiresAt: {\r\n        //             lt: cutoffDate\r\n        //         },\r\n        //         type: { in: [\"SOCIO\", \"SOCIO_FUNDADOR\"] }\r\n        //     },\r\n        //     data: {\r\n        //         status: \"INACTIVE\"\r\n        //     }\r\n        // });\r\n\r\n        const count = await prisma.member.count({\r\n            where: {\r\n                status: \"ACTIVE\",\r\n                membershipExpiresAt: {\r\n                    lt: cutoffDate\r\n                },\r\n                type: { in: [\"SOCIO\", \"SOCIO_FUNDADOR\"] }\r\n            }\r\n        });\r\n\r\n        console.log(`Debt Monitor: Found ${count} expired members.`);\r\n        return { success: true, count };\r\n    } catch (error) {\r\n        console.error(\"Error running debt monitor:\", error);\r\n        return { error: \"Fallo en el monitor de deuda\" };\r\n    }\r\n}\r\n\r\n/**\r\n * Deletes a member.\r\n * Checks for dependent records (Sales, etc.) might be handled by DB Cascade or need explicit check.\r\n * Ideally, we soft-delete or check constraints. For now, strict delete.\r\n */\r\nexport async function deleteMember(id: string) {\r\n    const session = await auth();\r\n    if (session?.user?.role !== 'ADMIN' && session?.user?.role !== 'SUPERUSER') {\r\n        return { error: \"No autorizado\" };\r\n    }\r\n\r\n    try {\r\n        await prisma.member.delete({\r\n            where: { id }\r\n        });\r\n\r\n        revalidatePath(\"/dashboard/members\");\r\n        return { success: true };\r\n    } catch (error: any) {\r\n        console.error(\"Error deleting member:\", error);\r\n        if (error.code === 'P2003') {\r\n            return { error: \"No se puede eliminar el socio porque tiene registros asociados (Ventas, Sesiones, etc.).\" };\r\n        }\r\n        return { error: \"Error al eliminar el socio\" };\r\n    }\r\n}\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\rokat\\OneDrive\\Proyectos\\Akapoolco\\src\\app\\lib\\actions-migration.ts","messages":[],"suppressedMessages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":70,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":70,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2381,2384],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2381,2384],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":71,"column":49,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":71,"endColumn":52,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2435,2438],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2435,2438],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":108,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":108,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3782,3785],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3782,3785],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\rokat\\OneDrive\\Proyectos\\Akapoolco\\src\\app\\lib\\actions-payments.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'SaleType' is defined but never used.","line":6,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":6,"endColumn":18,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"SaleType"},"fix":{"range":[144,153],"text":""},"desc":"Remove unused variable \"SaleType\"."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use server';\r\n\r\nimport { prisma } from '@/lib/prisma';\r\nimport { revalidatePath } from 'next/cache';\r\nimport { auth } from '@/auth';\r\nimport { SaleType, Prisma } from '@prisma/client';\r\n\r\n// Helper to get active shift\r\nasync function getActiveShiftId() {\r\n    const shift = await prisma.shift.findFirst({\r\n        where: { status: 'OPEN' },\r\n        select: { id: true }\r\n    });\r\n    return shift?.id;\r\n}\r\n\r\nexport async function processDebtPayment(userId: string, amount: number, method: string) {\r\n    const session = await auth();\r\n    if (!session?.user) return { success: false, error: 'No autorizado' };\r\n\r\n    if (amount <= 0) return { success: false, error: 'Monto inválido' };\r\n\r\n    const shiftId = await getActiveShiftId();\r\n    if (!shiftId) return { success: false, error: 'No hay turno activo. Debe abrir caja primero.' };\r\n\r\n    try {\r\n        await prisma.$transaction(async (tx) => {\r\n            // 1. Create Sale Record\r\n            await tx.sale.create({\r\n                data: {\r\n                    userId,\r\n                    shiftId,\r\n                    total: new Prisma.Decimal(amount),\r\n                    method, // CASH, CARD, TRANSFER\r\n                    type: 'DEBT_PAYMENT',\r\n                    items: [{ name: 'Abono a Deuda', price: amount, quantity: 1 }],\r\n                    metadata: { processedBy: session.user.email }\r\n                }\r\n            });\r\n\r\n            // 2. Decrease User Debt\r\n            await tx.user.update({\r\n                where: { id: userId },\r\n                data: {\r\n                    currentDebt: { decrement: amount }\r\n                }\r\n            });\r\n        });\r\n\r\n        revalidatePath('/dashboard/users');\r\n        revalidatePath('/dashboard/shifts');\r\n        return { success: true };\r\n    } catch (error) {\r\n        console.error('Error paying debt:', error);\r\n        return { success: false, error: 'Error al procesar el pago' };\r\n    }\r\n}\r\n\r\nexport async function processMembershipPayment(userId: string, months: number, amount: number, method: string) {\r\n    const session = await auth();\r\n    if (!session?.user) return { success: false, error: 'No autorizado' };\r\n\r\n    const shiftId = await getActiveShiftId();\r\n    if (!shiftId) return { success: false, error: 'No hay turno activo.' };\r\n\r\n    try {\r\n        const user = await prisma.user.findUnique({ where: { id: userId } });\r\n        if (!user) return { success: false, error: 'Usuario no encontrado' };\r\n\r\n        // Calculate new expiration date\r\n        const currentExpire = user.membershipExpiresAt && user.membershipExpiresAt > new Date()\r\n            ? new Date(user.membershipExpiresAt)\r\n            : new Date();\r\n\r\n        const newExpire = new Date(currentExpire);\r\n        newExpire.setMonth(newExpire.getMonth() + months);\r\n\r\n        await prisma.$transaction(async (tx) => {\r\n            // 1. Register Sale\r\n            await tx.sale.create({\r\n                data: {\r\n                    userId,\r\n                    shiftId,\r\n                    total: new Prisma.Decimal(amount),\r\n                    method,\r\n                    type: 'MEMBERSHIP',\r\n                    items: [{ name: `Renovación Membresía (${months} meses)`, price: amount, quantity: 1 }],\r\n                    metadata: {\r\n                        previousExpire: currentExpire,\r\n                        newExpire: newExpire\r\n                    }\r\n                }\r\n            });\r\n\r\n            // 2. Update User Membership\r\n            await tx.user.update({\r\n                where: { id: userId },\r\n                data: {\r\n                    membershipExpiresAt: newExpire,\r\n                    // If they weren't a member type, maybe upgrade them? \r\n                    // Keeping simple: assuming manual role check or they are already SOCIO\r\n                }\r\n            });\r\n        });\r\n\r\n        revalidatePath('/dashboard/users');\r\n        revalidatePath('/dashboard/shifts');\r\n        return { success: true, newExpire };\r\n    } catch (error) {\r\n        console.error('Error paying membership:', error);\r\n        return { success: false, error: 'Error al procesar membresía' };\r\n    }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\rokat\\OneDrive\\Proyectos\\Akapoolco\\src\\app\\lib\\actions-pos.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":61,"column":22,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":61,"endColumn":25,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2376,2379],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2376,2379],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":78,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":78,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2961,2964],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2961,2964],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":128,"column":22,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":128,"endColumn":25,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5212,5215],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5212,5215],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":135,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":135,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5353,5356],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5353,5356],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":4,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use server';\r\n\r\nimport { prisma } from '@/lib/prisma';\r\nimport { revalidatePath } from 'next/cache';\r\nimport { auth } from '@/auth';\r\nimport { Prisma } from '@prisma/client';\r\n\r\nexport interface PosItem {\r\n    productId: string;\r\n    name: string;\r\n    price: number;\r\n    quantity: number;\r\n}\r\n\r\n// ----------------------------------------------------------------------\r\n// 1. Process Direct Sale (Quick POS - No/Optional User, No Session)\r\n// ----------------------------------------------------------------------\r\nexport async function processDirectSale(items: PosItem[], method: string, userId?: string) {\r\n    const session = await auth();\r\n    if (!session?.user) return { success: false, error: 'No autorizado' };\r\n\r\n    if (items.length === 0) return { success: false, error: 'Carro vacío' };\r\n\r\n    try {\r\n        const activeShift = await prisma.shift.findFirst({ where: { status: 'OPEN' } });\r\n\r\n        if (!activeShift) return { success: false, error: 'Caja Cerrada. Abra turno primero.' };\r\n\r\n        const total = items.reduce((sum, item) => sum + (item.price * item.quantity), 0);\r\n\r\n        await prisma.$transaction(async (tx) => {\r\n            // Decrement Stock\r\n            for (const item of items) {\r\n                await tx.product.update({\r\n                    where: { id: item.productId },\r\n                    data: { stock: { decrement: item.quantity } }\r\n                });\r\n\r\n                await tx.stockMovement.create({\r\n                    data: {\r\n                        productId: item.productId,\r\n                        type: 'PURCHASE', // Outgoing sale\r\n                        quantity: -item.quantity,\r\n                        reason: 'Venta Directa (POS)',\r\n                        userId: session.user.id\r\n                    }\r\n                });\r\n            }\r\n\r\n            // Create Sale Record\r\n            await tx.sale.create({\r\n                data: {\r\n                    shiftId: activeShift.id,\r\n                    userId: undefined, // Clear legacy User ID\r\n                    memberId: userId, // Map input \"userId\" to memberId\r\n                    total: new Prisma.Decimal(total),\r\n                    method: method,\r\n                    type: 'CONSUMPTION',\r\n                    items: items as unknown as Prisma.InputJsonValue,\r\n                    metadata: { source: 'QuickPOS' }\r\n                } as any\r\n            });\r\n\r\n            // Update Member Debt if method is ACCOUNT\r\n            if (method === 'ACCOUNT') {\r\n                if (!userId) throw new Error('Se requiere socio para venta Fiado');\r\n                await tx.member.update({\r\n                    where: { id: userId }, // \"userId\" is actually memberId\r\n                    data: { currentDebt: { increment: total } }\r\n                });\r\n            }\r\n        });\r\n\r\n        revalidatePath('/dashboard');\r\n        revalidatePath('/dashboard/products');\r\n\r\n        return { success: true };\r\n    } catch (error: any) {\r\n        console.error('POS Error:', error);\r\n        return { success: false, error: error.message || 'Error al procesar venta' };\r\n    }\r\n}\r\n\r\n// ----------------------------------------------------------------------\r\n// 2. Register Sale (Legacy/Table Adapter - Supports SessionId & Total Override)\r\n// ----------------------------------------------------------------------\r\nexport async function registerSale(sessionId: string | null, items: PosItem[], total: number, method: string) {\r\n    const session = await auth();\r\n    if (!session?.user) return { success: false, error: 'No autorizado' };\r\n\r\n    // Basic validation\r\n    if (!items || items.length === 0) return { success: false, error: 'Carro vacío' };\r\n\r\n    try {\r\n        const activeShift = await prisma.shift.findFirst({ where: { status: 'OPEN' } });\r\n        if (!activeShift) return { success: false, error: 'Caja Cerrada' };\r\n\r\n        await prisma.$transaction(async (tx) => {\r\n            // 1. Stock\r\n            for (const item of items) {\r\n                if (item.productId) {\r\n                    await tx.product.update({\r\n                        where: { id: item.productId },\r\n                        data: { stock: { decrement: item.quantity } }\r\n                    });\r\n                    await tx.stockMovement.create({\r\n                        data: {\r\n                            productId: item.productId,\r\n                            type: 'PURCHASE',\r\n                            quantity: -item.quantity,\r\n                            reason: sessionId ? 'Consumo Mesa' : 'Venta Rápida',\r\n                            userId: session.user.id\r\n                        }\r\n                    });\r\n                }\r\n            }\r\n\r\n            // 2. Sale Linked to Session\r\n            await tx.sale.create({\r\n                data: {\r\n                    shiftId: activeShift.id,\r\n                    sessionId: sessionId || undefined,\r\n                    total: new Prisma.Decimal(total),\r\n                    method: method,\r\n                    type: 'CONSUMPTION',\r\n                    items: items as unknown as Prisma.InputJsonValue,\r\n                    metadata: { source: sessionId ? 'TableConsumption' : 'LegacyRegister' }\r\n                } as any\r\n            });\r\n        });\r\n\r\n        revalidatePath('/dashboard/cockpit');\r\n        return { success: true };\r\n\r\n    } catch (error: any) {\r\n        console.error('RegisterSale Error:', error);\r\n        return { success: false, error: error.message };\r\n    }\r\n}\r\n\r\n// ----------------------------------------------------------------------\r\n// 3. Get Products (For Selectors)\r\n// ----------------------------------------------------------------------\r\nexport async function getProducts() {\r\n    return await prisma.product.findMany({\r\n        where: { stockControl: true },\r\n        orderBy: { name: 'asc' }\r\n    });\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\rokat\\OneDrive\\Proyectos\\Akapoolco\\src\\app\\lib\\actions-products.ts","messages":[],"suppressedMessages":[{"ruleId":"prefer-const","severity":2,"message":"'updateOperation' is never reassigned. Use 'const' instead.","line":94,"column":13,"nodeType":"Identifier","messageId":"useConst","endLine":94,"endColumn":33,"fix":{"range":[2618,2647],"text":"const updateOperation: any = {}"},"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'updateOperation' is assigned a value but never used.","line":94,"column":13,"nodeType":"Identifier","messageId":"unusedVar","endLine":94,"endColumn":28,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":94,"column":30,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":94,"endColumn":33,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2639,2642],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2639,2642],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\rokat\\OneDrive\\Proyectos\\Akapoolco\\src\\app\\lib\\actions-sessions.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'TableType' is defined but never used.","line":5,"column":23,"nodeType":"Identifier","messageId":"unusedVar","endLine":5,"endColumn":32,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"TableType"},"fix":{"range":[134,145],"text":""},"desc":"Remove unused variable \"TableType\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is defined but never used.","line":447,"column":14,"nodeType":"Identifier","messageId":"unusedVar","endLine":447,"endColumn":19}],"suppressedMessages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":15,"column":31,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":15,"endColumn":34,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[490,493],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[490,493],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":23,"column":52,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":23,"endColumn":55,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[750,753],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[750,753],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":38,"column":70,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":38,"endColumn":73,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1392,1395],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1392,1395],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":40,"column":34,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":40,"endColumn":37,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1483,1486],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1483,1486],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":57,"column":55,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":57,"endColumn":58,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2358,2361],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2358,2361],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":90,"column":63,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":90,"endColumn":66,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3986,3989],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3986,3989],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":95,"column":55,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":95,"endColumn":58,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4205,4208],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4205,4208],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":96,"column":42,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":96,"endColumn":45,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4261,4264],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4261,4264],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":111,"column":45,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":111,"endColumn":48,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4652,4655],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4652,4655],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":151,"column":58,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":151,"endColumn":61,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6211,6214],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6211,6214],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":272,"column":64,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":272,"endColumn":67,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10961,10964],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10961,10964],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":285,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":285,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[11403,11406],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[11403,11406],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":426,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":426,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[16610,16613],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[16610,16613],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/* eslint-disable @typescript-eslint/no-explicit-any */\r\n'use server';\r\n\r\nimport { prisma } from '@/lib/prisma';\r\nimport { TableStatus, TableType } from '@prisma/client';\r\nimport { revalidatePath } from 'next/cache';\r\nimport { auth } from '@/auth';\r\nimport { SessionData } from '@/lib/types';\r\nimport { Prisma } from '@prisma/client';\r\n\r\nconst FALLBACK_HOURLY_RATE = 4000;\r\nconst FALLBACK_MEMBER_RATE = 2000;\r\n\r\n// Helper to extract rates from a Table object\r\nfunction getTableRates(table: any) {\r\n    return {\r\n        client: Number(table.priceClient) || FALLBACK_HOURLY_RATE,\r\n        member: Number(table.priceMember) || FALLBACK_MEMBER_RATE\r\n    };\r\n}\r\n\r\n// Unified Logic for Cost Calculation\r\nasync function calculateSessionCost(activeSession: any) {\r\n    const endTime = new Date();\r\n    const rates = getTableRates(activeSession.table);\r\n\r\n    let totalAmount = 0;\r\n    let durationMin = 0;\r\n    let timeCost = 0;\r\n\r\n    // --- CARDS LOGIC (Individual Billing) ---\r\n    if (activeSession.table.type === 'CARDS') {\r\n        const start = new Date(activeSession.startTime);\r\n        durationMin = Math.ceil((endTime.getTime() - start.getTime()) / 1000 / 60);\r\n\r\n        // Try to use Relational SessionPlayers first (New Model)\r\n        if (activeSession.sessionPlayers && activeSession.sessionPlayers.length > 0) {\r\n            const sPlayers = activeSession.sessionPlayers.filter((p: any) => p.status === 'ACTIVE' || p.status === 'LEFT');\r\n\r\n            sPlayers.forEach((p: any) => {\r\n                // If player already left, use their stored cost. If active, calculate current cost.\r\n                if (p.status === 'LEFT') {\r\n                    totalAmount += Number(p.totalCost || 0);\r\n                } else {\r\n                    const pStart = new Date(p.startTime);\r\n                    const pDurationMs = endTime.getTime() - pStart.getTime();\r\n                    const pHours = pDurationMs / 1000 / 60 / 60;\r\n                    // Use player's stored hourlyRate (snapshot) or fallback to table rate logic\r\n                    const pRate = Number(p.hourlyRate) || rates.client;\r\n\r\n                    totalAmount += Math.ceil(pHours * pRate);\r\n                }\r\n            });\r\n        }\r\n        // Fallback to JSON players (Legacy) - TO BE REMOVED eventually\r\n        else {\r\n            const players = (activeSession.players as any[]) || [];\r\n            players.forEach(player => {\r\n                if (player.startTime) {\r\n                    const pStart = new Date(player.startTime);\r\n                    const pDurationMs = endTime.getTime() - pStart.getTime();\r\n                    const pHours = pDurationMs / 1000 / 60 / 60;\r\n\r\n                    // Use Member type for rate logic if linked\r\n                    const memberType = player.member?.type || 'CLIENTE'; // Need to ensure member is fetched\r\n                    let pRate = (memberType === 'SOCIO' || memberType === 'SOCIO_FUNDADOR') ? rates.member : rates.client;\r\n                    if (activeSession.isTraining) pRate *= 0.5;\r\n\r\n                    totalAmount += Math.ceil(pHours * pRate);\r\n                }\r\n            });\r\n        }\r\n    }\r\n    // --- POOL / SNOOKER LOGIC (Table Billing) ---\r\n    else {\r\n        const start = new Date(activeSession.startTime);\r\n        const durationMs = endTime.getTime() - start.getTime();\r\n        durationMin = Math.ceil(durationMs / 1000 / 60);\r\n        const hours = durationMs / 1000 / 60 / 60;\r\n\r\n        let rate = rates.client;\r\n\r\n        // Check relational sessionPlayers for Members\r\n        // We assume sessionPlayers are populated for Pool/Snooker too in new logic? \r\n        // Or we check the legacy JSON \"players\" which might have memberId now.\r\n        // Let's check sessionPlayers (Relational) because startSession should create them.\r\n\r\n        let hasMember = false;\r\n        if (activeSession.sessionPlayers && activeSession.sessionPlayers.length > 0) {\r\n            hasMember = activeSession.sessionPlayers.some((p: any) =>\r\n                p.member?.type === 'SOCIO' || p.member?.type === 'SOCIO_FUNDADOR'\r\n            );\r\n        } else {\r\n            // Fallback JSON (Legacy)\r\n            const players = (activeSession.players as any[]) || [];\r\n            hasMember = players.some((p: any) => p.role === 'SOCIO' || p.role === 'SOCIO_FUNDADOR');\r\n        }\r\n\r\n        if (hasMember) {\r\n            rate = rates.member;\r\n        }\r\n\r\n        if (activeSession.isTraining) rate *= 0.5;\r\n\r\n        timeCost = Math.ceil(hours * rate);\r\n        totalAmount = timeCost;\r\n    }\r\n\r\n    // --- CONSUMPTION ---\r\n    let consumptionTotal = 0;\r\n    const orders = (activeSession.orders as any[]) || [];\r\n    orders.forEach(item => {\r\n        consumptionTotal += (item.price * item.quantity);\r\n    });\r\n\r\n    return {\r\n        total: Math.ceil(totalAmount + consumptionTotal),\r\n        timeCost: Math.ceil(totalAmount), // For Cards, this is sum of all players time costs\r\n        consumptionTotal: consumptionTotal,\r\n        duration: durationMin,\r\n        endTime,\r\n        appliedRate: activeSession.table.type === 'CARDS' ? 'INDIVIDUAL' : (activeSession.isTraining ? 'ENTRENAMIENTO' : (totalAmount < (durationMin / 60 * rates.client) ? 'SOCIO' : 'CLIENTE'))\r\n    };\r\n}\r\n\r\nexport async function startSession(tableId: string, data: SessionData) {\r\n    const session = await auth();\r\n    if (!session?.user) {\r\n        return { success: false, error: 'No autorizado' };\r\n    }\r\n\r\n    try {\r\n        const table = await prisma.table.findUnique({\r\n            where: { id: tableId },\r\n            include: { currentSession: true }\r\n        });\r\n\r\n        if (!table) {\r\n            return { success: false, error: 'Mesa no encontrada' };\r\n        }\r\n\r\n        if (table.currentSession) {\r\n            return { success: false, error: 'La mesa ya tiene una sesión activa' };\r\n        }\r\n\r\n        // Create Start Time constant\r\n        const startTime = new Date();\r\n\r\n        // Prepare Player Data (Relational SessionPlayer creation needs to happen inside transaction)\r\n        // We just prepare the JSON for legacy support if needed, but the main logic is creating SessionPlayer relations.\r\n        const playersJSON = (data.players || []).map((p: any) => ({\r\n            ...p,\r\n            startTime: startTime.toISOString(),\r\n            isActive: true\r\n        }));\r\n\r\n        await prisma.$transaction(async (tx) => {\r\n            const newSession = await tx.session.create({\r\n                data: {\r\n                    tableId: tableId,\r\n                    startTime: startTime,\r\n                    status: 'ACTIVE',\r\n                    players: playersJSON as unknown as Prisma.InputJsonValue,\r\n                    isTraining: data.isTraining,\r\n                }\r\n            });\r\n\r\n            // Create SessionPlayers\r\n            // data.players contains { id, name, role? } where id is memberId if registered\r\n            if (data.players && data.players.length > 0) {\r\n                for (const p of data.players) {\r\n                    const isMember = p.id && String(p.id).length > 5;\r\n                    const memberId = isMember ? String(p.id) : null;\r\n                    // Always save name as snapshot/guestName for redundancy\r\n                    const guestName = String(p.name);\r\n\r\n                    await tx.sessionPlayer.create({\r\n                        data: {\r\n                            sessionId: newSession.id,\r\n                            userId: null,\r\n                            memberId: memberId,\r\n                            guestName: guestName,\r\n                            startTime: startTime,\r\n                            status: 'ACTIVE'\r\n                        }\r\n                    });\r\n                }\r\n            }\r\n\r\n            await tx.table.update({\r\n                where: { id: tableId },\r\n                data: {\r\n                    status: TableStatus.OCCUPIED,\r\n                    currentSessionId: newSession.id\r\n                }\r\n            });\r\n        });\r\n\r\n        revalidatePath('/dashboard/tables');\r\n        return { success: true };\r\n    } catch (error) {\r\n        console.error('Error starting session:', error);\r\n        return { success: false, error: 'Error al abrir la mesa' };\r\n    }\r\n}\r\n\r\nexport async function addSessionConsumption(sessionId: string, items: { productId: string, name: string, price: number, quantity: number }[], targetUserId?: string) {\r\n    const session = await auth();\r\n    if (!session?.user) return { success: false, error: 'No autorizado' };\r\n\r\n    try {\r\n        const activeSession = await prisma.session.findUnique({\r\n            where: { id: sessionId },\r\n            select: { orders: true, status: true }\r\n        });\r\n\r\n        if (!activeSession || activeSession.status !== 'ACTIVE') {\r\n            return { success: false, error: 'Sesión no activa' };\r\n        }\r\n\r\n        // Fetch Active Shift\r\n        const activeShift = await prisma.shift.findFirst({ where: { status: 'OPEN' } });\r\n\r\n        await prisma.$transaction(async (tx) => {\r\n            // 1. Deduct Stock (Always)\r\n            for (const item of items) {\r\n                await tx.product.update({\r\n                    where: { id: item.productId },\r\n                    data: { stock: { decrement: item.quantity } }\r\n                });\r\n\r\n                // Log Movement\r\n                await tx.stockMovement.create({\r\n                    data: {\r\n                        productId: item.productId,\r\n                        type: 'ADJUSTMENT',\r\n                        quantity: -item.quantity,\r\n                        reason: `Consumo ${targetUserId ? 'Jugador' : 'Mesa'} (Session ${sessionId})`,\r\n                        userId: session.user.id\r\n                    }\r\n                });\r\n            }\r\n\r\n            // 2. Charge Logic\r\n            if (targetUserId) {\r\n                // targetUserId is effectively targetMemberId now\r\n                const memberId = targetUserId;\r\n\r\n                const total = items.reduce((sum, item) => sum + (item.price * item.quantity), 0);\r\n\r\n                // Create Sale associated with Member\r\n                await tx.sale.create({\r\n                    data: {\r\n                        sessionId: sessionId,\r\n                        userId: undefined,\r\n                        memberId: memberId,\r\n                        total: new Prisma.Decimal(total),\r\n                        method: 'ACCOUNT',\r\n                        shiftId: activeShift?.id, // Link to Active Shift\r\n                        items: items as unknown as Prisma.InputJsonValue\r\n                    }\r\n                });\r\n\r\n                // Update Member Debt\r\n                await tx.member.update({\r\n                    where: { id: memberId },\r\n                    data: { currentDebt: { increment: total } }\r\n                });\r\n\r\n            } else {\r\n                // Charge to Table (Add to Orders)\r\n                const currentOrders = (activeSession.orders as any[]) || [];\r\n                const newOrders = [...currentOrders, ...items];\r\n\r\n                // Consider migrating this to TableOrder eventually\r\n                await tx.session.update({\r\n                    where: { id: sessionId },\r\n                    data: { orders: newOrders }\r\n                });\r\n            }\r\n        });\r\n\r\n        revalidatePath('/dashboard/tables');\r\n        return { success: true };\r\n    } catch (error: any) {\r\n        console.error('Error adding consumption:', error);\r\n        return { success: false, error: error.message || 'Error desconocido al agregar consumo' };\r\n    }\r\n}\r\n\r\nexport async function getPricingPreview(sessionId: string) {\r\n    try {\r\n        const activeSession = await prisma.session.findUnique({\r\n            where: { id: sessionId },\r\n            include: {\r\n                table: true,\r\n                sessionPlayers: {\r\n                    include: { member: true }\r\n                }\r\n            }\r\n        });\r\n\r\n        if (!activeSession || activeSession.status !== 'ACTIVE') {\r\n            return { success: false, error: 'Sesión no válida' };\r\n        }\r\n\r\n        const calculation = await calculateSessionCost(activeSession);\r\n\r\n        // Fetch Processed Sales (Fiado/Direct charges linked to this session)\r\n        const processedSales = await prisma.sale.findMany({\r\n            where: {\r\n                sessionId: sessionId,\r\n                type: 'CONSUMPTION'\r\n            },\r\n            include: {\r\n                member: { select: { name: true } }\r\n            },\r\n            orderBy: { createdAt: 'desc' }\r\n        });\r\n\r\n        return {\r\n            success: true,\r\n            ...calculation,\r\n            processedSales,\r\n            pendingOrders: activeSession.orders // Sync fix: Return actual items from DB\r\n        };\r\n    } catch (error) {\r\n        console.error('Error calculating preview:', error);\r\n        return { success: false, error: 'Error al calcular precio' };\r\n    }\r\n}\r\n\r\nexport async function endSession(sessionId: string, payments?: { amount: number, method: string, userId?: string }[]) {\r\n    const session = await auth();\r\n    if (!session?.user) {\r\n        return { success: false, error: 'No autorizado' };\r\n    }\r\n\r\n    try {\r\n        const activeSession = await prisma.session.findUnique({\r\n            where: { id: sessionId },\r\n            include: {\r\n                table: true,\r\n                sessionPlayers: {\r\n                    include: { member: true }\r\n                }\r\n            }\r\n        });\r\n\r\n        if (!activeSession || activeSession.status !== 'ACTIVE') {\r\n            return { success: false, error: 'Sesión no válida o ya cerrada' };\r\n        }\r\n\r\n        const endTime = new Date();\r\n        const calculation = await calculateSessionCost(activeSession);\r\n\r\n        const totalToPay = calculation.total;\r\n\r\n        // Payment Validation\r\n        if (payments && payments.length > 0) {\r\n            const sum = payments.reduce((acc, p) => acc + p.amount, 0);\r\n            // Allow small margin error? No, exact matches.\r\n            if (Math.abs(sum - totalToPay) > 50) { // Tolerance 50 pesos\r\n                return { success: false, error: `El total de pagos ($${sum}) no coincide con el total a pagar ($${totalToPay})` };\r\n            }\r\n        } else {\r\n            // Default 1 payment cash/generic if not provided (Legacy fallback)\r\n            payments = [{ amount: totalToPay, method: 'CASH' }];\r\n        }\r\n\r\n        // Fetch Active Shift\r\n        const activeShift = await prisma.shift.findFirst({ where: { status: 'OPEN' } });\r\n\r\n        await prisma.$transaction(async (tx) => {\r\n            // 1. Close Session\r\n            await tx.session.update({\r\n                where: { id: sessionId },\r\n                data: {\r\n                    endTime: endTime,\r\n                    status: 'CLOSED',\r\n                    durationMin: calculation.duration,\r\n                    totalAmount: new Prisma.Decimal(totalToPay)\r\n                }\r\n            });\r\n\r\n            // 2. Free Table\r\n            await tx.table.update({\r\n                where: { id: activeSession.tableId },\r\n                data: {\r\n                    status: TableStatus.AVAILABLE,\r\n                    currentSessionId: null\r\n                }\r\n            });\r\n\r\n            // 3. Create Sales (Split Payments)\r\n            // ... (Orders logic kept same)\r\n\r\n            for (const payment of payments!) {\r\n                await tx.sale.create({\r\n                    data: {\r\n                        sessionId: sessionId,\r\n                        total: new Prisma.Decimal(payment.amount),\r\n                        method: payment.method,\r\n                        userId: undefined,\r\n                        memberId: payment.userId,\r\n                        shiftId: activeShift?.id, // Link to Active Shift\r\n                        items: [\r\n                            { name: \"Cierre de Mesa (Pago Parcial/Total)\", price: payment.amount, quantity: 1 }\r\n                        ]\r\n                    }\r\n                });\r\n\r\n                // If ACCOUNT payment (Fiado), increment Debt on Member\r\n                if (payment.method === 'ACCOUNT' && payment.userId) {\r\n                    await tx.member.update({\r\n                        where: { id: payment.userId }, // Assuming payment.userId is memberId passed from frontend\r\n                        data: { currentDebt: { increment: payment.amount } }\r\n                    });\r\n                }\r\n            }\r\n        });\r\n\r\n        revalidatePath('/dashboard/tables');\r\n        return { success: true, total: totalToPay };\r\n\r\n    } catch (error: any) {\r\n        console.error('Error ending session:', error);\r\n        return { success: false, error: 'Error al cerrar la mesa: ' + error.message };\r\n    }\r\n}\r\n\r\nexport async function getActiveSession(tableId: string) {\r\n    try {\r\n        const table = await prisma.table.findUnique({\r\n            where: { id: tableId },\r\n            include: {\r\n                currentSession: true\r\n            }\r\n        });\r\n\r\n        if (!table?.currentSession) return null;\r\n\r\n        return {\r\n            ...table.currentSession,\r\n            players: table.currentSession.players as unknown as SessionData['players']\r\n        };\r\n    } catch (error) {\r\n        return null;\r\n    }\r\n}\r\n\r\n\r\n\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\rokat\\OneDrive\\Proyectos\\Akapoolco\\src\\app\\lib\\actions-shifts.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is defined but never used.","line":64,"column":14,"nodeType":"Identifier","messageId":"unusedVar","endLine":64,"endColumn":19},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":107,"column":39,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":107,"endColumn":42,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3267,3270],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3267,3270],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":162,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":162,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4823,4826],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4823,4826],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use server\"\r\n\r\nimport { prisma } from \"@/lib/prisma\"\r\nimport { revalidatePath } from \"next/cache\"\r\n\r\nexport async function openShift(userId: string, initialAmount: number) {\r\n    try {\r\n        // Check if there is already an open shift (globally or for this user? Usually globally for one cash drawer)\r\n        // System Manager Rules imply One Global Shift for the business usually, or per point of sale.\r\n        // Assuming single point of sale logic for now.\r\n        const activeShift = await prisma.shift.findFirst({\r\n            where: { status: \"OPEN\" }\r\n        })\r\n\r\n        if (activeShift) {\r\n            return { error: \"Ya existe un turno abierto.\" }\r\n        }\r\n\r\n        const shift = await prisma.shift.create({\r\n            data: {\r\n                startUserId: userId,\r\n                initialAmount,\r\n                status: \"OPEN\"\r\n            }\r\n        })\r\n\r\n        revalidatePath('/dashboard/shifts')\r\n        return { success: true, shift }\r\n    } catch (error) {\r\n        console.error(\"Failed to open shift:\", error)\r\n        return { error: \"Error al abrir turno\" }\r\n    }\r\n}\r\n\r\nexport async function closeShift(shiftId: string, userId: string, finalAmount: number) {\r\n    try {\r\n        const shift = await prisma.shift.update({\r\n            where: { id: shiftId },\r\n            data: {\r\n                endUserId: userId,\r\n                finalAmount,\r\n                closedAt: new Date(),\r\n                status: \"CLOSED\"\r\n            }\r\n        })\r\n\r\n        revalidatePath('/dashboard/shifts')\r\n        return { success: true, shift }\r\n    } catch (error) {\r\n        console.error(\"Failed to close shift:\", error)\r\n        return { error: \"Error al cerrar turno\" }\r\n    }\r\n}\r\n\r\nexport async function getCurrentShift() {\r\n    try {\r\n        return await prisma.shift.findFirst({\r\n            where: { status: \"OPEN\" },\r\n            include: {\r\n                startUser: true,\r\n                sales: true\r\n            }\r\n        })\r\n    } catch (error) {\r\n        return null\r\n    }\r\n}\r\n\r\nexport async function getActiveShiftDetails() {\r\n    try {\r\n        const activeShift = await prisma.shift.findFirst({\r\n            where: { status: \"OPEN\" },\r\n            include: {\r\n                sales: {\r\n                    include: { user: { select: { name: true } } }\r\n                }\r\n            }\r\n        })\r\n\r\n        if (!activeShift) return null\r\n\r\n        // Aggregations\r\n        const summary = {\r\n            total: 0,\r\n            cash: 0,\r\n            card: 0,\r\n            transfer: 0,\r\n            byType: {\r\n                CONSUMPTION: 0,\r\n                DEBT_PAYMENT: 0,\r\n                MEMBERSHIP: 0\r\n            },\r\n            salesCount: activeShift.sales.length\r\n        }\r\n\r\n        activeShift.sales.forEach(sale => {\r\n            const amount = Number(sale.total)\r\n            summary.total += amount\r\n\r\n            // By Method\r\n            if (sale.method === 'CASH') summary.cash += amount\r\n            else if (sale.method === 'CARD') summary.card += amount\r\n            else if (sale.method === 'TRANSFER') summary.transfer += amount\r\n\r\n            // By Type\r\n            // Cast to string to avoid specific enum index issues if types aren't fully reloaded\r\n            const saleType = (sale as any).type || 'CONSUMPTION';\r\n\r\n            if (summary.byType[saleType as keyof typeof summary.byType] !== undefined) {\r\n                summary.byType[saleType as keyof typeof summary.byType] += amount\r\n            } else {\r\n                summary.byType['CONSUMPTION'] += amount\r\n            }\r\n        })\r\n\r\n        return {\r\n            shift: activeShift,\r\n            summary\r\n        }\r\n\r\n    } catch (error) {\r\n        console.error(\"Error fetching shift details:\", error)\r\n        return null\r\n    }\r\n}\r\n\r\nexport async function getShiftSummary(shiftId: string) {\r\n    const shift = await prisma.shift.findUnique({\r\n        where: { id: shiftId },\r\n        include: {\r\n            sales: {\r\n                include: { user: { select: { name: true } } }\r\n            },\r\n            startUser: true,\r\n            endUser: true\r\n        }\r\n    })\r\n\r\n    if (!shift) return null;\r\n\r\n    // Recalculate summaris for closed shifts same way\r\n    const summary = {\r\n        total: 0,\r\n        cash: 0,\r\n        card: 0,\r\n        transfer: 0,\r\n        byType: {\r\n            CONSUMPTION: 0,\r\n            DEBT_PAYMENT: 0,\r\n            MEMBERSHIP: 0\r\n        },\r\n        salesCount: shift.sales.length\r\n    }\r\n\r\n    shift.sales.forEach(sale => {\r\n        const amount = Number(sale.total)\r\n        summary.total += amount\r\n        if (sale.method === 'CASH') summary.cash += amount\r\n        else if (sale.method === 'CARD') summary.card += amount\r\n        else if (sale.method === 'TRANSFER') summary.transfer += amount\r\n\r\n        const saleType = (sale as any).type || 'CONSUMPTION';\r\n        if (summary.byType[saleType as keyof typeof summary.byType] !== undefined) {\r\n            summary.byType[saleType as keyof typeof summary.byType] += amount\r\n        } else {\r\n            summary.byType['CONSUMPTION'] += amount\r\n        }\r\n    })\r\n\r\n    return { shift, summary }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\rokat\\OneDrive\\Proyectos\\Akapoolco\\src\\app\\lib\\actions-tables.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\rokat\\OneDrive\\Proyectos\\Akapoolco\\src\\app\\lib\\actions-users.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is defined but never used.","line":114,"column":14,"nodeType":"Identifier","messageId":"unusedVar","endLine":114,"endColumn":19}],"suppressedMessages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":67,"column":77,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":67,"endColumn":80,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2535,2538],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2535,2538],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":73,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":73,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2708,2711],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2708,2711],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/* eslint-disable @typescript-eslint/no-explicit-any */\r\n\"use server\"\r\n\r\nimport { prisma } from \"@/lib/prisma\"\r\nimport { auth } from \"@/auth\"\r\nimport { hasPermission } from \"@/lib/permissions\"\r\nimport bcrypt from \"bcryptjs\"\r\nimport { revalidatePath } from \"next/cache\"\r\nimport { z } from \"zod\"\r\n\r\nconst userSchema = z.object({\r\n    name: z.string().min(2, \"El nombre debe tener al menos 2 caracteres\"),\r\n    email: z.string().email(\"Correo electrónico inválido\"),\r\n    password: z.string().min(6, \"La contraseña debe tener al menos 6 caracteres\"),\r\n    role: z.enum([\"ADMIN\", \"STAFF\", \"SUPERUSER\"]),\r\n    customPermissions: z.record(z.string(), z.boolean()).optional(),\r\n})\r\n\r\nexport async function createUser(data: z.infer<typeof userSchema>) {\r\n    const session = await auth()\r\n\r\n    // 1. Authentication Check\r\n    if (!session?.user?.id) {\r\n        return { error: \"No autorizado. Debe iniciar sesión.\" }\r\n    }\r\n\r\n    // 2. Permission Check\r\n    const currentUser = await prisma.user.findUnique({ where: { id: session.user.id } })\r\n    if (!currentUser || !hasPermission(currentUser.role, \"MANAGE_USERS\")) {\r\n        return { error: \"Acceso denegado. No tiene permisos para crear usuarios.\" }\r\n    }\r\n\r\n    // 3. Logic Check\r\n    if (data.role === \"SUPERUSER\" && currentUser.role !== \"SUPERUSER\") {\r\n        return { error: \"Solo un Superusuario puede crear otros Superusuarios.\" }\r\n    }\r\n    // Relaxed Rule: Admins can create Admins\r\n    // if (data.role === \"ADMIN\" && currentUser.role !== \"SUPERUSER\") {\r\n    //    return { error: \"Solo un Superusuario puede crear Administradores.\" }\r\n    // }\r\n\r\n    // 4. Validation\r\n    const validation = userSchema.safeParse(data)\r\n    if (!validation.success) {\r\n        // Use .issues for ZodError\r\n        return { error: validation.error.issues[0].message }\r\n    }\r\n\r\n    const trustedData = validation.data\r\n\r\n    try {\r\n        // Check duplicate email\r\n        const existing = await prisma.user.findUnique({ where: { email: trustedData.email } })\r\n        if (existing) {\r\n            return { error: \"El correo electrónico ya está registrado.\" }\r\n        }\r\n\r\n        const hashedPassword = await bcrypt.hash(trustedData.password, 10)\r\n\r\n        await prisma.user.create({\r\n            data: {\r\n                name: trustedData.name,\r\n                email: trustedData.email,\r\n                password: hashedPassword,\r\n                role: trustedData.role,\r\n                systemAccess: true,\r\n                customPermissions: (trustedData.customPermissions ?? {}) as any\r\n            }\r\n        })\r\n\r\n        revalidatePath(\"/dashboard/users\")\r\n        return { success: true, message: \"Usuario creado exitosamente.\" }\r\n    } catch (error: any) {\r\n        console.error(\"Error creating user:\", error)\r\n        return { error: `Error al crear usuario: ${error.message}` } // Expose error for debugging\r\n    }\r\n}\r\n\r\nexport async function getUsers() {\r\n    const session = await auth()\r\n    if (!session?.user?.id) return []\r\n\r\n    const users = await prisma.user.findMany({\r\n        where: {\r\n            systemAccess: true\r\n        },\r\n        orderBy: { createdAt: \"desc\" }\r\n    })\r\n\r\n    return users.map(user => ({\r\n        ...user,\r\n        currentDebt: user.currentDebt.toNumber(),\r\n        debtLimit: user.debtLimit.toNumber()\r\n    }))\r\n}\r\n\r\nexport async function deleteUser(userId: string) {\r\n    const session = await auth()\r\n    if (!session?.user?.id) return { error: \"No autorizado\" }\r\n\r\n    const currentUser = await prisma.user.findUnique({ where: { id: session.user.id } })\r\n    if (!currentUser || !hasPermission(currentUser.role, \"MANAGE_USERS\")) {\r\n        return { error: \"No tiene permisos para eliminar usuarios.\" }\r\n    }\r\n\r\n    if (userId === currentUser.id) {\r\n        return { error: \"No puede eliminarse a sí mismo.\" }\r\n    }\r\n\r\n    try {\r\n        await prisma.user.delete({ where: { id: userId } })\r\n        revalidatePath(\"/dashboard/users\")\r\n        return { success: true, message: \"Usuario eliminado correctamente\" }\r\n    } catch (error) {\r\n        return { error: \"Error al eliminar usuario\" }\r\n    }\r\n}\r\n\r\n// --- PASSWORD MANAGEMENT ---\r\n\r\n/**\r\n * Admin Action: Reset user password manually.\r\n */\r\nexport async function resetUserPassword(userId: string, newPassword: string) {\r\n    const session = await auth();\r\n    if (!session?.user?.id) return { error: \"No autorizado\" };\r\n\r\n    // Permission Check\r\n    const currentUser = await prisma.user.findUnique({ where: { id: session.user.id } });\r\n    if (!currentUser || !hasPermission(currentUser.role, \"MANAGE_USERS\")) {\r\n        return { error: \"No tiene permisos para gestionar usuarios.\" };\r\n    }\r\n\r\n    // Self-reset prevention? Not strictly necessary for admins, but 'changeOwnPassword' is preferred.\r\n    // Logic: Admin resets SOMEONE ELSE's password. \r\n    // If resetting own, they should use the other flow, but technically this works too.\r\n\r\n    try {\r\n        const hashedPassword = await bcrypt.hash(newPassword, 10);\r\n        await prisma.user.update({\r\n            where: { id: userId },\r\n            data: {\r\n                password: hashedPassword,\r\n                // Reset limit counters when admin resets it?\r\n                // Maybe yes, to unblock them.\r\n                passwordChangeCount: 0,\r\n                lastPasswordChangeDate: new Date()\r\n            }\r\n        });\r\n        return { success: true, message: \"Contraseña restablecida correctamente.\" };\r\n    } catch (error) {\r\n        console.error(\"Error resetting password:\", error);\r\n        return { error: \"Error al restablecer contraseña.\" };\r\n    }\r\n}\r\n\r\n/**\r\n * User Action: Change own password.\r\n * Rate Limit: Max 4 times per month.\r\n */\r\nexport async function changeOwnPassword(currentPassword: string, newPassword: string) {\r\n    const session = await auth();\r\n    if (!session?.user?.id) return { error: \"No autorizado\" };\r\n\r\n    try {\r\n        const user = await prisma.user.findUnique({ where: { id: session.user.id } });\r\n        if (!user || !user.password) return { error: \"Usuario no encontrado.\" };\r\n\r\n        // 1. Verify Current Password\r\n        const isValid = await bcrypt.compare(currentPassword, user.password);\r\n        if (!isValid) return { error: \"La contraseña actual es incorrecta.\" };\r\n\r\n        // 2. Rate Limiting Logic\r\n        const now = new Date();\r\n        const lastChange = user.lastPasswordChangeDate ? new Date(user.lastPasswordChangeDate) : null;\r\n\r\n        let currentCount = user.passwordChangeCount;\r\n\r\n        // Reset count if new month\r\n        if (lastChange) {\r\n            if (lastChange.getMonth() !== now.getMonth() || lastChange.getFullYear() !== now.getFullYear()) {\r\n                currentCount = 0;\r\n            }\r\n        }\r\n\r\n        if (currentCount >= 4) {\r\n            return { error: \"Ha excedido el límite de 4 cambios de contraseña por mes.\" };\r\n        }\r\n\r\n        // 3. Update Password\r\n        const hashedPassword = await bcrypt.hash(newPassword, 10);\r\n\r\n        await prisma.user.update({\r\n            where: { id: user.id },\r\n            data: {\r\n                password: hashedPassword,\r\n                passwordChangeCount: currentCount + 1,\r\n                lastPasswordChangeDate: now\r\n            }\r\n        });\r\n\r\n        return {\r\n            success: true,\r\n            message: \"Contraseña actualizada exitosamente.\",\r\n            remainingChanges: 4 - (currentCount + 1)\r\n        };\r\n\r\n    } catch (error) {\r\n        console.error(\"Change password error:\", error);\r\n        return { error: \"Error al cambiar la contraseña.\" };\r\n    }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\rokat\\OneDrive\\Proyectos\\Akapoolco\\src\\app\\lib\\actions-waiting-list.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is defined but never used.","line":27,"column":14,"nodeType":"Identifier","messageId":"unusedVar","endLine":27,"endColumn":19},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is defined but never used.","line":40,"column":14,"nodeType":"Identifier","messageId":"unusedVar","endLine":40,"endColumn":19}],"suppressedMessages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":15,"column":26,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":15,"endColumn":29,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[379,382],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[379,382],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":34,"column":26,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":34,"endColumn":29,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1073,1076],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1073,1076],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":46,"column":29,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":46,"endColumn":32,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1416,1419],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1416,1419],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/* eslint-disable @typescript-eslint/no-explicit-any */\r\n\"use server\"\r\n\r\nimport { prisma } from \"@/lib/prisma\"\r\nimport { revalidatePath } from \"next/cache\"\r\nimport { TableType } from \"@prisma/client\"\r\n\r\nexport async function addToWaitingList(data: {\r\n    name: string\r\n    phone?: string\r\n    gameType: TableType\r\n    partySize: number\r\n}) {\r\n    try {\r\n        await (prisma as any).waitingList.create({\r\n            data: {\r\n                name: data.name,\r\n                phone: data.phone,\r\n                gameType: data.gameType,\r\n                partySize: data.partySize,\r\n                status: \"WAITING\"\r\n            }\r\n        })\r\n        revalidatePath('/dashboard/cockpit') // Make sure cockpit sees it? Or dedicated page\r\n        revalidatePath('/dashboard/waiting-list')\r\n        return { success: true }\r\n    } catch (error) {\r\n        return { error: \"Error al agregar a lista de espera\" }\r\n    }\r\n}\r\n\r\nexport async function updateWaitingStatus(id: string, status: \"NOTIFIED\" | \"SEATED\" | \"CANCELLED\" | \"NO_SHOW\") {\r\n    try {\r\n        await (prisma as any).waitingList.update({\r\n            where: { id },\r\n            data: { status }\r\n        })\r\n        revalidatePath('/dashboard/waiting-list')\r\n        return { success: true }\r\n    } catch (error) {\r\n        return { error: \"Error al actualizar estado\" }\r\n    }\r\n}\r\n\r\nexport async function getWaitingList() {\r\n    return await (prisma as any).waitingList.findMany({\r\n        where: {\r\n            status: { in: [\"WAITING\", \"NOTIFIED\"] }\r\n        },\r\n        orderBy: { createdAt: 'asc' }\r\n    })\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\rokat\\OneDrive\\Proyectos\\Akapoolco\\src\\app\\lib\\actions.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'result' is assigned a value but never used.","line":9,"column":15,"nodeType":"Identifier","messageId":"unusedVar","endLine":9,"endColumn":21}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use server\"\r\n\r\nimport { signIn } from \"@/auth\"\r\nimport { AuthError } from \"next-auth\"\r\n\r\nexport async function authenticate(formData: FormData) {\r\n    try {\r\n        console.log(\"🔐 Attempting login with:\", Object.fromEntries(formData))\r\n        const result = await signIn(\"credentials\", {\r\n            email: formData.get(\"email\") as string,\r\n            password: formData.get(\"password\") as string,\r\n            redirectTo: \"/dashboard\",\r\n        })\r\n        console.log(\"✅ Login successful\")\r\n        return { success: true }\r\n    } catch (error) {\r\n        console.error(\"❌ Login error:\", error)\r\n        if (error instanceof AuthError) {\r\n            switch (error.type) {\r\n                case \"CredentialsSignin\":\r\n                    return { error: \"Invalid credentials.\" }\r\n                default:\r\n                    return { error: \"Something went wrong.\" }\r\n            }\r\n        }\r\n        throw error\r\n    }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\rokat\\OneDrive\\Proyectos\\Akapoolco\\src\\app\\lib\\business-rules.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'User' is defined but never used.","line":1,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":1,"endColumn":14,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"User"},"fix":{"range":[9,14],"text":""},"desc":"Remove unused variable \"User\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'SessionPlayer' is defined but never used.","line":1,"column":54,"nodeType":"Identifier","messageId":"unusedVar","endLine":1,"endColumn":67,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"SessionPlayer"},"fix":{"range":[51,66],"text":""},"desc":"Remove unused variable \"SessionPlayer\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'user' is defined but never used.","line":75,"column":38,"nodeType":"Identifier","messageId":"unusedVar","endLine":75,"endColumn":42}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { User, UserType, UserStatus, Table, Product, SessionPlayer } from \"@prisma/client\";\r\n\r\n// Constants for Rules\r\nexport const MEMBER_GRACE_PERIOD_DAYS = 30;\r\n\r\n/**\r\n * Determines if a user is considered an Active Member (Socio/Fundador)\r\n * Rules:\r\n * - Must be SOCIO or SOCIO_FUNDADOR\r\n * - Status must be ACTIVE\r\n * - OR Status INACTIVE but within grace period (handled by caller typically, but here we enforce strict status)\r\n * \r\n * Note: The 30-day rule pushes them to INACTIVE, so checking status === ACTIVE is usually sufficient.\r\n */\r\nexport function isUserActiveMember(user: { type: UserType; status: UserStatus; membershipExpiresAt?: Date | null } | null): boolean {\r\n    if (!user) return false;\r\n\r\n    // Must be a Member Type\r\n    if (user.type !== \"SOCIO\" && user.type !== \"SOCIO_FUNDADOR\") return false;\r\n\r\n    // Must be explicitly ACTIVE (not Banned/Deleted)\r\n    if (user.status !== \"ACTIVE\") return false;\r\n\r\n    // Check Expiration + Grace Period\r\n    // If no expiration date, assume active (legacy) or indefinite\r\n    if (!user.membershipExpiresAt) return true;\r\n\r\n    const now = new Date();\r\n    const gracePeriodEnd = new Date(user.membershipExpiresAt);\r\n    gracePeriodEnd.setDate(gracePeriodEnd.getDate() + MEMBER_GRACE_PERIOD_DAYS); // 30 Days Grace\r\n\r\n    // If Now is after Grace Period End, they are NOT active member (Financial Inactivity)\r\n    if (now > gracePeriodEnd) {\r\n        return false;\r\n    }\r\n\r\n    return true;\r\n}\r\n\r\n/**\r\n * Calculates the product price for a specific user.\r\n * Returns member price if user is an active member, otherwise client price.\r\n */\r\nexport function calculateProductPrice(product: Product, user: { type: UserType; status: UserStatus; membershipExpiresAt?: Date | null } | null): number {\r\n    if (isUserActiveMember(user)) {\r\n        return Number(product.priceMember);\r\n    }\r\n    return Number(product.priceClient);\r\n}\r\n\r\n/**\r\n * Calculates the hourly rate for a table session/player.\r\n * \r\n * Logic:\r\n * - Pool/Snooker (Per Table): \r\n *   - If the payer (or session starter) is a Member, use priceMember for the whole table.\r\n *   - Else, priceClient.\r\n *   - **Note**: This logic often resides in the Session creation, but we provide the helper here.\r\n * \r\n * - Cards (Per Person):\r\n *   - Each player pays based on their own status.\r\n */\r\nexport function calculateTableRate(table: Table, user: { type: UserType; status: UserStatus; membershipExpiresAt?: Date | null } | null): number {\r\n    if (isUserActiveMember(user)) {\r\n        return Number(table.priceMember);\r\n    }\r\n    return Number(table.priceClient);\r\n}\r\n\r\n/**\r\n * Helper to check if a specific debt amount allows purchasing (credit check).\r\n * Currently the rule is \"Accumulates Debt\", so we just warn or track, but don't block \r\n * unless strictly enforced by a flag not yet fully implemented.\r\n */\r\nexport function canPurchaseOnAccount(user: { currentDebt: number; debtLimit: number }): boolean {\r\n    // Current Rule: \"accumulates debt now\" - permissive\r\n    // But we might want to flag if over limit\r\n    return true;\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\rokat\\OneDrive\\Proyectos\\Akapoolco\\src\\app\\login\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\rokat\\OneDrive\\Proyectos\\Akapoolco\\src\\app\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\rokat\\OneDrive\\Proyectos\\Akapoolco\\src\\app\\table\\[tableId]\\layout.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\rokat\\OneDrive\\Proyectos\\Akapoolco\\src\\app\\table\\[tableId]\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'notFound' is defined but never used.","line":3,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":3,"endColumn":18,"suggestions":[{"messageId":"removeUnusedImportDeclaration","data":{"varName":"notFound"},"fix":{"range":[123,166],"text":""},"desc":"Remove unused import declaration."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { getKioskState } from '@/app/lib/actions-kiosk';\r\nimport { KioskManager } from '@/components/kiosk/KioskManager';\r\nimport { notFound } from 'next/navigation';\r\n\r\ninterface PageProps {\r\n    params: Promise<{ tableId: string }>;\r\n}\r\n\r\nexport default async function TableKioskPage({ params }: PageProps) {\r\n    const { tableId } = await params;\r\n    const initialData = await getKioskState(tableId);\r\n\r\n    if (initialData.error) {\r\n        return (\r\n            <div className=\"h-screen flex items-center justify-center bg-black text-red-500\">\r\n                Error: {initialData.error}\r\n            </div>\r\n        );\r\n    }\r\n\r\n    return (\r\n        <KioskManager tableId={tableId} initialData={initialData} />\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\rokat\\OneDrive\\Proyectos\\Akapoolco\\src\\auth.config.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":24,"column":51,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":24,"endColumn":54,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[837,840],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[837,840],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import type { NextAuthConfig } from \"next-auth\"\r\n\r\nexport const authConfig = {\r\n    pages: {\r\n        signIn: \"/login\",\r\n    },\r\n    trustHost: true,\r\n    callbacks: {\r\n        authorized({ auth, request: { nextUrl } }) {\r\n            const isLoggedIn = !!auth?.user\r\n            const isOnDashboard = nextUrl.pathname.startsWith(\"/dashboard\")\r\n            if (isOnDashboard) {\r\n                if (isLoggedIn) return true\r\n                return false // Redirect unauthenticated users to login page\r\n            }\r\n            return true\r\n        },\r\n        session({ session, token }) {\r\n            if (token.sub && session.user) {\r\n                session.user.id = token.sub\r\n            }\r\n            // Agregar role a la sesión\r\n            if (token.role && session.user) {\r\n                session.user.role = token.role as any\r\n            }\r\n            return session\r\n        },\r\n        jwt({ token, user }) {\r\n            // Agregar role al token cuando el usuario se autentica\r\n            if (user) {\r\n                token.role = user.role\r\n            }\r\n            return token\r\n        }\r\n    },\r\n    providers: [], // Configured in auth.ts\r\n} satisfies NextAuthConfig\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\rokat\\OneDrive\\Proyectos\\Akapoolco\\src\\auth.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\rokat\\OneDrive\\Proyectos\\Akapoolco\\src\\components\\admin\\AdManager.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is defined but never used.","line":40,"column":18,"nodeType":"Identifier","messageId":"unusedVar","endLine":40,"endColumn":23},{"ruleId":"@next/next/no-img-element","severity":1,"message":"Using `<img>` could result in slower LCP and higher bandwidth. Consider using `<Image />` from `next/image` or a custom image loader to automatically optimize images. This may incur additional usage or cost from your provider. See: https://nextjs.org/docs/messages/no-img-element","line":130,"column":33,"nodeType":"JSXOpeningElement","endLine":130,"endColumn":168}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport { useState } from 'react';\r\nimport { uploadAdBanner, toggleAdStatus, deleteAd } from '@/app/lib/actions-ads';\r\nimport { Button } from '@/components/ui/button';\r\nimport { Switch } from '@/components/ui/switch';\r\nimport { Input } from '@/components/ui/input';\r\nimport { Label } from '@/components/ui/label';\r\nimport { toast } from 'sonner';\r\nimport { Loader2, Trash2, Upload, MonitorPlay, Image as ImageIcon } from 'lucide-react';\r\nimport { AdBanner } from '@prisma/client';\r\nimport { cn } from '@/lib/utils';\r\n\r\ninterface AdManagerProps {\r\n    initialAds: AdBanner[];\r\n}\r\n\r\nexport function AdManager({ initialAds }: AdManagerProps) {\r\n    const [ads, setAds] = useState<AdBanner[]>(initialAds);\r\n    const [isUploading, setIsUploading] = useState(false);\r\n\r\n    // Upload Handler\r\n    const handleUpload = async (e: React.FormEvent<HTMLFormElement>) => {\r\n        e.preventDefault();\r\n        setIsUploading(true);\r\n\r\n        const formData = new FormData(e.currentTarget);\r\n\r\n        try {\r\n            const result = await uploadAdBanner(formData);\r\n            if (result.error) {\r\n                toast.error(result.error);\r\n            } else if (result.success && result.ad) {\r\n                toast.success('Anuncio subido correctamente');\r\n                // Optimistic update (or waiting for revalidate) - here we just refetch handled by page reload or we can append\r\n                // Ideally server revalidates and we might need to router.refresh(), but manual append works for instant feedback\r\n                setAds(prev => [result.ad!, ...prev]);\r\n                (e.target as HTMLFormElement).reset();\r\n            }\r\n        } catch (error) {\r\n            toast.error('Error de conexión');\r\n        } finally {\r\n            setIsUploading(false);\r\n        }\r\n    };\r\n\r\n    // Toggle Handler\r\n    const handleToggle = async (id: string, currentStatus: boolean) => {\r\n        // Optimistic UI\r\n        setAds(prev => prev.map(ad => ad.id === id ? { ...ad, active: !currentStatus } : ad));\r\n\r\n        const result = await toggleAdStatus(id, !currentStatus);\r\n        if (result.error) {\r\n            toast.error(result.error);\r\n            // Revert\r\n            setAds(prev => prev.map(ad => ad.id === id ? { ...ad, active: currentStatus } : ad));\r\n        }\r\n    };\r\n\r\n    // Delete Handler\r\n    const handleDelete = async (id: string, imageUrl: string) => {\r\n        if (!confirm('¿Seguro que deseas eliminar este anuncio permanentemente?')) return;\r\n\r\n        // Optimistic UI\r\n        setAds(prev => prev.filter(ad => ad.id !== id));\r\n\r\n        const result = await deleteAd(id, imageUrl);\r\n        if (result.error) {\r\n            toast.error(result.error);\r\n            // Revert (trickier without fetching, but less critical for delete)\r\n            toast.warning('Recarga la página si el error persiste');\r\n        } else {\r\n            toast.success('Anuncio eliminado');\r\n        }\r\n    };\r\n\r\n    return (\r\n        <div className=\"space-y-8\">\r\n            {/* Upload Section */}\r\n            <div className=\"bg-slate-900/50 border-2 border-dashed border-slate-700 rounded-xl p-8 flex flex-col items-center justify-center text-center hover:bg-slate-900/80 transition-colors\">\r\n                <form onSubmit={handleUpload} className=\"w-full max-w-md space-y-4\">\r\n                    <div className=\"space-y-2\">\r\n                        <div className=\"w-16 h-16 bg-blue-600/20 text-blue-400 rounded-full flex items-center justify-center mx-auto mb-4\">\r\n                            <Upload className=\"w-8 h-8\" />\r\n                        </div>\r\n                        <h3 className=\"text-xl font-bold text-white\">Subir Nuevo Anuncio</h3>\r\n                        <p className=\"text-sm text-slate-400\">Arrastra una imagen o selecciónala (JPG, PNG, WEBP)</p>\r\n                    </div>\r\n\r\n                    <div className=\"grid gap-4 bg-slate-950 p-4 rounded-lg border border-slate-800 text-left\">\r\n                        <div className=\"space-y-2\">\r\n                            <Label htmlFor=\"title\" className=\"text-slate-300\">Título / Descripción</Label>\r\n                            <Input name=\"title\" id=\"title\" placeholder=\"Ej: Promo Pisco Sour\" required className=\"bg-slate-900 border-slate-700\" />\r\n                        </div>\r\n                        <div className=\"space-y-2\">\r\n                            <Label htmlFor=\"file\" className=\"text-slate-300\">Imagen</Label>\r\n                            <Input name=\"file\" id=\"file\" type=\"file\" accept=\"image/*\" required className=\"bg-slate-900 border-slate-700 file:text-blue-400\" />\r\n                        </div>\r\n                    </div>\r\n\r\n                    <Button type=\"submit\" disabled={isUploading} className=\"w-full bg-blue-600 hover:bg-blue-500 font-bold\">\r\n                        {isUploading ? <><Loader2 className=\"mr-2 h-4 w-4 animate-spin\" /> Subiendo...</> : 'Publicar Anuncio'}\r\n                    </Button>\r\n                </form>\r\n            </div>\r\n\r\n            {/* Gallery Grid */}\r\n            <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6\">\r\n                {ads.map((ad) => (\r\n                    <div key={ad.id} className={cn(\r\n                        \"group relative rounded-xl overflow-hidden border transition-all duration-300 bg-slate-900\",\r\n                        ad.active ? \"border-slate-700 shadow-lg\" : \"border-slate-800 opacity-60 grayscale hover:grayscale-0 hover:opacity-100\"\r\n                    )}>\r\n                        {/* Status Badge */}\r\n                        <div className=\"absolute top-3 left-3 z-10\">\r\n                            {ad.active ? (\r\n                                <span className=\"bg-emerald-500/90 text-white text-xs font-bold px-2 py-1 rounded-full flex items-center gap-1 backdrop-blur-sm\">\r\n                                    <MonitorPlay className=\"w-3 h-3\" /> ACTIVO\r\n                                </span>\r\n                            ) : (\r\n                                <span className=\"bg-slate-500/90 text-white text-xs font-bold px-2 py-1 rounded-full backdrop-blur-sm\">\r\n                                    INACTIVO\r\n                                </span>\r\n                            )}\r\n                        </div>\r\n\r\n                        {/* Image Preview */}\r\n                        <div className=\"aspect-video w-full bg-slate-950 relative overflow-hidden\">\r\n                            {ad.imageUrl ? (\r\n                                <img src={ad.imageUrl} alt={ad.title} className=\"w-full h-full object-cover transition-transform duration-700 group-hover:scale-105\" />\r\n                            ) : (\r\n                                <div className=\"w-full h-full flex items-center justify-center text-slate-700\"><ImageIcon className=\"w-12 h-12\" /></div>\r\n                            )}\r\n                        </div>\r\n\r\n                        {/* Controls */}\r\n                        <div className=\"p-4 space-y-4\">\r\n                            <div>\r\n                                <h4 className=\"font-bold text-white truncate\" title={ad.title}>{ad.title}</h4>\r\n                                <p className=\"text-xs text-slate-500\">{new Date(ad.createdAt).toLocaleDateString()}</p>\r\n                            </div>\r\n\r\n                            <div className=\"flex items-center justify-between pt-2 border-t border-slate-800\">\r\n                                <div className=\"flex items-center gap-2\">\r\n                                    <Switch\r\n                                        checked={ad.active}\r\n                                        onCheckedChange={() => handleToggle(ad.id, ad.active)}\r\n                                    />\r\n                                    <span className=\"text-xs font-medium text-slate-400\">\r\n                                        {ad.active ? 'Visible' : 'Oculto'}\r\n                                    </span>\r\n                                </div>\r\n\r\n                                <Button\r\n                                    variant=\"ghost\"\r\n                                    size=\"icon\"\r\n                                    className=\"text-red-400 hover:text-red-300 hover:bg-red-900/20\"\r\n                                    onClick={() => handleDelete(ad.id, ad.imageUrl)}\r\n                                >\r\n                                    <Trash2 className=\"w-4 h-4\" />\r\n                                </Button>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                ))}\r\n\r\n                {ads.length === 0 && (\r\n                    <div className=\"col-span-full py-12 text-center text-slate-500\">\r\n                        <div className=\"w-16 h-16 bg-slate-900 rounded-full flex items-center justify-center mx-auto mb-4 border border-slate-800\">\r\n                            <ImageIcon className=\"w-8 h-8 opacity-20\" />\r\n                        </div>\r\n                        <p>No hay anuncios cargados aún.</p>\r\n                    </div>\r\n                )}\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\rokat\\OneDrive\\Proyectos\\Akapoolco\\src\\components\\admin\\CopyButton.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\rokat\\OneDrive\\Proyectos\\Akapoolco\\src\\components\\admin\\HistoricalUploadDialog.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'DialogFooter' is defined but never used.","line":5,"column":75,"nodeType":"Identifier","messageId":"unusedVar","endLine":5,"endColumn":87,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"DialogFooter"},"fix":{"range":[181,195],"text":""},"desc":"Remove unused variable \"DialogFooter\"."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`\"` can be escaped with `&quot;`, `&ldquo;`, `&#34;`, `&rdquo;`.","line":95,"column":98,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&quot;"},"fix":{"range":[4142,4242],"text":" Estos registros actualizarán el estado de &quot;Al día\" de los socios pero\r\n                            "},"desc":"Replace with `&quot;`."},{"messageId":"replaceWithAlt","data":{"alt":"&ldquo;"},"fix":{"range":[4142,4242],"text":" Estos registros actualizarán el estado de &ldquo;Al día\" de los socios pero\r\n                            "},"desc":"Replace with `&ldquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#34;"},"fix":{"range":[4142,4242],"text":" Estos registros actualizarán el estado de &#34;Al día\" de los socios pero\r\n                            "},"desc":"Replace with `&#34;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rdquo;"},"fix":{"range":[4142,4242],"text":" Estos registros actualizarán el estado de &rdquo;Al día\" de los socios pero\r\n                            "},"desc":"Replace with `&rdquo;`."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`\"` can be escaped with `&quot;`, `&ldquo;`, `&#34;`, `&rdquo;`.","line":95,"column":105,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&quot;"},"fix":{"range":[4142,4242],"text":" Estos registros actualizarán el estado de \"Al día&quot; de los socios pero\r\n                            "},"desc":"Replace with `&quot;`."},{"messageId":"replaceWithAlt","data":{"alt":"&ldquo;"},"fix":{"range":[4142,4242],"text":" Estos registros actualizarán el estado de \"Al día&ldquo; de los socios pero\r\n                            "},"desc":"Replace with `&ldquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#34;"},"fix":{"range":[4142,4242],"text":" Estos registros actualizarán el estado de \"Al día&#34; de los socios pero\r\n                            "},"desc":"Replace with `&#34;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rdquo;"},"fix":{"range":[4142,4242],"text":" Estos registros actualizarán el estado de \"Al día&rdquo; de los socios pero\r\n                            "},"desc":"Replace with `&rdquo;`."}]}],"suppressedMessages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":17,"column":52,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":17,"endColumn":55,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[799,802],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[799,802],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":35,"column":53,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":35,"endColumn":56,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1582,1585],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1582,1585],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":35,"column":113,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":35,"endColumn":116,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1642,1645],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1642,1645],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":2,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/* eslint-disable @typescript-eslint/no-explicit-any */\r\n'use client';\r\n\r\nimport { useState } from 'react';\r\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogTrigger, DialogFooter } from '@/components/ui/dialog';\r\nimport { Button } from '@/components/ui/button';\r\nimport { Input } from '@/components/ui/input';\r\nimport { Label } from '@/components/ui/label';\r\nimport { toast } from 'sonner';\r\nimport { Upload, FileSpreadsheet, AlertCircle, Loader2 } from 'lucide-react';\r\nimport * as XLSX from 'xlsx';\r\nimport { uploadHistoricalPayments } from '@/app/lib/actions-admin-finance';\r\n\r\nexport function HistoricalUploadDialog() {\r\n    const [isOpen, setIsOpen] = useState(false);\r\n    const [isLoading, setIsLoading] = useState(false);\r\n    const [previewData, setPreviewData] = useState<any[]>([]);\r\n    const [fileStats, setFileStats] = useState<{ total: number } | null>(null);\r\n\r\n    const handleFileUpload = (e: React.ChangeEvent<HTMLInputElement>) => {\r\n        const file = e.target.files?.[0];\r\n        if (!file) return;\r\n\r\n        const reader = new FileReader();\r\n        reader.onload = (evt) => {\r\n            try {\r\n                const bstr = evt.target?.result;\r\n                const wb = XLSX.read(bstr, { type: 'binary' });\r\n                const wsname = wb.SheetNames[0];\r\n                const ws = wb.Sheets[wsname];\r\n                const data = XLSX.utils.sheet_to_json(ws);\r\n\r\n                // Validate structure\r\n                // Expected: rut, amount, paymentDate (YYYY-MM-DD), months\r\n                const validRows = data.filter((row: any) => row.rut && row.amount && row.paymentDate).map((row: any) => ({\r\n                    rut: String(row.rut).trim(),\r\n                    amount: Number(row.amount),\r\n                    paymentDate: row.paymentDate, // Date formatting might be tricky from Excel\r\n                    months: Number(row.months || 12)\r\n                }));\r\n\r\n                setPreviewData(validRows);\r\n                setFileStats({ total: validRows.length });\r\n\r\n                if (validRows.length === 0) {\r\n                    toast.error('No se encontraron filas válidas. Verifique el formato (rut, amount, paymentDate).');\r\n                }\r\n            } catch (error) {\r\n                console.error(error);\r\n                toast.error('Error al leer el archivo Excel.');\r\n            }\r\n        };\r\n        reader.readAsBinaryString(file);\r\n    };\r\n\r\n    const handleConfirm = async () => {\r\n        if (previewData.length === 0) return;\r\n        setIsLoading(true);\r\n\r\n        const result = await uploadHistoricalPayments(previewData);\r\n\r\n        setIsLoading(false);\r\n\r\n        if (result.success) {\r\n            toast.success(`Carga completada. ${result.count} registros procesados.`);\r\n            if (result.errors && result.errors.length > 0) {\r\n                toast.warning(`${result.errors.length} errores detectados. Revise consola.`);\r\n                console.warn(\"Import Errors:\", result.errors);\r\n            }\r\n            setIsOpen(false);\r\n            setPreviewData([]);\r\n            setFileStats(null);\r\n        } else {\r\n            toast.error(result.error || 'Error en la carga masiva.');\r\n        }\r\n    };\r\n\r\n    return (\r\n        <Dialog open={isOpen} onOpenChange={setIsOpen}>\r\n            <DialogTrigger asChild>\r\n                <Button variant=\"outline\" className=\"gap-2\">\r\n                    <Upload size={16} />\r\n                    Carga Histórica\r\n                </Button>\r\n            </DialogTrigger>\r\n            <DialogContent className=\"sm:max-w-lg\">\r\n                <DialogHeader>\r\n                    <DialogTitle>Carga de Pagos Históricos</DialogTitle>\r\n                </DialogHeader>\r\n\r\n                <div className=\"space-y-4 py-4\">\r\n                    <div className=\"bg-yellow-50 dark:bg-yellow-900/20 p-3 rounded-md border border-yellow-200 dark:border-yellow-800 text-sm flex gap-2\">\r\n                        <AlertCircle className=\"h-5 w-5 text-yellow-600 shrink-0\" />\r\n                        <div className=\"text-yellow-700 dark:text-yellow-400\">\r\n                            <strong>Atención:</strong> Estos registros actualizarán el estado de \"Al día\" de los socios pero\r\n                            <strong> NO afectarán</strong> los reportes de Caja ni Ingresos Reales del sistema actual.\r\n                        </div>\r\n                    </div>\r\n\r\n                    <div className=\"space-y-2\">\r\n                        <Label>Seleccionar Archivo Excel (.xlsx, .csv)</Label>\r\n                        <Input\r\n                            type=\"file\"\r\n                            accept=\".xlsx, .xls, .csv\"\r\n                            onChange={handleFileUpload}\r\n                        />\r\n                        <p className=\"text-xs text-muted-foreground\">\r\n                            Columnas esperadas: <code>rut</code>, <code>amount</code>, <code>paymentDate</code> (YYYY-MM-DD), <code>months</code>\r\n                        </p>\r\n                    </div>\r\n\r\n                    {fileStats && (\r\n                        <div className=\"bg-slate-50 dark:bg-slate-800 p-3 rounded text-center\">\r\n                            <div className=\"flex items-center justify-center gap-2 mb-2\">\r\n                                <FileSpreadsheet className=\"text-emerald-500\" />\r\n                                <span className=\"font-medium\">{fileStats.total} Registros Válidos</span>\r\n                            </div>\r\n                            <Button\r\n                                onClick={handleConfirm}\r\n                                disabled={isLoading}\r\n                                className=\"w-full\"\r\n                            >\r\n                                {isLoading ? <Loader2 className=\"animate-spin mr-2\" /> : null}\r\n                                Confirmar Importación\r\n                            </Button>\r\n                        </div>\r\n                    )}\r\n                </div>\r\n            </DialogContent>\r\n        </Dialog>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\rokat\\OneDrive\\Proyectos\\Akapoolco\\src\\components\\auth\\ChangePasswordDialog.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'err' is defined but never used.","line":55,"column":18,"nodeType":"Identifier","messageId":"unusedVar","endLine":55,"endColumn":21}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\"\r\n\r\nimport { useState } from \"react\"\r\nimport { Button } from \"@/components/ui/button\"\r\nimport {\r\n    Dialog,\r\n    DialogContent,\r\n    DialogHeader,\r\n    DialogTitle,\r\n    DialogDescription,\r\n    DialogFooter\r\n} from \"@/components/ui/dialog\"\r\nimport { Input } from \"@/components/ui/input\"\r\nimport { Label } from \"@/components/ui/label\"\r\nimport { toast } from \"sonner\"\r\nimport { changeOwnPassword } from \"@/app/lib/actions-users\"\r\nimport { Lock, AlertCircle } from \"lucide-react\"\r\n\r\ninterface ChangePasswordDialogProps {\r\n    open: boolean\r\n    onOpenChange: (open: boolean) => void\r\n}\r\n\r\nexport function ChangePasswordDialog({ open, onOpenChange }: ChangePasswordDialogProps) {\r\n    const [currentPassword, setCurrentPassword] = useState(\"\")\r\n    const [newPassword, setNewPassword] = useState(\"\")\r\n    const [confirmPassword, setConfirmPassword] = useState(\"\")\r\n    const [isLoading, setIsLoading] = useState(false)\r\n\r\n    const handleSubmit = async (e: React.FormEvent) => {\r\n        e.preventDefault()\r\n\r\n        if (newPassword !== confirmPassword) {\r\n            toast.error(\"Las nuevas contraseñas no coinciden\")\r\n            return\r\n        }\r\n\r\n        if (newPassword.length < 6) {\r\n            toast.error(\"La contraseña debe tener al menos 6 caracteres\")\r\n            return\r\n        }\r\n\r\n        setIsLoading(true)\r\n        try {\r\n            const res = await changeOwnPassword(currentPassword, newPassword)\r\n            if (res.error) {\r\n                toast.error(res.error)\r\n            } else {\r\n                toast.success(res.message)\r\n                if (res.remainingChanges !== undefined) {\r\n                    toast.info(`Cambios restantes este mes: ${res.remainingChanges}`)\r\n                }\r\n                handleClose()\r\n            }\r\n        } catch (err) {\r\n            toast.error(\"Error al cambiar contraseña\")\r\n        } finally {\r\n            setIsLoading(false)\r\n        }\r\n    }\r\n\r\n    const handleClose = () => {\r\n        setCurrentPassword(\"\")\r\n        setNewPassword(\"\")\r\n        setConfirmPassword(\"\")\r\n        onOpenChange(false)\r\n    }\r\n\r\n    return (\r\n        <Dialog open={open} onOpenChange={onOpenChange}>\r\n            <DialogContent className=\"sm:max-w-[425px] bg-slate-950 border-white/10 text-white\">\r\n                <DialogHeader>\r\n                    <DialogTitle>Cambiar Contraseña</DialogTitle>\r\n                    <DialogDescription>\r\n                        Ingrese su contraseña actual y la nueva contraseña deseada.\r\n                    </DialogDescription>\r\n                </DialogHeader>\r\n\r\n                <div className=\"bg-blue-900/20 border border-blue-500/20 p-3 rounded-md flex gap-3 text-sm text-blue-200 mb-4\">\r\n                    <AlertCircle className=\"w-5 h-5 flex-shrink-0 text-blue-400\" />\r\n                    <p>Por seguridad, tiene un límite de <strong>4 cambios de contraseña por mes</strong>.</p>\r\n                </div>\r\n\r\n                <form onSubmit={handleSubmit} className=\"space-y-4\">\r\n                    <div className=\"space-y-2\">\r\n                        <Label>Contraseña Actual</Label>\r\n                        <div className=\"relative\">\r\n                            <Lock className=\"absolute left-3 top-2.5 h-4 w-4 text-muted-foreground\" />\r\n                            <Input\r\n                                type=\"password\"\r\n                                className=\"pl-9 bg-black/20 border-white/10\"\r\n                                value={currentPassword}\r\n                                onChange={e => setCurrentPassword(e.target.value)}\r\n                                required\r\n                            />\r\n                        </div>\r\n                    </div>\r\n\r\n                    <div className=\"space-y-2\">\r\n                        <Label>Nueva Contraseña</Label>\r\n                        <Input\r\n                            type=\"password\"\r\n                            className=\"bg-black/20 border-white/10\"\r\n                            value={newPassword}\r\n                            onChange={e => setNewPassword(e.target.value)}\r\n                            minLength={6}\r\n                            required\r\n                        />\r\n                    </div>\r\n\r\n                    <div className=\"space-y-2\">\r\n                        <Label>Confirmar Nueva Contraseña</Label>\r\n                        <Input\r\n                            type=\"password\"\r\n                            className=\"bg-black/20 border-white/10\"\r\n                            value={confirmPassword}\r\n                            onChange={e => setConfirmPassword(e.target.value)}\r\n                            required\r\n                        />\r\n                    </div>\r\n\r\n                    <DialogFooter className=\"mt-4\">\r\n                        <Button type=\"button\" variant=\"ghost\" onClick={handleClose} className=\"hover:bg-white/10\">\r\n                            Cancelar\r\n                        </Button>\r\n                        <Button type=\"submit\" disabled={isLoading} className=\"bg-primary hover:bg-emerald-600\">\r\n                            {isLoading ? \"Actualizando...\" : \"Cambiar Contraseña\"}\r\n                        </Button>\r\n                    </DialogFooter>\r\n                </form>\r\n            </DialogContent>\r\n        </Dialog>\r\n    )\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\rokat\\OneDrive\\Proyectos\\Akapoolco\\src\\components\\cockpit\\table-card.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\rokat\\OneDrive\\Proyectos\\Akapoolco\\src\\components\\dashboard\\ActiveTablesWidget.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\rokat\\OneDrive\\Proyectos\\Akapoolco\\src\\components\\dashboard\\DebtorsWidget.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\rokat\\OneDrive\\Proyectos\\Akapoolco\\src\\components\\dashboard\\QuickSaleWidget.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'CardFooter' is defined but never used.","line":3,"column":52,"nodeType":"Identifier","messageId":"unusedVar","endLine":3,"endColumn":62,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"CardFooter"},"fix":{"range":[66,78],"text":""},"desc":"Remove unused variable \"CardFooter\"."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":25,"column":56,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":25,"endColumn":59,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1056,1059],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1056,1059],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":30,"column":52,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":30,"endColumn":55,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1281,1284],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1281,1284],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":31,"column":54,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":31,"endColumn":57,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1347,1350],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1347,1350],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":47,"column":33,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":47,"endColumn":36,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1871,1874],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1871,1874],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":4,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport { Card, CardHeader, CardTitle, CardContent, CardFooter } from \"@/components/ui/card\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { Input } from \"@/components/ui/input\";\r\nimport { Search, ShoppingCart, Trash2, User } from \"lucide-react\";\r\nimport { useState, useTransition } from \"react\";\r\nimport { searchProducts } from \"@/app/lib/actions-products\";\r\nimport { processDirectSale } from \"@/app/lib/actions-pos\";\r\nimport { searchMembers } from \"@/app/lib/actions-members\";\r\nimport { toast } from \"sonner\";\r\nimport { Dialog, DialogContent, DialogHeader, DialogTitle } from '@/components/ui/dialog';\r\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\r\nimport { Label } from \"@/components/ui/label\";\r\n\r\ninterface CartItem {\r\n    id: string; // product id\r\n    name: string;\r\n    price: number;\r\n    quantity: number;\r\n}\r\n\r\nexport function QuickSaleWidget() {\r\n    const [searchTerm, setSearchTerm] = useState('');\r\n    const [searchResults, setSearchResults] = useState<any[]>([]);\r\n    const [cart, setCart] = useState<CartItem[]>([]);\r\n\r\n    // User search (optional for Fiado)\r\n    const [userSearchTerm, setUserSearchTerm] = useState('');\r\n    const [userResults, setUserResults] = useState<any[]>([]);\r\n    const [selectedUser, setSelectedUser] = useState<any>(null);\r\n\r\n    const [isPaymentOpen, setIsPaymentOpen] = useState(false);\r\n    const [paymentMethod, setPaymentMethod] = useState('CASH');\r\n    const [isPending, startTransition] = useTransition();\r\n\r\n    const handleProductSearch = async (term: string) => {\r\n        setSearchTerm(term);\r\n        if (term.length < 2) {\r\n            setSearchResults([]);\r\n            return;\r\n        }\r\n        const results = await searchProducts(term);\r\n        setSearchResults(results);\r\n    };\r\n\r\n    const addToCart = (product: any) => {\r\n        setCart(prev => {\r\n            const existing = prev.find(p => p.id === product.id);\r\n            if (existing) {\r\n                return prev.map(p => p.id === product.id ? { ...p, quantity: p.quantity + 1 } : p);\r\n            }\r\n            return [...prev, { id: product.id, name: product.name, price: Number(product.priceClient), quantity: 1 }];\r\n        });\r\n        setSearchTerm('');\r\n        setSearchResults([]);\r\n        // Focus back on input?\r\n    };\r\n\r\n    const removeFromCart = (id: string) => {\r\n        setCart(prev => prev.filter(item => item.id !== id));\r\n    };\r\n\r\n    const cartTotal = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);\r\n\r\n    const handleUserSearch = async (term: string) => {\r\n        setUserSearchTerm(term);\r\n        if (term.length < 2) {\r\n            setUserResults([]);\r\n            return;\r\n        }\r\n        const results = await searchMembers(term);\r\n        setUserResults(results);\r\n    };\r\n\r\n    const handleProcessPayment = () => {\r\n        if (cart.length === 0) return;\r\n        if (paymentMethod === 'ACCOUNT' && !selectedUser) {\r\n            toast.error('Debe seleccionar un socio para Fiado');\r\n            return;\r\n        }\r\n\r\n        startTransition(async () => {\r\n            const items = cart.map(i => ({\r\n                productId: i.id,\r\n                name: i.name,\r\n                price: i.price,\r\n                quantity: i.quantity\r\n            }));\r\n\r\n            const res = await processDirectSale(items, paymentMethod, selectedUser?.id);\r\n\r\n            if (res.success) {\r\n                toast.success('Venta registrada');\r\n                setCart([]);\r\n                setPaymentMethod('CASH');\r\n                setSelectedUser(null);\r\n                setIsPaymentOpen(false);\r\n            } else {\r\n                toast.error(res.error || 'Error en venta');\r\n            }\r\n        });\r\n    };\r\n\r\n    return (\r\n        <Card className=\"bg-slate-950 border-white/10 h-full flex flex-col border-emerald-500/20 shadow-lg\">\r\n            <CardHeader className=\"pb-3 border-b border-white/5\">\r\n                <CardTitle className=\"text-slate-200 text-lg flex items-center gap-2\">\r\n                    <ShoppingCart className=\"w-5 h-5 text-emerald-400\" />\r\n                    Punto de Venta Rápido\r\n                </CardTitle>\r\n            </CardHeader>\r\n            <CardContent className=\"flex-1 flex flex-col gap-4 pt-4 min-h-[400px]\">\r\n\r\n                {/* Search Bar */}\r\n                <div className=\"relative z-20\">\r\n                    <Search className=\"absolute left-3 top-2.5 h-4 w-4 text-muted-foreground\" />\r\n                    <Input\r\n                        placeholder=\"Buscar producto (ej. Coca Cola)...\"\r\n                        className=\"pl-9 bg-slate-900 border-white/10 focus:border-emerald-500/50 transition-colors\"\r\n                        value={searchTerm}\r\n                        onChange={(e) => handleProductSearch(e.target.value)}\r\n                    />\r\n                    {searchResults.length > 0 && (\r\n                        <div className=\"absolute top-full left-0 right-0 mt-1 bg-slate-900 border border-white/10 rounded-md shadow-xl z-50 max-h-60 overflow-y-auto\">\r\n                            {searchResults.map(prod => (\r\n                                <div\r\n                                    key={prod.id}\r\n                                    className=\"p-3 hover:bg-emerald-900/20 cursor-pointer flex justify-between items-center border-b border-white/5 last:border-0\"\r\n                                    onClick={() => addToCart(prod)}\r\n                                >\r\n                                    <span className=\"font-medium text-slate-200\">{prod.name}</span>\r\n                                    <span className=\"text-emerald-400 font-mono\">${Number(prod.priceClient).toLocaleString()}</span>\r\n                                </div>\r\n                            ))}\r\n                        </div>\r\n                    )}\r\n                </div>\r\n\r\n                {/* Cart List */}\r\n                <div className=\"flex-1 bg-slate-900/30 rounded-lg p-2 overflow-y-auto space-y-2 border border-white/5\">\r\n                    {cart.length === 0 ? (\r\n                        <div className=\"h-full flex flex-col items-center justify-center text-slate-500 text-sm gap-2 opacity-50\">\r\n                            <ShoppingCart className=\"w-8 h-8\" />\r\n                            <span>Carro vacío</span>\r\n                        </div>\r\n                    ) : (\r\n                        cart.map(item => (\r\n                            <div key={item.id} className=\"flex items-center justify-between p-2 bg-slate-800/50 rounded group hover:bg-slate-800\">\r\n                                <div className=\"flex flex-col\">\r\n                                    <span className=\"font-medium text-sm text-slate-200\">{item.name}</span>\r\n                                    <span className=\"text-xs text-muted-foreground\">${item.price.toLocaleString()} x {item.quantity}</span>\r\n                                </div>\r\n                                <div className=\"flex items-center gap-3\">\r\n                                    <span className=\"font-mono text-emerald-400 text-sm\">${(item.price * item.quantity).toLocaleString()}</span>\r\n                                    <button\r\n                                        onClick={() => removeFromCart(item.id)}\r\n                                        className=\"text-slate-500 hover:text-red-400 transition-colors p-1\"\r\n                                    >\r\n                                        <Trash2 className=\"w-4 h-4\" />\r\n                                    </button>\r\n                                </div>\r\n                            </div>\r\n                        ))\r\n                    )}\r\n                </div>\r\n\r\n                {/* Totals & Action */}\r\n                <div className=\"mt-auto pt-2 space-y-4\">\r\n                    <div className=\"flex justify-between items-end border-t border-white/10 pt-4\">\r\n                        <div className=\"text-sm text-slate-400\">Total a Pagar</div>\r\n                        <div className=\"text-3xl font-bold text-white tracking-tight\">${cartTotal.toLocaleString('es-CL')}</div>\r\n                    </div>\r\n                    <Button\r\n                        className=\"w-full bg-emerald-600 hover:bg-emerald-500 text-white h-12 text-lg font-semibold shadow-[0_0_20px_rgba(16,185,129,0.2)]\"\r\n                        disabled={cart.length === 0}\r\n                        onClick={() => setIsPaymentOpen(true)}\r\n                    >\r\n                        Cobrar\r\n                    </Button>\r\n                </div>\r\n            </CardContent>\r\n\r\n            {/* Payment Modal inside Widget for speed */}\r\n            <Dialog open={isPaymentOpen} onOpenChange={setIsPaymentOpen}>\r\n                <DialogContent className=\"sm:max-w-md bg-slate-950 border-white/10 text-white\">\r\n                    <DialogHeader>\r\n                        <DialogTitle>Finalizar Venta Rápida</DialogTitle>\r\n                    </DialogHeader>\r\n                    <div className=\"space-y-4 py-2\">\r\n                        <div className=\"text-center py-4 bg-emerald-950/30 rounded border border-emerald-900/50\">\r\n                            <span className=\"text-3xl font-bold text-emerald-400\">${cartTotal.toLocaleString()}</span>\r\n                        </div>\r\n\r\n                        <div className=\"space-y-2\">\r\n                            <Label>Método de Pago</Label>\r\n                            <Select value={paymentMethod} onValueChange={setPaymentMethod}>\r\n                                <SelectTrigger className=\"bg-slate-900 border-white/10\">\r\n                                    <SelectValue />\r\n                                </SelectTrigger>\r\n                                <SelectContent>\r\n                                    <SelectItem value=\"CASH\">Efectivo</SelectItem>\r\n                                    <SelectItem value=\"CARD\">Tarjeta</SelectItem>\r\n                                    <SelectItem value=\"TRANSFER\">Transferencia</SelectItem>\r\n                                    <SelectItem value=\"ACCOUNT\">Fiado (Cta. Cte.)</SelectItem>\r\n                                </SelectContent>\r\n                            </Select>\r\n                        </div>\r\n\r\n                        {/* Optional User Assignment for History or Required for Debt */}\r\n                        <div className=\"space-y-2 pt-2 border-t border-white/5\">\r\n                            <Label className=\"flex justify-between\">\r\n                                <span>Asignar a Cliente / Socio <span className=\"text-slate-500 font-normal\">(Opcional)</span></span>\r\n                                {paymentMethod === 'ACCOUNT' && <span className=\"text-xs text-red-400 font-bold\">* Requerido para Fiado</span>}\r\n                            </Label>\r\n\r\n                            {!selectedUser ? (\r\n                                <div className=\"relative\">\r\n                                    <User className=\"absolute left-3 top-2.5 h-4 w-4 text-muted-foreground\" />\r\n                                    <Input\r\n                                        placeholder=\"Buscar por nombre...\"\r\n                                        className={`pl-9 bg-slate-900 border-white/10 ${paymentMethod === 'ACCOUNT' ? 'border-red-500/50' : ''}`}\r\n                                        value={userSearchTerm}\r\n                                        onChange={(e) => handleUserSearch(e.target.value)}\r\n                                    />\r\n                                    {userResults.length > 0 && (\r\n                                        <div className=\"absolute top-full left-0 right-0 mt-1 bg-slate-900 border border-white/10 rounded-md shadow-xl z-50 max-h-40 overflow-y-auto\">\r\n                                            {userResults.map(u => (\r\n                                                <div\r\n                                                    key={u.id}\r\n                                                    className=\"p-2 hover:bg-slate-800 cursor-pointer flex justify-between items-center text-sm\"\r\n                                                    onClick={() => { setSelectedUser(u); setUserSearchTerm(''); setUserResults([]); }}\r\n                                                >\r\n                                                    <div className=\"flex flex-col\">\r\n                                                        <span className=\"text-slate-200\">{u.name}</span>\r\n                                                        <span className=\"text-[10px] text-slate-500 capitalize\">{u.type?.toLowerCase().replace('_', ' ')}</span>\r\n                                                    </div>\r\n                                                    {Number(u.currentDebt) > 0 && <span className=\"text-xs text-red-400\">Deuda: ${Number(u.currentDebt).toLocaleString()}</span>}\r\n                                                </div>\r\n                                            ))}\r\n                                        </div>\r\n                                    )}\r\n                                </div>\r\n                            ) : (\r\n                                <div className=\"flex justify-between items-center p-2 bg-blue-900/20 border border-blue-500/30 rounded\">\r\n                                    <div className=\"flex items-center gap-2\">\r\n                                        <div className=\"h-6 w-6 rounded-full bg-blue-500/20 flex items-center justify-center text-blue-400 text-xs font-bold\">\r\n                                            {selectedUser.name.substring(0, 2).toUpperCase()}\r\n                                        </div>\r\n                                        <span className=\"font-medium text-blue-300 text-sm\">{selectedUser.name}</span>\r\n                                    </div>\r\n                                    <Button variant=\"ghost\" size=\"sm\" onClick={() => setSelectedUser(null)} className=\"h-6 text-xs hover:text-red-400\">\r\n                                        <Trash2 className=\"w-3 h-3\" />\r\n                                    </Button>\r\n                                </div>\r\n                            )}\r\n                        </div>\r\n\r\n                        <Button\r\n                            className=\"w-full mt-4 bg-emerald-600 hover:bg-emerald-500\"\r\n                            onClick={handleProcessPayment}\r\n                            disabled={isPending || (paymentMethod === 'ACCOUNT' && !selectedUser)}\r\n                        >\r\n                            {isPending ? 'Procesando...' : 'Confirmar Pago'}\r\n                        </Button>\r\n                    </div>\r\n                </DialogContent>\r\n            </Dialog>\r\n        </Card>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\rokat\\OneDrive\\Proyectos\\Akapoolco\\src\\components\\dashboard\\StatCards.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\rokat\\OneDrive\\Proyectos\\Akapoolco\\src\\components\\kiosk\\ActiveScreen.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":17,"column":14,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":17,"endColumn":17,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[635,638],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[635,638],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":18,"column":16,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":18,"endColumn":19,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[656,659],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[656,659],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'_e' is defined but never used.","line":50,"column":18,"nodeType":"Identifier","messageId":"unusedVar","endLine":50,"endColumn":20}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport { GameScoreboard } from './scoreboard/GameScoreboard';\r\n\r\nimport { useState } from 'react';\r\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\r\nimport { Clock, UtensilsCrossed, Trophy, ShoppingCart } from \"lucide-react\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { toast } from \"sonner\";\r\nimport { submitTableOrder } from \"@/app/lib/actions-kiosk\";\r\nimport { PaymentSelector } from './PaymentSelector';\r\nimport { PrintCategory } from '@prisma/client';\r\n\r\nimport MatchReferee from '@/components/referee/MatchReferee';\r\n\r\ninterface ActiveScreenProps {\r\n    session: any;\r\n    products?: any[];\r\n}\r\n\r\n\r\nexport function ActiveScreen({ session }: ActiveScreenProps) {\r\n\r\n    // We need a real product fetching or passing here.\r\n    // For this skeleton, I will simulate product list or assume it's fetched by the page wrapper\r\n    const [isOrdering, setIsOrdering] = useState(false);\r\n    const [isPaymentSelectorOpen, setIsPaymentSelectorOpen] = useState(false);\r\n    const [isRefereeMode, setIsRefereeMode] = useState(false);\r\n\r\n    // Timer Logic (Simplified for Visuals, use a real hook for precision)\r\n    // const startTime = new Date(session.startTime); // Unused for now\r\n    // In a real app, use a useInterval to update this specific display\r\n\r\n    const handleConfirmOrder = async (targetPlayerId?: string) => {\r\n        setIsOrdering(true);\r\n        // Simulate Items for now as we didn't build the catalog UI yet in this step\r\n        // In reality, 'cart' would be populated by the menu.\r\n        const mockItems = [\r\n            { productId: 'mock-1', quantity: 2, price: 5000, name: 'Pisco Sour', printCategory: PrintCategory.BAR }\r\n        ];\r\n\r\n        try {\r\n            const result = await submitTableOrder(session.id, mockItems, targetPlayerId);\r\n            if (result.success) {\r\n                toast.success(\"¡Pedido enviado a barra/cocina!\");\r\n                setIsPaymentSelectorOpen(false);\r\n            } else {\r\n                toast.error(result.error);\r\n            }\r\n        } catch (_e) {\r\n            toast.error(\"Error de conexión\");\r\n        } finally {\r\n            setIsOrdering(false);\r\n        }\r\n    };\r\n\r\n    // Extract player names safely\r\n    const playerNames: [string, string] = [\r\n        session.players?.[0]?.name || \"Jugador 1\",\r\n        session.players?.[1]?.name || \"Jugador 2\"\r\n    ];\r\n\r\n    // Determine Table Type from session or inject it via props if needed. \r\n    // Assuming session.table?.type or session.gameType exists. \r\n    // Based on previous context, table type is in session.table.type (enum)\r\n    // But here 'session' props seems to correspond to what `getKioskSession` returns.\r\n    // Let's assume session.table.type exists or use a fallback.\r\n    const tableType = session.table?.type || 'POOL';\r\n\r\n    if (isRefereeMode) {\r\n        return <MatchReferee session={session} onExit={() => setIsRefereeMode(false)} />;\r\n    }\r\n\r\n    return (\r\n        <div className=\"h-screen w-full bg-slate-950 flex flex-col text-slate-100\">\r\n            {/* ... (Header) */}\r\n\r\n            {/* Main Content Areas */}\r\n            <div className=\"flex-grow overflow-hidden\">\r\n                <Tabs defaultValue=\"scoreboard\" className=\"h-full flex flex-col\">\r\n                    <TabsList className=\"bg-slate-900/50 p-1 h-16 w-full justify-start rounded-none border-b border-white/5 flex items-center\">\r\n                        <TabsTrigger value=\"scoreboard\" className=\"h-full px-8 text-lg gap-2 data-[state=active]:bg-blue-600 data-[state=active]:text-white\">\r\n                            <Trophy className=\"w-5 h-5\" />\r\n                            Marcador\r\n                        </TabsTrigger>\r\n                        <TabsTrigger value=\"menu\" className=\"h-full px-8 text-lg gap-2 data-[state=active]:bg-emerald-600 data-[state=active]:text-white\">\r\n                            <UtensilsCrossed className=\"w-5 h-5\" />\r\n                            Carta & Pedidos\r\n                        </TabsTrigger>\r\n\r\n                        {/* Referee Toggle */}\r\n                        {tableType === 'CARAMBOLA' && (\r\n                            <Button\r\n                                variant=\"outline\"\r\n                                onClick={() => setIsRefereeMode(true)}\r\n                                className=\"ml-auto mr-4 bg-orange-900/20 border-orange-500/50 text-orange-400 hover:bg-orange-500 hover:text-white\"\r\n                            >\r\n                                <Clock className=\"mr-2 h-4 w-4\" />\r\n                                Modo Juez\r\n                            </Button>\r\n                        )}\r\n                    </TabsList>\r\n\r\n                    <TabsContent value=\"scoreboard\" className=\"flex-grow p-0 overflow-hidden\">\r\n                        <GameScoreboard\r\n                            sessionId={session.id}\r\n                            initialState={session.gameState}\r\n                            tableType={tableType}\r\n                            playerNames={playerNames}\r\n                            players={session.players || []}\r\n                            // New Props\r\n                            cameraTopUrl={session.table?.cameraTopUrl}\r\n                            cameraFrontUrl={session.table?.cameraFrontUrl}\r\n                            onOrderClick={() => setIsPaymentSelectorOpen(true)}\r\n                        />\r\n                    </TabsContent>\r\n\r\n                    <TabsContent value=\"menu\" className=\"flex-grow p-6\">\r\n\r\n                        <div className=\"h-full flex items-center justify-center\">\r\n                            <Button size=\"lg\" onClick={() => setIsPaymentSelectorOpen(true)} className=\"bg-emerald-600 hover:bg-emerald-500 text-xl py-8 px-12\">\r\n                                <ShoppingCart className=\"mr-3 w-8 h-8\" />\r\n                                Simular Pedido (Demo)\r\n                            </Button>\r\n                        </div>\r\n                    </TabsContent>\r\n                </Tabs>\r\n            </div>\r\n\r\n            {/* Modals */}\r\n            <PaymentSelector\r\n                isOpen={isPaymentSelectorOpen}\r\n                onClose={() => setIsPaymentSelectorOpen(false)}\r\n                players={session.players || []}\r\n                onConfirm={handleConfirmOrder}\r\n                isSubmitting={isOrdering}\r\n            />\r\n        </div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\rokat\\OneDrive\\Proyectos\\Akapoolco\\src\\components\\kiosk\\IdleScreen.tsx","messages":[{"ruleId":"@next/next/no-img-element","severity":1,"message":"Using `<img>` could result in slower LCP and higher bandwidth. Consider using `<Image />` from `next/image` or a custom image loader to automatically optimize images. This may incur additional usage or cost from your provider. See: https://nextjs.org/docs/messages/no-img-element","line":41,"column":21,"nodeType":"JSXOpeningElement","endLine":45,"endColumn":23}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport { useEffect, useState } from 'react';\r\nimport { motion, AnimatePresence } from 'framer-motion';\r\nimport { AdBanner } from '@prisma/client';\r\n\r\n// Fallback images if no ads are configured\r\nconst DEFAULT_ADS: Partial<AdBanner>[] = [\r\n    { id: '1', imageUrl: 'https://images.unsplash.com/photo-1571216524316-2de96328bc64?q=80&w=2000&auto=format&fit=crop', title: 'Bienvenidos' },\r\n    { id: '2', imageUrl: 'https://images.unsplash.com/photo-1542322307-e83fa3d6664d?q=80&w=2000&auto=format&fit=crop', title: 'Torneo Mensual' }\r\n];\r\n\r\ninterface IdleScreenProps {\r\n    ads: AdBanner[];\r\n    tableName?: string;\r\n    tableType?: string;\r\n}\r\n\r\nexport function IdleScreen({ ads, tableName, tableType }: IdleScreenProps) {\r\n    const displayAds = ads.length > 0 ? ads : DEFAULT_ADS;\r\n    const [currentIndex, setCurrentIndex] = useState(0);\r\n\r\n    useEffect(() => {\r\n        const timer = setInterval(() => {\r\n            setCurrentIndex((prev) => (prev + 1) % displayAds.length);\r\n        }, 8000); // 8 seconds per slide\r\n        return () => clearInterval(timer);\r\n    }, [displayAds.length]);\r\n\r\n    return (\r\n        <div className=\"relative w-full h-screen overflow-hidden bg-black text-white\">\r\n            <AnimatePresence mode='wait'>\r\n                <motion.div\r\n                    key={currentIndex}\r\n                    initial={{ opacity: 0, scale: 1.1 }}\r\n                    animate={{ opacity: 1, scale: 1 }}\r\n                    exit={{ opacity: 0 }}\r\n                    transition={{ duration: 1.5 }}\r\n                    className=\"absolute inset-0\"\r\n                >\r\n                    <img\r\n                        src={displayAds[currentIndex].imageUrl}\r\n                        alt={displayAds[currentIndex].title}\r\n                        className=\"w-full h-full object-cover opacity-60\"\r\n                    />\r\n                    <div className=\"absolute inset-0 bg-gradient-to-t from-black via-transparent to-black/40\" />\r\n                </motion.div>\r\n            </AnimatePresence>\r\n\r\n            {/* Center Content: Table Name & Game Graphic */}\r\n            <div className=\"absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 bg-black/50 backdrop-blur-sm p-10 rounded-3xl border border-white/10 flex flex-col items-center\">\r\n                {/* Game Graphic */}\r\n                <div className=\"mb-6 scale-150\">\r\n                    {(!tableType || tableType === 'POOL') && (\r\n                        <div className=\"flex gap-2\">\r\n                            <div className=\"w-12 h-12 rounded-full bg-yellow-400 border-4 border-white flex items-center justify-center font-bold text-black shadow-lg\">1</div>\r\n                            <div className=\"w-12 h-12 rounded-full bg-blue-600 border-4 border-white flex items-center justify-center font-bold text-white shadow-lg\">2</div>\r\n                            <div className=\"w-12 h-12 rounded-full bg-red-600 border-4 border-white flex items-center justify-center font-bold text-white shadow-lg\">3</div>\r\n                            <div className=\"w-12 h-12 rounded-full bg-black border-4 border-white flex items-center justify-center font-bold text-white shadow-lg\">8</div>\r\n                        </div>\r\n                    )}\r\n                    {tableType === 'CARAMBOLA' && (\r\n                        <div className=\"flex gap-4\">\r\n                            <div className=\"w-16 h-16 rounded-full bg-white border-4 border-slate-300 shadow-[0_0_20px_white]\"></div>\r\n                            <div className=\"w-16 h-16 rounded-full bg-yellow-300 border-4 border-yellow-100 shadow-[0_0_20px_yellow]\"></div>\r\n                            <div className=\"w-16 h-16 rounded-full bg-red-600 border-4 border-red-300 shadow-[0_0_20px_red]\"></div>\r\n                        </div>\r\n                    )}\r\n                    {(tableType === 'CARDS' || tableType === 'POKER') && (\r\n                        <div className=\"flex gap-4 text-7xl\">\r\n                            <span className=\"text-white drop-shadow-[0_0_10px_white]\">♠️</span>\r\n                            <span className=\"text-red-500 drop-shadow-[0_0_10px_red]\">♥️</span>\r\n                            <span className=\"text-red-500 drop-shadow-[0_0_10px_red]\">♦️</span>\r\n                            <span className=\"text-white drop-shadow-[0_0_10px_white]\">♣️</span>\r\n                        </div>\r\n                    )}\r\n                </div>\r\n\r\n                {/* Table Name */}\r\n                <h2 className=\"text-4xl font-bold uppercase tracking-wider text-blue-400 mb-2\">\r\n                    {tableName || \"MESA\"}\r\n                </h2>\r\n                <h1 className=\"text-6xl font-black uppercase tracking-widest text-shadow-lg mb-4 text-white\">\r\n                    DISPONIBLE\r\n                </h1>\r\n                <p className=\"text-xl font-light text-slate-300 uppercase tracking-widest\">\r\n                    Solicita tu activación en barra\r\n                </p>\r\n            </div>\r\n\r\n            {/* Tap hint to view menu maybe? */}\r\n            <div className=\"absolute bottom-6 right-6 z-20\">\r\n                <div className=\"bg-white/10 backdrop-blur-md px-6 py-3 rounded-full border border-white/20 animate-pulse\">\r\n                    <span className=\"text-sm font-semibold tracking-wider\">CLUB SANTIAGO BSM</span>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\rokat\\OneDrive\\Proyectos\\Akapoolco\\src\\components\\kiosk\\KioskManager.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":10,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":10,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[276,279],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[276,279],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport { useTableSync } from '@/hooks/useTableSync';\r\nimport { IdleScreen } from './IdleScreen';\r\nimport { ActiveScreen } from './ActiveScreen';\r\nimport { Loader2 } from 'lucide-react';\r\n\r\ninterface KioskManagerProps {\r\n    tableId: string;\r\n    initialData: any;\r\n}\r\n\r\nexport function KioskManager({ tableId, initialData }: KioskManagerProps) {\r\n    const { status, sessionData, ads } = useTableSync(tableId, initialData);\r\n\r\n    // STATES\r\n    if (status === 'AVAILABLE' || status === 'RESERVED') {\r\n        return <IdleScreen\r\n            ads={ads}\r\n            tableName={initialData.tableName}\r\n            tableType={initialData.tableType}\r\n        />;\r\n    }\r\n\r\n    if (status === 'OCCUPIED' && sessionData) {\r\n        return <ActiveScreen session={sessionData} />;\r\n    }\r\n\r\n    if (status === 'CLEANING') {\r\n        return (\r\n            <div className=\"h-screen w-full bg-slate-900 flex flex-col items-center justify-center text-white\">\r\n                <div className=\"animate-spin mb-4\">\r\n                    <Loader2 className=\"w-12 h-12 text-blue-500\" />\r\n                </div>\r\n                <h2 className=\"text-2xl font-bold\">Preparando Mesa...</h2>\r\n            </div>\r\n        );\r\n    }\r\n\r\n    // Default Loading / Error\r\n    return (\r\n        <div className=\"h-screen w-full bg-black flex items-center justify-center text-slate-500\">\r\n            <span className=\"animate-pulse\">Cargando Sistema...</span>\r\n        </div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\rokat\\OneDrive\\Proyectos\\Akapoolco\\src\\components\\kiosk\\PaymentSelector.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'User' is defined but never used.","line":5,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":5,"endColumn":14,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"User"},"fix":{"range":[187,192],"text":""},"desc":"Remove unused variable \"User\"."}]},{"ruleId":"@next/next/no-img-element","severity":1,"message":"Using `<img>` could result in slower LCP and higher bandwidth. Consider using `<Image />` from `next/image` or a custom image loader to automatically optimize images. This may incur additional usage or cost from your provider. See: https://nextjs.org/docs/messages/no-img-element","line":73,"column":41,"nodeType":"JSXOpeningElement","endLine":73,"endColumn":114}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogDescription } from \"@/components/ui/dialog\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { User, Users, CheckCircle2 } from \"lucide-react\";\r\nimport { cn } from \"@/lib/utils\";\r\n\r\ninterface Payer {\r\n    id: string; // sessionPlayerId\r\n    name: string;\r\n    isMember: boolean;\r\n    image?: string | null;\r\n}\r\n\r\ninterface PaymentSelectorProps {\r\n    isOpen: boolean;\r\n    onClose: () => void;\r\n    players: Payer[];\r\n    onConfirm: (targetId?: string) => void;\r\n    isSubmitting: boolean;\r\n}\r\n\r\nexport function PaymentSelector({ isOpen, onClose, players, onConfirm, isSubmitting }: PaymentSelectorProps) {\r\n    return (\r\n        <Dialog open={isOpen} onOpenChange={onClose}>\r\n            <DialogContent className=\"max-w-md bg-slate-900 text-white border-white/10 sm:rounded-xl\">\r\n                <DialogHeader>\r\n                    <DialogTitle className=\"text-xl text-center\">Confirmar Pedido</DialogTitle>\r\n                    <DialogDescription className=\"text-center text-slate-400\">\r\n                        Selecciona a quién cargar este consumo\r\n                    </DialogDescription>\r\n                </DialogHeader>\r\n\r\n                <div className=\"flex flex-col gap-3 py-4\">\r\n                    {/* Opción 1: MESA */}\r\n                    <Button\r\n                        variant=\"outline\"\r\n                        size=\"lg\"\r\n                        className={cn(\r\n                            \"h-20 justify-start text-lg border-emerald-500/30 hover:bg-emerald-500/10 hover:text-emerald-400 hover:border-emerald-500 transition-all\",\r\n                            \"bg-emerald-950/20 text-emerald-100\"\r\n                        )}\r\n                        onClick={() => onConfirm(undefined)}\r\n                        disabled={isSubmitting}\r\n                    >\r\n                        <div className=\"w-10 h-10 rounded-full bg-emerald-500/20 flex items-center justify-center mr-4\">\r\n                            <Users className=\"w-6 h-6 text-emerald-500\" />\r\n                        </div>\r\n                        <div className=\"flex flex-col items-start\">\r\n                            <span className=\"font-semibold\">Cuenta General (Mesa)</span>\r\n                            <span className=\"text-xs text-emerald-400/70 font-normal\">Se paga al cerrar la sesión</span>\r\n                        </div>\r\n                    </Button>\r\n\r\n                    <div className=\"relative flex py-2 items-center\">\r\n                        <div className=\"flex-grow border-t border-slate-700\"></div>\r\n                        <span className=\"flex-shrink mx-4 text-[10px] tracking-widest text-slate-500 uppercase\">O cargar a jugador</span>\r\n                        <div className=\"flex-grow border-t border-slate-700\"></div>\r\n                    </div>\r\n\r\n                    {/* Lista de Jugadores */}\r\n                    <div className=\"grid grid-cols-1 gap-2 max-h-[300px] overflow-y-auto pr-1 custom-scrollbar\">\r\n                        {players.map(p => (\r\n                            <Button\r\n                                key={p.id}\r\n                                variant=\"ghost\"\r\n                                className=\"h-16 justify-start bg-slate-800/50 hover:bg-blue-600/20 border border-transparent hover:border-blue-500/50\"\r\n                                onClick={() => onConfirm(p.id)}\r\n                                disabled={isSubmitting}\r\n                            >\r\n                                <div className=\"w-10 h-10 rounded-full bg-blue-600 flex items-center justify-center mr-3 font-bold text-sm shrink-0 overflow-hidden\">\r\n                                    {p.image ? (\r\n                                        <img src={p.image} alt={p.name} className=\"w-full h-full object-cover\" />\r\n                                    ) : (\r\n                                        <span>{p.name.substring(0, 2).toUpperCase()}</span>\r\n                                    )}\r\n                                </div>\r\n                                <div className=\"flex flex-col items-start w-full overflow-hidden\">\r\n                                    <div className=\"flex items-center gap-2 w-full\">\r\n                                        <span className=\"truncate\">{p.name}</span>\r\n                                        {p.isMember && (\r\n                                            <span className=\"shrink-0 text-[9px] bg-amber-500/20 text-amber-400 border border-amber-500/30 px-1.5 rounded-sm font-medium tracking-wider\">\r\n                                                SOCIO\r\n                                            </span>\r\n                                        )}\r\n                                    </div>\r\n                                    <span className=\"text-xs text-slate-400 font-normal\">Cuenta Individual</span>\r\n                                </div>\r\n                                <div className=\"ml-auto opacity-0 group-hover:opacity-100\">\r\n                                    <CheckCircle2 className=\"w-5 h-5 text-blue-500\" />\r\n                                </div>\r\n                            </Button>\r\n                        ))}\r\n                    </div>\r\n                </div>\r\n\r\n                <div className=\"flex justify-center mt-2\">\r\n                    <Button variant=\"ghost\" onClick={onClose} disabled={isSubmitting} className=\"text-slate-500 hover:text-white\">\r\n                        Cancelar\r\n                    </Button>\r\n                </div>\r\n            </DialogContent>\r\n        </Dialog>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\rokat\\OneDrive\\Proyectos\\Akapoolco\\src\\components\\kiosk\\PrintQueueManager.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":19,"column":31,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":19,"endColumn":34,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[794,797],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[794,797],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\nC:\\Users\\rokat\\OneDrive\\Proyectos\\Akapoolco\\src\\components\\kiosk\\PrintQueueManager.tsx:25:9\n  23 |     useEffect(() => {\n  24 |         // eslint-disable-next-line react-hooks/set-state-in-effect\n> 25 |         fetchTickets();\n     |         ^^^^^^^^^^^^ Avoid calling setState() directly within an effect\n  26 |         const interval = setInterval(fetchTickets, 10000); // Poll every 10s\n  27 |         return () => clearInterval(interval);\n  28 |     }, [fetchTickets]);","line":25,"column":9,"nodeType":null,"endLine":25,"endColumn":21,"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport { useState, useEffect, useCallback } from 'react';\r\nimport { getPendingTickets, markTicketPrinted } from '@/app/lib/actions-kiosk';\r\nimport { ThermalReceipt, TicketData } from './ThermalReceipt';\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { Printer, RefreshCw, CheckCircle } from \"lucide-react\";\r\nimport { toast } from 'sonner';\r\n\r\nexport function PrintQueueManager() {\r\n    const [tickets, setTickets] = useState<TicketData[]>([]);\r\n    const [loading, setLoading] = useState(false);\r\n    const [printingTicketId, setPrintingTicketId] = useState<string | null>(null);\r\n\r\n    // Polling Logic\r\n    const fetchTickets = useCallback(async () => {\r\n        setLoading(true);\r\n        const pending = await getPendingTickets();\r\n        setTickets(pending as any); // Cast for simplicity due to date string/date obj mismatch\r\n        setLoading(false);\r\n    }, []);\r\n\r\n    useEffect(() => {\r\n        // eslint-disable-next-line react-hooks/set-state-in-effect\r\n        fetchTickets();\r\n        const interval = setInterval(fetchTickets, 10000); // Poll every 10s\r\n        return () => clearInterval(interval);\r\n    }, [fetchTickets]);\r\n\r\n    const handlePrint = async (ticket: TicketData) => {\r\n        setPrintingTicketId(ticket.id);\r\n\r\n        // Wait for render update (in case we hide/show specific tickets, though here we render mapped)\r\n        setTimeout(() => {\r\n            window.print(); // Browser Print Dialog\r\n\r\n            // In a real Kiosk setup:\r\n            // 1. We might use a silent print extension/service.\r\n            // 2. Here we ask confirmation or auto-confirm after print dialogue closes.\r\n\r\n            // For this demo, we assume success after print dialog opens\r\n            /* \r\n               Ideally, we show a \"Did it print?\" dialog. \r\n               For flow speed, I'll allow manual marking.\r\n            */\r\n        }, 500);\r\n    };\r\n\r\n    const confirmPrinted = async (ticketId: string) => {\r\n        const res = await markTicketPrinted(ticketId);\r\n        if (res.success) {\r\n            toast.success(\"Ticket marcado como impreso\");\r\n            setTickets(prev => prev.filter(t => t.id !== ticketId));\r\n            setPrintingTicketId(null);\r\n        } else {\r\n            toast.error(\"Error al actualizar estado\");\r\n        }\r\n    };\r\n\r\n    return (\r\n        <div className=\"p-6 max-w-6xl mx-auto\">\r\n            <div className=\"flex justify-between items-center mb-8 no-print\">\r\n                <h1 className=\"text-3xl font-bold flex items-center gap-3\">\r\n                    <Printer className=\"w-8 h-8\" />\r\n                    Cola de Impresión\r\n                </h1>\r\n                <Button onClick={fetchTickets} variant=\"outline\" disabled={loading}>\r\n                    <RefreshCw className={`w-4 h-4 mr-2 ${loading ? 'animate-spin' : ''}`} />\r\n                    Actualizar\r\n                </Button>\r\n            </div>\r\n\r\n            {/* Queue Grid */}\r\n            <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 no-print\">\r\n                {tickets.length === 0 && (\r\n                    <div className=\"col-span-full text-center py-20 text-slate-500 bg-slate-50 border-2 border-dashed border-slate-200 rounded-xl\">\r\n                        No hay tickets pendientes\r\n                    </div>\r\n                )}\r\n\r\n                {tickets.map(ticket => (\r\n                    <div key={ticket.id} className=\"bg-white border rounded-xl shadow-sm overflow-hidden flex flex-col\">\r\n                        <div className=\"bg-slate-100 p-3 border-b flex justify-between items-center\">\r\n                            <span className=\"font-bold text-sm\">{ticket.category}</span>\r\n                            <span className=\"text-xs text-slate-500\">{ticket.date.substring(11, 16)}</span>\r\n                        </div>\r\n\r\n                        <div className=\"p-4 flex-grow flex justify-center bg-gray-50\">\r\n                            {/* Preview, scaled down visually */}\r\n                            <div className=\"transform scale-90 origin-top\">\r\n                                <ThermalReceipt data={ticket} />\r\n                            </div>\r\n                        </div>\r\n\r\n                        <div className=\"p-3 bg-white border-t flex gap-2\">\r\n                            <Button\r\n                                className=\"flex-1\"\r\n                                onClick={() => handlePrint(ticket)}\r\n                            >\r\n                                <Printer className=\"w-4 h-4 mr-2\" />\r\n                                Imprimir\r\n                            </Button>\r\n                            <Button\r\n                                variant=\"secondary\"\r\n                                onClick={() => confirmPrinted(ticket.id)}\r\n                            >\r\n                                <CheckCircle className=\"w-4 h-4\" />\r\n                            </Button>\r\n                        </div>\r\n                    </div>\r\n                ))}\r\n            </div>\r\n\r\n            {/* Hidden Print Area - Only renders the 'printingTicketId' one to force single ticket print */}\r\n            <div className=\"hidden print:block print:absolute print:top-0 print:left-0\">\r\n                {printingTicketId && tickets.find(t => t.id === printingTicketId) && (\r\n                    <ThermalReceipt data={tickets.find(t => t.id === printingTicketId)!} />\r\n                )}\r\n            </div>\r\n\r\n            <style jsx global>{`\r\n                @media print {\r\n                    /* Hide everything except the ticket container */\r\n                    body * {\r\n                        visibility: hidden;\r\n                    }\r\n                    .thermal-receipt, .thermal-receipt * {\r\n                        visibility: visible;\r\n                    }\r\n                    .thermal-receipt {\r\n                        position: absolute;\r\n                        left: 0;\r\n                        top: 0;\r\n                    }\r\n                }\r\n            `}</style>\r\n        </div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\rokat\\OneDrive\\Proyectos\\Akapoolco\\src\\components\\kiosk\\TableLiveStream.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Camera' is defined but never used.","line":6,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":6,"endColumn":16,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"Camera"},"fix":{"range":[113,120],"text":""},"desc":"Remove unused variable \"Camera\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'RefreshCw' is defined but never used.","line":6,"column":28,"nodeType":"Identifier","messageId":"unusedVar","endLine":6,"endColumn":37,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"RefreshCw"},"fix":{"range":[129,140],"text":""},"desc":"Remove unused variable \"RefreshCw\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'cn' is defined but never used.","line":7,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":7,"endColumn":12,"suggestions":[{"messageId":"removeUnusedImportDeclaration","data":{"varName":"cn"},"fix":{"range":[165,198],"text":""},"desc":"Remove unused import declaration."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'setIsMock' is assigned a value but never used.","line":16,"column":20,"nodeType":"Identifier","messageId":"unusedVar","endLine":16,"endColumn":29},{"ruleId":"@next/next/no-img-element","severity":1,"message":"Using `<img>` could result in slower LCP and higher bandwidth. Consider using `<Image />` from `next/image` or a custom image loader to automatically optimize images. This may incur additional usage or cost from your provider. See: https://nextjs.org/docs/messages/no-img-element","line":36,"column":25,"nodeType":"JSXOpeningElement","endLine":40,"endColumn":27}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":5,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\r\n\"use client\";\r\n\r\nimport { useState } from \"react\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { Camera, VideoOff, RefreshCw } from \"lucide-react\";\r\nimport { cn } from \"@/lib/utils\";\r\n\r\ninterface TableLiveStreamProps {\r\n    cameraTopUrl?: string | null;\r\n    cameraFrontUrl?: string | null;\r\n}\r\n\r\nexport function TableLiveStream({ cameraTopUrl, cameraFrontUrl }: TableLiveStreamProps) {\r\n    const [activeView, setActiveView] = useState<'TOP' | 'FRONT'>('TOP');\r\n    const [isMock, setIsMock] = useState(true); // For development/demo\r\n\r\n    // Resolve URL based on view\r\n    const currentUrl = activeView === 'TOP' ? cameraTopUrl : cameraFrontUrl;\r\n\r\n    // Mock Data for Demo if no URL provided\r\n    const mockVideoUrl = \"https://cdn.pixabay.com/video/2020/04/18/36427-414674716_large.mp4\"; // Generic Abstract Video\r\n    // Or a static image for \"Top View\" feel\r\n    const mockImage = \"https://images.unsplash.com/photo-1579619627768-450ee63c7eb1?auto=format&fit=crop&q=80&w=1000\";\r\n\r\n    const hasSource = !!currentUrl || isMock;\r\n\r\n    return (\r\n        <div className=\"relative w-full aspect-video bg-black rounded-xl overflow-hidden shadow-2xl border border-zinc-800 group\">\r\n\r\n            {/* Video Feed */}\r\n            {hasSource ? (\r\n                isMock && !currentUrl ? (\r\n                    // Mock Render\r\n                    activeView === 'TOP' ? (\r\n                        <img\r\n                            src={mockImage}\r\n                            alt=\"Top View Mock\"\r\n                            className=\"w-full h-full object-cover opacity-80\"\r\n                        />\r\n                    ) : (\r\n                        <video\r\n                            src={mockVideoUrl}\r\n                            autoPlay\r\n                            muted\r\n                            loop\r\n                            playsInline\r\n                            className=\"w-full h-full object-cover opacity-80\"\r\n                        />\r\n                    )\r\n                ) : (\r\n                    // Real Stream\r\n                    <iframe\r\n                        src={currentUrl || \"\"}\r\n                        className=\"w-full h-full border-0 pointer-events-none\"\r\n                        title=\"Live Feed\"\r\n                    />\r\n                )\r\n            ) : (\r\n                <div className=\"flex flex-col items-center justify-center h-full text-zinc-600\">\r\n                    <VideoOff className=\"w-12 h-12 mb-2\" />\r\n                    <span>Cámaras Desconectadas</span>\r\n                </div>\r\n            )}\r\n\r\n            {/* Overlays / Controls */}\r\n            <div className=\"absolute top-4 right-4 bg-black/60 backdrop-blur-md p-1 rounded-lg border border-white/10 flex gap-1 z-10 transition-opacity hover:opacity-100 opacity-60\">\r\n                <Button\r\n                    size=\"sm\"\r\n                    variant={activeView === 'TOP' ? 'secondary' : 'ghost'}\r\n                    onClick={() => setActiveView('TOP')}\r\n                    className=\"text-xs font-bold h-8\"\r\n                >\r\n                    CENITAL\r\n                </Button>\r\n                <div className=\"w-[1px] bg-white/20 my-1\" />\r\n                <Button\r\n                    size=\"sm\"\r\n                    variant={activeView === 'FRONT' ? 'secondary' : 'ghost'}\r\n                    onClick={() => setActiveView('FRONT')}\r\n                    className=\"text-xs font-bold h-8\"\r\n                >\r\n                    FRONTAL\r\n                </Button>\r\n            </div>\r\n\r\n            {/* Live Indicator */}\r\n            <div className=\"absolute top-4 left-4 flex items-center gap-2 bg-red-600/90 text-white text-[10px] font-black tracking-widest px-2 py-1 rounded\">\r\n                <div className=\"w-2 h-2 bg-white rounded-full animate-pulse\" />\r\n                LIVE\r\n            </div>\r\n\r\n        </div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\rokat\\OneDrive\\Proyectos\\Akapoolco\\src\\components\\kiosk\\ThermalReceipt.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\rokat\\OneDrive\\Proyectos\\Akapoolco\\src\\components\\kiosk\\scoreboard\\CardScoreboard.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'cn' is defined but never used.","line":5,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":5,"endColumn":12,"suggestions":[{"messageId":"removeUnusedImportDeclaration","data":{"varName":"cn"},"fix":{"range":[176,209],"text":""},"desc":"Remove unused import declaration."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use strict\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { UtensilsCrossed, Clock } from \"lucide-react\";\r\nimport { TableLiveStream } from \"../TableLiveStream\";\r\nimport { cn } from \"@/lib/utils\";\r\n\r\ninterface CardScoreboardProps {\r\n    playerNames: [string, string]; // We might ignore this or show list of players if passed differently\r\n    cameraTopUrl?: string | null;\r\n    cameraFrontUrl?: string | null;\r\n    onOrderClick?: () => void;\r\n}\r\n\r\nexport function CardScoreboard({\r\n    cameraTopUrl,\r\n    cameraFrontUrl,\r\n    onOrderClick\r\n}: CardScoreboardProps) {\r\n\r\n    return (\r\n        <div className=\"h-full w-full grid grid-cols-12 gap-1 p-2 bg-black\">\r\n\r\n            {/* LEFT COLUMN (25%) - Info / Decoration */}\r\n            <div className=\"col-span-3 flex flex-col h-full gap-2 bg-zinc-900/30 rounded-xl border border-white/5 p-4 items-center justify-center\">\r\n                <div className=\"w-24 h-24 rounded-full bg-indigo-500/10 flex items-center justify-center mb-4\">\r\n                    <span className=\"text-4xl\">♠️</span>\r\n                </div>\r\n                <h2 className=\"text-2xl font-bold text-indigo-400 uppercase tracking-widest text-center\">Mesa de Cartas</h2>\r\n                <p className=\"text-zinc-500 text-sm text-center\">Disfrute su juego</p>\r\n            </div>\r\n\r\n            {/* CENTER COLUMN (50%) - Video & Actions */}\r\n            <div className=\"col-span-6 flex flex-col h-full gap-2 px-1\">\r\n                {/* 1. Video Feed */}\r\n                <div className=\"flex-grow flex items-center justify-center bg-black rounded-xl overflow-hidden border border-zinc-800 relative\">\r\n                    <TableLiveStream\r\n                        cameraTopUrl={cameraTopUrl}\r\n                        cameraFrontUrl={cameraFrontUrl}\r\n                    />\r\n                </div>\r\n\r\n                {/* 2. Action Buttons */}\r\n                <div className=\"h-24\">\r\n                    <Button\r\n                        onClick={onOrderClick}\r\n                        className=\"w-full h-full bg-indigo-900/40 hover:bg-indigo-900/60 border border-indigo-500/30 text-indigo-300 flex items-center justify-center gap-2 text-lg\"\r\n                    >\r\n                        <UtensilsCrossed className=\"w-6 h-6\" />\r\n                        <span className=\"font-bold uppercase\">Solicitar Servicio a la Mesa</span>\r\n                    </Button>\r\n                </div>\r\n            </div>\r\n\r\n            {/* RIGHT COLUMN (25%) - Timer or Info */}\r\n            <div className=\"col-span-3 flex flex-col h-full gap-2 bg-zinc-900/30 rounded-xl border border-white/5 p-4 items-center justify-center\">\r\n                {/* Decorative / Info */}\r\n                <div className=\"w-24 h-24 rounded-full bg-red-500/10 flex items-center justify-center mb-4\">\r\n                    <span className=\"text-4xl\">♥️</span>\r\n                </div>\r\n                <div className=\"flex flex-col items-center\">\r\n                    <Clock className=\"w-8 h-8 text-zinc-600 mb-2\" />\r\n                    <span className=\"text-zinc-500 text-xs uppercase\">Tiempo Transcurrido</span>\r\n                    {/* Note: We don't have the timer prop passed down here yet. \r\n                        For now just static or removing. \r\n                        Ideally we pass the session start time to show a clock.\r\n                    */}\r\n                </div>\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\rokat\\OneDrive\\Proyectos\\Akapoolco\\src\\components\\kiosk\\scoreboard\\CaromScoreboard.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\rokat\\OneDrive\\Proyectos\\Akapoolco\\src\\components\\kiosk\\scoreboard\\CaromSettingsDialog.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\rokat\\OneDrive\\Proyectos\\Akapoolco\\src\\components\\kiosk\\scoreboard\\ChileanPoolScoreboard.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'players' is defined but never used.","line":25,"column":5,"nodeType":"Identifier","messageId":"unusedVar","endLine":25,"endColumn":12},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":374,"column":126,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":374,"endColumn":129,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[18760,18763],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[18760,18763],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState } from \"react\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { ChileanState } from \"@/types/game-state\";\r\nimport { RotateCcw, Target, Monitor, UtensilsCrossed, AlertTriangle, Trophy } from \"lucide-react\";\r\nimport { cn } from \"@/lib/utils\";\r\nimport { useChileanGame } from \"@/hooks/useChileanGame\";\r\nimport { PoolBallIcon } from \"./PoolBallIcon\";\r\nimport { Switch } from \"@/components/ui/switch\";\r\nimport { TableLiveStream } from \"../TableLiveStream\";\r\nimport { Dialog, DialogContent, DialogHeader, DialogTitle } from \"@/components/ui/dialog\";\r\n\r\ninterface ChileanPoolScoreboardProps {\r\n    state: ChileanState;\r\n    playerNames: [string, string];\r\n    players?: { name: string; image?: string | null }[];\r\n    onUpdate: (newState: ChileanState) => void;\r\n    cameraTopUrl?: string | null;\r\n    cameraFrontUrl?: string | null;\r\n    onOrderClick?: () => void;\r\n}\r\n\r\nexport function ChileanPoolScoreboard({\r\n    state,\r\n    playerNames,\r\n    players,\r\n    onUpdate,\r\n    cameraTopUrl,\r\n    cameraFrontUrl,\r\n    onOrderClick\r\n}: ChileanPoolScoreboardProps) {\r\n    // UI State for \"Assignment Mode\"\r\n    // false = Player 1, true = Player 2\r\n    const [assignToP2, setAssignToP2] = useState(false);\r\n\r\n    // UI State for Swapped Names (Who is actually sitting at Left vs Right)\r\n    const [isSwapped, setIsSwapped] = useState(false);\r\n\r\n    // UI State for Foul Dialog\r\n    const [foulPlayer, setFoulPlayer] = useState<0 | 1 | null>(null);\r\n\r\n    // UI State for Camera View\r\n    const [showCamera, setShowCamera] = useState(false);\r\n\r\n    // Game Logic Hook\r\n    const metrics = useChileanGame(state);\r\n\r\n    // Derived Visual Names\r\n    const leftName = isSwapped ? playerNames[1] : playerNames[0];\r\n    const rightName = isSwapped ? playerNames[0] : playerNames[1];\r\n\r\n    // Handlers\r\n    const handleBallClick = (ball: number) => {\r\n        const newState = { ...state };\r\n        const isAvailable = state.availableBalls.includes(ball);\r\n        const isP1 = state.p1Balls.includes(ball);\r\n        const isP2 = state.p2Balls.includes(ball);\r\n\r\n        // Simple assignment based on target swapper\r\n        // If !assignToP2 (Left Target) \r\n        // -> If !isSwapped: P1. If isSwapped: P2.\r\n        const targetIsP2 = (!assignToP2 && isSwapped) || (assignToP2 && !isSwapped);\r\n\r\n        if (isAvailable) {\r\n            newState.availableBalls = state.availableBalls.filter(b => b !== ball);\r\n            if (!targetIsP2) {\r\n                newState.p1Balls = [...state.p1Balls, ball].sort((a, b) => a - b);\r\n            } else {\r\n                newState.p2Balls = [...state.p2Balls, ball].sort((a, b) => a - b);\r\n            }\r\n        } else if (isP1) {\r\n            newState.p1Balls = state.p1Balls.filter(b => b !== ball);\r\n            newState.availableBalls = [...state.availableBalls, ball].sort((a, b) => a - b);\r\n        } else if (isP2) {\r\n            newState.p2Balls = state.p2Balls.filter(b => b !== ball);\r\n            newState.availableBalls = [...state.availableBalls, ball].sort((a, b) => a - b);\r\n        }\r\n\r\n        onUpdate(newState);\r\n    };\r\n\r\n    // New Foul Handler: Opens Dialog\r\n    const handleFoulClick = (visualSide: 'left' | 'right') => {\r\n        // Left = Swapped ? P2 : P1\r\n        const isP2 = (visualSide === 'left' && isSwapped) || (visualSide === 'right' && !isSwapped);\r\n        setFoulPlayer(isP2 ? 1 : 0);\r\n    };\r\n\r\n    // Confirm Foul: Applies variable points\r\n    const confirmFoul = (ballValue: number) => {\r\n        if (foulPlayer === null) return;\r\n\r\n        const newState = { ...state };\r\n        if (foulPlayer === 0) {\r\n            newState.p1FoulPoints += ballValue;\r\n        } else {\r\n            newState.p2FoulPoints += ballValue;\r\n        }\r\n        onUpdate(newState);\r\n        setFoulPlayer(null);\r\n    };\r\n\r\n    // --- GAME CONTROL ---\r\n\r\n    // 1. Full Reset (New Match)\r\n    const handleResetMatch = () => {\r\n        if (confirm(\"¿Comenzar NUEVO PARTIDO? (Todos los puntajes a 0)\")) {\r\n            onUpdate({\r\n                gameType: 'CHILEAN',\r\n                availableBalls: Array.from({ length: 15 }, (_, i) => i + 1),\r\n                p1Balls: [],\r\n                p2Balls: [],\r\n                p1FoulPoints: 0,\r\n                p2FoulPoints: 0,\r\n                p1GamesWon: 0,\r\n                p2GamesWon: 0\r\n            });\r\n        }\r\n    }\r\n\r\n    // 2. Win Set (Finish Rack, Increment Set, Reset Board)\r\n    const handleWinSet = (visualSide: 'left' | 'right') => {\r\n        const isP2 = (visualSide === 'left' && isSwapped) || (visualSide === 'right' && !isSwapped);\r\n        const winnerName = isP2 ? playerNames[1] : playerNames[0];\r\n\r\n        if (confirm(`¿Finalizar Mano/Set? Ganador: ${winnerName}`)) {\r\n            const newState = {\r\n                ...state,\r\n                availableBalls: Array.from({ length: 15 }, (_, i) => i + 1),\r\n                p1Balls: [],\r\n                p2Balls: [],\r\n                p1FoulPoints: 0,\r\n                p2FoulPoints: 0,\r\n                // Increment Sets\r\n                p1GamesWon: (state.p1GamesWon || 0) + (!isP2 ? 1 : 0),\r\n                p2GamesWon: (state.p2GamesWon || 0) + (isP2 ? 1 : 0),\r\n            };\r\n            onUpdate(newState);\r\n        }\r\n    }\r\n\r\n    // Static list of all 15 balls for grid rendering\r\n    const ALL_BALLS = Array.from({ length: 15 }, (_, i) => i + 1);\r\n\r\n    return (\r\n        <div className=\"h-full w-full flex flex-col bg-[#1a472a] relative overflow-hidden font-sans\">\r\n            {/* Green Felt Texture Overlay */}\r\n            <div className=\"absolute inset-0 opacity-20 pointer-events-none\" style={{ backgroundImage: 'radial-gradient(circle, transparent 20%, #000 130%)' }}></div>\r\n\r\n            {/* Top Bar: Assignment Switcher */}\r\n            <div className=\"z-10 bg-black/40 backdrop-blur-md p-4 flex justify-between items-center border-b border-white/10 shadow-xl relative\">\r\n\r\n                {/* Left Controls */}\r\n                <div className=\"absolute left-4 flex gap-2\">\r\n                    <Button\r\n                        variant=\"outline\"\r\n                        size=\"sm\"\r\n                        onClick={() => setIsSwapped(!isSwapped)}\r\n                        className=\"border-white/20 text-indigo-300 hover:text-white hover:bg-white/10 text-xs uppercase font-bold tracking-wider\"\r\n                    >\r\n                        <RotateCcw className=\"w-4 h-4 mr-2\" /> Rotar Lados\r\n                    </Button>\r\n                </div>\r\n\r\n                <div className=\"flex items-center gap-4 mx-auto bg-black/60 p-2 px-6 rounded-full border border-white/10\">\r\n                    <span className={cn(\"font-bold transition-colors uppercase tracking-wider text-sm\", !assignToP2 ? \"text-emerald-400\" : \"text-zinc-500\")}>\r\n                        {leftName}\r\n                    </span>\r\n\r\n                    <Switch\r\n                        checked={assignToP2}\r\n                        onCheckedChange={setAssignToP2}\r\n                        className=\"data-[state=checked]:bg-blue-600 data-[state=unchecked]:bg-emerald-600 scale-125 border-2 border-white/20\"\r\n                    />\r\n\r\n                    <span className={cn(\"font-bold transition-colors uppercase tracking-wider text-sm\", assignToP2 ? \"text-blue-400\" : \"text-zinc-500\")}>\r\n                        {rightName}\r\n                    </span>\r\n                </div>\r\n\r\n                <div className=\"absolute right-4\">\r\n                    <Button\r\n                        variant=\"default\"\r\n                        size=\"sm\"\r\n                        onClick={handleResetMatch}\r\n                        className=\"bg-emerald-600 hover:bg-emerald-500 text-white font-black uppercase tracking-widest shadow-lg shadow-emerald-900/50\"\r\n                    >\r\n                        NUEVO PARTIDO\r\n                    </Button>\r\n                </div>\r\n            </div>\r\n\r\n            {/* Main Game Area */}\r\n            <div className=\"flex-1 grid grid-cols-12 p-4 gap-6 z-10 min-h-0\">\r\n\r\n                {/* Player Left Panel */}\r\n                <div className=\"col-span-3 flex flex-col gap-4 h-full\">\r\n                    <PlayerCard\r\n                        name={leftName}\r\n                        rawScore={isSwapped ? metrics.p2RawScore : metrics.p1RawScore}\r\n                        netScore={isSwapped ? metrics.p2NetScore : metrics.p1NetScore}\r\n                        penalty={isSwapped ? (metrics.p2NetScore - metrics.p2RawScore) : (metrics.p1NetScore - metrics.p1RawScore)}\r\n                        balls={isSwapped ? state.p2Balls : state.p1Balls}\r\n                        colorClass=\"emerald\"\r\n                        onFoul={() => handleFoulClick('left')}\r\n                        isActive={!assignToP2}\r\n                        isWinner={isSwapped ? (metrics.winner === 'p2') : (metrics.winner === 'p1')}\r\n                        setsWon={isSwapped ? (state.p2GamesWon || 0) : (state.p1GamesWon || 0)}\r\n                        onWinSet={() => handleWinSet('left')}\r\n                    />\r\n                </div>\r\n\r\n                {/* Center Table (Balls Grid or Camera) */}\r\n                <div className=\"col-span-6 flex flex-col bg-black/20 rounded-3xl border border-white/5 p-6 shadow-inner relative h-full\">\r\n                    {/* Header Controls */}\r\n                    <div className=\"absolute top-4 left-0 w-full flex justify-between px-6 z-20 pointer-events-none\">\r\n                        <span className=\"bg-black/60 text-emerald-100/90 text-sm px-4 py-1 rounded-full uppercase tracking-wider font-bold border border-emerald-500/30 backdrop-blur-md pointer-events-auto shadow-lg\">\r\n                            Mesa en Juego: {metrics.pointsRemaining} Ptos\r\n                        </span>\r\n\r\n                        <Button\r\n                            variant=\"secondary\"\r\n                            size=\"sm\"\r\n                            onClick={() => setShowCamera(!showCamera)}\r\n                            className=\"pointer-events-auto h-8 bg-indigo-600/90 hover:bg-indigo-500 text-white border border-indigo-400/50 shadow-lg backdrop-blur-md gap-2\"\r\n                        >\r\n                            {showCamera ? (\r\n                                <>\r\n                                    <Target className=\"w-4 h-4\" /> Ver Mesa\r\n                                </>\r\n                            ) : (\r\n                                <>\r\n                                    <Monitor className=\"w-4 h-4\" /> Ver Cámara\r\n                                </>\r\n                            )}\r\n                        </Button>\r\n                    </div>\r\n\r\n                    <div className=\"flex-1 flex items-center justify-center pt-10\">\r\n                        {showCamera ? (\r\n                            <div className=\"w-full h-full flex items-center justify-center\">\r\n                                <TableLiveStream\r\n                                    cameraTopUrl={cameraTopUrl}\r\n                                    cameraFrontUrl={cameraFrontUrl}\r\n                                />\r\n                            </div>\r\n                        ) : (\r\n                            <div className=\"grid grid-cols-5 gap-4 scale-100 transition-transform\">\r\n                                {ALL_BALLS.map(ball => {\r\n                                    const isAvailable = state.availableBalls.includes(ball);\r\n                                    const isOwned = !isAvailable;\r\n\r\n                                    const ownerKey = state.p1Balls.includes(ball) ? 'p1' : (state.p2Balls.includes(ball) ? 'p2' : null);\r\n\r\n                                    let ownerLabel = '';\r\n                                    let ownerColor = '';\r\n\r\n                                    if (ownerKey === 'p1') {\r\n                                        // P1 is Green (Left) unless swapped\r\n                                        // If not swapped: P1=Left(Green). Swapped: P1=Right(Blue)\r\n                                        ownerLabel = !isSwapped ? 'JUG A' : 'JUG B';\r\n                                        ownerColor = !isSwapped ? \"bg-emerald-900 text-emerald-400\" : \"bg-blue-900 text-blue-400\";\r\n                                    } else if (ownerKey === 'p2') {\r\n                                        ownerLabel = !isSwapped ? 'JUG B' : 'JUG A';\r\n                                        ownerColor = !isSwapped ? \"bg-blue-900 text-blue-400\" : \"bg-emerald-900 text-emerald-400\";\r\n                                    }\r\n\r\n                                    return (\r\n                                        <div key={ball} className=\"relative group\">\r\n                                            <PoolBallIcon\r\n                                                value={ball}\r\n                                                size=\"xl\"\r\n                                                className={cn(\r\n                                                    \"transition-all duration-300 shadow-2xl\",\r\n                                                    !isAvailable && \"opacity-20 scale-90 grayscale blur-[1px]\",\r\n                                                    // Hover effect\r\n                                                    isAvailable && \"hover:scale-110 hover:z-20 cursor-pointer\"\r\n                                                )}\r\n                                                onClick={() => handleBallClick(ball)}\r\n                                            />\r\n                                            {isOwned && (\r\n                                                <div className={cn(\r\n                                                    \"absolute -bottom-2 left-1/2 -translate-x-1/2 text-[10px] font-black px-2 rounded-full border border-white/20 whitespace-nowrap z-20 shadow-lg\",\r\n                                                    ownerColor\r\n                                                )}>\r\n                                                    {ownerLabel}\r\n                                                </div>\r\n                                            )}\r\n                                        </div>\r\n                                    )\r\n                                })}\r\n                            </div>\r\n                        )}\r\n                    </div>\r\n                </div>\r\n\r\n                {/* Player Right Panel */}\r\n                <div className=\"col-span-3 flex flex-col gap-4 h-full\">\r\n                    <PlayerCard\r\n                        name={rightName}\r\n                        rawScore={isSwapped ? metrics.p1RawScore : metrics.p2RawScore}\r\n                        netScore={isSwapped ? metrics.p1NetScore : metrics.p2NetScore}\r\n                        penalty={isSwapped ? (metrics.p1NetScore - metrics.p1RawScore) : (metrics.p2NetScore - metrics.p2RawScore)}\r\n                        balls={isSwapped ? state.p1Balls : state.p2Balls}\r\n                        colorClass=\"blue\"\r\n                        onFoul={() => handleFoulClick('right')}\r\n                        isActive={assignToP2}\r\n                        isWinner={isSwapped ? (metrics.winner === 'p1') : (metrics.winner === 'p2')}\r\n                        setsWon={isSwapped ? (state.p1GamesWon || 0) : (state.p2GamesWon || 0)}\r\n                        onWinSet={() => handleWinSet('right')}\r\n                    />\r\n                </div>\r\n            </div>\r\n\r\n            {/* Bottom Service Bar */}\r\n            <div className=\"h-16 bg-black/60 border-t border-white/10 flex items-center justify-center z-20 backdrop-blur-sm\">\r\n                <Button\r\n                    variant=\"ghost\"\r\n                    className=\"text-indigo-300 hover:text-indigo-100 font-bold tracking-widest gap-2 opacity-50 hover:opacity-100 uppercase\"\r\n                    onClick={onOrderClick}\r\n                >\r\n                    <UtensilsCrossed className=\"w-5 h-5\" /> Solicitar Servicio\r\n                </Button>\r\n            </div>\r\n\r\n            {/* Foul Penalty Picker Dialog */}\r\n            <Dialog open={foulPlayer !== null} onOpenChange={(open) => !open && setFoulPlayer(null)}>\r\n                <DialogContent className=\"max-w-2xl bg-zinc-900/95 backdrop-blur-xl border-red-900/50 text-white shadow-2xl z-50\">\r\n                    <DialogHeader>\r\n                        <DialogTitle className=\"text-center text-3xl uppercase font-black tracking-widest text-red-500 flex items-center justify-center gap-2\">\r\n                            <AlertTriangle className=\"w-8 h-8\" />\r\n                            Ingresar Valor de Pillo\r\n                        </DialogTitle>\r\n                        <p className=\"text-center text-zinc-400 font-mono\">\r\n                            Seleccione el valor de la bola correspondiente a la falta\r\n                        </p>\r\n                    </DialogHeader>\r\n\r\n                    <div className=\"py-6 flex flex-col items-center gap-6\">\r\n                        <div className=\"grid grid-cols-5 gap-4\">\r\n                            {ALL_BALLS.map(val => {\r\n                                const isAvailable = state.availableBalls.includes(val);\r\n                                return (\r\n                                    <button\r\n                                        key={val}\r\n                                        onClick={() => isAvailable && confirmFoul(val)}\r\n                                        disabled={!isAvailable}\r\n                                        className={cn(\r\n                                            \"w-14 h-14 rounded-full flex items-center justify-center text-xl font-black text-black shadow-lg transition-all border-2 border-transparent\",\r\n                                            isAvailable\r\n                                                ? \"hover:scale-110 active:scale-95 hover:border-white cursor-pointer\"\r\n                                                : \"opacity-20 grayscale cursor-not-allowed\",\r\n                                            getBallColorWithBg(val)\r\n                                        )}\r\n                                    >\r\n                                        {val}\r\n                                    </button>\r\n                                )\r\n                            })}\r\n                        </div>\r\n                        <Button\r\n                            variant=\"ghost\"\r\n                            className=\"text-zinc-500 hover:text-white\"\r\n                            onClick={() => setFoulPlayer(null)}\r\n                        >\r\n                            Cancelar\r\n                        </Button>\r\n                    </div>\r\n                </DialogContent>\r\n            </Dialog>\r\n        </div>\r\n    )\r\n}\r\n\r\nfunction PlayerCard({ name, rawScore, netScore, penalty, balls, colorClass, onFoul, isActive, isWinner, setsWon, onWinSet }: any) {\r\n    const isEmerald = colorClass === 'emerald';\r\n\r\n    return (\r\n        <div className={cn(\r\n            \"flex-1 rounded-3xl p-4 flex flex-col gap-2 border-2 transition-all duration-300 bg-black/40 backdrop-blur-md shadow-2xl min-h-0\",\r\n            isEmerald ? \"border-emerald-900/50\" : \"border-blue-900/50\",\r\n            isActive && (isEmerald ? \"border-emerald-500 shadow-emerald-900/20 ring-1 ring-emerald-500/50\" : \"border-blue-500 shadow-blue-900/20 ring-1 ring-blue-500/50\"),\r\n            isWinner && \"ring-4 ring-yellow-400 border-yellow-400 transform scale-105 z-30\"\r\n        )}>\r\n            {/* Header / Score */}\r\n            <div className=\"bg-black/40 rounded-2xl p-4 text-center relative overflow-hidden flex-shrink-0\">\r\n                <h3 className=\"text-zinc-400 font-bold uppercase text-xs tracking-widest mb-1 truncate px-2\">{name}</h3>\r\n\r\n                {/* Sets Won Badge */}\r\n                <div className=\"absolute top-2 left-2 flex items-center gap-1\">\r\n                    <Trophy className={cn(\"w-3 h-3\", isEmerald ? \"text-emerald-500\" : \"text-blue-500\")} />\r\n                    <span className=\"text-xs font-bold text-white\">{setsWon} Sets</span>\r\n                </div>\r\n\r\n                <div className={cn(\r\n                    \"text-6xl font-black font-mono tracking-tighter tabular-nums mt-2\",\r\n                    isWinner ? \"text-yellow-400\" : \"text-white\"\r\n                )}>\r\n                    {netScore.toFixed(1)}\r\n                </div>\r\n                {isWinner && <div className=\"absolute top-2 right-2 text-yellow-400 animate-bounce\"><Target /></div>}\r\n            </div>\r\n\r\n            {/* Stats Breakdown */}\r\n            <div className=\"bg-black/20 rounded-xl p-3 flex flex-col gap-1 text-xs font-mono text-zinc-400 flex-shrink-0\">\r\n                <div className=\"flex justify-between\">\r\n                    <span>Bolas:</span>\r\n                    <span className=\"text-white\">{rawScore}</span>\r\n                </div>\r\n                <div className=\"flex justify-between\">\r\n                    <span>Ajeno/Pillo:</span>\r\n                    <span className={penalty < 0 ? \"text-red-400\" : \"text-green-400\"}>\r\n                        {penalty > 0 ? '+' : ''}{penalty.toFixed(1)}\r\n                    </span>\r\n                </div>\r\n                <div className=\"border-t border-white/10 my-1\"></div>\r\n                <div className=\"flex justify-between font-bold\">\r\n                    <span>Neto:</span>\r\n                    <span className=\"text-white\">{netScore.toFixed(1)}</span>\r\n                </div>\r\n            </div>\r\n\r\n            {/* Collected Balls - Scrollable area */}\r\n            <div className=\"flex-1 bg-black/20 rounded-xl p-3 content-start flex flex-wrap gap-2 overflow-y-auto min-h-0\">\r\n                {balls.length === 0 && <span className=\"text-zinc-600 text-xs w-full text-center py-4 italic\">Sin bolas</span>}\r\n                {balls.map((b: number) => (\r\n                    <PoolBallIcon key={b} value={b} size=\"sm\" />\r\n                ))}\r\n            </div>\r\n\r\n            {/* Actions Grid */}\r\n            <div className=\"grid grid-cols-2 gap-2 flex-shrink-0\">\r\n                <Button\r\n                    onClick={onFoul}\r\n                    className=\"h-14 bg-red-900/80 hover:bg-red-800 text-red-200 hover:text-white font-bold text-sm rounded-xl border border-red-500/30 uppercase\"\r\n                >\r\n                    <AlertTriangle className=\"w-4 h-4 mr-1\" />\r\n                    Pillo\r\n                </Button>\r\n\r\n                <Button\r\n                    onClick={onWinSet}\r\n                    className={cn(\r\n                        \"h-14 font-black text-sm rounded-xl border uppercase shadow-lg active:translate-y-1 transition-all\",\r\n                        isEmerald\r\n                            ? \"bg-emerald-600 hover:bg-emerald-500 border-emerald-400 text-white\"\r\n                            : \"bg-blue-600 hover:bg-blue-500 border-blue-400 text-white\"\r\n                    )}\r\n                >\r\n                    <Trophy className=\"w-4 h-4 mr-1\" />\r\n                    Ganó Set\r\n                </Button>\r\n            </div>\r\n        </div>\r\n    )\r\n}\r\n\r\nfunction getBallColorWithBg(num: number) {\r\n    if (num === 1 || num === 9) return 'bg-yellow-400';\r\n    if (num === 2 || num === 10) return 'bg-blue-600';\r\n    if (num === 3 || num === 11) return 'bg-red-600';\r\n    if (num === 4 || num === 12) return 'bg-purple-600';\r\n    if (num === 5 || num === 13) return 'bg-orange-500';\r\n    if (num === 6 || num === 14) return 'bg-green-600';\r\n    if (num === 7 || num === 15) return 'bg-amber-900';\r\n    if (num === 8) return 'bg-black text-white';\r\n    return 'bg-white';\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\rokat\\OneDrive\\Proyectos\\Akapoolco\\src\\components\\kiosk\\scoreboard\\GameScoreboard.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":14,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":14,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[665,668],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[665,668],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\nC:\\Users\\rokat\\OneDrive\\Proyectos\\Akapoolco\\src\\components\\kiosk\\scoreboard\\GameScoreboard.tsx:43:17\n  41 |             // e.g. Table is CHILEAN but State is POOL\n  42 |             if ((tableType === 'POOL_CHILENO' || tableType === 'CHILEAN') && loadedState.gameType !== 'CHILEAN') {\n> 43 |                 setGameState({\n     |                 ^^^^^^^^^^^^ Avoid calling setState() directly within an effect\n  44 |                     gameType: 'CHILEAN',\n  45 |                     availableBalls: Array.from({ length: 15 }, (_, i) => i + 1), // 1-15\n  46 |                     p1Balls: [],","line":43,"column":17,"nodeType":null,"endLine":43,"endColumn":29}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useEffect, useState, useCallback } from \"react\";\r\nimport { GameState, PoolState, CaromState, ChileanState, SnookerState } from \"@/types/game-state\";\r\nimport { PoolScoreboard } from \"./PoolScoreboard\";\r\nimport { CaromScoreboard } from \"./CaromScoreboard\";\r\nimport { ChileanPoolScoreboard } from \"./ChileanPoolScoreboard\";\r\nimport { SnookerScoreboard } from \"./SnookerScoreboard\";\r\nimport { CardScoreboard } from \"./CardScoreboard\";\r\nimport { updateGameState } from \"@/app/lib/actions-kiosk\";\r\nimport { toast } from \"sonner\";\r\nimport { useDebouncedCallback } from \"use-debounce\";\r\n\r\ninterface GameScoreboardProps {\r\n    sessionId: string;\r\n    initialState: any; // Raw JSON from DB\r\n    tableType: string;\r\n    playerNames: [string, string];\r\n    players?: { name: string; image?: string | null }[];\r\n    cameraTopUrl?: string | null;\r\n    cameraFrontUrl?: string | null;\r\n    onOrderClick?: () => void;\r\n}\r\n\r\nexport function GameScoreboard({\r\n    sessionId,\r\n    initialState,\r\n    tableType,\r\n    playerNames,\r\n    players,\r\n    cameraTopUrl,\r\n    cameraFrontUrl,\r\n    onOrderClick\r\n}: GameScoreboardProps) {\r\n    const [gameState, setGameState] = useState<GameState | null>(null);\r\n\r\n    // Initial State Factory\r\n    // Initial State Factory\r\n    useEffect(() => {\r\n        if (initialState) {\r\n            const loadedState = initialState as GameState;\r\n            // Hot-Fix: Force Game Type correction if DB has old state mismatch\r\n            // e.g. Table is CHILEAN but State is POOL\r\n            if ((tableType === 'POOL_CHILENO' || tableType === 'CHILEAN') && loadedState.gameType !== 'CHILEAN') {\r\n                setGameState({\r\n                    gameType: 'CHILEAN',\r\n                    availableBalls: Array.from({ length: 15 }, (_, i) => i + 1), // 1-15\r\n                    p1Balls: [],\r\n                    p2Balls: [],\r\n                    p1FoulPoints: 0,\r\n                    p2FoulPoints: 0,\r\n                    p1GamesWon: 0,\r\n                    p2GamesWon: 0\r\n                });\r\n            } else if ((tableType === 'POOL_CHILENO' || tableType === 'CHILEAN') && loadedState.gameType === 'CHILEAN' && loadedState.p1GamesWon === undefined) {\r\n                // Backward compatibility for states created before this feature\r\n                setGameState({\r\n                    ...loadedState,\r\n                    p1GamesWon: 0,\r\n                    p2GamesWon: 0\r\n                });\r\n            } else if (tableType === 'SNOOKER' && loadedState.gameType !== 'SNOOKER') {\r\n                setGameState({\r\n                    gameType: 'SNOOKER',\r\n                    p1Score: 0,\r\n                    p2Score: 0,\r\n                    p1Frames: 0,\r\n                    p2Frames: 0,\r\n                    currentBreak: 0\r\n                });\r\n            } else {\r\n                setGameState(loadedState);\r\n            }\r\n        } else {\r\n            // Default Init logic - Ensure we don't trigger unnecessary re-renders loop\r\n            // We only set this if gameState is null (first load)\r\n            setGameState(prev => {\r\n                if (prev) return prev; // Don't override if already set (optimistic updates preservation)\r\n\r\n                if (tableType === 'CARAMBOLA') {\r\n                    return {\r\n                        gameType: 'CAROM',\r\n                        p1Score: 0,\r\n                        p2Score: 0,\r\n                        innings: 0,\r\n                        currentRun: 0\r\n                    };\r\n                } else if (tableType === 'POOL_CHILENO' || tableType === 'CHILEAN') {\r\n                    return {\r\n                        gameType: 'CHILEAN',\r\n                        availableBalls: Array.from({ length: 15 }, (_, i) => i + 1), // 1-15\r\n                        p1Balls: [],\r\n                        p2Balls: [],\r\n                        p1FoulPoints: 0,\r\n                        p2FoulPoints: 0,\r\n                        p1GamesWon: 0,\r\n                        p2GamesWon: 0\r\n                    };\r\n                } else if (tableType === 'SNOOKER') {\r\n                    return {\r\n                        gameType: 'SNOOKER',\r\n                        p1Score: 0,\r\n                        p2Score: 0,\r\n                        p1Frames: 0,\r\n                        p2Frames: 0,\r\n                        currentBreak: 0\r\n                    };\r\n                } else {\r\n                    return {\r\n                        gameType: 'POOL',\r\n                        p1Racks: 0,\r\n                        p2Racks: 0,\r\n                        history: []\r\n                    };\r\n                }\r\n            });\r\n        }\r\n    }, [initialState, tableType]);\r\n\r\n    // Persist to Server with Debounce\r\n    const debouncedSave = useDebouncedCallback(async (newState: GameState) => {\r\n        const result = await updateGameState(sessionId, newState);\r\n        if (!result.success) {\r\n            toast.error(\"Error al guardar marcador\", {\r\n                description: \"Verifique su conexión\",\r\n                duration: 2000\r\n            });\r\n        }\r\n    }, 1000); // 1.0s debounce\r\n\r\n    const handleUpdate = useCallback((newState: GameState) => {\r\n        setGameState(newState); // Optimistic\r\n        debouncedSave(newState); // Server\r\n    }, [debouncedSave]);\r\n\r\n    // Props for children\r\n    const videoProps = { cameraTopUrl, cameraFrontUrl };\r\n\r\n    if (tableType === 'CARDS' || tableType === 'POKER') {\r\n        return (\r\n            <div className=\"w-full h-full bg-black/90 rounded-xl overflow-hidden shadow-2xl border border-zinc-800\">\r\n                <CardScoreboard\r\n                    playerNames={playerNames}\r\n                    {...videoProps}\r\n                    onOrderClick={onOrderClick}\r\n                />\r\n            </div>\r\n        )\r\n    }\r\n\r\n    if (!gameState) return <div className=\"text-zinc-500 p-10\">Cargando marcador...</div>;\r\n\r\n    return (\r\n        <div className=\"w-full h-full bg-black/90 rounded-xl overflow-hidden shadow-2xl border border-zinc-800\">\r\n            {gameState.gameType === 'CAROM' && (\r\n                <CaromScoreboard\r\n                    state={gameState as CaromState}\r\n                    playerNames={playerNames}\r\n                    onUpdate={handleUpdate}\r\n                    {...videoProps}\r\n                    onOrderClick={onOrderClick}\r\n                />\r\n            )}\r\n            {(gameState.gameType === 'POOL' || gameState.gameType === 'POOL_INTL') && (\r\n                <PoolScoreboard\r\n                    state={gameState as PoolState}\r\n                    playerNames={playerNames}\r\n                    onUpdate={handleUpdate}\r\n                    {...videoProps}\r\n                    onOrderClick={onOrderClick}\r\n                />\r\n            )}\r\n            {gameState.gameType === 'CHILEAN' && (\r\n                <ChileanPoolScoreboard\r\n                    state={gameState as ChileanState}\r\n                    playerNames={playerNames}\r\n                    players={players}\r\n                    onUpdate={handleUpdate}\r\n                    {...videoProps}\r\n                    onOrderClick={onOrderClick}\r\n                />\r\n            )}\r\n            {gameState.gameType === 'SNOOKER' && (\r\n                <SnookerScoreboard\r\n                    state={gameState as SnookerState}\r\n                    playerNames={playerNames}\r\n                    onUpdate={handleUpdate}\r\n                    {...videoProps}\r\n                    onOrderClick={onOrderClick}\r\n                />\r\n            )}\r\n        </div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\rokat\\OneDrive\\Proyectos\\Akapoolco\\src\\components\\kiosk\\scoreboard\\PoolBallIcon.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\rokat\\OneDrive\\Proyectos\\Akapoolco\\src\\components\\kiosk\\scoreboard\\PoolScoreboard.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\rokat\\OneDrive\\Proyectos\\Akapoolco\\src\\components\\kiosk\\scoreboard\\ShotClock.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'useRef' is defined but never used.","line":3,"column":31,"nodeType":"Identifier","messageId":"unusedVar","endLine":3,"endColumn":37,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"useRef"},"fix":{"range":[45,53],"text":""},"desc":"Remove unused variable \"useRef\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Plus' is defined but never used.","line":5,"column":34,"nodeType":"Identifier","messageId":"unusedVar","endLine":5,"endColumn":38,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"Plus"},"fix":{"range":[137,143],"text":""},"desc":"Remove unused variable \"Plus\"."}]},{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\nC:\\Users\\rokat\\OneDrive\\Proyectos\\Akapoolco\\src\\components\\kiosk\\scoreboard\\ShotClock.tsx:21:9\n  19 |     // Sync external running state\n  20 |     useEffect(() => {\n> 21 |         setIsPaused(!isRunning);\n     |         ^^^^^^^^^^^ Avoid calling setState() directly within an effect\n  22 |     }, [isRunning]);\n  23 |\n  24 |     // Timer Logic","line":21,"column":9,"nodeType":null,"endLine":21,"endColumn":20},{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\nC:\\Users\\rokat\\OneDrive\\Proyectos\\Akapoolco\\src\\components\\kiosk\\scoreboard\\ShotClock.tsx:44:9\n  42 |     // Reset when initialSeconds changes (new turn)\n  43 |     useEffect(() => {\n> 44 |         setSecondsLeft(initialSeconds);\n     |         ^^^^^^^^^^^^^^ Avoid calling setState() directly within an effect\n  45 |         setIsPaused(!isRunning);\n  46 |     }, [initialSeconds, isRunning]);\n  47 |","line":44,"column":9,"nodeType":null,"endLine":44,"endColumn":23},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'percentage' is assigned a value but never used.","line":49,"column":11,"nodeType":"Identifier","messageId":"unusedVar","endLine":49,"endColumn":21}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport { useEffect, useState, useRef } from 'react';\r\nimport { cn } from '@/lib/utils';\r\nimport { Play, Pause, RotateCcw, Plus } from 'lucide-react';\r\nimport { Button } from '@/components/ui/button';\r\n\r\ninterface ShotClockProps {\r\n    initialSeconds: number;\r\n    isRunning: boolean;\r\n    onTimeout?: () => void;\r\n    onReset?: () => void; // Called when reset button is clicked manually\r\n}\r\n\r\nexport function ShotClock({ initialSeconds, isRunning, onTimeout, onReset }: ShotClockProps) {\r\n    const [secondsLeft, setSecondsLeft] = useState(initialSeconds);\r\n    const [isPaused, setIsPaused] = useState(!isRunning);\r\n\r\n    // Sync external running state\r\n    useEffect(() => {\r\n        setIsPaused(!isRunning);\r\n    }, [isRunning]);\r\n\r\n    // Timer Logic\r\n    useEffect(() => {\r\n        if (isPaused) return;\r\n        if (secondsLeft <= 0) return;\r\n\r\n        const interval = setInterval(() => {\r\n            setSecondsLeft(prev => {\r\n                const next = prev - 1;\r\n                if (next === 0 && onTimeout) {\r\n                    onTimeout();\r\n                }\r\n                return Math.max(0, next);\r\n            });\r\n        }, 1000);\r\n\r\n        return () => clearInterval(interval);\r\n    }, [isPaused, secondsLeft, onTimeout]);\r\n\r\n    // Reset when initialSeconds changes (new turn)\r\n    useEffect(() => {\r\n        setSecondsLeft(initialSeconds);\r\n        setIsPaused(!isRunning);\r\n    }, [initialSeconds, isRunning]);\r\n\r\n    // Visuals\r\n    const percentage = (secondsLeft / 40) * 100; // Assuming 40 base for visual, or dynamic\r\n    const isWarning = secondsLeft <= 10;\r\n    const isCritical = secondsLeft <= 5;\r\n\r\n    const handleExtension = () => {\r\n        setSecondsLeft(prev => prev + 30); // Standard extension\r\n    };\r\n\r\n    return (\r\n        <div className=\"flex flex-col items-center gap-2\">\r\n            <div className={cn(\r\n                \"w-24 h-24 rounded-full border-4 flex items-center justify-center relative shadow-[0_0_20px_rgba(0,0,0,0.5)] transition-all duration-500\",\r\n                isCritical ? \"border-red-600 bg-red-950/50 animate-pulse\" :\r\n                    isWarning ? \"border-amber-500 bg-amber-950/50\" : \"border-zinc-700 bg-black/50\"\r\n            )}>\r\n                <span className={cn(\r\n                    \"text-4xl font-black font-mono tracking-tighter\",\r\n                    isCritical ? \"text-red-500\" : isWarning ? \"text-amber-500\" : \"text-white\"\r\n                )}>\r\n                    {secondsLeft}\r\n                </span>\r\n\r\n                {/* Progress Ring (Simplified) */}\r\n                <svg className=\"absolute inset-0 w-full h-full -rotate-90 pointer-events-none opacity-20\">\r\n                    <circle cx=\"50%\" cy=\"50%\" r=\"40%\" stroke=\"currentColor\" strokeWidth=\"4\" fill=\"none\" className={isWarning ? \"text-amber-500\" : \"text-emerald-500\"} strokeDasharray=\"100\" strokeDashoffset={100 - (secondsLeft / initialSeconds * 100)} />\r\n                </svg>\r\n            </div>\r\n\r\n            <div className=\"flex gap-1 scale-90\">\r\n                <Button\r\n                    variant=\"ghost\"\r\n                    size=\"icon\"\r\n                    onClick={() => setIsPaused(!isPaused)}\r\n                    className=\"h-8 w-8 rounded-full border border-zinc-700 hover:bg-zinc-800\"\r\n                >\r\n                    {isPaused ? <Play className=\"w-4 h-4 text-emerald-500\" /> : <Pause className=\"w-4 h-4 text-amber-500\" />}\r\n                </Button>\r\n\r\n                <Button\r\n                    variant=\"ghost\"\r\n                    size=\"icon\"\r\n                    onClick={() => { setSecondsLeft(initialSeconds); onReset?.(); }}\r\n                    className=\"h-8 w-8 rounded-full border border-zinc-700 hover:bg-zinc-800\"\r\n                >\r\n                    <RotateCcw className=\"w-4 h-4 text-white\" />\r\n                </Button>\r\n\r\n                <Button\r\n                    variant=\"ghost\"\r\n                    size=\"sm\"\r\n                    onClick={handleExtension}\r\n                    className=\"h-8 px-2 rounded-full border border-zinc-700 hover:bg-zinc-800 text-xs font-bold text-zinc-400\"\r\n                >\r\n                    +30s\r\n                </Button>\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\rokat\\OneDrive\\Proyectos\\Akapoolco\\src\\components\\kiosk\\scoreboard\\SnookerScoreboard.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\rokat\\OneDrive\\Proyectos\\Akapoolco\\src\\components\\members\\MigrationControl.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\rokat\\OneDrive\\Proyectos\\Akapoolco\\src\\components\\members\\consumption-chart.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\rokat\\OneDrive\\Proyectos\\Akapoolco\\src\\components\\members\\create-member-dialog.tsx","messages":[],"suppressedMessages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":27,"column":42,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":27,"endColumn":45,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[768,771],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[768,771],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\rokat\\OneDrive\\Proyectos\\Akapoolco\\src\\components\\members\\delete-member-dialog.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is defined but never used.","line":38,"column":18,"nodeType":"Identifier","messageId":"unusedVar","endLine":38,"endColumn":23}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\"\r\n\r\nimport {\r\n    Dialog,\r\n    DialogContent,\r\n    DialogDescription,\r\n    DialogFooter,\r\n    DialogHeader,\r\n    DialogTitle,\r\n} from \"@/components/ui/dialog\"\r\nimport { Button } from \"@/components/ui/button\"\r\nimport { Loader2, Trash2 } from \"lucide-react\"\r\nimport { useState } from \"react\"\r\nimport { toast } from \"sonner\"\r\nimport { deleteMember } from \"@/app/lib/actions-members\"\r\n\r\ninterface DeleteMemberDialogProps {\r\n    member: { id: string; name: string } | null\r\n    open: boolean\r\n    onOpenChange: (open: boolean) => void\r\n}\r\n\r\nexport function DeleteMemberDialog({ member, open, onOpenChange }: DeleteMemberDialogProps) {\r\n    const [isDeleting, setIsDeleting] = useState(false)\r\n\r\n    async function handleDelete() {\r\n        if (!member) return\r\n\r\n        setIsDeleting(true)\r\n        try {\r\n            const result = await deleteMember(member.id)\r\n            if (result.error) {\r\n                toast.error(result.error)\r\n            } else {\r\n                toast.success(\"Socio eliminado correctamente\")\r\n                onOpenChange(false)\r\n            }\r\n        } catch (error) {\r\n            toast.error(\"Error inesperado al eliminar\")\r\n        } finally {\r\n            setIsDeleting(false)\r\n        }\r\n    }\r\n\r\n    return (\r\n        <Dialog open={open} onOpenChange={onOpenChange}>\r\n            <DialogContent className=\"bg-zinc-950 border-white/10 text-white sm:max-w-[425px]\">\r\n                <DialogHeader>\r\n                    <DialogTitle className=\"flex items-center gap-2 text-red-500\">\r\n                        <Trash2 className=\"w-5 h-5\" />\r\n                        Eliminar Socio\r\n                    </DialogTitle>\r\n                    <DialogDescription className=\"text-zinc-400\">\r\n                        ¿Estás seguro que deseas eliminar a <span className=\"font-bold text-white\">{member?.name}</span>?\r\n                        <br />\r\n                        Esta acción no se puede deshacer.\r\n                    </DialogDescription>\r\n                </DialogHeader>\r\n                <DialogFooter className=\"mt-4\">\r\n                    <Button\r\n                        variant=\"ghost\"\r\n                        onClick={() => onOpenChange(false)}\r\n                        disabled={isDeleting}\r\n                        className=\"hover:bg-white/10\"\r\n                    >\r\n                        Cancelar\r\n                    </Button>\r\n                    <Button\r\n                        variant=\"destructive\"\r\n                        onClick={handleDelete}\r\n                        disabled={isDeleting}\r\n                        className=\"bg-red-600 hover:bg-red-700 text-white\"\r\n                    >\r\n                        {isDeleting ? (\r\n                            <>\r\n                                <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" />\r\n                                Eliminando...\r\n                            </>\r\n                        ) : (\r\n                            \"Eliminar\"\r\n                        )}\r\n                    </Button>\r\n                </DialogFooter>\r\n            </DialogContent>\r\n        </Dialog>\r\n    )\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\rokat\\OneDrive\\Proyectos\\Akapoolco\\src\\components\\members\\edit-member-dialog.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":47,"column":42,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":47,"endColumn":45,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1441,1444],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1441,1444],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\"\r\n\r\nimport { useState, useRef } from \"react\"\r\nimport { Button } from \"@/components/ui/button\"\r\nimport {\r\n    Dialog,\r\n    DialogContent,\r\n    DialogHeader,\r\n    DialogTitle,\r\n    DialogTrigger,\r\n} from \"@/components/ui/dialog\"\r\nimport { Input } from \"@/components/ui/input\"\r\nimport {\r\n    Select,\r\n    SelectContent,\r\n    SelectItem,\r\n    SelectTrigger,\r\n    SelectValue,\r\n} from \"@/components/ui/select\"\r\nimport { updateMember } from \"@/app/lib/actions-members\"\r\nimport { Loader2, Camera, Upload, FileText, CheckCircle } from \"lucide-react\"\r\nimport { Avatar, AvatarFallback, AvatarImage } from \"@/components/ui/avatar\"\r\n\r\ninterface EditMemberDialogProps {\r\n    member: {\r\n        id: string\r\n        name: string\r\n        rut?: string | null\r\n        email?: string | null\r\n        type: string\r\n        debtLimit?: number\r\n        image?: string | null\r\n        documentImage?: string | null\r\n    }\r\n    trigger?: React.ReactNode\r\n    open?: boolean\r\n    onOpenChange?: (open: boolean) => void\r\n}\r\n\r\nexport function EditMemberDialog({ member, trigger, open, onOpenChange }: EditMemberDialogProps) {\r\n    const [internalOpen, setInternalOpen] = useState(false)\r\n    const isControlled = open !== undefined\r\n    const isOpen = isControlled ? open : internalOpen\r\n    const setOpen = isControlled ? onOpenChange! : setInternalOpen\r\n\r\n    const [isLoading, setIsLoading] = useState(false)\r\n    const [errors, setErrors] = useState<any>({})\r\n\r\n    // File states\r\n    const [imageFile, setImageFile] = useState<File | null>(null)\r\n    const [imagePreview, setImagePreview] = useState<string | null>(member.image || null)\r\n\r\n    const [docFile, setDocFile] = useState<File | null>(null)\r\n\r\n    const fileInputRef = useRef<HTMLInputElement>(null)\r\n    const docInputRef = useRef<HTMLInputElement>(null)\r\n\r\n    const handleImageChange = (e: React.ChangeEvent<HTMLInputElement>) => {\r\n        const file = e.target.files?.[0]\r\n        if (file) {\r\n            setImageFile(file)\r\n            const reader = new FileReader()\r\n            reader.onloadend = () => {\r\n                setImagePreview(reader.result as string)\r\n            }\r\n            reader.readAsDataURL(file)\r\n        }\r\n    }\r\n\r\n    const handleDocChange = (e: React.ChangeEvent<HTMLInputElement>) => {\r\n        const file = e.target.files?.[0]\r\n        if (file) {\r\n            setDocFile(file)\r\n        }\r\n    }\r\n\r\n    async function onSubmit(formData: FormData) {\r\n        setIsLoading(true)\r\n        setErrors({})\r\n\r\n        // Append files manually if they exist (FormData from form might not match if we controlled inputs weirdly, \r\n        // but inputs with name attribute inside form usually work. We'll verify.)\r\n\r\n        // Actually, inputs with name=\"image\" and type=\"file\" will be in formData automatically.\r\n        // But if we used a hidden input or custom handler, we might need to append.\r\n        // We will use hidden file inputs referenced by refs for styling.\r\n\r\n        if (imageFile) formData.set(\"image\", imageFile)\r\n        if (docFile) formData.set(\"documentImage\", docFile)\r\n\r\n        const result = await updateMember(member.id, formData)\r\n\r\n        if (result?.error) {\r\n            setErrors(result.error)\r\n            setIsLoading(false)\r\n        } else {\r\n            setOpen(false)\r\n            setIsLoading(false)\r\n            // Optional: Toast success\r\n        }\r\n    }\r\n\r\n    return (\r\n        <Dialog open={isOpen} onOpenChange={setOpen}>\r\n            {trigger && <DialogTrigger asChild>{trigger}</DialogTrigger>}\r\n            <DialogContent className=\"sm:max-w-[600px] bg-zinc-950 border-white/10 text-white p-0 overflow-hidden\">\r\n                <DialogHeader className=\"p-6 bg-black/40 border-b border-white/5\">\r\n                    <DialogTitle className=\"text-2xl text-center\">Editar Socio</DialogTitle>\r\n                </DialogHeader>\r\n\r\n                <form action={onSubmit} className=\"p-6 space-y-6 max-h-[80vh] overflow-y-auto\">\r\n\r\n                    {/* Photo Upload */}\r\n                    <div className=\"flex flex-col items-center gap-4\">\r\n                        <div className=\"relative group cursor-pointer\" onClick={() => fileInputRef.current?.click()}>\r\n                            <Avatar className=\"w-24 h-24 border-2 border-dashed border-white/20 group-hover:border-primary/50 transition-colors\">\r\n                                <AvatarImage src={imagePreview || \"\"} />\r\n                                <AvatarFallback className=\"bg-white/5 text-zinc-500\">\r\n                                    <Camera className=\"w-8 h-8\" />\r\n                                </AvatarFallback>\r\n                            </Avatar>\r\n                            <div className=\"absolute inset-0 flex items-center justify-center bg-black/60 opacity-0 group-hover:opacity-100 rounded-full transition-opacity\">\r\n                                <span className=\"text-xs text-white font-medium\">Cambiar</span>\r\n                            </div>\r\n                        </div>\r\n                        <input\r\n                            type=\"file\"\r\n                            ref={fileInputRef}\r\n                            accept=\"image/*\"\r\n                            className=\"hidden\"\r\n                            onChange={handleImageChange}\r\n                            name=\"image_dummy\" // We append manually to ensure correctness or just let it be if we didn't use append logic above? \r\n                        // Standard form action gets it if input has name. \r\n                        // But we manually set keys above in onSubmit to be safe.\r\n                        />\r\n                        <span className=\"text-xs text-zinc-400\">Click para subir foto de perfil</span>\r\n                    </div>\r\n\r\n                    {/* Basic Info */}\r\n                    <div className=\"grid grid-cols-2 gap-4\">\r\n                        <div className=\"space-y-2 col-span-2\">\r\n                            <label className=\"text-sm font-medium text-zinc-300\">Nombre Completo</label>\r\n                            <Input name=\"name\" defaultValue={member.name} className=\"bg-zinc-900 border-white/10\" required />\r\n                        </div>\r\n\r\n                        <div className=\"space-y-2\">\r\n                            <label className=\"text-sm font-medium text-zinc-300\">RUT</label>\r\n                            <Input name=\"rut\" defaultValue={member.rut || \"\"} className=\"bg-zinc-900 border-white/10\" />\r\n                            {errors.rut && <p className=\"text-red-400 text-xs\">{errors.rut}</p>}\r\n                        </div>\r\n\r\n                        <div className=\"space-y-2\">\r\n                            <label className=\"text-sm font-medium text-zinc-300\">Email</label>\r\n                            <Input name=\"email\" type=\"email\" defaultValue={member.email || \"\"} className=\"bg-zinc-900 border-white/10\" />\r\n                            {errors.email && <p className=\"text-red-400 text-xs\">{errors.email}</p>}\r\n                        </div>\r\n                    </div>\r\n\r\n                    {/* Type & Limit */}\r\n                    <div className=\"grid grid-cols-2 gap-4\">\r\n                        <div className=\"space-y-2\">\r\n                            <label className=\"text-sm font-medium text-zinc-300\">Tipo de Cliente</label>\r\n                            <Select name=\"type\" defaultValue={member.type}>\r\n                                <SelectTrigger className=\"bg-zinc-900 border-white/10\">\r\n                                    <SelectValue />\r\n                                </SelectTrigger>\r\n                                <SelectContent className=\"bg-zinc-900 border-white/10 text-white\">\r\n                                    <SelectItem value=\"CLIENTE\">Cliente</SelectItem>\r\n                                    <SelectItem value=\"SOCIO\">Socio</SelectItem>\r\n                                    <SelectItem value=\"SOCIO_FUNDADOR\">Socio Fundador</SelectItem>\r\n                                </SelectContent>\r\n                            </Select>\r\n                        </div>\r\n\r\n                        <div className=\"space-y-2\">\r\n                            <label className=\"text-sm font-medium text-zinc-300\">Cupo ($)</label>\r\n                            <Input type=\"number\" name=\"debtLimit\" defaultValue={member.debtLimit || 0} className=\"bg-zinc-900 border-white/10\" />\r\n                        </div>\r\n                    </div>\r\n\r\n                    {/* Document Upload */}\r\n                    <div className=\"space-y-2 pt-4 border-t border-white/5\">\r\n                        <label className=\"text-sm font-medium text-zinc-300 flex items-center gap-2\">\r\n                            <FileText className=\"w-4 h-4 text-primary\" />\r\n                            Cédula de Identidad / Documento\r\n                        </label>\r\n\r\n                        <div\r\n                            className=\"border border-dashed border-white/20 rounded-lg p-4 flex items-center justify-between hover:bg-white/5 cursor-pointer transition-colors\"\r\n                            onClick={() => docInputRef.current?.click()}\r\n                        >\r\n                            <div className=\"flex items-center gap-3\">\r\n                                <div className=\"p-2 bg-white/10 rounded\">\r\n                                    {docFile ? <CheckCircle className=\"w-5 h-5 text-green-400\" /> : <Upload className=\"w-5 h-5 text-zinc-400\" />}\r\n                                </div>\r\n                                <div className=\"flex flex-col\">\r\n                                    <span className=\"text-sm text-zinc-200\">\r\n                                        {docFile ? docFile.name : (member.documentImage ? \"Documento cargado (Click para cambiar)\" : \"Subir escaneo de documento\")}\r\n                                    </span>\r\n                                    <span className=\"text-xs text-zinc-500\">PDF, PNG, JPG (Max 4MB)</span>\r\n                                </div>\r\n                            </div>\r\n                            <Button type=\"button\" variant=\"ghost\" size=\"sm\">Examinar</Button>\r\n                        </div>\r\n                        <input\r\n                            type=\"file\"\r\n                            ref={docInputRef}\r\n                            accept=\"image/*,application/pdf\"\r\n                            className=\"hidden\"\r\n                            onChange={handleDocChange}\r\n                        />\r\n                    </div>\r\n\r\n                    {errors.root && <p className=\"text-red-400 text-sm text-center bg-red-900/20 p-2 rounded\">{errors.root}</p>}\r\n\r\n                    <div className=\"flex justify-end gap-3 pt-4\">\r\n                        <Button type=\"button\" variant=\"ghost\" onClick={() => setOpen(false)}>Cancelar</Button>\r\n                        <Button type=\"submit\" disabled={isLoading} className=\"bg-primary text-black font-semibold hover:bg-primary/90\">\r\n                            {isLoading && <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" />}\r\n                            Guardar Cambios\r\n                        </Button>\r\n                    </div>\r\n                </form>\r\n            </DialogContent>\r\n        </Dialog>\r\n    )\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\rokat\\OneDrive\\Proyectos\\Akapoolco\\src\\components\\members\\import-members-dialog.tsx","messages":[],"suppressedMessages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'XCircle' is defined but never used.","line":17,"column":63,"nodeType":"Identifier","messageId":"unusedVar","endLine":17,"endColumn":70,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"XCircle"},"fix":{"range":[498,507],"text":""},"desc":"Remove unused variable \"XCircle\"."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":27,"column":46,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":27,"endColumn":49,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[894,897],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[894,897],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":28,"column":86,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":28,"endColumn":89,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[992,995],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[992,995],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":47,"column":47,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":47,"endColumn":50,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1823,1826],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1823,1826],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":52,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":52,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2156,2159],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2156,2159],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\rokat\\OneDrive\\Proyectos\\Akapoolco\\src\\components\\members\\members-table.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Ban' is defined but never used.","line":15,"column":36,"nodeType":"Identifier","messageId":"unusedVar","endLine":15,"endColumn":39,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"Ban"},"fix":{"range":[405,410],"text":""},"desc":"Remove unused variable \"Ban\"."}]},{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\nC:\\Users\\rokat\\OneDrive\\Proyectos\\Akapoolco\\src\\components\\members\\members-table.tsx:88:9\n  86 |     // Reset page when filter changes\n  87 |     useEffect(() => {\n> 88 |         setCurrentPage(1);\n     |         ^^^^^^^^^^^^^^ Avoid calling setState() directly within an effect\n  89 |     }, [searchTerm, filterType, filterStatus]);\n  90 |\n  91 |     return (","line":88,"column":9,"nodeType":null,"endLine":88,"endColumn":23}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\"\r\n\r\nimport {\r\n    Table,\r\n    TableBody,\r\n    TableCell,\r\n    TableHead,\r\n    TableHeader,\r\n    TableRow,\r\n} from \"@/components/ui/table\"\r\nimport { Avatar, AvatarFallback, AvatarImage } from \"@/components/ui/avatar\"\r\nimport { Badge } from \"@/components/ui/badge\"\r\nimport { Button } from \"@/components/ui/button\"\r\nimport { Input } from \"@/components/ui/input\"\r\nimport { MoreHorizontal, FileText, Ban, Pencil, Search, ChevronLeft, ChevronRight, Filter, Trash2 } from \"lucide-react\"\r\nimport {\r\n    DropdownMenu,\r\n    DropdownMenuContent,\r\n    DropdownMenuItem,\r\n    DropdownMenuLabel,\r\n    DropdownMenuSeparator,\r\n    DropdownMenuTrigger,\r\n} from \"@/components/ui/dropdown-menu\"\r\nimport {\r\n    Select,\r\n    SelectContent,\r\n    SelectItem,\r\n    SelectTrigger,\r\n    SelectValue,\r\n} from \"@/components/ui/select\"\r\nimport Link from \"next/link\"\r\nimport { EditMemberDialog } from \"./edit-member-dialog\"\r\nimport { DeleteMemberDialog } from \"./delete-member-dialog\"\r\nimport { useState, useMemo, useEffect } from \"react\"\r\nimport { cn } from \"@/lib/utils\"\r\n\r\ninterface Member {\r\n    id: string\r\n    name: string\r\n    email: string | null\r\n    type: string\r\n    debtStatus: boolean\r\n    image?: string | null\r\n    documentImage?: string | null\r\n    rut?: string | null\r\n    paymentStatus?: string // New\r\n    billingProfile?: string // New\r\n}\r\n\r\ninterface MembersTableProps {\r\n    members: Member[]\r\n}\r\n\r\nconst ITEMS_PER_PAGE = 8;\r\n\r\nexport function MembersTable({ members }: MembersTableProps) {\r\n    const [editingMember, setEditingMember] = useState<Member | null>(null)\r\n    const [deletingMember, setDeletingMember] = useState<Member | null>(null)\r\n    const [searchTerm, setSearchTerm] = useState(\"\")\r\n    const [filterType, setFilterType] = useState(\"ALL\")\r\n    const [filterStatus, setFilterStatus] = useState(\"ALL\") // New Filter\r\n    const [currentPage, setCurrentPage] = useState(1)\r\n\r\n    // Filter Logic\r\n    const filteredMembers = useMemo(() => {\r\n        return members.filter(member => {\r\n            const matchesSearch =\r\n                member.name.toLowerCase().includes(searchTerm.toLowerCase()) ||\r\n                (member.email && member.email.toLowerCase().includes(searchTerm.toLowerCase())) ||\r\n                (member.rut && member.rut.includes(searchTerm));\r\n\r\n            const matchesType = filterType === \"ALL\" || member.type === filterType;\r\n            const matchesStatus = filterStatus === \"ALL\" || (member.paymentStatus || 'AL_DIA') === filterStatus;\r\n\r\n            return matchesSearch && matchesType && matchesStatus;\r\n        });\r\n    }, [members, searchTerm, filterType, filterStatus]);\r\n\r\n    // Pagination Logic\r\n    const totalPages = Math.ceil(filteredMembers.length / ITEMS_PER_PAGE);\r\n    const paginatedMembers = filteredMembers.slice(\r\n        (currentPage - 1) * ITEMS_PER_PAGE,\r\n        currentPage * ITEMS_PER_PAGE\r\n    );\r\n\r\n    // Reset page when filter changes\r\n    useEffect(() => {\r\n        setCurrentPage(1);\r\n    }, [searchTerm, filterType, filterStatus]);\r\n\r\n    return (\r\n        <div className=\"space-y-4\">\r\n            {/* Controls Bar */}\r\n            <div className=\"flex flex-col md:flex-row gap-4 justify-between items-center bg-black/20 p-4 rounded-lg border border-white/5 backdrop-blur-sm\">\r\n                <div className=\"relative w-full md:w-96\">\r\n                    <Search className=\"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-zinc-400\" />\r\n                    <Input\r\n                        placeholder=\"Buscar por nombre, email o RUT...\"\r\n                        className=\"pl-10 bg-zinc-900/50 border-white/10 text-white placeholder:text-zinc-500\"\r\n                        value={searchTerm}\r\n                        onChange={(e) => setSearchTerm(e.target.value)}\r\n                    />\r\n                </div>\r\n\r\n                <div className=\"flex items-center gap-2 w-full md:w-auto\">\r\n                    <Filter className=\"w-4 h-4 text-zinc-400 hidden md:block\" />\r\n                    <Select value={filterType} onValueChange={setFilterType}>\r\n                        <SelectTrigger className=\"w-full md:w-[200px] bg-zinc-900/50 border-white/10 text-white\">\r\n                            <SelectValue placeholder=\"Filtrar por tipo\" />\r\n                        </SelectTrigger>\r\n                        <SelectContent className=\"bg-zinc-950 border-white/10 text-white\">\r\n                            <SelectItem value=\"ALL\">Todos los Tipos</SelectItem>\r\n                            <SelectItem value=\"SOCIO\">Socio</SelectItem>\r\n                            <SelectItem value=\"SOCIO_FUNDADOR\">Socio Fundador</SelectItem>\r\n                            <SelectItem value=\"CLIENTE\">Cliente</SelectItem>\r\n                        </SelectContent>\r\n                    </Select>\r\n\r\n                    <Select value={filterStatus} onValueChange={setFilterStatus}>\r\n                        <SelectTrigger className=\"w-full md:w-[200px] bg-zinc-900/50 border-white/10 text-white\">\r\n                            <SelectValue placeholder=\"Estado de Pago\" />\r\n                        </SelectTrigger>\r\n                        <SelectContent className=\"bg-zinc-950 border-white/10 text-white\">\r\n                            <SelectItem value=\"ALL\">Todos los Estados</SelectItem>\r\n                            <SelectItem value=\"AL_DIA\">Al Día</SelectItem>\r\n                            <SelectItem value=\"PENDIENTE\">Pendiente</SelectItem>\r\n                            <SelectItem value=\"MOROSO\">Moroso</SelectItem>\r\n                            <SelectItem value=\"CONVENIO\">Convenio</SelectItem>\r\n                            <SelectItem value=\"HONORARIO\">Honorario</SelectItem>\r\n                        </SelectContent>\r\n                    </Select>\r\n                </div>\r\n            </div>\r\n\r\n            {/* Table */}\r\n            <div className=\"rounded-md border border-white/10 bg-black/40 backdrop-blur-md overflow-hidden\">\r\n                <div className=\"relative overflow-x-auto\">\r\n                    <Table>\r\n                        <TableHeader className=\"bg-white/5\">\r\n                            <TableRow className=\"border-white/5 hover:bg-white/5\">\r\n                                <TableHead className=\"w-[80px] text-zinc-400\">Avatar</TableHead>\r\n                                <TableHead className=\"text-zinc-400\">Información</TableHead>\r\n                                <TableHead className=\"text-zinc-400\">Tipo</TableHead>\r\n                                <TableHead className=\"text-zinc-400\">Estado</TableHead>\r\n                                <TableHead className=\"text-right text-zinc-400\">Acciones</TableHead>\r\n                            </TableRow>\r\n                        </TableHeader>\r\n                        <TableBody>\r\n                            {paginatedMembers.length === 0 ? (\r\n                                <TableRow>\r\n                                    <TableCell colSpan={5} className=\"h-24 text-center text-muted-foreground\">\r\n                                        No se encontraron resultados.\r\n                                    </TableCell>\r\n                                </TableRow>\r\n                            ) : (\r\n                                paginatedMembers.map((member) => (\r\n                                    <TableRow key={member.id} className=\"border-white/5 hover:bg-white/5 transition-colors\">\r\n                                        <TableCell>\r\n                                            <Avatar className=\"h-10 w-10 border border-white/10\">\r\n                                                <AvatarImage src={member.image || \"\"} />\r\n                                                <AvatarFallback className=\"bg-primary/10 text-primary text-xs\">\r\n                                                    {member.name.substring(0, 2).toUpperCase()}\r\n                                                </AvatarFallback>\r\n                                            </Avatar>\r\n                                        </TableCell>\r\n                                        <TableCell className=\"font-medium text-white\">\r\n                                            <div className=\"flex flex-col\">\r\n                                                <span className=\"text-sm\">{member.name}</span>\r\n                                                <span className=\"text-xs text-muted-foreground\">{member.email || member.rut || \"Sin contacto\"}</span>\r\n                                            </div>\r\n                                        </TableCell>\r\n                                        <TableCell>\r\n                                            <Badge variant=\"outline\" className={cn(\r\n                                                \"border-opacity-50\",\r\n                                                member.type === 'SOCIO_FUNDADOR' ? \"border-amber-500 text-amber-500 bg-amber-500/10\" :\r\n                                                    member.type === 'SOCIO' ? \"border-primary text-primary bg-primary/10\" :\r\n                                                        \"border-zinc-500 text-zinc-400 bg-zinc-500/10\"\r\n                                            )}>\r\n                                                {member.type.replace('_', ' ')}\r\n                                            </Badge>\r\n                                        </TableCell>\r\n                                        <TableCell>\r\n                                            {(() => {\r\n                                                const s = member.paymentStatus || 'AL_DIA';\r\n                                                switch (s) {\r\n                                                    case 'MOROSO':\r\n                                                        return <Badge variant=\"destructive\" className=\"bg-red-500/20 text-red-400 border-red-500/50\">MOROSO</Badge>;\r\n                                                    case 'PENDIENTE':\r\n                                                        return <Badge variant=\"secondary\" className=\"bg-yellow-500/20 text-yellow-400 border-yellow-500/50\">PENDIENTE</Badge>;\r\n                                                    case 'HONORARIO':\r\n                                                        return <Badge variant=\"outline\" className=\"text-purple-400 border-purple-500/50\">HONORARIO</Badge>;\r\n                                                    case 'CONVENIO':\r\n                                                        return <Badge variant=\"outline\" className=\"text-blue-400 border-blue-500/50\">CONVENIO</Badge>;\r\n                                                    case 'CLIENTE':\r\n                                                        return <span className=\"text-xs text-muted-foreground\">-</span>;\r\n                                                    default: // AL_DIA\r\n                                                        return <Badge variant=\"default\" className=\"bg-green-500/20 text-green-400 border-green-500/50\">AL DÍA</Badge>;\r\n                                                }\r\n                                            })()}\r\n                                        </TableCell>\r\n                                        <TableCell className=\"text-right\">\r\n                                            <DropdownMenu>\r\n                                                <DropdownMenuTrigger asChild>\r\n                                                    <Button variant=\"ghost\" className=\"h-8 w-8 p-0 text-zinc-400 hover:text-white\">\r\n                                                        <span className=\"sr-only\">Open menu</span>\r\n                                                        <MoreHorizontal className=\"h-4 w-4\" />\r\n                                                    </Button>\r\n                                                </DropdownMenuTrigger>\r\n                                                <DropdownMenuContent align=\"end\" className=\"bg-zinc-950 border-white/10 text-zinc-200\">\r\n                                                    <DropdownMenuLabel>Acciones</DropdownMenuLabel>\r\n                                                    <DropdownMenuItem\r\n                                                        className=\"focus:bg-primary/20 focus:text-primary cursor-pointer mt-1\"\r\n                                                        onClick={() => setEditingMember(member)}\r\n                                                    >\r\n                                                        <Pencil className=\"mr-2 h-4 w-4\" /> Editar Datos\r\n                                                    </DropdownMenuItem>\r\n                                                    <Link href={`/dashboard/members/${member.id}`} className=\"w-full\">\r\n                                                        <DropdownMenuItem className=\"focus:bg-primary/20 focus:text-primary cursor-pointer\">\r\n                                                            <FileText className=\"mr-2 h-4 w-4\" /> Ver Perfil\r\n                                                        </DropdownMenuItem>\r\n                                                    </Link>\r\n                                                    <DropdownMenuSeparator className=\"bg-white/10\" />\r\n                                                    <DropdownMenuItem\r\n                                                        className=\"text-red-400 focus:bg-red-500/20 focus:text-red-400 cursor-pointer\"\r\n                                                        onClick={() => setDeletingMember(member)}\r\n                                                    >\r\n                                                        <Trash2 className=\"mr-2 h-4 w-4\" /> Eliminar\r\n                                                    </DropdownMenuItem>\r\n                                                </DropdownMenuContent>\r\n                                            </DropdownMenu>\r\n                                        </TableCell>\r\n                                    </TableRow>\r\n                                ))\r\n                            )}\r\n                        </TableBody>\r\n                    </Table>\r\n                </div>\r\n            </div>\r\n\r\n            {/* Pagination Controls */}\r\n            {totalPages > 1 && (\r\n                <div className=\"flex items-center justify-between px-2\">\r\n                    <p className=\"text-sm text-muted-foreground\">\r\n                        Mostrando {(currentPage - 1) * ITEMS_PER_PAGE + 1} a {Math.min(currentPage * ITEMS_PER_PAGE, filteredMembers.length)} de {filteredMembers.length} socios\r\n                    </p>\r\n                    <div className=\"flex items-center space-x-2\">\r\n                        <Button\r\n                            variant=\"outline\"\r\n                            size=\"sm\"\r\n                            onClick={() => setCurrentPage(p => Math.max(1, p - 1))}\r\n                            disabled={currentPage === 1}\r\n                            className=\"bg-zinc-900 border-white/10 hover:bg-white/10\"\r\n                        >\r\n                            <ChevronLeft className=\"h-4 w-4\" />\r\n                        </Button>\r\n                        <span className=\"text-sm font-medium text-white\">\r\n                            Página {currentPage} de {totalPages}\r\n                        </span>\r\n                        <Button\r\n                            variant=\"outline\"\r\n                            size=\"sm\"\r\n                            onClick={() => setCurrentPage(p => Math.min(totalPages, p + 1))}\r\n                            disabled={currentPage === totalPages}\r\n                            className=\"bg-zinc-900 border-white/10 hover:bg-white/10\"\r\n                        >\r\n                            <ChevronRight className=\"h-4 w-4\" />\r\n                        </Button>\r\n                    </div>\r\n                </div>\r\n            )}\r\n\r\n            {editingMember && (\r\n                <EditMemberDialog\r\n                    member={editingMember}\r\n                    open={!!editingMember}\r\n                    onOpenChange={(open) => !open && setEditingMember(null)}\r\n                />\r\n            )}\r\n\r\n            {deletingMember && (\r\n                <DeleteMemberDialog\r\n                    member={deletingMember}\r\n                    open={!!deletingMember}\r\n                    onOpenChange={(open) => !open && setDeletingMember(null)}\r\n                />\r\n            )}\r\n        </div>\r\n    )\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\rokat\\OneDrive\\Proyectos\\Akapoolco\\src\\components\\pos\\checkout-modal.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'stopSession' is defined but never used.","line":7,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":7,"endColumn":21,"suggestions":[{"messageId":"removeUnusedImportDeclaration","data":{"varName":"stopSession"},"fix":{"range":[305,360],"text":""},"desc":"Remove unused import declaration."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'tableId' is defined but never used.","line":18,"column":55,"nodeType":"Identifier","messageId":"unusedVar","endLine":18,"endColumn":62},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":20,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":20,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[852,855],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[852,855],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\"\r\n\r\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogTrigger } from \"@/components/ui/dialog\"\r\nimport { Button } from \"@/components/ui/button\"\r\nimport { Square, CreditCard, Banknote, User, Loader2 } from \"lucide-react\"\r\nimport { useState, useEffect, useCallback } from \"react\"\r\nimport { stopSession } from \"@/app/lib/actions-cockpit\"\r\nimport { processCheckout, getSessionDetails } from \"@/app/lib/actions-checkout\"\r\nimport { Separator } from \"@/components/ui/separator\"\r\n\r\ninterface CheckoutModalProps {\r\n    sessionId: string\r\n    tableName: string\r\n    tableId: string\r\n    members: { id: string, name: string, type: string }[]\r\n}\r\n\r\nexport function CheckoutModal({ sessionId, tableName, tableId, members }: CheckoutModalProps) {\r\n    const [isOpen, setIsOpen] = useState(false)\r\n    const [details, setDetails] = useState<any>(null)\r\n    const [isLoading, setIsLoading] = useState(false)\r\n    const [isProcessing, setIsProcessing] = useState(false)\r\n    const [paymentMethod, setPaymentMethod] = useState<'CASH' | 'CARD' | 'ACCOUNT' | null>(null)\r\n    const [selectedMember, setSelectedMember] = useState<string>(\"\")\r\n    const [error, setError] = useState<string | null>(null)\r\n\r\n    const getDetails = useCallback(async () => {\r\n        setIsLoading(true)\r\n        try {\r\n            const data = await getSessionDetails(sessionId)\r\n            setDetails(data)\r\n        } catch (e) {\r\n            console.error(e)\r\n        } finally {\r\n            setIsLoading(false)\r\n        }\r\n    }, [sessionId])\r\n\r\n    useEffect(() => {\r\n        if (isOpen) {\r\n            getDetails()\r\n            setPaymentMethod(null)\r\n            setSelectedMember(\"\")\r\n            setError(null)\r\n        }\r\n    }, [isOpen, getDetails])\r\n\r\n\r\n    const handlePayment = async () => {\r\n        if (!paymentMethod) return\r\n        if (paymentMethod === 'ACCOUNT' && !selectedMember) {\r\n            setError(\"Must select a member for account charge.\")\r\n            return\r\n        }\r\n\r\n        setIsProcessing(true)\r\n        setError(null)\r\n\r\n        const result = await processCheckout(sessionId, paymentMethod, paymentMethod === 'ACCOUNT' ? selectedMember : undefined)\r\n\r\n        if (result?.error) {\r\n            setError(result.error)\r\n            setIsProcessing(false)\r\n        } else {\r\n            // Success\r\n            setIsOpen(false)\r\n            setIsProcessing(false)\r\n        }\r\n    }\r\n\r\n    return (\r\n        <Dialog open={isOpen} onOpenChange={setIsOpen}>\r\n            <DialogTrigger asChild>\r\n                <Button variant=\"destructive\" className=\"flex-1 bg-red-600 hover:bg-red-700\">\r\n                    <Square className=\"w-4 h-4 mr-2\" /> CLOSE\r\n                </Button>\r\n            </DialogTrigger>\r\n            <DialogContent className=\"sm:max-w-[400px] bg-zinc-950 border-white/10 text-white\">\r\n                <DialogHeader>\r\n                    <DialogTitle>Checkout: {tableName}</DialogTitle>\r\n                </DialogHeader>\r\n\r\n                {isLoading || !details ? (\r\n                    <div className=\"py-8 text-center text-zinc-500\">Calculating final usage...</div>\r\n                ) : (\r\n                    <div className=\"space-y-4\">\r\n                        <div className=\"space-y-2\">\r\n                            <div className=\"flex justify-between\">\r\n                                <span className=\"text-zinc-400\">Time ({details.durationMin} min)</span>\r\n                                <span>${details.timeTotal.toLocaleString()}</span>\r\n                            </div>\r\n                            <div className=\"flex justify-between\">\r\n                                <span className=\"text-zinc-400\">Bar Consumption</span>\r\n                                <span>${details.consumptionTotal.toLocaleString()}</span>\r\n                            </div>\r\n                            <Separator className=\"bg-white/10\" />\r\n                            <div className=\"flex justify-between text-xl font-bold text-green-400\">\r\n                                <span>Total to Pay</span>\r\n                                <span>${details.grandTotal.toLocaleString()}</span>\r\n                            </div>\r\n                        </div>\r\n\r\n                        {error && <div className=\"p-2 bg-red-900/30 border border-red-500/50 rounded text-red-200 text-xs text-center\">{error}</div>}\r\n\r\n                        <div className=\"pt-4\">\r\n                            <p className=\"text-sm font-medium mb-2 text-zinc-400\">Select Payment Method</p>\r\n                            <div className=\"grid grid-cols-3 gap-2 mb-4\">\r\n                                <Button\r\n                                    variant={paymentMethod === 'CASH' ? \"default\" : \"outline\"}\r\n                                    className={`flex flex-col items-center h-20 gap-2 ${paymentMethod === 'CASH' ? 'bg-green-600 hover:bg-green-700 border-transparent' : 'border-white/10 hover:bg-white/10'}`}\r\n                                    onClick={() => setPaymentMethod('CASH')}\r\n                                >\r\n                                    <Banknote className=\"h-6 w-6\" />\r\n                                    <span className=\"text-xs\">Cash</span>\r\n                                </Button>\r\n                                <Button\r\n                                    variant={paymentMethod === 'CARD' ? \"default\" : \"outline\"}\r\n                                    className={`flex flex-col items-center h-20 gap-2 ${paymentMethod === 'CARD' ? 'bg-blue-600 hover:bg-blue-700 border-transparent' : 'border-white/10 hover:bg-white/10'}`}\r\n                                    onClick={() => setPaymentMethod('CARD')}\r\n                                >\r\n                                    <CreditCard className=\"h-6 w-6\" />\r\n                                    <span className=\"text-xs\">Card</span>\r\n                                </Button>\r\n                                <Button\r\n                                    variant={paymentMethod === 'ACCOUNT' ? \"default\" : \"outline\"}\r\n                                    className={`flex flex-col items-center h-20 gap-2 ${paymentMethod === 'ACCOUNT' ? 'bg-amber-600 hover:bg-amber-700 border-transparent' : 'border-white/10 hover:bg-white/10'}`}\r\n                                    onClick={() => setPaymentMethod('ACCOUNT')}\r\n                                >\r\n                                    <User className=\"h-6 w-6\" />\r\n                                    <span className=\"text-xs\">Fiado</span>\r\n                                </Button>\r\n                            </div>\r\n\r\n                            {paymentMethod === 'ACCOUNT' && (\r\n                                <div className=\"space-y-2 animate-in fade-in slide-in-from-top-2\">\r\n                                    <label className=\"text-xs text-zinc-400\">Seleccionar Socio</label>\r\n                                    <select\r\n                                        className=\"w-full bg-white/5 border border-white/10 rounded-md p-2 text-sm text-white focus:outline-none focus:ring-1 focus:ring-primary\"\r\n                                        value={selectedMember}\r\n                                        onChange={(e) => setSelectedMember(e.target.value)}\r\n                                        title=\"Seleccionar Socio\"\r\n                                    >\r\n                                        <option value=\"\">-- Buscar Socio --</option>\r\n                                        {members.map(m => (\r\n                                            <option key={m.id} value={m.id}>{m.name} ({m.type})</option>\r\n                                        ))}\r\n                                    </select>\r\n                                </div>\r\n                            )}\r\n\r\n                            <Button\r\n                                className=\"w-full mt-4 bg-green-500 hover:bg-green-600 text-black font-bold\"\r\n                                disabled={!paymentMethod || (paymentMethod === 'ACCOUNT' && !selectedMember) || isProcessing}\r\n                                onClick={handlePayment}\r\n                            >\r\n                                {isProcessing ? <Loader2 className=\"w-4 h-4 mr-2 animate-spin\" /> : \"CONFIRM PAYMENT\"}\r\n                            </Button>\r\n                        </div>\r\n                    </div>\r\n                )}\r\n            </DialogContent>\r\n        </Dialog>\r\n    )\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\rokat\\OneDrive\\Proyectos\\Akapoolco\\src\\components\\pos\\quick-sale-modal.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Badge' is defined but never used.","line":9,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":9,"endColumn":15,"suggestions":[{"messageId":"removeUnusedImportDeclaration","data":{"varName":"Badge"},"fix":{"range":[372,417],"text":""},"desc":"Remove unused import declaration."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'ScrollArea' is defined but never used.","line":10,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":10,"endColumn":20,"suggestions":[{"messageId":"removeUnusedImportDeclaration","data":{"varName":"ScrollArea"},"fix":{"range":[419,475],"text":""},"desc":"Remove unused import declaration."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\"\r\n\r\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogTrigger } from \"@/components/ui/dialog\"\r\nimport { Button } from \"@/components/ui/button\"\r\nimport { Input } from \"@/components/ui/input\"\r\nimport { Plus, Minus, ShoppingCart, Search } from \"lucide-react\"\r\nimport { useState } from \"react\"\r\nimport { registerSale } from \"@/app/lib/actions-pos\"\r\nimport { Badge } from \"@/components/ui/badge\"\r\nimport { ScrollArea } from \"@/components/ui/scroll-area\" // We need to add this component\r\n\r\ninterface Product {\r\n    id: string\r\n    name: string\r\n    priceClient: number\r\n    category: string | null\r\n}\r\n\r\ninterface QuickSaleModalProps {\r\n    sessionId: string\r\n    products: Product[]\r\n    tableName: string\r\n}\r\n\r\nexport function QuickSaleModal({ sessionId, products, tableName }: QuickSaleModalProps) {\r\n    const [isOpen, setIsOpen] = useState(false)\r\n    const [cart, setCart] = useState<{ product: Product, quantity: number }[]>([])\r\n    const [filter, setFilter] = useState(\"\")\r\n\r\n    const addToCart = (product: Product) => {\r\n        setCart(prev => {\r\n            const existing = prev.find(p => p.product.id === product.id)\r\n            if (existing) {\r\n                return prev.map(p => p.product.id === product.id ? { ...p, quantity: p.quantity + 1 } : p)\r\n            }\r\n            return [...prev, { product, quantity: 1 }]\r\n        })\r\n    }\r\n\r\n    const removeFromCart = (productId: string) => {\r\n        setCart(prev => prev.reduce((acc, item) => {\r\n            if (item.product.id === productId) {\r\n                if (item.quantity > 1) return [...acc, { ...item, quantity: item.quantity - 1 }]\r\n                return acc\r\n            }\r\n            return [...acc, item]\r\n        }, [] as { product: Product, quantity: number }[]))\r\n    }\r\n\r\n    const cartTotal = cart.reduce((acc, item) => acc + (Number(item.product.priceClient) * item.quantity), 0)\r\n\r\n    const handleCheckout = async () => {\r\n        const itemsSnapshot = cart.map(i => ({\r\n            productId: i.product.id,\r\n            name: i.product.name,\r\n            price: Number(i.product.priceClient),\r\n            quantity: i.quantity\r\n        }))\r\n\r\n        await registerSale(sessionId, itemsSnapshot, cartTotal, 'CASH') // Default to CASH for quick add\r\n        setCart([])\r\n        setIsOpen(false)\r\n    }\r\n\r\n    const filteredProducts = products.filter(p => p.name.toLowerCase().includes(filter.toLowerCase()))\r\n\r\n    return (\r\n        <Dialog open={isOpen} onOpenChange={setIsOpen}>\r\n            <DialogTrigger asChild>\r\n                <Button variant=\"outline\" size=\"sm\" className=\"w-full mt-2 border-primary/50 text-primary hover:bg-primary/10\">\r\n                    <ShoppingCart className=\"w-4 h-4 mr-2\" /> Quick Add\r\n                </Button>\r\n            </DialogTrigger>\r\n            <DialogContent className=\"sm:max-w-[700px] bg-zinc-950 border-white/10 text-white\">\r\n                <DialogHeader>\r\n                    <DialogTitle>Add Items to {tableName}</DialogTitle>\r\n                </DialogHeader>\r\n\r\n                <div className=\"flex gap-4 h-[400px]\">\r\n                    {/* Catalog */}\r\n                    <div className=\"flex-1 flex flex-col gap-4\">\r\n                        <div className=\"relative\">\r\n                            <Search className=\"absolute left-2 top-2.5 h-4 w-4 text-muted-foreground\" />\r\n                            <Input\r\n                                placeholder=\"Search products...\"\r\n                                className=\"pl-8 bg-white/5 border-white/10\"\r\n                                value={filter}\r\n                                onChange={(e) => setFilter(e.target.value)}\r\n                            />\r\n                        </div>\r\n                        <div className=\"flex-1 overflow-y-auto pr-2 space-y-2\">\r\n                            {filteredProducts.map(product => (\r\n                                <div key={product.id} className=\"flex items-center justify-between p-2 bg-white/5 rounded-md hover:bg-white/10 cursor-pointer\" onClick={() => addToCart(product)}>\r\n                                    <div>\r\n                                        <p className=\"font-medium\">{product.name}</p>\r\n                                        <p className=\"text-xs text-muted-foreground\">${Number(product.priceClient).toLocaleString()}</p>\r\n                                    </div>\r\n                                    <Button size=\"icon\" variant=\"ghost\" className=\"h-6 w-6\">\r\n                                        <Plus className=\"h-4 w-4\" />\r\n                                    </Button>\r\n                                </div>\r\n                            ))}\r\n                        </div>\r\n                    </div>\r\n\r\n                    {/* Cart */}\r\n                    <div className=\"w-[280px] bg-white/5 rounded-md p-4 flex flex-col\">\r\n                        <h3 className=\"font-bold mb-4 flex items-center gap-2\">\r\n                            <ShoppingCart className=\"h-4 w-4\" /> Current Order\r\n                        </h3>\r\n                        <div className=\"flex-1 overflow-y-auto space-y-2 mb-4\">\r\n                            {cart.length === 0 && <p className=\"text-sm text-zinc-500 text-center py-8\">Cart is empty</p>}\r\n                            {cart.map(item => (\r\n                                <div key={item.product.id} className=\"flex justify-between items-center text-sm\">\r\n                                    <div className=\"flex flex-col\">\r\n                                        <span>{item.product.name}</span>\r\n                                        <span className=\"text-xs text-zinc-500\">${(Number(item.product.priceClient) * item.quantity).toLocaleString()}</span>\r\n                                    </div>\r\n                                    <div className=\"flex items-center gap-1 bg-black/40 rounded px-1\">\r\n                                        <button className=\"p-1 hover:text-red-400\" onClick={() => removeFromCart(item.product.id)}><Minus className=\"h-3 w-3\" /></button>\r\n                                        <span className=\"w-4 text-center\">{item.quantity}</span>\r\n                                        <button className=\"p-1 hover:text-green-400\" onClick={() => addToCart(item.product)}><Plus className=\"h-3 w-3\" /></button>\r\n                                    </div>\r\n                                </div>\r\n                            ))}\r\n                        </div>\r\n                        <div className=\"pt-4 border-t border-white/10\">\r\n                            <div className=\"flex justify-between font-bold mb-4\">\r\n                                <span>Total:</span>\r\n                                <span className=\"text-green-400\">${cartTotal.toLocaleString()}</span>\r\n                            </div>\r\n                            <Button\r\n                                className=\"w-full bg-green-600 hover:bg-green-700\"\r\n                                onClick={handleCheckout}\r\n                                disabled={cart.length === 0}\r\n                            >\r\n                                Confirm Add\r\n                            </Button>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            </DialogContent>\r\n        </Dialog>\r\n    )\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\rokat\\OneDrive\\Proyectos\\Akapoolco\\src\\components\\referee\\MatchReferee.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":10,"column":14,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":10,"endColumn":17,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[378,381],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[378,381],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'isPending' is assigned a value but never used.","line":18,"column":12,"nodeType":"Identifier","messageId":"unusedVar","endLine":18,"endColumn":21,"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport { useState, useTransition } from 'react';\r\nimport { updateGameState } from '@/app/lib/actions-kiosk';\r\nimport ShotClock from './ShotClock';\r\nimport { RotateCcw, ArrowLeftRight, Trophy } from 'lucide-react';\r\nimport { cn } from '@/lib/utils';\r\n// Defining minimal SessionData structure based on inference if not importing\r\ninterface Props {\r\n    session: any; // Using any for session to avoid complex type matching right now, will refine\r\n    onExit?: () => void;\r\n}\r\n\r\nimport { CaromState } from '@/types/game-state';\r\n\r\nexport default function MatchReferee({ session, onExit }: Props) {\r\n    // eslint-disable-next-line @typescript-eslint/no-unused-vars\r\n    const [isPending, startTransition] = useTransition();\r\n\r\n    // 1. Initial State Initialization\r\n    // We expect session.gameState to match CaromState structure\r\n    const getInitialState = (): CaromState => {\r\n        const defaultState: CaromState = {\r\n            gameType: 'CAROM',\r\n            p1Score: 0,\r\n            p2Score: 0,\r\n            innings: 0,\r\n            currentRun: 0,\r\n            activePlayer: 'p1',\r\n            timerStatus: 'idle',\r\n            extensions: { p1: 2, p2: 2 }\r\n        };\r\n        return (session.gameState as CaromState) || defaultState;\r\n    };\r\n\r\n    const [gameState, setGameState] = useState<CaromState>(getInitialState);\r\n    const [resetTrigger, setResetTrigger] = useState(0);\r\n\r\n    // Sync with Server Logic (Optimistic)\r\n    const updateServer = (newState: CaromState) => {\r\n        setGameState(newState);\r\n        startTransition(async () => {\r\n            await updateGameState(session.id, newState);\r\n        });\r\n    };\r\n\r\n    // Identifiers\r\n    const p1 = session.sessionPlayers?.[0];\r\n    const p2 = session.sessionPlayers?.[1];\r\n\r\n    const p1Name = p1?.member?.name || p1?.user?.name || p1?.guestName || 'Jugador 1';\r\n    const p2Name = p2?.member?.name || p2?.user?.name || p2?.guestName || 'Jugador 2';\r\n\r\n    // Layout\r\n    const [layout, setLayout] = useState<'standard' | 'swapped'>('standard');\r\n\r\n    // Limits\r\n    const limit = gameState.targetScore || 0;\r\n    const maxInnings = gameState.limitInnings || 0;\r\n\r\n    // Derived\r\n    const isFinished = (limit > 0 && (gameState.p1Score >= limit || gameState.p2Score >= limit)) ||\r\n        (maxInnings > 0 && gameState.innings >= maxInnings);\r\n\r\n    // Timer Sync\r\n    // We update the timer status in the game state so other clients can see \"PAUSED\"\r\n    const handleTimerStatusChange = (status: 'idle' | 'running' | 'paused' | 'timeout') => {\r\n        if (status !== gameState.timerStatus) {\r\n            updateServer({ ...gameState, timerStatus: status });\r\n        }\r\n    };\r\n\r\n    // Game Logic\r\n    const handleUpdate = (p1Delta: number, p2Delta: number, inningDelta: number) => {\r\n        if (isFinished && (p1Delta > 0 || p2Delta > 0)) return;\r\n\r\n        const newState = { ...gameState };\r\n\r\n        let newCurrentRun = newState.currentRun;\r\n        let newHighRunP1 = newState.p1HighRun || 0;\r\n        let newHighRunP2 = newState.p2HighRun || 0;\r\n\r\n        // Run Logic\r\n        if (p1Delta > 0 || p2Delta > 0) {\r\n            newCurrentRun += (p1Delta + p2Delta);\r\n        }\r\n\r\n        // Reset run if turn changes\r\n        if (inningDelta > 0) {\r\n            newCurrentRun = 0;\r\n        }\r\n\r\n        // High Run Check\r\n        if (p1Delta > 0 && newCurrentRun > newHighRunP1) newHighRunP1 = newCurrentRun;\r\n        if (p2Delta > 0 && newCurrentRun > newHighRunP2) newHighRunP2 = newCurrentRun;\r\n\r\n        // Apply\r\n        newState.p1Score = Math.max(0, (newState.p1Score || 0) + p1Delta);\r\n        newState.p2Score = Math.max(0, (newState.p2Score || 0) + p2Delta);\r\n        newState.innings = Math.max(0, (newState.innings || 0) + inningDelta);\r\n        newState.currentRun = newCurrentRun;\r\n        newState.p1HighRun = newHighRunP1;\r\n        newState.p2HighRun = newHighRunP2;\r\n\r\n        setResetTrigger(prev => prev + 1); // Reset timer on any score/turn change\r\n        updateServer(newState);\r\n    };\r\n\r\n    const toggleTurn = () => {\r\n        if (isFinished) return;\r\n\r\n        const nextPlayer = gameState.activePlayer === 'p1' ? 'p2' : 'p1';\r\n        // Logic: Increment inning when switching from P2 back to P1 (completing the inning)\r\n        const inningDelta = gameState.activePlayer === 'p2' ? 1 : 0;\r\n\r\n        const newState: CaromState = {\r\n            ...gameState,\r\n            activePlayer: nextPlayer,\r\n            innings: (gameState.innings || 0) + inningDelta,\r\n            currentRun: 0,\r\n            timerStatus: 'idle', // Reset timer status\r\n        };\r\n\r\n        setResetTrigger(prev => prev + 1);\r\n        updateServer(newState);\r\n    };\r\n\r\n    // UI Helpers\r\n    const getPlayerData = (side: 'left' | 'right') => {\r\n        const isP1 = (layout === 'standard' && side === 'left') || (layout === 'swapped' && side === 'right');\r\n        if (isP1) {\r\n            return {\r\n                key: 'p1',\r\n                name: p1Name,\r\n                score: gameState.p1Score,\r\n                active: gameState.activePlayer === 'p1',\r\n                ballColor: 'text-white'\r\n            };\r\n        } else {\r\n            return {\r\n                key: 'p2',\r\n                name: p2Name,\r\n                score: gameState.p2Score,\r\n                active: gameState.activePlayer === 'p2',\r\n                ballColor: 'text-yellow-400'\r\n            };\r\n        }\r\n    };\r\n\r\n    const left = getPlayerData('left');\r\n    const right = getPlayerData('right');\r\n\r\n    return (\r\n        <div className=\"flex flex-col h-full bg-black text-white p-4 max-w-4xl mx-auto\">\r\n            {/* Header */}\r\n            <div className=\"flex justify-between items-center mb-4\">\r\n                <button onClick={onExit} className=\"text-slate-500 hover:text-white text-sm uppercase font-bold tracking-wider\">\r\n                    &larr; Salir\r\n                </button>\r\n                <div className=\"text-center\">\r\n                    <span className=\"text-xs text-orange-500 font-bold uppercase tracking-widest block\">Modo Referí</span>\r\n                    <span className=\"text-slate-400 text-xs\">{limit > 0 ? `A ${limit} Puntos` : 'Entrenamiento'}</span>\r\n                </div>\r\n                <button onClick={() => setLayout(l => l === 'standard' ? 'swapped' : 'standard')} className=\"text-slate-500 hover:text-white\" aria-label=\"Cambiar lados\">\r\n                    <ArrowLeftRight size={20} />\r\n                </button>\r\n            </div>\r\n\r\n            {/* Shot Clock */}\r\n            <ShotClock\r\n                initialSeconds={gameState.timerSettings?.limitSeconds || 40}\r\n                activePlayer={gameState.activePlayer || 'p1'}\r\n                resetTrigger={resetTrigger}\r\n                onStatusChange={handleTimerStatusChange}\r\n            />\r\n\r\n            {/* Innings */}\r\n            <div className=\"flex justify-center -mt-4 mb-6 relative z-20\">\r\n                <div className=\"bg-slate-900 border border-slate-700 rounded-xl px-8 py-2 flex flex-col items-center shadow-2xl\">\r\n                    <span className=\"text-slate-500 text-[10px] uppercase font-bold tracking-wider\">Entrada</span>\r\n                    <span className=\"text-4xl font-mono font-bold text-white leading-none\">\r\n                        {(gameState.innings || 0) + 1}\r\n                    </span>\r\n                </div>\r\n            </div>\r\n\r\n            {/* Scores */}\r\n            <div className=\"grid grid-cols-2 gap-4 flex-1\">\r\n                {[left, right].map((p, idx) => (\r\n                    <div key={idx} className={cn(\r\n                        \"relative flex flex-col rounded-2xl border-2 transition-all overflow-hidden\",\r\n                        p.active ? \"border-blue-500 bg-blue-900/10\" : \"border-slate-800 bg-slate-900/40 opacity-50 grayscale-[0.5]\"\r\n                    )}>\r\n                        {/* Name Header */}\r\n                        <div className=\"p-4 bg-slate-900/80 border-b border-white/5 flex flex-col text-center\">\r\n                            <span className={cn(\"text-xs font-bold uppercase tracking-widest mb-1\", p.ballColor)}>\r\n                                {p.key === 'p1' ? 'Bola Blanca' : 'Bola Amarilla'}\r\n                            </span>\r\n                            <h2 className=\"text-lg font-bold truncate\">{p.name}</h2>\r\n                        </div>\r\n\r\n                        {/* Score Display */}\r\n                        <div className=\"flex-1 flex items-center justify-center py-6\">\r\n                            <span className=\"text-8xl font-black tabular-nums\">{p.score}</span>\r\n                        </div>\r\n\r\n                        {/* Controls */}\r\n                        <div className=\"p-4 grid grid-cols-2 gap-3 z-10\">\r\n                            <button\r\n                                onClick={() => handleUpdate(p.key === 'p1' ? -1 : 0, p.key === 'p2' ? -1 : 0, 0)}\r\n                                className=\"py-4 rounded-xl bg-slate-800 text-slate-400 font-bold hover:bg-red-900/50 hover:text-red-400 disabled:opacity-50\"\r\n                                disabled={!p.active}\r\n                            >\r\n                                -1\r\n                            </button>\r\n                            <button\r\n                                onClick={() => handleUpdate(p.key === 'p1' ? 1 : 0, p.key === 'p2' ? 1 : 0, 0)}\r\n                                className=\"py-4 rounded-xl bg-slate-700 text-white font-bold hover:bg-green-600 shadow-lg disabled:opacity-50\"\r\n                                disabled={!p.active}\r\n                            >\r\n                                +1\r\n                            </button>\r\n                        </div>\r\n                    </div>\r\n                ))}\r\n            </div>\r\n\r\n            {/* Turn Switch */}\r\n            <div className=\"mt-6 flex justify-center\">\r\n                <button\r\n                    onClick={toggleTurn}\r\n                    className=\"flex items-center gap-3 px-8 py-4 bg-orange-600 hover:bg-orange-500 text-white rounded-full font-bold shadow-lg shadow-orange-900/20 active:scale-95 transition-all w-full max-w-sm justify-center\"\r\n                >\r\n                    <RotateCcw size={20} />\r\n                    Cambiar Turno\r\n                </button>\r\n            </div>\r\n\r\n            {/* Winner Overlay */}\r\n            {isFinished && (\r\n                <div className=\"absolute inset-0 bg-black/90 z-50 flex items-center justify-center p-6 backdrop-blur-sm\">\r\n                    <div className=\"bg-slate-900 border border-white/10 rounded-3xl p-8 text-center max-w-md w-full animate-in zoom-in duration-300\">\r\n                        <Trophy className=\"w-16 h-16 text-yellow-500 mx-auto mb-4\" />\r\n                        <h2 className=\"text-2xl font-bold text-white mb-6\">¡Partido Finalizado!</h2>\r\n\r\n                        <div className=\"grid grid-cols-2 gap-4 mb-8\">\r\n                            <div className=\"bg-black/30 p-4 rounded-xl\">\r\n                                <div className=\"text-xs text-slate-500 font-bold mb-1\">{p1Name}</div>\r\n                                <div className={cn(\"text-3xl font-black\", gameState.p1Score > gameState.p2Score ? \"text-green-500\" : \"text-white\")}>\r\n                                    {gameState.p1Score}\r\n                                </div>\r\n                            </div>\r\n                            <div className=\"bg-black/30 p-4 rounded-xl\">\r\n                                <div className=\"text-xs text-slate-500 font-bold mb-1\">{p2Name}</div>\r\n                                <div className={cn(\"text-3xl font-black\", gameState.p2Score > gameState.p1Score ? \"text-green-500\" : \"text-white\")}>\r\n                                    {gameState.p2Score}\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n\r\n                        <button\r\n                            onClick={onExit}\r\n                            className=\"w-full py-4 bg-slate-800 hover:bg-slate-700 text-white rounded-xl font-bold\"\r\n                        >\r\n                            Volver al Menú\r\n                        </button>\r\n                    </div>\r\n                </div>\r\n            )}\r\n        </div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\rokat\\OneDrive\\Proyectos\\Akapoolco\\src\\components\\referee\\RefereeMatchControl.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Badge' is defined but never used.","line":6,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":6,"endColumn":15,"suggestions":[{"messageId":"removeUnusedImportDeclaration","data":{"varName":"Badge"},"fix":{"range":[245,291],"text":""},"desc":"Remove unused import declaration."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Trophy' is defined but never used.","line":14,"column":21,"nodeType":"Identifier","messageId":"unusedVar","endLine":14,"endColumn":27,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"Trophy"},"fix":{"range":[725,733],"text":""},"desc":"Remove unused variable \"Trophy\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'AlertTriangle' is defined but never used.","line":14,"column":29,"nodeType":"Identifier","messageId":"unusedVar","endLine":14,"endColumn":42,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"AlertTriangle"},"fix":{"range":[733,748],"text":""},"desc":"Remove unused variable \"AlertTriangle\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Timer' is defined but never used.","line":14,"column":44,"nodeType":"Identifier","messageId":"unusedVar","endLine":14,"endColumn":49,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"Timer"},"fix":{"range":[748,755],"text":""},"desc":"Remove unused variable \"Timer\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Play' is defined but never used.","line":14,"column":51,"nodeType":"Identifier","messageId":"unusedVar","endLine":14,"endColumn":55,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"Play"},"fix":{"range":[755,761],"text":""},"desc":"Remove unused variable \"Play\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Pause' is defined but never used.","line":14,"column":57,"nodeType":"Identifier","messageId":"unusedVar","endLine":14,"endColumn":62,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"Pause"},"fix":{"range":[761,768],"text":""},"desc":"Remove unused variable \"Pause\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'RotateCcw' is defined but never used.","line":14,"column":64,"nodeType":"Identifier","messageId":"unusedVar","endLine":14,"endColumn":73,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"RotateCcw"},"fix":{"range":[768,779],"text":""},"desc":"Remove unused variable \"RotateCcw\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'isSubmitting' is assigned a value but never used.","line":29,"column":12,"nodeType":"Identifier","messageId":"unusedVar","endLine":29,"endColumn":24},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'initialState'. Either include it or remove the dependency array.","line":55,"column":8,"nodeType":"ArrayExpression","endLine":55,"endColumn":26,"suggestions":[{"desc":"Update the dependencies array to be: [state, sessionId, initialState]","fix":{"range":[2436,2454],"text":"[state, sessionId, initialState]"}}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'winnerId' is assigned a value but never used.","line":215,"column":15,"nodeType":"Identifier","messageId":"unusedVar","endLine":215,"endColumn":23}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":10,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport { useEffect, useState, useRef } from \"react\";\r\nimport { CaromState } from \"@/types/game-state\"; // We focus on Carom for now as requested context implied Carom/3-Cushion\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { Badge } from \"@/components/ui/badge\";\r\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogFooter } from \"@/components/ui/dialog\";\r\nimport { Input } from \"@/components/ui/input\";\r\nimport { Label } from \"@/components/ui/label\";\r\nimport { useRouter } from \"next/navigation\";\r\nimport { updateGameState, finalizeMatch } from \"@/app/lib/actions-kiosk\";\r\nimport { toast } from \"sonner\";\r\nimport { RefereeScoreboard } from \"./RefereeScoreboard\";\r\nimport { ArrowLeft, Trophy, AlertTriangle, Timer, Play, Pause, RotateCcw } from \"lucide-react\";\r\n\r\ninterface RefereeMatchControlProps {\r\n    sessionId: string;\r\n    initialState: CaromState;\r\n    playerNames: [string, string];\r\n    tableId: string;\r\n}\r\n\r\nexport function RefereeMatchControl({ sessionId, initialState, playerNames, tableId }: RefereeMatchControlProps) {\r\n    const router = useRouter();\r\n    const [state, setState] = useState<CaromState>(initialState);\r\n    const [initModalOpen, setInitModalOpen] = useState(!state.matchStatus || state.matchStatus === 'WARMUP');\r\n    const [refereeName, setRefereeName] = useState(state.refereeName || \"\");\r\n    const [lagWinner, setLagWinner] = useState<'p1' | 'p2' | null>(state.lagWinner || null);\r\n    const [isSubmitting, setIsSubmitting] = useState(false);\r\n\r\n    // Audio Refs\r\n    const audioBeepRef = useRef<HTMLAudioElement | null>(null);\r\n    const audioAlarmRef = useRef<HTMLAudioElement | null>(null);\r\n\r\n    // --- SOUND EFFECTS ---\r\n    useEffect(() => {\r\n        audioBeepRef.current = new Audio('/sounds/beep-short.mp3');\r\n        audioAlarmRef.current = new Audio('/sounds/alarm.mp3');\r\n    }, []);\r\n\r\n    const playSound = (type: 'beep' | 'alarm') => {\r\n        if (type === 'beep') audioBeepRef.current?.play().catch(() => { });\r\n        if (type === 'alarm') audioAlarmRef.current?.play().catch(() => { });\r\n    };\r\n\r\n    // --- SYNC WITH SERVER ---\r\n    // Debounce state updates to server\r\n    useEffect(() => {\r\n        const timer = setTimeout(() => {\r\n            if (state !== initialState) {\r\n                updateGameState(sessionId, state).catch(console.error);\r\n            }\r\n        }, 500);\r\n        return () => clearTimeout(timer);\r\n    }, [state, sessionId]); // initialState excluded to avoid loop, we assume optimistic local is truth\r\n\r\n    // --- GAME LOGIC HANDLERS ---\r\n\r\n    const handleInitConfirm = () => {\r\n        if (!refereeName || !lagWinner) {\r\n            toast.error(\"Complete todos los campos\");\r\n            return;\r\n        }\r\n\r\n        const newState: CaromState = {\r\n            ...state,\r\n            refereeName,\r\n            lagWinner,\r\n            matchStatus: 'PLAYING',\r\n            activePlayer: lagWinner, // Lag winner starts\r\n            startPlayer: lagWinner,\r\n            innings: 0,\r\n            currentRun: 0,\r\n            p1Score: 0,\r\n            p2Score: 0,\r\n            timerStatus: 'running', // Auto-start clock? Maybe 'idle' first. Let's say 'idle'.\r\n        };\r\n\r\n        // Setup initial timer reset\r\n        if (state.timerSettings?.enabled) {\r\n            newState.timerStatus = 'idle';\r\n        }\r\n\r\n        setState(newState);\r\n        updateGameState(sessionId, newState);\r\n        setInitModalOpen(false);\r\n    };\r\n\r\n    const handleScore = (player: 'p1' | 'p2', delta: number) => {\r\n        if (state.matchStatus !== 'PLAYING' && state.matchStatus !== 'LAG') return;\r\n        if (player !== state.activePlayer) { // Strict Rule: Only active player scores\r\n            // Unless we allow penalty on opponent? Usually in carom, you just score your own.\r\n            // Let's enforce active player only for +1. -1 is correction.\r\n            if (delta > 0) {\r\n                toast.error(\"Solo el jugador activo puede sumar puntos\");\r\n                return;\r\n            }\r\n        }\r\n\r\n        const newState = { ...state };\r\n\r\n        if (player === 'p1') {\r\n            newState.p1Score = Math.max(0, newState.p1Score + delta);\r\n            if (delta > 0) {\r\n                newState.currentRun = (newState.currentRun || 0) + delta;\r\n                if (newState.currentRun > (newState.p1HighRun || 0)) newState.p1HighRun = newState.currentRun;\r\n            } else {\r\n                // Correction\r\n                newState.currentRun = Math.max(0, (newState.currentRun || 0) + delta);\r\n            }\r\n        } else {\r\n            newState.p2Score = Math.max(0, newState.p2Score + delta);\r\n            if (delta > 0) {\r\n                newState.currentRun = (newState.currentRun || 0) + delta;\r\n                if (newState.currentRun > (newState.p2HighRun || 0)) newState.p2HighRun = newState.currentRun;\r\n            } else {\r\n                newState.currentRun = Math.max(0, (newState.currentRun || 0) + delta);\r\n            }\r\n        }\r\n\r\n        // Check Win Condition (Immediate validation)\r\n        checkWinCondition(newState);\r\n        setState(newState);\r\n    };\r\n\r\n    const switchTurn = () => {\r\n        // Validation: Cannot switch if current run > 0? No, you can miss after scoring.\r\n\r\n        const newState = { ...state };\r\n        const nextPlayer = state.activePlayer === 'p1' ? 'p2' : 'p1';\r\n\r\n        // Increment Innings Logic:\r\n        // In Carom, inning increments when the SECOND player finishes their turn (completing the round).\r\n        // Or is it when the Start Player finishes?\r\n        // Standard: Inning 1 = P1 turn, then P2 turn. When P2 finishes, Inning 1 ends.\r\n\r\n        // If the player finishing now is the one who played LAST in the sequence...\r\n        // Let's assume P1 started.\r\n        // P1 ends -> P2 active (Inning 1 bottom).\r\n        // P2 ends -> P1 active (Inning 2 top).\r\n\r\n        // So if (nextPlayer === startPlayer), we just completed a full round -> Increment inning.\r\n        // Wait, standard convention is:\r\n        // Inning 1: Player A (Run), Player B (Run). \r\n        // When Player B finishes, we move to Inning 2.\r\n\r\n        if (nextPlayer === state.startPlayer) {\r\n            newState.innings = (newState.innings || 0) + 1;\r\n        }\r\n\r\n        newState.activePlayer = nextPlayer;\r\n        newState.currentRun = 0;\r\n        newState.timerStatus = 'idle'; // Reset clock, wait for 'Resume' or Auto-start\r\n        // Auto-start clock usually? In referee mode, maybe we want explicit start or auto.\r\n        // Let's set to 'running' for flow, 40s Countdown starts.\r\n        if (state.timerSettings?.enabled) {\r\n            newState.timerStatus = 'running';\r\n        }\r\n\r\n        setState(newState);\r\n    };\r\n\r\n    const handleFoul = () => {\r\n        // Carom Foul: Usually ends turn, no points deduction standardly, but rules vary.\r\n        // Assuming \"End Turn\" functionality + optional penalty input if needed.\r\n        // For now: Just switch turn (Miss).\r\n        toast(\"Falta registrada - Cambio de turno\");\r\n        switchTurn();\r\n    };\r\n\r\n    // --- CHECK WIN CONDITION ---\r\n    const checkWinCondition = (currentState: CaromState) => {\r\n        if (!currentState.targetScore) return;\r\n\r\n        const p1Finished = currentState.p1Score >= currentState.targetScore;\r\n        const p2Finished = currentState.p2Score >= currentState.targetScore;\r\n\r\n        if (p1Finished || p2Finished) {\r\n            // \"Contrasalida\" (Equalizing Inning) Logic\r\n            // If Start Player finishes, Opponent gets one last chance (Equalizing Inning).\r\n            // If Second Player finishes, game over immediately.\r\n\r\n            const isStartPlayer = currentState.activePlayer === currentState.startPlayer;\r\n\r\n            if (isStartPlayer && (p1Finished || p2Finished) && !currentState.equalizingInning) {\r\n                // Activate Equalizing Inning for the OTHER player\r\n                toast(\"¡Distancia alcanzada! Turno de contrasalida.\");\r\n                currentState.equalizingInning = true;\r\n                switchTurn(); // Force switch to opponent for their last shots\r\n            } else if (currentState.equalizingInning) {\r\n                // We are IN the equalizing inning.\r\n                // If the equalizer misses (switches turn) or reaches target...\r\n                // Wait, checkWinCondition is called on Score. \r\n                // If equalizer reaches target -> DRAW (or Penalties).\r\n                // If equalizer misses -> Original Winner wins.\r\n                // This logic effectively happens when the turn ends or score updates.\r\n\r\n                // If Active Player (Equalizer) >= Target -> DRAW/TIE\r\n                if (p1Finished && p2Finished) {\r\n                    // EMPATE\r\n                    // finishMatch('DRAW');\r\n                }\r\n            } else {\r\n                // Second Player finished naturally -> WIN\r\n                // finishMatch('SCORE');\r\n            }\r\n        }\r\n    };\r\n\r\n    const handleFinishMatch = async (forceWinner?: 'p1' | 'p2') => {\r\n        if (!confirm(\"¿Finalizar el partido y cerrar mesa?\")) return;\r\n        setIsSubmitting(true);\r\n\r\n        // Determine Winner Logic based on state\r\n        const winnerId = null;\r\n        if (forceWinner) {\r\n            // W.O. or explicit\r\n            // Map 'p1'/'p2' to DB IDs? We don't have them in props easily, need from session or just logic.\r\n            // We'll leave winner determination to backend or pass implicit 'p1'/'p2' string if backend handles it.\r\n            // For now, let's just close it.\r\n        } else {\r\n            // Score based\r\n        }\r\n\r\n        await finalizeMatch(sessionId, undefined, 'SCORE', state);\r\n        setIsSubmitting(false);\r\n        router.push('/dashboard/referee');\r\n    };\r\n\r\n    return (\r\n        <div className=\"h-full flex flex-col bg-neutral-950\">\r\n            {/* Header / Info Bar */}\r\n            <div className=\"bg-neutral-900 border-b border-neutral-800 p-2 flex justify-between items-center text-xs text-neutral-400\">\r\n                <Button variant=\"ghost\" size=\"sm\" onClick={() => router.back()}>\r\n                    <ArrowLeft className=\"w-4 h-4 mr-1\" /> Salir\r\n                </Button>\r\n                <div className=\"flex gap-4\">\r\n                    <span>Juez: <span className=\"text-white font-bold\">{state.refereeName || \"Sin Asignar\"}</span></span>\r\n                    <span>Mesa: <span className=\"text-white font-bold\">{playerNames[0]} vs {playerNames[1]}</span></span>\r\n                </div>\r\n                <div className=\"flex gap-2\">\r\n                    <Button variant=\"destructive\" size=\"sm\" onClick={() => handleFinishMatch('p1')}>W.O.</Button>\r\n                    <Button variant=\"outline\" size=\"sm\" onClick={() => handleFinishMatch()}>Finalizar</Button>\r\n                </div>\r\n            </div>\r\n\r\n            {/* Initialization Modal */}\r\n            <Dialog open={initModalOpen} onOpenChange={setInitModalOpen}>\r\n                <DialogContent>\r\n                    <DialogHeader>\r\n                        <DialogTitle>Inicialización de Partido - {tableId}</DialogTitle>\r\n                    </DialogHeader>\r\n                    <div className=\"grid gap-4 py-4\">\r\n                        <div className=\"grid gap-2\">\r\n                            <Label>Nombre del Juez</Label>\r\n                            <Input\r\n                                placeholder=\"Ingrese su nombre\"\r\n                                value={refereeName}\r\n                                onChange={(e) => setRefereeName(e.target.value)}\r\n                            />\r\n                        </div>\r\n                        <div className=\"grid gap-2\">\r\n                            <Label>Ganador del Arrime (Lag)</Label>\r\n                            <div className=\"grid grid-cols-2 gap-2\">\r\n                                <Button\r\n                                    variant={lagWinner === 'p1' ? 'default' : 'outline'}\r\n                                    className={lagWinner === 'p1' ? 'bg-yellow-500 hover:bg-yellow-600 text-black' : ''}\r\n                                    onClick={() => setLagWinner('p1')}\r\n                                >\r\n                                    {playerNames[0]} (Blanca)\r\n                                </Button>\r\n                                <Button\r\n                                    variant={lagWinner === 'p2' ? 'default' : 'outline'}\r\n                                    className={lagWinner === 'p2' ? 'bg-yellow-500 hover:bg-yellow-600 text-black' : ''}\r\n                                    onClick={() => setLagWinner('p2')}\r\n                                >\r\n                                    {playerNames[1]} (Amarilla)\r\n                                </Button>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                    <DialogFooter>\r\n                        <Button onClick={handleInitConfirm} disabled={!refereeName || !lagWinner}>\r\n                            Iniciar Partido\r\n                        </Button>\r\n                    </DialogFooter>\r\n                </DialogContent>\r\n            </Dialog>\r\n\r\n            {/* Main Scoreboard UI */}\r\n            <div className=\"flex-1 overflow-hidden relative\">\r\n                <RefereeScoreboard\r\n                    state={state}\r\n                    playerNames={playerNames}\r\n                    onScore={handleScore}\r\n                    onSwitchTurn={switchTurn}\r\n                    onFoul={handleFoul}\r\n                    playSound={playSound}\r\n                />\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\rokat\\OneDrive\\Proyectos\\Akapoolco\\src\\components\\referee\\RefereeScoreboard.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Play' is defined but never used.","line":6,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":6,"endColumn":14,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"Play"},"fix":{"range":[161,166],"text":""},"desc":"Remove unused variable \"Play\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Plus' is defined but never used.","line":6,"column":34,"nodeType":"Identifier","messageId":"unusedVar","endLine":6,"endColumn":38,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"Plus"},"fix":{"range":[183,189],"text":""},"desc":"Remove unused variable \"Plus\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Minus' is defined but never used.","line":6,"column":40,"nodeType":"Identifier","messageId":"unusedVar","endLine":6,"endColumn":45,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"Minus"},"fix":{"range":[189,196],"text":""},"desc":"Remove unused variable \"Minus\"."}]},{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\nC:\\Users\\rokat\\OneDrive\\Proyectos\\Akapoolco\\src\\components\\referee\\RefereeScoreboard.tsx:32:13\n  30 |     useEffect(() => {\n  31 |         if (state.timerStatus === 'idle') {\n> 32 |             setTimeLeft(state.timerSettings?.limitSeconds || 40);\n     |             ^^^^^^^^^^^ Avoid calling setState() directly within an effect\n  33 |         }\n  34 |     }, [state.timerStatus, state.activePlayer, state.innings, state.timerSettings?.limitSeconds]);\n  35 |","line":32,"column":13,"nodeType":null,"endLine":32,"endColumn":24}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport { CaromState } from \"@/types/game-state\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { cn } from \"@/lib/utils\";\r\nimport { Play, Pause, RotateCcw, Plus, Minus, StepForward, AlertTriangle, Timer } from \"lucide-react\";\r\nimport { useEffect, useState } from \"react\";\r\n\r\ninterface RefereeScoreboardProps {\r\n    state: CaromState;\r\n    playerNames: [string, string];\r\n    onScore: (player: 'p1' | 'p2', delta: number) => void;\r\n    onSwitchTurn: () => void;\r\n    onFoul: () => void;\r\n    playSound: (type: 'beep' | 'alarm') => void;\r\n}\r\n\r\nexport function RefereeScoreboard({\r\n    state,\r\n    playerNames,\r\n    onScore,\r\n    onSwitchTurn,\r\n    onFoul,\r\n    playSound\r\n}: RefereeScoreboardProps) {\r\n    // --- TIMER LOGIC ---\r\n    // We handle timer locally for smoothness, sync with state when actions happen\r\n    const [timeLeft, setTimeLeft] = useState(state.timerSettings?.limitSeconds || 40);\r\n\r\n    useEffect(() => {\r\n        if (state.timerStatus === 'idle') {\r\n            setTimeLeft(state.timerSettings?.limitSeconds || 40);\r\n        }\r\n    }, [state.timerStatus, state.activePlayer, state.innings, state.timerSettings?.limitSeconds]);\r\n\r\n    useEffect(() => {\r\n        if (state.timerStatus !== 'running') return;\r\n\r\n        const interval = setInterval(() => {\r\n            setTimeLeft((prev) => {\r\n                if (prev <= 0) {\r\n                    clearInterval(interval);\r\n                    playSound('alarm');\r\n                    // Trigger Time Foul? Or just alarm. Referee decides.\r\n                    return 0;\r\n                }\r\n                // Auditory cues\r\n                if (prev === 11) playSound('beep'); // Warn at 10 (actually tick before)\r\n                if (prev <= 5 && prev > 0) playSound('beep');\r\n\r\n                return prev - 1;\r\n            });\r\n        }, 1000);\r\n\r\n        return () => clearInterval(interval);\r\n    }, [state.timerStatus, playSound]);\r\n\r\n\r\n    // Helper to get formatted Time\r\n    const formatTime = (seconds: number) => {\r\n        return `${seconds}s`;\r\n    };\r\n\r\n    const isP1Active = state.activePlayer === 'p1';\r\n    const isP2Active = state.activePlayer === 'p2';\r\n\r\n    return (\r\n        <div className=\"h-full grid grid-cols-12 bg-black text-white\">\r\n\r\n            {/* PLAYER 1 COLUMN */}\r\n            <div className={cn(\r\n                \"col-span-4 border-r border-neutral-800 flex flex-col relative transition-colors duration-500\",\r\n                isP1Active ? \"bg-emerald-950/30\" : \"bg-neutral-950\"\r\n            )}>\r\n                {/* Header */}\r\n                <div className=\"p-4 border-b border-neutral-800 text-center\">\r\n                    <h2 className=\"text-3xl font-black uppercase tracking-tight truncate\">{playerNames[0]}</h2>\r\n                    <div className=\"flex justify-between items-center mt-2 text-neutral-400 font-mono text-sm\">\r\n                        <span>Max: <b className=\"text-white\">{state.p1HighRun || 0}</b></span>\r\n                        <span>Avg: <b className=\"text-white\">{state.innings > 0 ? (state.p1Score / state.innings).toFixed(3) : \"0.000\"}</b></span>\r\n                    </div>\r\n                </div>\r\n\r\n                {/* Big Score */}\r\n                <div className=\"flex-1 flex items-center justify-center relative\">\r\n                    <span className={cn(\r\n                        \"text-[12rem] font-black font-mono leading-none tracking-tighter tabular-nums select-none\",\r\n                        isP1Active ? \"text-emerald-500\" : \"text-neutral-700\"\r\n                    )}>\r\n                        {state.p1Score}\r\n                    </span>\r\n                    {state.lagWinner === 'p1' ? (\r\n                        <div className=\"absolute top-4 left-4 w-6 h-6 rounded-full bg-white shadow-[0_0_10px_white]\"></div>\r\n                    ) : (\r\n                        <div className=\"absolute top-4 left-4 w-6 h-6 rounded-full bg-yellow-400 shadow-[0_0_10px_orange]\"></div>\r\n                    )}\r\n                </div>\r\n\r\n                {/* Controls - ONLY ACTIVE IF PLAYER IS ACTIVE */}\r\n                <div className=\"p-4 grid grid-cols-2 gap-4 h-32\">\r\n                    <Button\r\n                        disabled={!isP1Active}\r\n                        onClick={() => onScore('p1', 1)}\r\n                        className={cn(\"h-full text-5xl font-black rounded-xl\", isP1Active ? \"bg-emerald-600 hover:bg-emerald-500 text-white\" : \"bg-neutral-900 text-neutral-600\")}\r\n                    >\r\n                        +1\r\n                    </Button>\r\n                    <Button\r\n                        disabled={!isP1Active}\r\n                        onClick={() => onScore('p1', -1)}\r\n                        variant=\"secondary\"\r\n                        className=\"h-full text-3xl font-bold bg-neutral-900 text-neutral-500 hover:text-white\"\r\n                    >\r\n                        -1\r\n                    </Button>\r\n                </div>\r\n            </div>\r\n\r\n            {/* CENTER CONTROL COLUMN */}\r\n            <div className=\"col-span-4 flex flex-col border-r border-neutral-800 bg-neutral-900/50\">\r\n                {/* Stats Header */}\r\n                <div className=\"h-32 p-4 grid grid-cols-2 gap-2 border-b border-neutral-800 bg-black\">\r\n                    <div className=\"bg-neutral-900 rounded-lg flex flex-col items-center justify-center border border-neutral-800\">\r\n                        <span className=\"text-neutral-500 text-xs uppercase tracking-widest\">Entradas</span>\r\n                        <span className=\"text-4xl font-mono text-white font-bold\">{state.innings}</span>\r\n                    </div>\r\n                    <div className=\"bg-neutral-900 rounded-lg flex flex-col items-center justify-center border border-neutral-800\">\r\n                        <span className=\"text-neutral-500 text-xs uppercase tracking-widest\">Tacada</span>\r\n                        <span className=\"text-5xl font-mono text-amber-500 font-bold animate-pulse\">{state.currentRun}</span>\r\n                    </div>\r\n                </div>\r\n\r\n                {/* TIMER DISPLAY */}\r\n                <div className=\"flex-1 flex flex-col items-center justify-center p-8 relative\">\r\n                    {state.timerSettings?.enabled && (\r\n                        <div className=\"relative\">\r\n                            <div className={cn(\r\n                                \"text-[8rem] font-mono font-black leading-none tabular-nums transition-colors duration-300\",\r\n                                timeLeft <= 10 ? \"text-red-500 animate-pulse\" : (timeLeft <= 20 ? \"text-amber-400\" : \"text-blue-400\")\r\n                            )}>\r\n                                {formatTime(timeLeft)}\r\n                            </div>\r\n                            <div className=\"flex justify-center gap-4 mt-6\">\r\n                                {/* Timer Controls not fully wired yet to state but visual for now */}\r\n                                <Button size=\"icon\" variant=\"outline\" className=\"h-12 w-12 rounded-full border-neutral-700 hover:bg-white/10\">\r\n                                    <Pause className=\"w-6 h-6\" />\r\n                                </Button>\r\n                                <Button size=\"icon\" variant=\"outline\" className=\"h-12 w-12 rounded-full border-neutral-700 hover:bg-white/10\">\r\n                                    <RotateCcw className=\"w-6 h-6\" />\r\n                                </Button>\r\n                            </div>\r\n                        </div>\r\n                    )}\r\n\r\n                    {state.equalizingInning && (\r\n                        <div className=\"absolute top-4 w-full text-center\">\r\n                            <span className=\"bg-red-600 text-white font-black text-sm uppercase px-4 py-1 rounded-full animate-bounce shadow-lg shadow-red-900/50\">\r\n                                Contrasalida / Equalizing Inning\r\n                            </span>\r\n                        </div>\r\n                    )}\r\n                </div>\r\n\r\n                {/* MASTER CONTROLS */}\r\n                <div className=\"p-4 grid gap-4 bg-black border-t border-neutral-800\">\r\n                    <Button\r\n                        onClick={onSwitchTurn}\r\n                        className=\"h-24 text-2xl uppercase font-black bg-indigo-600 hover:bg-indigo-500 text-white shadow-[0_0_20px_rgba(79,70,229,0.4)] border border-indigo-400\"\r\n                    >\r\n                        <StepForward className=\"w-8 h-8 mr-2\" />\r\n                        Cambio de Turno\r\n                    </Button>\r\n\r\n                    <div className=\"grid grid-cols-2 gap-4\">\r\n                        <Button\r\n                            onClick={onFoul}\r\n                            variant=\"destructive\"\r\n                            className=\"h-16 text-lg font-bold uppercase bg-red-900/50 border border-red-800 hover:bg-red-800\"\r\n                        >\r\n                            <AlertTriangle className=\"w-5 h-5 mr-2\" /> Falta\r\n                        </Button>\r\n                        <Button\r\n                            variant=\"secondary\"\r\n                            className=\"h-16 text-lg font-bold uppercase bg-neutral-800 text-neutral-400 hover:text-white\"\r\n                        >\r\n                            <Timer className=\"w-5 h-5 mr-2\" /> Extensión\r\n                        </Button>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n\r\n            {/* PLAYER 2 COLUMN */}\r\n            <div className={cn(\r\n                \"col-span-4 border-l border-neutral-800 flex flex-col relative transition-colors duration-500\",\r\n                isP2Active ? \"bg-blue-950/30\" : \"bg-neutral-950\"\r\n            )}>\r\n                {/* Header */}\r\n                <div className=\"p-4 border-b border-neutral-800 text-center\">\r\n                    <h2 className=\"text-3xl font-black uppercase tracking-tight truncate\">{playerNames[1]}</h2>\r\n                    <div className=\"flex justify-between items-center mt-2 text-neutral-400 font-mono text-sm\">\r\n                        <span>Max: <b className=\"text-white\">{state.p2HighRun || 0}</b></span>\r\n                        <span>Avg: <b className=\"text-white\">{state.innings > 0 ? (state.p2Score / state.innings).toFixed(3) : \"0.000\"}</b></span>\r\n                    </div>\r\n                </div>\r\n\r\n                {/* Big Score */}\r\n                <div className=\"flex-1 flex items-center justify-center relative\">\r\n                    <span className={cn(\r\n                        \"text-[12rem] font-black font-mono leading-none tracking-tighter tabular-nums select-none\",\r\n                        isP2Active ? \"text-blue-500\" : \"text-neutral-700\"\r\n                    )}>\r\n                        {state.p2Score}\r\n                    </span>\r\n                    {state.lagWinner === 'p2' ? (\r\n                        <div className=\"absolute top-4 right-4 w-6 h-6 rounded-full bg-white shadow-[0_0_10px_white]\"></div>\r\n                    ) : (\r\n                        <div className=\"absolute top-4 right-4 w-6 h-6 rounded-full bg-yellow-400 shadow-[0_0_10px_orange]\"></div>\r\n                    )}\r\n                </div>\r\n\r\n                {/* Controls */}\r\n                <div className=\"p-4 grid grid-cols-2 gap-4 h-32\">\r\n                    <Button\r\n                        disabled={!isP2Active}\r\n                        onClick={() => onScore('p2', 1)}\r\n                        className={cn(\"h-full text-5xl font-black rounded-xl\", isP2Active ? \"bg-blue-600 hover:bg-blue-500 text-white\" : \"bg-neutral-900 text-neutral-600\")}\r\n                    >\r\n                        +1\r\n                    </Button>\r\n                    <Button\r\n                        disabled={!isP2Active}\r\n                        onClick={() => onScore('p2', -1)}\r\n                        variant=\"secondary\"\r\n                        className=\"h-full text-3xl font-bold bg-neutral-900 text-neutral-500 hover:text-white\"\r\n                    >\r\n                        -1\r\n                    </Button>\r\n                </div>\r\n            </div>\r\n\r\n        </div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\rokat\\OneDrive\\Proyectos\\Akapoolco\\src\\components\\referee\\ShotClock.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":40,"column":68,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":40,"endColumn":71,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1377,1380],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1377,1380],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'playBeep'. Either include it or remove the dependency array.","line":96,"column":8,"nodeType":"ArrayExpression","endLine":96,"endColumn":27,"suggestions":[{"desc":"Update the dependencies array to be: [status, onTimeout, playBeep]","fix":{"range":[3287,3306],"text":"[status, onTimeout, playBeep]"}}]},{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\nC:\\Users\\rokat\\OneDrive\\Proyectos\\Akapoolco\\src\\components\\referee\\ShotClock.tsx:111:13\n  109 |     useEffect(() => {\n  110 |         if (resetTrigger !== undefined) {\n> 111 |             setSeconds(initialSeconds);\n      |             ^^^^^^^^^^ Avoid calling setState() directly within an effect\n  112 |             setStatus('idle');\n  113 |         }\n  114 |     }, [resetTrigger, initialSeconds]);","line":111,"column":13,"nodeType":null,"endLine":111,"endColumn":23}],"suppressedMessages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'isRunning' is assigned a value but never used.","line":24,"column":12,"nodeType":"Identifier","messageId":"unusedVar","endLine":24,"endColumn":21,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'setIsRunning' is assigned a value but never used.","line":24,"column":23,"nodeType":"Identifier","messageId":"unusedVar","endLine":24,"endColumn":35,"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":2,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport { useState, useEffect, useRef } from 'react';\r\nimport { Play, Pause, RotateCcw, Timer, AlertTriangle } from 'lucide-react';\r\nimport { cn } from '@/lib/utils';\r\n\r\ninterface ShotClockProps {\r\n    initialSeconds?: number;\r\n    activePlayer: 'p1' | 'p2';\r\n    onTimeout?: () => void;\r\n    resetTrigger?: number;\r\n    onStatusChange?: (status: 'idle' | 'running' | 'paused' | 'timeout') => void;\r\n}\r\n\r\nexport default function ShotClock({\r\n    initialSeconds = 40,\r\n    activePlayer,\r\n    onTimeout,\r\n    resetTrigger,\r\n    onStatusChange\r\n}: ShotClockProps) {\r\n    const [seconds, setSeconds] = useState(initialSeconds);\r\n    // eslint-disable-next-line @typescript-eslint/no-unused-vars\r\n    const [isRunning, setIsRunning] = useState(false);\r\n    const [status, setStatus] = useState<'idle' | 'running' | 'paused' | 'timeout'>('idle');\r\n\r\n    useEffect(() => {\r\n        if (onStatusChange) onStatusChange(status);\r\n    }, [status, onStatusChange]);\r\n\r\n    // Extensions State\r\n    const [extensions, setExtensions] = useState<{ p1: number; p2: number }>({ p1: 2, p2: 2 });\r\n\r\n    // Audio Context\r\n    const audioContextRef = useRef<AudioContext | null>(null);\r\n\r\n    // Initialize Audio Context on user interaction\r\n    const initAudio = () => {\r\n        if (!audioContextRef.current) {\r\n            const AudioContext = window.AudioContext || (window as any).webkitAudioContext;\r\n            audioContextRef.current = new AudioContext();\r\n        }\r\n        if (audioContextRef.current.state === 'suspended') {\r\n            audioContextRef.current.resume();\r\n        }\r\n    };\r\n\r\n    const playBeep = (freq = 440, type: OscillatorType = 'sine', duration = 0.1) => {\r\n        try {\r\n            if (!audioContextRef.current) initAudio();\r\n             \r\n            const ctx = audioContextRef.current!;\r\n            const osc = ctx.createOscillator();\r\n            const gain = ctx.createGain();\r\n\r\n            osc.type = type;\r\n            osc.frequency.setValueAtTime(freq, ctx.currentTime);\r\n            gain.gain.setValueAtTime(0.1, ctx.currentTime);\r\n\r\n            osc.connect(gain);\r\n            gain.connect(ctx.destination);\r\n\r\n            osc.start();\r\n            osc.stop(ctx.currentTime + duration);\r\n        } catch (e) {\r\n            console.error(\"Audio error\", e);\r\n        }\r\n    };\r\n\r\n    // Timer Logic\r\n    useEffect(() => {\r\n        let interval: NodeJS.Timeout | null = null;\r\n        if (status === 'running') {\r\n            interval = setInterval(() => {\r\n                setSeconds(prev => {\r\n                    if (prev <= 0) return 0; // Safety check\r\n\r\n                    const next = prev - 1;\r\n\r\n                    // Audio Cues\r\n                    if (next === 10) playBeep(600, 'square', 0.2); // Warning start\r\n                    if (next <= 5 && next > 0) playBeep(800, 'sawtooth', 0.1); // Critical ticks\r\n                    if (next === 0) {\r\n                        playBeep(200, 'sawtooth', 1.0); // Time over\r\n                        setStatus('timeout');\r\n                        if (onTimeout) onTimeout();\r\n                    }\r\n\r\n                    return next;\r\n                });\r\n            }, 1000);\r\n        }\r\n        return () => {\r\n            if (interval) clearInterval(interval);\r\n        };\r\n    }, [status, onTimeout]); // Removed seconds from deps\r\n\r\n    // Derived Visual State\r\n    const getVisualState = () => {\r\n        if (status === 'timeout') return 'timeout';\r\n        if (seconds <= 5) return 'critical';\r\n        if (seconds <= 10) return 'warning';\r\n        return 'normal';\r\n    };\r\n\r\n    const visualState = getVisualState();\r\n\r\n    // Reset Logic\r\n    useEffect(() => {\r\n        if (resetTrigger !== undefined) {\r\n            setSeconds(initialSeconds);\r\n            setStatus('idle');\r\n        }\r\n    }, [resetTrigger, initialSeconds]);\r\n\r\n    // Handlers\r\n    const handleStart = () => {\r\n        initAudio(); // Ensure audio is ready\r\n        setStatus('running');\r\n    };\r\n\r\n    const handlePause = () => {\r\n        setStatus('paused');\r\n    };\r\n\r\n    const handleReset = () => {\r\n        setSeconds(initialSeconds);\r\n        setStatus('idle');\r\n    };\r\n\r\n    const handleExtension = () => {\r\n        if (status !== 'running' && status !== 'paused' && status !== 'idle') return;\r\n\r\n        const playerKey = activePlayer === 'p1' ? 'p1' : 'p2';\r\n        if (extensions[playerKey] > 0) {\r\n            setSeconds(initialSeconds); // Rules often reset to full time (40s)\r\n            setExtensions(prev => ({\r\n                ...prev,\r\n                [playerKey]: prev[playerKey] - 1\r\n            }));\r\n            playBeep(1000, 'sine', 0.3); // Extension confirmation beep\r\n            setStatus('running'); // Ensure running\r\n        } else {\r\n            // Error feedback?\r\n            alert(\"No hay más extensiones disponibles\");\r\n        }\r\n    };\r\n\r\n    // Color Helpers\r\n    const getColors = () => {\r\n        switch (visualState) {\r\n            case 'timeout': return 'border-red-600 bg-red-900/30 text-red-500 animate-pulse';\r\n            case 'critical': return 'border-red-500 text-red-500 shadow-[0_0_30px_rgba(239,68,68,0.4)]';\r\n            case 'warning': return 'border-yellow-500 text-yellow-500';\r\n            default: return 'border-green-500 text-green-500 shadow-[0_0_15px_rgba(34,197,94,0.2)]';\r\n        }\r\n    };\r\n\r\n    return (\r\n        <div className=\"flex flex-col items-center justify-center p-4 bg-slate-900/50 backdrop-blur-sm rounded-2xl border border-white/10 w-full mb-6 relative overflow-hidden\">\r\n            {/* Background Warning Flash */}\r\n            {visualState === 'timeout' && (\r\n                <div className=\"absolute inset-0 bg-red-500/10 z-0 animate-pulse pointer-events-none\" />\r\n            )}\r\n\r\n            <div className=\"flex justify-between w-full px-4 mb-2 z-10\">\r\n                <div className=\"text-xs font-bold text-slate-400 uppercase tracking-widest flex items-center gap-2\">\r\n                    <Timer size={14} />\r\n                    Reloj de Tiro\r\n                </div>\r\n                {/* Active Player Indicator */}\r\n                <div className=\"text-xs font-bold uppercase tracking-wider text-blue-400\">\r\n                    Turno: {activePlayer === 'p1' ? 'Jugador 1' : 'Jugador 2'}\r\n                </div>\r\n            </div>\r\n\r\n            {/* Main Timer Display */}\r\n            <div className={cn(\r\n                \"relative z-10 text-6xl md:text-8xl font-mono font-black border-[6px] rounded-full w-32 h-32 md:w-48 md:h-48 flex items-center justify-center transition-all duration-300 bg-slate-950\",\r\n                getColors()\r\n            )}>\r\n                {seconds}\r\n                {status === 'paused' && (\r\n                    <div className=\"absolute -bottom-4 bg-yellow-600 text-black text-xs font-bold px-2 py-1 rounded-full uppercase tracking-tighter shadow-lg pt-1\">\r\n                        PAUSA\r\n                    </div>\r\n                )}\r\n                {status === 'timeout' && (\r\n                    <div className=\"absolute -bottom-4 bg-red-600 text-white text-xs font-bold px-3 py-1 rounded-full uppercase tracking-tighter shadow-lg pt-1 flex items-center gap-1\">\r\n                        <AlertTriangle size={12} fill=\"currentColor\" /> FALTA\r\n                    </div>\r\n                )}\r\n            </div>\r\n\r\n            {/* Controls */}\r\n            <div className=\"flex gap-4 mt-6 w-full justify-center z-10 relative\">\r\n                {/* Extension Button */}\r\n                <div className=\"absolute left-4 top-1/2 -translate-y-1/2 md:static md:translate-y-0\">\r\n                    <button\r\n                        onClick={handleExtension}\r\n                        disabled={extensions[activePlayer === 'p1' ? 'p1' : 'p2'] === 0 || status === 'timeout'}\r\n                        className=\"flex flex-col items-center justify-center gap-1\"\r\n                    >\r\n                        <div className={cn(\r\n                            \"w-12 h-12 rounded-full flex items-center justify-center border-2 transition-all\",\r\n                            extensions[activePlayer] > 0\r\n                                ? \"border-yellow-500 text-yellow-500 hover:bg-yellow-500/10 active:scale-95\"\r\n                                : \"border-slate-700 text-slate-700 opacity-50 cursor-not-allowed\"\r\n                        )}>\r\n                            <span className=\"font-bold text-sm\">EXT</span>\r\n                        </div>\r\n                        <span className=\"text-[10px] text-slate-500 font-medium uppercase\">\r\n                            Restan: {extensions[activePlayer]}\r\n                        </span>\r\n                    </button>\r\n                </div>\r\n\r\n                {/* Play/Pause */}\r\n                {status === 'running' ? (\r\n                    <button\r\n                        onClick={handlePause}\r\n                        className=\"flex items-center justify-center w-16 h-16 md:w-20 md:h-20 rounded-full bg-yellow-600 hover:bg-yellow-500 text-white transition-all active:scale-95 shadow-xl shadow-yellow-900/20\"\r\n                        aria-label=\"Pausar Reloj\"\r\n                    >\r\n                        <Pause size={32} fill=\"currentColor\" className=\"md:w-10 md:h-10\" />\r\n                    </button>\r\n                ) : (\r\n                    <button\r\n                        onClick={handleStart}\r\n                        className=\"flex items-center justify-center w-16 h-16 md:w-20 md:h-20 rounded-full bg-green-600 hover:bg-green-500 text-white transition-all active:scale-95 shadow-xl shadow-green-900/20\"\r\n                        aria-label=\"Iniciar Reloj\"\r\n                    >\r\n                        <Play size={32} fill=\"currentColor\" className=\"ml-1 md:w-10 md:h-10\" />\r\n                    </button>\r\n                )}\r\n\r\n                {/* Reset Button */}\r\n                <div className=\"absolute right-4 top-1/2 -translate-y-1/2 md:static md:translate-y-0\">\r\n                    <button\r\n                        onClick={handleReset}\r\n                        className=\"flex flex-col items-center justify-center gap-1 group\"\r\n                        aria-label=\"Reiniciar Reloj\"\r\n                    >\r\n                        <div className=\"w-12 h-12 rounded-full border-2 border-slate-600 text-slate-400 bg-slate-900 flex items-center justify-center transition-all group-hover:border-slate-500 group-hover:text-white active:scale-95\">\r\n                            <RotateCcw size={20} />\r\n                        </div>\r\n                        <span className=\"text-[10px] text-slate-500 group-hover:text-slate-400 font-medium uppercase\">\r\n                            Reset\r\n                        </span>\r\n                    </button>\r\n                </div>\r\n            </div>\r\n\r\n        </div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\rokat\\OneDrive\\Proyectos\\Akapoolco\\src\\components\\shifts\\DebtPaymentDialog.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":18,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":18,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[791,794],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[791,794],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":26,"column":56,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":26,"endColumn":59,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1097,1100],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1097,1100],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":27,"column":54,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":27,"endColumn":57,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1163,1166],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1163,1166],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\nC:\\Users\\rokat\\OneDrive\\Proyectos\\Akapoolco\\src\\components\\shifts\\DebtPaymentDialog.tsx:32:13\n  30 |     useEffect(() => {\n  31 |         if (isOpen && initialUser) {\n> 32 |             setSelectedUser(initialUser);\n     |             ^^^^^^^^^^^^^^^ Avoid calling setState() directly within an effect\n  33 |         } else if (isOpen && !initialUser) {\n  34 |             // Optional: clear if no initial user, so previous state doesn't persist if we reuse the component instance?\n  35 |             // But if we want to keep state, maybe not. ","line":32,"column":13,"nodeType":null,"endLine":32,"endColumn":28},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":55,"column":37,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":55,"endColumn":40,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2110,2113],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2110,2113],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":5,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport { useState, useEffect } from 'react';\r\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogFooter, DialogDescription } from '@/components/ui/dialog';\r\nimport { Button } from '@/components/ui/button';\r\nimport { Input } from '@/components/ui/input';\r\nimport { Label } from '@/components/ui/label';\r\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\r\nimport { Loader2, Search, DollarSign } from 'lucide-react';\r\nimport { processDebtPayment } from '@/app/lib/actions-payments';\r\nimport { searchMembers } from '@/app/lib/actions-members';\r\nimport { toast } from 'sonner';\r\n\r\ninterface DebtPaymentDialogProps {\r\n    isOpen: boolean;\r\n    onClose: () => void;\r\n    onSuccess: () => void;\r\n    initialUser?: any;\r\n}\r\n\r\nexport function DebtPaymentDialog({ isOpen, onClose, onSuccess, initialUser }: DebtPaymentDialogProps) {\r\n    const [isLoading, setIsLoading] = useState(false);\r\n\r\n    // Search State\r\n    const [searchTerm, setSearchTerm] = useState('');\r\n    const [searchResults, setSearchResults] = useState<any[]>([]);\r\n    const [selectedUser, setSelectedUser] = useState<any>(null);\r\n\r\n    // Sync initialUser when dialog opens\r\n    useEffect(() => {\r\n        if (isOpen && initialUser) {\r\n            setSelectedUser(initialUser);\r\n        } else if (isOpen && !initialUser) {\r\n            // Optional: clear if no initial user, so previous state doesn't persist if we reuse the component instance?\r\n            // But if we want to keep state, maybe not. \r\n            // Ideally better to clear.\r\n            setSelectedUser(null);\r\n        }\r\n    }, [isOpen, initialUser]);\r\n\r\n    // Payment State\r\n    const [amount, setAmount] = useState('');\r\n    const [method, setMethod] = useState('CASH');\r\n\r\n    const handleSearch = async (term: string) => {\r\n        setSearchTerm(term);\r\n        if (term.length < 2) {\r\n            setSearchResults([]);\r\n            return;\r\n        }\r\n        const results = await searchMembers(term);\r\n        setSearchResults(results);\r\n    };\r\n\r\n    const handleSelectUser = (user: any) => {\r\n        setSelectedUser(user);\r\n        setSearchResults([]);\r\n        setSearchTerm('');\r\n        // Pre-fill amount with full debt if > 0? Maybe manually is better to avoid mistakes\r\n    };\r\n\r\n    const handleSubmit = async () => {\r\n        if (!selectedUser || !amount) return;\r\n\r\n        setIsLoading(true);\r\n        const result = await processDebtPayment(selectedUser.id, Number(amount), method);\r\n        setIsLoading(false);\r\n\r\n        if (result.success) {\r\n            toast.success('Pago registrado correctamente');\r\n            onSuccess();\r\n            onClose();\r\n            // Reset\r\n            setSelectedUser(null);\r\n            setAmount('');\r\n        } else {\r\n            toast.error(result.error || 'Error al procesar pago');\r\n        }\r\n    };\r\n\r\n    return (\r\n        <Dialog open={isOpen} onOpenChange={onClose}>\r\n            <DialogContent className=\"sm:max-w-md bg-slate-950 border-white/10 text-white\">\r\n                <DialogHeader>\r\n                    <DialogTitle>Registrar Pago de Deuda</DialogTitle>\r\n                    <DialogDescription>\r\n                        Abona a la cuenta corriente de un socio.\r\n                    </DialogDescription>\r\n                </DialogHeader>\r\n\r\n                <div className=\"space-y-4 py-4\">\r\n                    {!selectedUser ? (\r\n                        <div className=\"space-y-2\">\r\n                            <Label>Buscar Socio</Label>\r\n                            <div className=\"relative\">\r\n                                <Search className=\"absolute left-2 top-2.5 h-4 w-4 text-muted-foreground\" />\r\n                                <Input\r\n                                    placeholder=\"Nombre...\"\r\n                                    value={searchTerm}\r\n                                    onChange={(e) => handleSearch(e.target.value)}\r\n                                    className=\"pl-8 bg-slate-900 border-white/10\"\r\n                                />\r\n                            </div>\r\n\r\n                            {searchResults.length > 0 && (\r\n                                <div className=\"border border-white/10 rounded-md shadow-sm max-h-40 overflow-y-auto mt-2 bg-slate-900\">\r\n                                    {searchResults.map(user => (\r\n                                        <div\r\n                                            key={user.id}\r\n                                            className=\"px-3 py-2 hover:bg-slate-800 cursor-pointer flex justify-between items-center\"\r\n                                            onClick={() => handleSelectUser(user)}\r\n                                        >\r\n                                            <div>\r\n                                                <div className=\"font-medium\">{user.name}</div>\r\n                                                <div className=\"text-xs text-red-400\">Deuda: ${Number(user.currentDebt).toLocaleString()}</div>\r\n                                            </div>\r\n                                            <span className=\"text-xs text-muted-foreground\">{user.type}</span>\r\n                                        </div>\r\n                                    ))}\r\n                                </div>\r\n                            )}\r\n                        </div>\r\n                    ) : (\r\n                        <div className=\"space-y-4\">\r\n                            <div className=\"p-3 bg-slate-900 border border-white/10 rounded flex justify-between items-center\">\r\n                                <div>\r\n                                    <div className=\"font-bold text-lg\">{selectedUser.name}</div>\r\n                                    <div className=\"text-sm text-red-400\">Deuda Actual: ${Number(selectedUser.currentDebt).toLocaleString()}</div>\r\n                                </div>\r\n                                <Button variant=\"ghost\" size=\"sm\" onClick={() => setSelectedUser(null)}>Cambiar</Button>\r\n                            </div>\r\n\r\n                            <div className=\"grid grid-cols-2 gap-4\">\r\n                                <div className=\"space-y-2\">\r\n                                    <Label>Monto a Pagar</Label>\r\n                                    <div className=\"relative\">\r\n                                        <DollarSign className=\"absolute left-3 top-2.5 h-4 w-4 text-muted-foreground\" />\r\n                                        <Input\r\n                                            type=\"number\"\r\n                                            className=\"pl-8 bg-slate-900 border-white/10\"\r\n                                            value={amount}\r\n                                            onChange={(e) => setAmount(e.target.value)}\r\n                                        />\r\n                                    </div>\r\n                                </div>\r\n                                <div className=\"space-y-2\">\r\n                                    <Label>Método</Label>\r\n                                    <Select value={method} onValueChange={setMethod}>\r\n                                        <SelectTrigger className=\"bg-slate-900 border-white/10\">\r\n                                            <SelectValue />\r\n                                        </SelectTrigger>\r\n                                        <SelectContent>\r\n                                            <SelectItem value=\"CASH\">Efectivo</SelectItem>\r\n                                            <SelectItem value=\"CARD\">Tarjeta</SelectItem>\r\n                                            <SelectItem value=\"TRANSFER\">Transferencia</SelectItem>\r\n                                        </SelectContent>\r\n                                    </Select>\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n                    )}\r\n                </div>\r\n\r\n                <DialogFooter>\r\n                    <Button variant=\"ghost\" onClick={onClose}>Cancelar</Button>\r\n                    <Button\r\n                        onClick={handleSubmit}\r\n                        disabled={!selectedUser || !amount || isLoading || Number(amount) <= 0}\r\n                        className=\"bg-emerald-600 hover:bg-emerald-500\"\r\n                    >\r\n                        {isLoading && <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" />}\r\n                        Confirmar Pago\r\n                    </Button>\r\n                </DialogFooter>\r\n            </DialogContent>\r\n        </Dialog>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\rokat\\OneDrive\\Proyectos\\Akapoolco\\src\\components\\shifts\\MembershipPaymentDialog.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":28,"column":56,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":28,"endColumn":59,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1164,1167],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1164,1167],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":29,"column":54,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":29,"endColumn":57,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1230,1233],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1230,1233],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":47,"column":37,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":47,"endColumn":40,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1742,1745],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1742,1745],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport { useState } from 'react';\r\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogFooter, DialogDescription } from '@/components/ui/dialog';\r\nimport { Button } from '@/components/ui/button';\r\nimport { Label } from '@/components/ui/label';\r\nimport { Input } from '@/components/ui/input';\r\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\r\nimport { Loader2, Search, Calendar, UserCheck } from 'lucide-react';\r\nimport { processMembershipPayment } from '@/app/lib/actions-payments';\r\nimport { searchMembers } from '@/app/lib/actions-members';\r\nimport { toast } from 'sonner';\r\n\r\ninterface MembershipPaymentDialogProps {\r\n    isOpen: boolean;\r\n    onClose: () => void;\r\n    onSuccess: () => void;\r\n}\r\n\r\n// Configurable pricing (could be dynamic later)\r\nconst MONTHLY_PRICE = 15000;\r\n\r\nexport function MembershipPaymentDialog({ isOpen, onClose, onSuccess }: MembershipPaymentDialogProps) {\r\n    const [isLoading, setIsLoading] = useState(false);\r\n\r\n    // Search State\r\n    const [searchTerm, setSearchTerm] = useState('');\r\n    const [searchResults, setSearchResults] = useState<any[]>([]);\r\n    const [selectedUser, setSelectedUser] = useState<any>(null);\r\n\r\n    // Payment State\r\n    const [months, setMonths] = useState('1');\r\n    const [method, setMethod] = useState('CASH');\r\n\r\n    const totalAmount = Number(months) * MONTHLY_PRICE;\r\n\r\n    const handleSearch = async (term: string) => {\r\n        setSearchTerm(term);\r\n        if (term.length < 2) {\r\n            setSearchResults([]);\r\n            return;\r\n        }\r\n        const results = await searchMembers(term);\r\n        setSearchResults(results);\r\n    };\r\n\r\n    const handleSelectUser = (user: any) => {\r\n        setSelectedUser(user);\r\n        setSearchResults([]);\r\n        setSearchTerm('');\r\n    };\r\n\r\n    const handleSubmit = async () => {\r\n        if (!selectedUser) return;\r\n\r\n        setIsLoading(true);\r\n        const result = await processMembershipPayment(selectedUser.id, Number(months), totalAmount, method);\r\n        setIsLoading(false);\r\n\r\n        if (result.success && result.newExpire) {\r\n            toast.success(`Membresía renovada hasta ${new Date(result.newExpire).toLocaleDateString()}`);\r\n            onSuccess();\r\n            onClose();\r\n            setSelectedUser(null);\r\n            setMonths('1');\r\n        } else {\r\n            toast.error(result.error || 'Error al procesar membresía');\r\n        }\r\n    };\r\n\r\n    return (\r\n        <Dialog open={isOpen} onOpenChange={onClose}>\r\n            <DialogContent className=\"sm:max-w-md bg-slate-950 border-white/10 text-white\">\r\n                <DialogHeader>\r\n                    <DialogTitle>Renovar Membresía</DialogTitle>\r\n                    <DialogDescription>\r\n                        Extiende la vigencia del socio.\r\n                    </DialogDescription>\r\n                </DialogHeader>\r\n\r\n                <div className=\"space-y-4 py-4\">\r\n                    {!selectedUser ? (\r\n                        <div className=\"space-y-2\">\r\n                            <Label>Buscar Socio</Label>\r\n                            <div className=\"relative\">\r\n                                <Search className=\"absolute left-2 top-2.5 h-4 w-4 text-muted-foreground\" />\r\n                                <Input\r\n                                    placeholder=\"Nombre...\"\r\n                                    value={searchTerm}\r\n                                    onChange={(e) => handleSearch(e.target.value)}\r\n                                    className=\"pl-8 bg-slate-900 border-white/10\"\r\n                                />\r\n                            </div>\r\n\r\n                            {searchResults.length > 0 && (\r\n                                <div className=\"border border-white/10 rounded-md shadow-sm max-h-40 overflow-y-auto mt-2 bg-slate-900\">\r\n                                    {searchResults.map(user => (\r\n                                        <div\r\n                                            key={user.id}\r\n                                            className=\"px-3 py-2 hover:bg-slate-800 cursor-pointer flex justify-between items-center\"\r\n                                            onClick={() => handleSelectUser(user)}\r\n                                        >\r\n                                            <div className=\"flex items-center gap-2\">\r\n                                                <UserCheck className=\"w-4 h-4 text-emerald-400\" />\r\n                                                <span className=\"font-medium\">{user.name}</span>\r\n                                            </div>\r\n                                            <span className=\"text-xs text-muted-foreground\">{user.type}</span>\r\n                                        </div>\r\n                                    ))}\r\n                                </div>\r\n                            )}\r\n                        </div>\r\n                    ) : (\r\n                        <div className=\"space-y-4\">\r\n                            <div className=\"p-3 bg-slate-900 border border-white/10 rounded flex justify-between items-center\">\r\n                                <div>\r\n                                    <div className=\"font-bold text-lg\">{selectedUser.name}</div>\r\n                                    <div className=\"text-xs text-slate-400 flex items-center gap-1\">\r\n                                        <Calendar className=\"w-3 h-3\" />\r\n                                        Vence: {selectedUser.membershipExpiresAt ? new Date(selectedUser.membershipExpiresAt).toLocaleDateString() : 'Vencida/Inactiva'}\r\n                                    </div>\r\n                                </div>\r\n                                <Button variant=\"ghost\" size=\"sm\" onClick={() => setSelectedUser(null)}>Cambiar</Button>\r\n                            </div>\r\n\r\n                            <div className=\"grid grid-cols-2 gap-4\">\r\n                                <div className=\"space-y-2\">\r\n                                    <Label>Periodo</Label>\r\n                                    <Select value={months} onValueChange={setMonths}>\r\n                                        <SelectTrigger className=\"bg-slate-900 border-white/10\">\r\n                                            <SelectValue />\r\n                                        </SelectTrigger>\r\n                                        <SelectContent>\r\n                                            <SelectItem value=\"1\">1 Mes (${MONTHLY_PRICE.toLocaleString()})</SelectItem>\r\n                                            <SelectItem value=\"3\">3 Meses (${(MONTHLY_PRICE * 3).toLocaleString()})</SelectItem>\r\n                                            <SelectItem value=\"6\">6 Meses (${(MONTHLY_PRICE * 6).toLocaleString()})</SelectItem>\r\n                                            <SelectItem value=\"12\">1 Año (${(MONTHLY_PRICE * 12).toLocaleString()})</SelectItem>\r\n                                        </SelectContent>\r\n                                    </Select>\r\n                                </div>\r\n                                <div className=\"space-y-2\">\r\n                                    <Label>Método</Label>\r\n                                    <Select value={method} onValueChange={setMethod}>\r\n                                        <SelectTrigger className=\"bg-slate-900 border-white/10\">\r\n                                            <SelectValue />\r\n                                        </SelectTrigger>\r\n                                        <SelectContent>\r\n                                            <SelectItem value=\"CASH\">Efectivo</SelectItem>\r\n                                            <SelectItem value=\"CARD\">Tarjeta</SelectItem>\r\n                                            <SelectItem value=\"TRANSFER\">Transferencia</SelectItem>\r\n                                        </SelectContent>\r\n                                    </Select>\r\n                                </div>\r\n                            </div>\r\n\r\n                            <div className=\"flex justify-between items-center p-2 border-t border-white/10 pt-4 mt-2\">\r\n                                <span className=\"font-semibold text-slate-300\">Total a Pagar</span>\r\n                                <span className=\"text-xl font-bold text-emerald-400\">${totalAmount.toLocaleString()}</span>\r\n                            </div>\r\n                        </div>\r\n                    )}\r\n                </div>\r\n\r\n                <DialogFooter>\r\n                    <Button variant=\"ghost\" onClick={onClose}>Cancelar</Button>\r\n                    <Button\r\n                        onClick={handleSubmit}\r\n                        disabled={!selectedUser || isLoading}\r\n                        className=\"bg-blue-600 hover:bg-blue-500\"\r\n                    >\r\n                        {isLoading && <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" />}\r\n                        Procesar Renovarción\r\n                    </Button>\r\n                </DialogFooter>\r\n            </DialogContent>\r\n        </Dialog>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\rokat\\OneDrive\\Proyectos\\Akapoolco\\src\\components\\sidebar.tsx","messages":[{"ruleId":"@next/next/no-img-element","severity":1,"message":"Using `<img>` could result in slower LCP and higher bandwidth. Consider using `<Image />` from `next/image` or a custom image loader to automatically optimize images. This may incur additional usage or cost from your provider. See: https://nextjs.org/docs/messages/no-img-element","line":94,"column":21,"nodeType":"JSXOpeningElement","endLine":98,"endColumn":23}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\"\r\n\r\nimport Link from \"next/link\"\r\nimport { usePathname } from \"next/navigation\"\r\nimport { useSession } from \"next-auth/react\"\r\nimport { cn } from \"@/lib/utils\"\r\nimport { LayoutDashboard, Users, Grid, LogOut, Package, Scale, ListOrdered, MonitorPlay, Link2, Utensils } from \"lucide-react\"\r\nimport { Button } from \"@/components/ui/button\"\r\nimport { filterByRole } from \"@/lib/permissions\"\r\nimport { UserRole } from \"@prisma/client\"\r\nimport { signOut } from \"next-auth/react\"\r\nimport { useState } from \"react\"\r\nimport { ChangePasswordDialog } from \"@/components/auth/ChangePasswordDialog\"\r\nimport { Lock } from \"lucide-react\"\r\n\r\nconst ALL_MENU_ITEMS = [\r\n    {\r\n        href: \"/dashboard\",\r\n        icon: LayoutDashboard,\r\n        label: \"Inicio\",\r\n        roles: [\"ADMIN\", \"STAFF\", \"SUPERUSER\"] as UserRole[]\r\n    },\r\n    {\r\n        href: \"/dashboard/cockpit\",\r\n        icon: Grid,\r\n        label: \"Panel de Control\",\r\n        roles: [\"ADMIN\", \"STAFF\"] as UserRole[]\r\n    },\r\n    {\r\n        href: \"/dashboard/members\",\r\n        icon: Users,\r\n        label: \"Socios\",\r\n        roles: [\"ADMIN\", \"SUPERUSER\"] as UserRole[]\r\n    },\r\n    {\r\n        href: \"/dashboard/products\",\r\n        icon: Package,\r\n        label: \"Productos\",\r\n        roles: [\"ADMIN\", \"STAFF\", \"SUPERUSER\"] as UserRole[]\r\n    },\r\n    {\r\n        href: \"/dashboard/kitchen\",\r\n        icon: Utensils,\r\n        label: \"Cocina\",\r\n        roles: [\"ADMIN\", \"STAFF\", \"SUPERUSER\"] as UserRole[]\r\n    },\r\n    {\r\n        href: \"/dashboard/shifts\",\r\n        icon: Scale,\r\n        label: \"Caja y Turnos\",\r\n        roles: [\"ADMIN\", \"STAFF\", \"SUPERUSER\"] as UserRole[]\r\n    },\r\n    {\r\n        href: \"/dashboard/waiting-list\",\r\n        icon: ListOrdered,\r\n        label: \"Lista de Espera\",\r\n        roles: [\"ADMIN\", \"STAFF\", \"SUPERUSER\"] as UserRole[]\r\n    },\r\n    {\r\n        href: \"/dashboard/marketing\",\r\n        icon: MonitorPlay,\r\n        label: \"Publicidad\",\r\n        roles: [\"ADMIN\", \"SUPERUSER\"] as UserRole[]\r\n    },\r\n    {\r\n        href: \"/dashboard/kiosk-links\",\r\n        icon: Link2,\r\n        label: \"Enlaces Kiosco\",\r\n        roles: [\"ADMIN\", \"STAFF\", \"SUPERUSER\"] as UserRole[]\r\n    },\r\n    {\r\n        href: \"/dashboard/users\",\r\n        icon: Users,\r\n        label: \"Usuarios\",\r\n        roles: [\"ADMIN\", \"SUPERUSER\"] as UserRole[]\r\n    },\r\n]\r\n\r\nexport function Sidebar() {\r\n    const pathname = usePathname()\r\n    const { data: session, status } = useSession()\r\n    const [isPasswordOpen, setIsPasswordOpen] = useState(false)\r\n\r\n    // Filtrar menu items según el rol del usuario\r\n    // Durante SSR o loading, mostrar todos los items (se filtrará en el cliente)\r\n    const menuItems = status === \"authenticated\"\r\n        ? filterByRole(ALL_MENU_ITEMS, session?.user?.role as UserRole | undefined)\r\n        : ALL_MENU_ITEMS // Mostrar todos durante carga\r\n\r\n    return (\r\n        <aside className=\"w-64 h-screen bg-black/40 backdrop-blur-xl border-r border-white/10 flex flex-col fixed left-0 top-0 z-50\">\r\n            <div className=\"p-6 flex flex-col items-center\">\r\n                <div className=\"relative w-32 h-32 mb-4 drop-shadow-[0_0_15px_rgba(255,215,0,0.3)]\">\r\n                    <img\r\n                        src=\"/images/branding/logo.jpg\"\r\n                        alt=\"Akapoolco Logo\"\r\n                        className=\"object-contain w-full h-full rounded-full border-2 border-[#C5A059]/50\"\r\n                    />\r\n                </div>\r\n                <h1 className=\"text-xl font-bold tracking-tighter text-[#C5A059] flex items-center gap-2\">\r\n                    Akapoolco\r\n                </h1>\r\n                <p className=\"text-xs text-muted-foreground mt-1\">Gestión del Sistema</p>\r\n            </div>\r\n\r\n            <nav className=\"flex-1 px-4 space-y-2 mt-4\">\r\n                {menuItems.map((item) => {\r\n                    const Icon = item.icon\r\n                    const isActive = pathname === item.href\r\n\r\n                    return (\r\n                        <Link\r\n                            key={item.href}\r\n                            href={item.href}\r\n                            className={cn(\r\n                                \"flex items-center gap-3 px-3 py-2.5 rounded-lg text-sm font-medium transition-all duration-200\",\r\n                                isActive\r\n                                    ? \"bg-primary/20 text-primary shadow-[0_0_10px_rgba(var(--primary),0.2)]\"\r\n                                    : \"text-muted-foreground hover:bg-white/5 hover:text-white\"\r\n                            )}\r\n                        >\r\n                            <Icon className=\"w-5 h-5\" />\r\n                            {item.label}\r\n                        </Link>\r\n                    )\r\n                })}\r\n            </nav>\r\n\r\n            <div className=\"p-4 border-t border-white/10 space-y-2\">\r\n                <Button\r\n                    variant=\"ghost\"\r\n                    className=\"w-full justify-start text-blue-400 hover:text-blue-300 hover:bg-blue-900/20 gap-3\"\r\n                    onClick={() => setIsPasswordOpen(true)}\r\n                >\r\n                    <Lock className=\"w-5 h-5\" />\r\n                    Cambiar Contraseña\r\n                </Button>\r\n\r\n                <Button\r\n                    variant=\"ghost\"\r\n                    className=\"w-full justify-start text-red-400 hover:text-red-300 hover:bg-red-900/20 gap-3\"\r\n                    onClick={() => signOut({ callbackUrl: \"/login\" })}\r\n                >\r\n                    <LogOut className=\"w-5 h-5\" />\r\n                    Cerrar Sesión\r\n                </Button>\r\n            </div>\r\n\r\n\r\n            <ChangePasswordDialog\r\n                open={isPasswordOpen}\r\n                onOpenChange={setIsPasswordOpen}\r\n            />\r\n        </aside >\r\n    )\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\rokat\\OneDrive\\Proyectos\\Akapoolco\\src\\components\\tables\\ActiveSessionControl.tsx","messages":[],"suppressedMessages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'endSession' is defined but never used.","line":19,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":19,"endColumn":20,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"endSession"},"fix":{"range":[696,707],"text":""},"desc":"Remove unused variable \"endSession\"."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":35,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":35,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1296,1299],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1296,1299],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":44,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":44,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1662,1665],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1662,1665],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'loadPreview'. Either include it or remove the dependency array.","line":60,"column":8,"nodeType":"ArrayExpression","endLine":60,"endColumn":45,"suggestions":[{"desc":"Update the dependencies array to be: [isOpen, session?.id, refreshTrigger, loadPreview]","fix":{"range":[2371,2408],"text":"[isOpen, session?.id, refreshTrigger, loadPreview]"}}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":96,"column":45,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":96,"endColumn":48,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3784,3787],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3784,3787],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":99,"column":67,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":99,"endColumn":70,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3952,3955],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3952,3955],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":145,"column":52,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":145,"endColumn":55,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6660,6663],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6660,6663],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":182,"column":58,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":182,"endColumn":61,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9301,9304],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9301,9304],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":210,"column":84,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":210,"endColumn":87,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10970,10973],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10970,10973],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":211,"column":72,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":211,"endColumn":75,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[11067,11070],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[11067,11070],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":215,"column":61,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":215,"endColumn":64,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[11371,11374],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[11371,11374],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":215,"column":79,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":215,"endColumn":82,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[11389,11392],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[11389,11392],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":232,"column":64,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":232,"endColumn":67,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[12597,12600],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[12597,12600],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":232,"column":82,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":232,"endColumn":85,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[12615,12618],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[12615,12618],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":254,"column":72,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":254,"endColumn":75,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[14206,14209],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[14206,14209],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":261,"column":65,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":261,"endColumn":68,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[14965,14968],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[14965,14968],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":261,"column":83,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":261,"endColumn":86,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[14983,14986],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[14983,14986],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\rokat\\OneDrive\\Proyectos\\Akapoolco\\src\\components\\tables\\AddConsumptionDialog.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'DialogTrigger' is defined but never used.","line":11,"column":5,"nodeType":"Identifier","messageId":"unusedVar","endLine":11,"endColumn":18,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"DialogTrigger"},"fix":{"range":[244,264],"text":""},"desc":"Remove unused variable \"DialogTrigger\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Separator' is defined but never used.","line":21,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":21,"endColumn":19,"suggestions":[{"messageId":"removeUnusedImportDeclaration","data":{"varName":"Separator"},"fix":{"range":[720,773],"text":""},"desc":"Remove unused import declaration."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is defined but never used.","line":152,"column":18,"nodeType":"Identifier","messageId":"unusedVar","endLine":152,"endColumn":23}],"suppressedMessages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":27,"column":14,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":27,"endColumn":17,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[958,961],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[958,961],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":35,"column":46,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":35,"endColumn":49,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1247,1250],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1247,1250],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":36,"column":62,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":36,"endColumn":65,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1320,1323],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1320,1323],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":77,"column":33,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":77,"endColumn":36,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2688,2691],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2688,2691],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/* eslint-disable @typescript-eslint/no-explicit-any */\r\n\"use client\"\r\n\r\nimport { useState, useEffect } from \"react\"\r\nimport { Button } from \"@/components/ui/button\"\r\nimport {\r\n    Dialog,\r\n    DialogContent,\r\n    DialogHeader,\r\n    DialogTitle,\r\n    DialogTrigger,\r\n    DialogFooter\r\n} from \"@/components/ui/dialog\"\r\nimport { Input } from \"@/components/ui/input\"\r\nimport { ShoppingCart, Search, Plus, Minus, Loader2 } from \"lucide-react\"\r\nimport { getProductsWithStock } from \"@/app/lib/actions-products\"\r\nimport { addSessionConsumption } from \"@/app/lib/actions-sessions\"\r\nimport { addOrderToPlayer } from \"@/app/lib/actions-card-tables\"\r\nimport { toast } from \"sonner\"\r\nimport { Badge } from \"@/components/ui/badge\"\r\nimport { Separator } from \"@/components/ui/separator\"\r\n\r\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\"\r\n\r\ninterface AddConsumptionDialogProps {\r\n    sessionId: string\r\n    players: any[]\r\n    isCardTable?: boolean\r\n    isOpen: boolean\r\n    onClose: () => void\r\n    onSuccess: () => void\r\n}\r\n\r\nexport function AddConsumptionDialog({ sessionId, players, isCardTable, isOpen, onClose, onSuccess }: AddConsumptionDialogProps) {\r\n    const [products, setProducts] = useState<any[]>([])\r\n    const [filteredProducts, setFilteredProducts] = useState<any[]>([])\r\n    const [search, setSearch] = useState(\"\")\r\n    const [cart, setCart] = useState<{ [id: string]: number }>({})\r\n    const [loading, setLoading] = useState(false)\r\n    const [isSubmitting, setIsSubmitting] = useState(false)\r\n    const [targetUser, setTargetUser] = useState<string>(\"TABLE\") // \"TABLE\" or userId\r\n\r\n    useEffect(() => {\r\n        if (isOpen) {\r\n            loadProducts()\r\n            setCart({})\r\n            setSearch(\"\")\r\n            setTargetUser(\"TABLE\")\r\n        }\r\n    }, [isOpen])\r\n\r\n    // ... (useEffect for search remains same)\r\n\r\n    useEffect(() => {\r\n        if (!search) {\r\n            setFilteredProducts(products)\r\n        } else {\r\n            const lower = search.toLowerCase()\r\n            setFilteredProducts(products.filter(p => p.name.toLowerCase().includes(lower)))\r\n        }\r\n    }, [search, products])\r\n\r\n    async function loadProducts() {\r\n        setLoading(true)\r\n        try {\r\n            const data = await getProductsWithStock()\r\n            // Only show products with stock if stockControl is true, or all if false/stock>0\r\n            setProducts(data.filter(p => !p.stockControl || p.stock > 0))\r\n            setFilteredProducts(data)\r\n        } catch (error) {\r\n            console.error(error)\r\n        } finally {\r\n            setLoading(false)\r\n        }\r\n    }\r\n\r\n    const addToCart = (product: any) => {\r\n        const current = cart[product.id] || 0\r\n        if (product.stockControl && current >= product.stock) {\r\n            toast.error(\"No hay suficiente stock\")\r\n            return\r\n        }\r\n        setCart(prev => ({ ...prev, [product.id]: current + 1 }))\r\n    }\r\n\r\n    const removeFromCart = (productId: string) => {\r\n        setCart(prev => {\r\n            const current = prev[productId] || 0\r\n            if (current <= 1) {\r\n                const copy = { ...prev }\r\n                delete copy[productId]\r\n                return copy\r\n            }\r\n            return { ...prev, [productId]: current - 1 }\r\n        })\r\n    }\r\n\r\n    // Filter valid players for selection\r\n    // For Card Tables: Any player in session (needs sessionPlayerId)\r\n    // For Pool Tables: Allow all (Members get charged to account, Guests get tagged in Table Order)\r\n    const validPlayers = players;\r\n\r\n    async function handleSubmit() {\r\n        setIsSubmitting(true)\r\n        try {\r\n            const selectedPlayer = targetUser !== \"TABLE\" ? players.find(p => p.id === targetUser) : null;\r\n\r\n            const items = Object.entries(cart).map(([id, quantity]) => {\r\n                const product = products.find(p => p.id === id)\r\n                return {\r\n                    productId: id,\r\n                    name: product.name,\r\n                    price: Number(product.priceClient), // Use client price for consumption usually\r\n                    quantity,\r\n                    // Tag with player name if specific player selected but not charging account\r\n                    orderedBy: selectedPlayer ? (selectedPlayer.name || selectedPlayer.guestName) : undefined\r\n                }\r\n            })\r\n\r\n            let result;\r\n            if (targetUser === \"TABLE\") {\r\n                // Add to Table Orders\r\n                result = await addSessionConsumption(sessionId, items, undefined);\r\n            } else {\r\n                // Target User is selected\r\n                if (isCardTable) {\r\n                    // Card Table: Charge to Session Player (Target is sessionPlayerId)\r\n                    result = await addOrderToPlayer(sessionId, targetUser, items);\r\n                } else {\r\n                    // Pool Table: \r\n                    // If Member -> Charge Account (Debt)\r\n                    // If Guest -> Add to Table Order but tagged\r\n                    const memberId = selectedPlayer?.memberId || selectedPlayer?.userId;\r\n\r\n                    if (memberId) {\r\n                        // Charge Member Account\r\n                        result = await addSessionConsumption(sessionId, items, memberId);\r\n                    } else {\r\n                        // Guest: Add to Table Orders (items already have orderedBy)\r\n                        result = await addSessionConsumption(sessionId, items, undefined);\r\n                    }\r\n                }\r\n            }\r\n\r\n            if (result.success) {\r\n                toast.success(targetUser !== \"TABLE\" ? \"Cargado a cuenta personal\" : \"Agregado a la mesa\")\r\n                onSuccess()\r\n                onClose()\r\n            } else {\r\n                toast.error(result.error || \"Error al agregar consumo\")\r\n            }\r\n        } catch (error) {\r\n            toast.error(\"Error inesperado\")\r\n        } finally {\r\n            setIsSubmitting(false)\r\n        }\r\n    }\r\n\r\n    const cartTotal = Object.entries(cart).reduce((sum, [id, qty]) => {\r\n        const product = products.find(p => p.id === id)\r\n        return sum + (Number(product?.priceClient || 0) * qty)\r\n    }, 0)\r\n\r\n    const cartCount = Object.values(cart).reduce((a, b) => a + b, 0)\r\n\r\n    return (\r\n        <Dialog open={isOpen} onOpenChange={onClose}>\r\n            <DialogContent className=\"sm:max-w-[700px] h-[80vh] flex flex-col pt-0 px-0 pb-0 bg-slate-950 border-white/10 text-white\">\r\n                <DialogHeader className=\"p-6 pb-2 border-b border-white/5 bg-black/20\">\r\n                    <DialogTitle className=\"flex justify-between items-center text-xl\">\r\n                        <span>Agregar Consumo</span>\r\n                        <Badge variant=\"outline\" className=\"border-amber-500/50 text-amber-500 text-base px-3\">\r\n                            Total: ${cartTotal.toLocaleString()}\r\n                        </Badge>\r\n                    </DialogTitle>\r\n\r\n                    <div className=\"flex gap-3 pt-4\">\r\n                        <div className=\"w-1/3\">\r\n                            <Select value={targetUser} onValueChange={setTargetUser}>\r\n                                <SelectTrigger className=\"bg-slate-900 border-white/10\">\r\n                                    <SelectValue placeholder=\"Cargar a...\" />\r\n                                </SelectTrigger>\r\n                                <SelectContent className=\"bg-slate-900 border-white/10 text-white\">\r\n                                    <SelectItem value=\"TABLE\">Mesa (General)</SelectItem>\r\n                                    {validPlayers.map((p, i) => (\r\n                                        <SelectItem key={p.id || i} value={p.id}>\r\n                                            {p.name || p.guestName || \"Jugador\"}\r\n                                        </SelectItem>\r\n                                    ))}\r\n                                </SelectContent>\r\n                            </Select>\r\n                        </div>\r\n                        <div className=\"relative flex-1\">\r\n                            <Search className=\"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-slate-400\" />\r\n                            <Input\r\n                                placeholder=\"Buscar productos...\"\r\n                                className=\"bg-slate-900 border-white/10 pl-9\"\r\n                                value={search}\r\n                                onChange={(e) => setSearch(e.target.value)}\r\n                            />\r\n                        </div>\r\n                    </div>\r\n                </DialogHeader>\r\n\r\n                <div className=\"flex-1 overflow-y-auto p-6 grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n                    {loading ? (\r\n                        <div className=\"col-span-full flex justify-center py-10\">\r\n                            <Loader2 className=\"animate-spin h-8 w-8 text-slate-500\" />\r\n                        </div>\r\n                    ) : filteredProducts.length === 0 ? (\r\n                        <div className=\"col-span-full text-center text-slate-500 py-10\">\r\n                            No se encontraron productos\r\n                        </div>\r\n                    ) : (\r\n                        filteredProducts.map(product => (\r\n                            <div key={product.id} className=\"flex items-center justify-between p-3 rounded-lg bg-white/5 border border-white/5 hover:border-amber-500/30 transition-colors\">\r\n                                <div className=\"flex flex-col\">\r\n                                    <span className=\"font-medium\">{product.name}</span>\r\n                                    <span className=\"text-xs text-slate-400\">${Number(product.priceClient).toLocaleString()}</span>\r\n                                    {product.stockControl && (\r\n                                        <span className=\"text-[10px] text-slate-500\">Stock: {product.stock}</span>\r\n                                    )}\r\n                                </div>\r\n                                <div className=\"flex items-center gap-3\">\r\n                                    {cart[product.id] ? (\r\n                                        <div className=\"flex items-center gap-2 bg-black/40 rounded-full p-1\">\r\n                                            <Button variant=\"ghost\" size=\"icon\" className=\"h-6 w-6 rounded-full hover:bg-white/10\" onClick={() => removeFromCart(product.id)}>\r\n                                                <Minus className=\"h-3 w-3\" />\r\n                                            </Button>\r\n                                            <span className=\"text-sm font-bold w-4 text-center\">{cart[product.id]}</span>\r\n                                            <Button variant=\"ghost\" size=\"icon\" className=\"h-6 w-6 rounded-full hover:bg-white/10\" onClick={() => addToCart(product)}>\r\n                                                <Plus className=\"h-3 w-3\" />\r\n                                            </Button>\r\n                                        </div>\r\n                                    ) : (\r\n                                        <Button size=\"sm\" variant=\"outline\" className=\"h-8 border-dashed border-white/20 hover:border-amber-500 hover:text-amber-500\" onClick={() => addToCart(product)}>\r\n                                            <Plus className=\"h-4 w-4 mr-1\" /> Agregar\r\n                                        </Button>\r\n                                    )}\r\n                                </div>\r\n                            </div>\r\n                        ))\r\n                    )}\r\n                </div>\r\n\r\n                <DialogFooter className=\"p-4 border-t border-white/5 bg-black/20\">\r\n                    <Button variant=\"ghost\" onClick={onClose}>Cancelar</Button>\r\n                    <Button\r\n                        onClick={handleSubmit}\r\n                        disabled={cartCount === 0 || isSubmitting}\r\n                        className=\"bg-amber-600 hover:bg-amber-700 text-white min-w-[150px]\"\r\n                    >\r\n                        {isSubmitting ? <Loader2 className=\"animate-spin mr-2 h-4 w-4\" /> : <ShoppingCart className=\"mr-2 h-4 w-4\" />}\r\n                        Confirmar ({cartCount})\r\n                    </Button>\r\n                </DialogFooter>\r\n            </DialogContent>\r\n        </Dialog>\r\n    )\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\rokat\\OneDrive\\Proyectos\\Akapoolco\\src\\components\\tables\\AddPlayerDialog.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'DialogFooter' is defined but never used.","line":4,"column":60,"nodeType":"Identifier","messageId":"unusedVar","endLine":4,"endColumn":72,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"DialogFooter"},"fix":{"range":[109,123],"text":""},"desc":"Remove unused variable \"DialogFooter\"."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":24,"column":56,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":24,"endColumn":59,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[913,916],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[913,916],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":38,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":38,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1365,1368],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1365,1368],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport { useState } from 'react';\r\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogFooter, DialogDescription } from '@/components/ui/dialog';\r\nimport { Button } from '@/components/ui/button';\r\nimport { Input } from '@/components/ui/input';\r\nimport { Loader2, Search } from 'lucide-react';\r\nimport { joinCardSession } from '@/app/lib/actions-card-tables';\r\nimport { searchMembers } from '@/app/lib/actions-members';\r\nimport { toast } from 'sonner';\r\n\r\ninterface AddPlayerDialogProps {\r\n    sessionId: string;\r\n    isOpen: boolean;\r\n    onClose: () => void;\r\n    onSuccess: () => void;\r\n}\r\n\r\nexport function AddPlayerDialog({ sessionId, isOpen, onClose, onSuccess }: AddPlayerDialogProps) {\r\n    const [isLoading, setIsLoading] = useState(false);\r\n\r\n    // Search State\r\n    const [searchTerm, setSearchTerm] = useState('');\r\n    const [searchResults, setSearchResults] = useState<any[]>([]);\r\n    const [showGuestInput, setShowGuestInput] = useState(false);\r\n    const [guestName, setGuestName] = useState('');\r\n\r\n    const handleSearch = async (term: string) => {\r\n        setSearchTerm(term);\r\n        if (term.length < 2) {\r\n            setSearchResults([]);\r\n            return;\r\n        }\r\n        const results = await searchMembers(term);\r\n        setSearchResults(results);\r\n    };\r\n\r\n    const handleAddUser = async (user: any) => {\r\n        setIsLoading(true);\r\n        const result = await joinCardSession(sessionId, { userId: user.id });\r\n        setIsLoading(false);\r\n\r\n        if (result.success) {\r\n            toast.success('Jugador agregado correctamente');\r\n            onSuccess();\r\n            onClose();\r\n        } else {\r\n            toast.error(result.error || 'Error al agregar jugador');\r\n        }\r\n    };\r\n\r\n    const handleAddGuest = async () => {\r\n        if (!guestName.trim()) return;\r\n        setIsLoading(true);\r\n        const result = await joinCardSession(sessionId, { guestName: guestName });\r\n        setIsLoading(false);\r\n\r\n        if (result.success) {\r\n            toast.success('Invitado agregado correctamente');\r\n            onSuccess();\r\n            onClose();\r\n        } else {\r\n            toast.error(result.error || 'Error al agregar invitado');\r\n        }\r\n    };\r\n\r\n    return (\r\n        <Dialog open={isOpen} onOpenChange={onClose}>\r\n            <DialogContent className=\"sm:max-w-md\">\r\n                <DialogHeader>\r\n                    <DialogTitle>Agregar Jugador a la Mesa</DialogTitle>\r\n                    <DialogDescription>\r\n                        Busque un socio o ingrese el nombre de un invitado.\r\n                    </DialogDescription>\r\n                </DialogHeader>\r\n\r\n                <div className=\"space-y-4 py-4\">\r\n                    {!showGuestInput ? (\r\n                        <div className=\"relative space-y-2\">\r\n                            <div className=\"relative\">\r\n                                <Search className=\"absolute left-2 top-2.5 h-4 w-4 text-muted-foreground\" />\r\n                                <Input\r\n                                    placeholder=\"Buscar socio...\"\r\n                                    value={searchTerm}\r\n                                    onChange={(e) => handleSearch(e.target.value)}\r\n                                    className=\"pl-8\"\r\n                                />\r\n                            </div>\r\n\r\n                            {searchResults.length > 0 && (\r\n                                <div className=\"border rounded-md shadow-sm max-h-40 overflow-y-auto mt-2\">\r\n                                    {searchResults.map(user => (\r\n                                        <div\r\n                                            key={user.id}\r\n                                            className=\"px-3 py-2 hover:bg-slate-100 dark:hover:bg-slate-800 cursor-pointer flex justify-between items-center\"\r\n                                            onClick={() => handleAddUser(user)}\r\n                                        >\r\n                                            <span className=\"font-medium\">{user.name}</span>\r\n                                            <span className=\"text-xs text-muted-foreground\">{user.type}</span>\r\n                                        </div>\r\n                                    ))}\r\n                                </div>\r\n                            )}\r\n\r\n                            <div className=\"text-center pt-2\">\r\n                                <Button variant=\"link\" size=\"sm\" onClick={() => setShowGuestInput(true)}>\r\n                                    Agregar Invitado (Manual)\r\n                                </Button>\r\n                            </div>\r\n                        </div>\r\n                    ) : (\r\n                        <div className=\"flex gap-2 items-center\">\r\n                            <Input\r\n                                placeholder=\"Nombre del Invitado\"\r\n                                value={guestName}\r\n                                onChange={(e) => setGuestName(e.target.value)}\r\n                            />\r\n                            <Button onClick={handleAddGuest} disabled={isLoading || !guestName.trim()}>\r\n                                {isLoading ? <Loader2 className=\"w-4 h-4 animate-spin\" /> : 'Agregar'}\r\n                            </Button>\r\n                            <Button variant=\"ghost\" onClick={() => setShowGuestInput(false)}>Cancelar</Button>\r\n                        </div>\r\n                    )}\r\n                </div>\r\n            </DialogContent>\r\n        </Dialog>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\rokat\\OneDrive\\Proyectos\\Akapoolco\\src\\components\\tables\\CloseSessionDialog.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'CreditCard' is defined but never used.","line":14,"column":52,"nodeType":"Identifier","messageId":"unusedVar","endLine":14,"endColumn":62,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"CreditCard"},"fix":{"range":[394,406],"text":""},"desc":"Remove unused variable \"CreditCard\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Banknote' is defined but never used.","line":14,"column":64,"nodeType":"Identifier","messageId":"unusedVar","endLine":14,"endColumn":72,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"Banknote"},"fix":{"range":[406,416],"text":""},"desc":"Remove unused variable \"Banknote\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'CommandEmpty' is defined but never used.","line":23,"column":5,"nodeType":"Identifier","messageId":"unusedVar","endLine":23,"endColumn":17,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"CommandEmpty"},"fix":{"range":[796,815],"text":""},"desc":"Remove unused variable \"CommandEmpty\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'cn' is defined but never used.","line":34,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":34,"endColumn":12,"suggestions":[{"messageId":"removeUnusedImportDeclaration","data":{"varName":"cn"},"fix":{"range":[1026,1058],"text":""},"desc":"Remove unused import declaration."}]},{"ruleId":"jsx-a11y/role-has-required-aria-props","severity":1,"message":"Elements with the ARIA role \"combobox\" must have the following attributes defined: aria-controls,aria-expanded","line":88,"column":22,"nodeType":"JSXAttribute","endLine":88,"endColumn":37},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is defined but never used.","line":217,"column":18,"nodeType":"Identifier","messageId":"unusedVar","endLine":217,"endColumn":23}],"suppressedMessages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":48,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":48,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1503,1506],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1503,1506],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":174,"column":65,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":174,"endColumn":68,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6945,6948],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6945,6948],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":251,"column":45,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":251,"endColumn":48,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10051,10054],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10051,10054],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":6,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/* eslint-disable @typescript-eslint/no-explicit-any */\r\n\"use client\"\r\n\r\nimport { useState, useEffect } from \"react\"\r\nimport { Button } from \"@/components/ui/button\"\r\nimport {\r\n    Dialog,\r\n    DialogContent,\r\n    DialogHeader,\r\n    DialogTitle,\r\n    DialogFooter\r\n} from \"@/components/ui/dialog\"\r\nimport { Input } from \"@/components/ui/input\"\r\nimport { Users, DollarSign, Loader2, Plus, Trash2, CreditCard, Banknote } from \"lucide-react\"\r\nimport { endSession } from \"@/app/lib/actions-sessions\"\r\nimport { toast } from \"sonner\"\r\nimport { Tabs, TabsList, TabsTrigger, TabsContent } from \"@/components/ui/tabs\"\r\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\"\r\nimport { searchMembers } from \"@/app/lib/actions-members\"\r\n\r\nimport {\r\n    Command,\r\n    CommandEmpty,\r\n    CommandGroup,\r\n    CommandInput,\r\n    CommandItem,\r\n    CommandList,\r\n} from \"@/components/ui/command\"\r\nimport {\r\n    Popover,\r\n    PopoverContent,\r\n    PopoverTrigger,\r\n} from \"@/components/ui/popover\"\r\nimport { cn } from \"@/lib/utils\"\r\n\r\n// Helper Component for Payment Row User Search (Using Popover for visibility)\r\nfunction PaymentUserSelect({\r\n    value,\r\n    onSelect,\r\n    required = false\r\n}: {\r\n    value?: { id: string, name: string },\r\n    onSelect: (user: { id: string, name: string } | undefined) => void,\r\n    required?: boolean\r\n}) {\r\n    const [open, setOpen] = useState(false)\r\n    const [term, setTerm] = useState(\"\")\r\n    const [results, setResults] = useState<any[]>([])\r\n    const [loading, setLoading] = useState(false)\r\n\r\n    useEffect(() => {\r\n        if (!open) {\r\n            setTerm(\"\")\r\n            setResults([])\r\n        }\r\n    }, [open])\r\n\r\n    const handleSearch = async (val: string) => {\r\n        setTerm(val)\r\n        if (val.length < 2) {\r\n            setResults([])\r\n            return\r\n        }\r\n        setLoading(true)\r\n        try {\r\n            const res = await searchMembers(val)\r\n            setResults(res)\r\n        } finally {\r\n            setLoading(false)\r\n        }\r\n    }\r\n\r\n    if (value) {\r\n        return (\r\n            <div className=\"flex items-center gap-2 bg-slate-900 border border-white/10 rounded px-2 h-8 text-sm min-w-[120px]\">\r\n                <Users className=\"w-3 h-3 text-emerald-400\" />\r\n                <span className=\"truncate max-w-[100px]\">{value.name}</span>\r\n                <Button variant=\"ghost\" size=\"icon\" className=\"h-6 w-6 ml-auto hover:text-red-400\" onClick={() => onSelect(undefined)}>\r\n                    <Trash2 className=\"w-3 h-3\" />\r\n                </Button>\r\n            </div>\r\n        )\r\n    }\r\n\r\n    return (\r\n        <Popover open={open} onOpenChange={setOpen}>\r\n            <PopoverTrigger asChild>\r\n                <div role=\"combobox\" aria-expanded={open} className={`flex items-center justify-between h-8 w-full min-w-[120px] rounded-md border bg-slate-950 px-3 py-1 text-xs shadow-sm cursor-pointer ${required ? 'border-red-500/50 text-red-200' : 'border-white/10 text-slate-400'}`}>\r\n                    {required ? \"Asignar (Req)\" : \"Asignar Usuario\"}\r\n                </div>\r\n            </PopoverTrigger>\r\n            <PopoverContent className=\"p-0 bg-slate-950 border-white/10 w-[200px]\" side=\"bottom\" align=\"start\">\r\n                <Command shouldFilter={false}>\r\n                    <CommandInput\r\n                        placeholder=\"Buscar nombre...\"\r\n                        value={term}\r\n                        onValueChange={handleSearch}\r\n                        className=\"h-9 text-xs\"\r\n                    />\r\n                    <CommandList>\r\n                        {loading && <div className=\"p-2 text-xs text-center text-slate-500\"><Loader2 className=\"w-3 h-3 animate-spin inline mr-1\" /> Buscando...</div>}\r\n                        {!loading && term.length > 0 && results.length === 0 && (\r\n                            <div className=\"py-6 text-center text-xs text-slate-500\">No encontrado.</div>\r\n                        )}\r\n                        {!loading && term.length < 2 && (\r\n                            <div className=\"py-2 text-center text-[10px] text-slate-500\">Ingresa 2 letras...</div>\r\n                        )}\r\n                        <CommandGroup>\r\n                            {results.map((u) => (\r\n                                <CommandItem\r\n                                    key={u.id}\r\n                                    value={u.id} // Not used for filtering, just unique\r\n                                    onSelect={() => {\r\n                                        onSelect({ id: u.id, name: u.name })\r\n                                        setOpen(false)\r\n                                    }}\r\n                                    className=\"text-xs hover:bg-white/10 cursor-pointer\"\r\n                                >\r\n                                    <div className=\"flex flex-col\">\r\n                                        <span className=\"font-bold\">{u.name}</span>\r\n                                        <span className=\"text-[10px] text-slate-400 capitalize\">{u.type?.toLowerCase().replace('_', ' ')}</span>\r\n                                    </div>\r\n                                </CommandItem>\r\n                            ))}\r\n                        </CommandGroup>\r\n                    </CommandList>\r\n                </Command>\r\n            </PopoverContent>\r\n        </Popover>\r\n    )\r\n}\r\n\r\ninterface CloseSessionDialogProps {\r\n    sessionId: string\r\n    tableName: string\r\n    preview: { total: number, timeCost: number, consumptionTotal: number }\r\n    isOpen: boolean\r\n    onClose: () => void\r\n    onSuccess: () => void\r\n}\r\n\r\nexport function CloseSessionDialog({ sessionId, tableName, preview, isOpen, onClose, onSuccess }: CloseSessionDialogProps) {\r\n    const [isSubmitting, setIsSubmitting] = useState(false)\r\n    const [paymentMode, setPaymentMode] = useState<\"single\" | \"split\">(\"single\")\r\n\r\n    // Split Payments State\r\n    const [payments, setPayments] = useState<{ amount: number, method: string, userId?: string, userName?: string }[]>([])\r\n\r\n    // Initialize default single payment\r\n    useEffect(() => {\r\n        if (isOpen && preview) {\r\n            setPayments([{ amount: preview.total, method: \"CASH\" }])\r\n            setPaymentMode(\"single\")\r\n        }\r\n    }, [isOpen, preview])\r\n\r\n    const totalPaid = payments.reduce((sum, p) => sum + (Number(p.amount) || 0), 0)\r\n    const remaining = preview ? (preview.total - totalPaid) : 0\r\n\r\n    const addPayment = () => {\r\n        if (remaining > 0) {\r\n            setPayments([...payments, { amount: remaining, method: \"CASH\" }])\r\n        } else {\r\n            setPayments([...payments, { amount: 0, method: \"CASH\" }])\r\n        }\r\n    }\r\n\r\n    const removePayment = (index: number) => {\r\n        const newPayments = [...payments]\r\n        newPayments.splice(index, 1)\r\n        setPayments(newPayments)\r\n    }\r\n\r\n    const updatePayment = (index: number, field: string, value: any) => {\r\n        const newPayments = [...payments]\r\n        newPayments[index] = { ...newPayments[index], [field]: value }\r\n\r\n        // Clear user if method changes and it's not ACCOUNT? No, keep it.\r\n        // But if method is ACCOUNT, user is required.\r\n        setPayments(newPayments)\r\n    }\r\n\r\n    const updateUser = (index: number, user: { id: string, name: string } | undefined) => {\r\n        const newPayments = [...payments]\r\n        newPayments[index] = {\r\n            ...newPayments[index],\r\n            userId: user?.id,\r\n            userName: user?.name\r\n        }\r\n        setPayments(newPayments)\r\n    }\r\n\r\n    async function handleConfirm() {\r\n        if (remaining !== 0 && Math.abs(remaining) > 50) { // Tolerance\r\n            toast.error(`El total pagado no coincide. Faltan $${remaining}`)\r\n            return\r\n        }\r\n\r\n        // Validate Account Payments\r\n        const invalidAccount = payments.some(p => p.method === 'ACCOUNT' && !p.userId);\r\n        if (invalidAccount) {\r\n            toast.error(\"Pagos con 'Fiado' requieren asignar un usuario\");\r\n            return;\r\n        }\r\n\r\n        setIsSubmitting(true)\r\n        try {\r\n            const result = await endSession(sessionId, payments)\r\n            if (result.success) {\r\n                toast.success(\"Mesa cerrada correctamente\", {\r\n                    description: `Total: $${result.total}`\r\n                })\r\n                onSuccess()\r\n            } else {\r\n                toast.error(result.error || \"Error al cerrar mesa\")\r\n            }\r\n        } catch (error) {\r\n            toast.error(\"Error inesperado\")\r\n        } finally {\r\n            setIsSubmitting(false)\r\n        }\r\n    }\r\n\r\n    if (!preview) return null\r\n\r\n    return (\r\n        <Dialog open={isOpen} onOpenChange={onClose}>\r\n            <DialogContent className=\"sm:max-w-[600px] bg-slate-950 border-white/10 text-white\">\r\n                <DialogHeader>\r\n                    <DialogTitle>Cerrar Mesa: {tableName}</DialogTitle>\r\n                </DialogHeader>\r\n\r\n                <div className=\"py-4 space-y-4\">\r\n                    {/* Summary */}\r\n                    <div className=\"bg-white/5 p-4 rounded-lg space-y-2\">\r\n                        <div className=\"flex justify-between text-sm\">\r\n                            <span className=\"text-slate-400\">Tiempo</span>\r\n                            <span>${preview.timeCost}</span>\r\n                        </div>\r\n                        <div className=\"flex justify-between text-sm\">\r\n                            <span className=\"text-slate-400\">Consumo</span>\r\n                            <span>${preview.consumptionTotal}</span>\r\n                        </div>\r\n                        <div className=\"flex justify-between font-bold text-xl text-emerald-400 pt-2 border-t border-white/10\">\r\n                            <span>Total a Pagar</span>\r\n                            <span>${preview.total}</span>\r\n                        </div>\r\n                    </div>\r\n\r\n                    <Tabs value={paymentMode} onValueChange={(v) => {\r\n                        setPaymentMode(v as any)\r\n                        // Reset payments on switch to ensure consistency\r\n                        if (v === 'single') setPayments([{ amount: preview.total, method: \"CASH\" }])\r\n                    }} className=\"w-full\">\r\n                        <TabsList className=\"grid w-full grid-cols-2 bg-white/10\">\r\n                            <TabsTrigger value=\"single\">Pago Único</TabsTrigger>\r\n                            <TabsTrigger value=\"split\">Dividir Cuenta</TabsTrigger>\r\n                        </TabsList>\r\n\r\n                        <TabsContent value=\"single\" className=\"space-y-4 mt-4\">\r\n                            <div className=\"flex flex-col gap-2\">\r\n                                <label className=\"text-sm text-slate-400\">Método de Pago</label>\r\n                                <Select\r\n                                    value={payments[0]?.method}\r\n                                    onValueChange={(v) => updatePayment(0, 'method', v)}\r\n                                >\r\n                                    <SelectTrigger className=\"bg-slate-900 border-white/10\">\r\n                                        <SelectValue />\r\n                                    </SelectTrigger>\r\n                                    <SelectContent>\r\n                                        <SelectItem value=\"CASH\">Efectivo</SelectItem>\r\n                                        <SelectItem value=\"CARD\">Tarjeta (Débito/Crédito)</SelectItem>\r\n                                        <SelectItem value=\"TRANSFER\">Transferencia</SelectItem>\r\n                                        <SelectItem value=\"ACCOUNT\">Fiado (Cta. Cte.)</SelectItem>\r\n                                    </SelectContent>\r\n                                </Select>\r\n\r\n                                <label className=\"text-sm text-slate-400 mt-2\">\r\n                                    Asignar a Usuario {payments[0]?.method === 'ACCOUNT' && <span className=\"text-red-500\">*</span>}\r\n                                </label>\r\n                                <PaymentUserSelect\r\n                                    value={payments[0]?.userId ? { id: payments[0].userId, name: payments[0].userName || '' } : undefined}\r\n                                    onSelect={(u) => updateUser(0, u)}\r\n                                    required={payments[0]?.method === 'ACCOUNT'}\r\n                                />\r\n                            </div>\r\n                        </TabsContent>\r\n\r\n                        <TabsContent value=\"split\" className=\"space-y-4 mt-4\">\r\n                            <div className=\"space-y-3 max-h-[300px] overflow-y-auto pr-2\">\r\n                                {payments.map((p, idx) => (\r\n                                    <div key={idx} className=\"flex flex-wrap items-center gap-2 bg-white/5 p-2 rounded border border-white/5\">\r\n                                        <div className=\"w-24\">\r\n                                            <Input\r\n                                                type=\"number\"\r\n                                                value={p.amount}\r\n                                                onChange={(e) => updatePayment(idx, 'amount', Number(e.target.value))}\r\n                                                className=\"bg-slate-900 border-white/10 h-8 font-mono\"\r\n                                            />\r\n                                        </div>\r\n                                        <Select\r\n                                            value={p.method}\r\n                                            onValueChange={(v) => updatePayment(idx, 'method', v)}\r\n                                        >\r\n                                            <SelectTrigger className=\"bg-slate-900 border-white/10 h-8 w-[110px]\">\r\n                                                <SelectValue />\r\n                                            </SelectTrigger>\r\n                                            <SelectContent>\r\n                                                <SelectItem value=\"CASH\">Efectivo</SelectItem>\r\n                                                <SelectItem value=\"CARD\">Tarjeta</SelectItem>\r\n                                                <SelectItem value=\"TRANSFER\">Transf.</SelectItem>\r\n                                                <SelectItem value=\"ACCOUNT\">Fiado</SelectItem>\r\n                                            </SelectContent>\r\n                                        </Select>\r\n\r\n                                        <div className=\"flex-1 min-w-[120px]\">\r\n                                            <PaymentUserSelect\r\n                                                value={p.userId ? { id: p.userId, name: p.userName || '' } : undefined}\r\n                                                onSelect={(u) => updateUser(idx, u)}\r\n                                                required={p.method === 'ACCOUNT'}\r\n                                            />\r\n                                        </div>\r\n\r\n                                        <Button variant=\"ghost\" size=\"icon\" className=\"h-8 w-8 text-red-400 hover:text-red-300 hover:bg-red-900/20\" onClick={() => removePayment(idx)}>\r\n                                            <Trash2 className=\"h-4 w-4\" />\r\n                                        </Button>\r\n                                    </div>\r\n                                ))}\r\n                            </div>\r\n                            <Button variant=\"outline\" size=\"sm\" onClick={addPayment} className=\"w-full border-dashed border-white/20 hover:border-emerald-500 hover:text-emerald-500\">\r\n                                <Plus className=\"w-4 h-4 mr-2\" /> Agregar Pago\r\n                            </Button>\r\n\r\n                            <div className=\"flex justify-between items-center bg-black/40 p-2 rounded text-sm mb-2\">\r\n                                <span className={remaining !== 0 ? \"text-amber-500\" : \"text-emerald-500\"}>\r\n                                    Faltante: ${remaining}\r\n                                </span>\r\n                                <span className=\"text-slate-500\">\r\n                                    Pagado: ${totalPaid} / ${preview.total}\r\n                                </span>\r\n                            </div>\r\n                        </TabsContent>\r\n                    </Tabs>\r\n\r\n                </div>\r\n\r\n                <DialogFooter>\r\n                    <Button variant=\"ghost\" onClick={onClose}>Cancelar</Button>\r\n                    <Button\r\n                        onClick={handleConfirm}\r\n                        disabled={isSubmitting || Math.abs(remaining) > 50}\r\n                        className=\"bg-red-600 hover:bg-red-700 text-white font-bold\"\r\n                    >\r\n                        {isSubmitting ? <Loader2 className=\"animate-spin mr-2 h-4 w-4\" /> : <DollarSign className=\"mr-2 h-4 w-4\" />}\r\n                        Finalizar Cobro\r\n                    </Button>\r\n                </DialogFooter>\r\n            </DialogContent>\r\n        </Dialog>\r\n    )\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\rokat\\OneDrive\\Proyectos\\Akapoolco\\src\\components\\tables\\EditTableDialog.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":26,"column":12,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":26,"endColumn":15,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[662,665],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[662,665],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\nC:\\Users\\rokat\\OneDrive\\Proyectos\\Akapoolco\\src\\components\\tables\\EditTableDialog.tsx:40:13\n  38 |     useEffect(() => {\n  39 |         if (table) {\n> 40 |             setName(table.name);\n     |             ^^^^^^^ Avoid calling setState() directly within an effect\n  41 |             setType(table.type as TableType);\n  42 |             setPriceMember(table.priceMember?.toString() || '0');\n  43 |             setPriceClient(table.priceClient?.toString() || '0');","line":40,"column":13,"nodeType":null,"endLine":40,"endColumn":20}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport { useState, useTransition, useEffect } from 'react';\r\nimport { updateTable } from '@/app/lib/actions-tables';\r\nimport { Button } from '@/components/ui/button';\r\nimport {\r\n    Dialog,\r\n    DialogContent,\r\n    DialogDescription,\r\n    DialogFooter,\r\n    DialogHeader,\r\n    DialogTitle,\r\n} from '@/components/ui/dialog';\r\nimport {\r\n    Select,\r\n    SelectContent,\r\n    SelectItem,\r\n    SelectTrigger,\r\n    SelectValue,\r\n} from '@/components/ui/select';\r\nimport { Input } from '@/components/ui/input';\r\nimport { Label } from '@/components/ui/label';\r\nimport { TableType } from '@prisma/client';\r\n\r\ninterface EditTableDialogProps {\r\n    table: any; // Using any for flexibility with serialized props, or define strict interface\r\n    open: boolean;\r\n    onOpenChange: (open: boolean) => void;\r\n}\r\n\r\nexport function EditTableDialog({ table, open, onOpenChange }: EditTableDialogProps) {\r\n    const [isPending, startTransition] = useTransition();\r\n    const [name, setName] = useState('');\r\n    const [type, setType] = useState<TableType | ''>('');\r\n    const [priceMember, setPriceMember] = useState('');\r\n    const [priceClient, setPriceClient] = useState('');\r\n\r\n    useEffect(() => {\r\n        if (table) {\r\n            setName(table.name);\r\n            setType(table.type as TableType);\r\n            setPriceMember(table.priceMember?.toString() || '0');\r\n            setPriceClient(table.priceClient?.toString() || '0');\r\n        }\r\n    }, [table]);\r\n\r\n    const handleSubmit = async (e: React.FormEvent) => {\r\n        e.preventDefault();\r\n        if (!name || !type || !table?.id) return;\r\n\r\n        startTransition(async () => {\r\n            const result = await updateTable(table.id, {\r\n                name,\r\n                type: type as TableType,\r\n                priceMember: Number(priceMember),\r\n                priceClient: Number(priceClient)\r\n            });\r\n            if (result.success) {\r\n                onOpenChange(false);\r\n            } else {\r\n                alert(result.error || 'Error al actualizar la mesa');\r\n            }\r\n        });\r\n    };\r\n\r\n    return (\r\n        <Dialog open={open} onOpenChange={onOpenChange}>\r\n            <DialogContent className=\"sm:max-w-[425px] bg-slate-950 text-white border-slate-800\">\r\n                <DialogHeader>\r\n                    <DialogTitle>Editar Mesa</DialogTitle>\r\n                    <DialogDescription className=\"text-slate-400\">\r\n                        Modifica los datos de la mesa.\r\n                    </DialogDescription>\r\n                </DialogHeader>\r\n                <form onSubmit={handleSubmit}>\r\n                    <div className=\"grid gap-4 py-4\">\r\n                        <div className=\"grid grid-cols-4 items-center gap-4\">\r\n                            <Label htmlFor=\"edit-name\" className=\"text-right\">\r\n                                Nombre\r\n                            </Label>\r\n                            <Input\r\n                                id=\"edit-name\"\r\n                                value={name}\r\n                                onChange={(e) => setName(e.target.value)}\r\n                                className=\"col-span-3 bg-slate-900 border-slate-700\"\r\n                                required\r\n                            />\r\n                        </div>\r\n                        <div className=\"grid grid-cols-4 items-center gap-4\">\r\n                            <Label htmlFor=\"edit-type\" className=\"text-right\">\r\n                                Tipo\r\n                            </Label>\r\n                            <Select\r\n                                value={type}\r\n                                onValueChange={(val) => setType(val as TableType)}\r\n                                required\r\n                            >\r\n                                <SelectTrigger className=\"col-span-3 bg-slate-900 border-slate-700\">\r\n                                    <SelectValue placeholder=\"Selecciona el tipo\" />\r\n                                </SelectTrigger>\r\n                                <SelectContent className=\"bg-slate-900 border-slate-700 text-white\">\r\n                                    <SelectItem value=\"POOL\">Pool</SelectItem>\r\n                                    <SelectItem value=\"CARAMBOLA\">Carambola</SelectItem>\r\n                                    <SelectItem value=\"POOL_CHILENO\">Pool Chileno</SelectItem>\r\n                                    <SelectItem value=\"NINE_BALL\">9 Ball</SelectItem>\r\n                                    <SelectItem value=\"CARDS\">Cartas</SelectItem>\r\n                                    <SelectItem value=\"SNOOKER\">Snooker</SelectItem>\r\n                                </SelectContent>\r\n                            </Select>\r\n                        </div>\r\n\r\n                        <div className=\"grid grid-cols-4 items-center gap-4\">\r\n                            <Label htmlFor=\"edit-priceClient\" className=\"text-right\">\r\n                                $ Cliente\r\n                            </Label>\r\n                            <Input\r\n                                id=\"edit-priceClient\"\r\n                                type=\"number\"\r\n                                value={priceClient}\r\n                                onChange={(e) => setPriceClient(e.target.value)}\r\n                                className=\"col-span-3 bg-slate-900 border-slate-700\"\r\n                                min=\"0\"\r\n                                step=\"100\"\r\n                                required\r\n                            />\r\n                        </div>\r\n\r\n                        <div className=\"grid grid-cols-4 items-center gap-4\">\r\n                            <Label htmlFor=\"edit-priceMember\" className=\"text-right\">\r\n                                $ Socio\r\n                            </Label>\r\n                            <Input\r\n                                id=\"edit-priceMember\"\r\n                                type=\"number\"\r\n                                value={priceMember}\r\n                                onChange={(e) => setPriceMember(e.target.value)}\r\n                                className=\"col-span-3 bg-slate-900 border-slate-700\"\r\n                                min=\"0\"\r\n                                step=\"100\"\r\n                                required\r\n                            />\r\n                        </div>\r\n                    </div>\r\n                    <DialogFooter>\r\n                        <Button type=\"submit\" disabled={isPending} className=\"bg-emerald-600 hover:bg-emerald-700\">\r\n                            {isPending ? 'Guardando...' : 'Guardar Cambios'}\r\n                        </Button>\r\n                    </DialogFooter>\r\n                </form>\r\n            </DialogContent>\r\n        </Dialog>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\rokat\\OneDrive\\Proyectos\\Akapoolco\\src\\components\\tables\\NewTableDialog.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\rokat\\OneDrive\\Proyectos\\Akapoolco\\src\\components\\tables\\OpenTableDialog.tsx","messages":[],"suppressedMessages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'UserPlus' is defined but never used.","line":11,"column":19,"nodeType":"Identifier","messageId":"unusedVar","endLine":11,"endColumn":27,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"UserPlus"},"fix":{"range":[502,512],"text":""},"desc":"Remove unused variable \"UserPlus\"."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'UserIcon' is defined but never used.","line":11,"column":48,"nodeType":"Identifier","messageId":"unusedVar","endLine":11,"endColumn":56,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"UserIcon"},"fix":{"range":[523,541],"text":""},"desc":"Remove unused variable \"UserIcon\"."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":38,"column":56,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":38,"endColumn":59,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1581,1584],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1581,1584],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'isSearching' is assigned a value but never used.","line":39,"column":12,"nodeType":"Identifier","messageId":"unusedVar","endLine":39,"endColumn":23,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":56,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":56,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2154,2157],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2154,2157],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\rokat\\OneDrive\\Proyectos\\Akapoolco\\src\\components\\tables\\PaymentModal.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\rokat\\OneDrive\\Proyectos\\Akapoolco\\src\\components\\tables\\SessionTimer.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\rokat\\OneDrive\\Proyectos\\Akapoolco\\src\\components\\tables\\TableCard.tsx","messages":[{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\nC:\\Users\\rokat\\OneDrive\\Proyectos\\Akapoolco\\src\\components\\tables\\TableCard.tsx:49:17\n  47 |         if (autoOpen) {\n  48 |             if (isAvailable) {\n> 49 |                 setShowOpenDialog(true);\n     |                 ^^^^^^^^^^^^^^^^^ Avoid calling setState() directly within an effect\n  50 |             } else if (table.currentSession) {\n  51 |                 setShowControlSheet(true);\n  52 |             }","line":49,"column":17,"nodeType":null,"endLine":49,"endColumn":34}],"suppressedMessages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":27,"column":24,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":27,"endColumn":27,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[947,950],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[947,950],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/* eslint-disable @typescript-eslint/no-explicit-any */\r\n'use client';\r\n\r\nimport { useState, useEffect } from 'react';\r\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\r\nimport { Badge } from '@/components/ui/badge';\r\nimport { Clock, Settings, Monitor } from 'lucide-react';\r\nimport { SessionTimer } from './SessionTimer';\r\nimport { OpenTableDialog } from './OpenTableDialog';\r\nimport { ActiveSessionControl } from './ActiveSessionControl';\r\nimport { EditTableDialog } from './EditTableDialog';\r\nimport { Button } from '@/components/ui/button';\r\n\r\n// Match the type from actions-tables (serialized)\r\ninterface TableWithSession {\r\n    id: string;\r\n    name: string;\r\n    type: string;\r\n    status: string;\r\n    hourlyRate?: number;\r\n    priceMember?: number;\r\n    priceClient?: number;\r\n    currentSession: {\r\n        id: string;\r\n        startTime: string;\r\n        endTime?: string | null;\r\n        [key: string]: any;\r\n    } | null;\r\n}\r\n\r\ninterface TableCardProps {\r\n    table: TableWithSession;\r\n    userRole?: string;\r\n    autoOpen?: boolean;\r\n}\r\n\r\nexport function TableCard({ table, userRole, autoOpen }: TableCardProps) {\r\n    const isAvailable = table.status === 'AVAILABLE';\r\n    const [showOpenDialog, setShowOpenDialog] = useState(false);\r\n    const [showControlSheet, setShowControlSheet] = useState(false);\r\n    const [showEditDialog, setShowEditDialog] = useState(false);\r\n\r\n    const [estimatedCost, setEstimatedCost] = useState(0);\r\n\r\n    // Auto-open if requested via URL\r\n    useEffect(() => {\r\n        if (autoOpen) {\r\n            if (isAvailable) {\r\n                setShowOpenDialog(true);\r\n            } else if (table.currentSession) {\r\n                setShowControlSheet(true);\r\n            }\r\n        }\r\n    }, [autoOpen, isAvailable, table.currentSession]);\r\n\r\n    // Simple ticker for estimated cost in card\r\n    useEffect(() => {\r\n        if (table.currentSession && !isAvailable) {\r\n            const calculateEstimate = () => {\r\n                const start = new Date(table.currentSession!.startTime);\r\n                const now = new Date();\r\n                const durationHours = (now.getTime() - start.getTime()) / 1000 / 60 / 60;\r\n\r\n                // Simplified estimate: uses client price of table (or member if we knew)..\r\n                // Just as a visual guide.\r\n                const rate = Number(table.priceClient) || 4000;\r\n                setEstimatedCost(Math.ceil(durationHours * rate));\r\n            };\r\n            calculateEstimate();\r\n            const interval = setInterval(calculateEstimate, 60000);\r\n            return () => clearInterval(interval);\r\n        }\r\n    }, [table.currentSession, isAvailable, table.priceClient]);\r\n\r\n\r\n    const isAdmin = userRole === 'ADMIN' || userRole === 'SUPERUSER';\r\n\r\n    const handleClick = () => {\r\n        if (isAvailable) {\r\n            setShowOpenDialog(true);\r\n        } else if (table.status === 'OCCUPIED' && table.currentSession) {\r\n            setShowControlSheet(true);\r\n        }\r\n    };\r\n\r\n    return (\r\n        <>\r\n            <Card\r\n                className={`hover:shadow-md transition-shadow cursor-pointer relative group ${isAvailable ? 'border-l-4 border-l-green-500' : 'border-l-4 border-l-amber-500'\r\n                    }`}\r\n                onClick={handleClick}\r\n            >\r\n                <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\r\n                    <CardTitle className=\"text-lg font-bold flex items-center justify-between w-full\">\r\n                        <div className=\"flex items-center gap-2\">\r\n                            {table.name}\r\n                            {table.type !== 'CARDS' && table.type !== 'POKER' && (\r\n                                <Button\r\n                                    variant=\"ghost\"\r\n                                    size=\"icon\"\r\n                                    className=\"h-6 w-6 text-slate-500 hover:text-emerald-400\"\r\n                                    title=\"Abrir Pantalla / Marcador\"\r\n                                    onClick={(e) => {\r\n                                        e.stopPropagation();\r\n                                        window.open(`/table/${table.id}`, '_blank');\r\n                                    }}\r\n                                >\r\n                                    <Monitor className=\"w-4 h-4\" />\r\n                                </Button>\r\n                            )}\r\n                        </div>\r\n                        {isAdmin && (\r\n                            <Button\r\n                                variant=\"ghost\"\r\n                                size=\"icon\"\r\n                                className=\"h-6 w-6 text-slate-400 opacity-0 group-hover:opacity-100 transition-opacity hover:text-white hover:bg-slate-800\"\r\n                                onClick={(e) => {\r\n                                    e.stopPropagation();\r\n                                    setShowEditDialog(true);\r\n                                }}\r\n                            >\r\n                                <Settings className=\"w-4 h-4\" />\r\n                            </Button>\r\n                        )}\r\n                    </CardTitle>\r\n                </CardHeader>\r\n                <CardContent>\r\n                    <div className=\"flex justify-between items-center mb-4\">\r\n                        <Badge variant=\"outline\" className=\"text-[10px] font-normal border-slate-700 text-slate-400\">\r\n                            {table.status === 'AVAILABLE' ? 'Disponible' : 'Ocupada'}\r\n                        </Badge>\r\n                        <span className=\"text-xs text-muted-foreground uppercase\">{table.type.replace('_', ' ')}</span>\r\n                    </div>\r\n\r\n                    <div className=\"flex flex-col gap-1 text-xs text-slate-500 mb-2\">\r\n                        {table.priceClient && (\r\n                            <div className=\"flex justify-between\">\r\n                                <span>Cliente:</span>\r\n                                <span className=\"font-mono text-slate-300\">${Number(table.priceClient).toLocaleString('es-CL')}</span>\r\n                            </div>\r\n                        )}\r\n                        {table.priceMember && (\r\n                            <div className=\"flex justify-between\">\r\n                                <span>Socio:</span>\r\n                                <span className=\"font-mono text-emerald-400\">${Number(table.priceMember).toLocaleString('es-CL')}</span>\r\n                            </div>\r\n                        )}\r\n                    </div>\r\n\r\n                    {!isAvailable && table.currentSession ? (\r\n                        <div className=\"flex items-center space-x-2 text-amber-600 font-mono text-xl justify-center mt-2\">\r\n                            <Clock className=\"w-5 h-5\" />\r\n                            <SessionTimer startTime={table.currentSession.startTime} />\r\n                        </div>\r\n                    ) : (\r\n                        <div className=\"text-sm text-green-600 font-medium flex items-center justify-center h-[28px] mt-2\">\r\n                            Lista para usar\r\n                        </div>\r\n                    )}\r\n\r\n                    {!isAvailable && table.currentSession && table.type !== 'CARDS' && (\r\n                        <div className=\"text-[10px] text-slate-500 text-center mt-1\">\r\n                            ~${estimatedCost.toLocaleString()} (Est.)\r\n                        </div>\r\n                    )}\r\n                </CardContent>\r\n            </Card>\r\n\r\n            <OpenTableDialog\r\n                tableId={table.id}\r\n                tableName={table.name}\r\n                tableType={table.type}\r\n                priceClient={table.priceClient}\r\n                priceMember={table.priceMember}\r\n                isOpen={showOpenDialog}\r\n                onClose={() => setShowOpenDialog(false)}\r\n            />\r\n\r\n            <ActiveSessionControl\r\n                table={table}\r\n                isOpen={showControlSheet}\r\n                onClose={() => setShowControlSheet(false)}\r\n            />\r\n\r\n            <EditTableDialog\r\n                table={table}\r\n                open={showEditDialog}\r\n                onOpenChange={setShowEditDialog}\r\n            />\r\n        </>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\rokat\\OneDrive\\Proyectos\\Akapoolco\\src\\components\\tables\\TableConsumption.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\rokat\\OneDrive\\Proyectos\\Akapoolco\\src\\components\\ui\\avatar.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\rokat\\OneDrive\\Proyectos\\Akapoolco\\src\\components\\ui\\badge.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\rokat\\OneDrive\\Proyectos\\Akapoolco\\src\\components\\ui\\button.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\rokat\\OneDrive\\Proyectos\\Akapoolco\\src\\components\\ui\\card.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\rokat\\OneDrive\\Proyectos\\Akapoolco\\src\\components\\ui\\checkbox.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\rokat\\OneDrive\\Proyectos\\Akapoolco\\src\\components\\ui\\command.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\rokat\\OneDrive\\Proyectos\\Akapoolco\\src\\components\\ui\\dialog.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\rokat\\OneDrive\\Proyectos\\Akapoolco\\src\\components\\ui\\dropdown-menu.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\rokat\\OneDrive\\Proyectos\\Akapoolco\\src\\components\\ui\\input.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\rokat\\OneDrive\\Proyectos\\Akapoolco\\src\\components\\ui\\label.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\rokat\\OneDrive\\Proyectos\\Akapoolco\\src\\components\\ui\\popover.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\rokat\\OneDrive\\Proyectos\\Akapoolco\\src\\components\\ui\\scroll-area.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\rokat\\OneDrive\\Proyectos\\Akapoolco\\src\\components\\ui\\select.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\rokat\\OneDrive\\Proyectos\\Akapoolco\\src\\components\\ui\\separator.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\rokat\\OneDrive\\Proyectos\\Akapoolco\\src\\components\\ui\\sheet.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\rokat\\OneDrive\\Proyectos\\Akapoolco\\src\\components\\ui\\switch.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\rokat\\OneDrive\\Proyectos\\Akapoolco\\src\\components\\ui\\table.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\rokat\\OneDrive\\Proyectos\\Akapoolco\\src\\components\\ui\\tabs.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\rokat\\OneDrive\\Proyectos\\Akapoolco\\src\\components\\ui\\textarea.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\rokat\\OneDrive\\Proyectos\\Akapoolco\\src\\hooks\\useChileanGame.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'WIN_THRESHOLD' is assigned a value but never used.","line":17,"column":11,"nodeType":"Identifier","messageId":"unusedVar","endLine":17,"endColumn":24}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\r\nimport { useMemo } from 'react';\r\nimport { ChileanState } from '@/types/game-state';\r\n\r\nexport interface ScoreMetrics {\r\n    p1RawScore: number;\r\n    p2RawScore: number;\r\n    p1NetScore: number;\r\n    p2NetScore: number;\r\n    pointsRemaining: number;\r\n    winner: 'p1' | 'p2' | null;\r\n}\r\n\r\nexport function useChileanGame(state: ChileanState) {\r\n\r\n    // Constants\r\n    const WIN_THRESHOLD = 60.5;\r\n    const TOTAL_POINTS = 120;\r\n\r\n    // derived State\r\n    const metrics = useMemo<ScoreMetrics>(() => {\r\n        // 1. Raw Ball Score = Sum(balls)\r\n        const p1RawScore = state.p1Balls.reduce((a, b) => a + b, 0);\r\n        const p2RawScore = state.p2Balls.reduce((a, b) => a + b, 0);\r\n\r\n        // 2. Net Score = Raw Ball Score - (MyFoul / 2) + (OpponentFoul / 2)\r\n        // Note: The logic requested is:\r\n        // \"If P1 commits foul of P (stored as p1FoulPoints):\r\n        // P1 loses P/2 (Debit)\r\n        // P2 gains P/2 (Credit)\"\r\n\r\n        // p1FoulPoints is the SUM of penalties committed by P1.\r\n        // So P1 has lost (p1FoulPoints / 2). P2 has gained (p1FoulPoints / 2).\r\n\r\n        const p1PenaltyEffect = state.p1FoulPoints / 2; // What P1 loses\r\n        const p2PenaltyEffect = state.p2FoulPoints / 2; // What P2 loses\r\n\r\n        const p1NetScore = p1RawScore - p1PenaltyEffect + p2PenaltyEffect;\r\n        const p2NetScore = p2RawScore - p2PenaltyEffect + p1PenaltyEffect;\r\n\r\n        // 3. Points Remaining\r\n        const pointsRemaining = TOTAL_POINTS - (p1RawScore + p2RawScore);\r\n\r\n        // Winner Check\r\n        // Winner Check\r\n        let winner: 'p1' | 'p2' | null = null;\r\n\r\n        // 1. Early Win (Majority > 60)\r\n        // If > 60, impossible for other to catch up if Sum is 120. \r\n        // Techincally > 60.0 is enough for majority. 60.5 covers 60.5 case.\r\n        if (p1NetScore > 60) winner = 'p1';\r\n        if (p2NetScore > 60) winner = 'p2';\r\n\r\n        // 2. End of Game Check (No balls left)\r\n        if (pointsRemaining === 0 && !winner) {\r\n            if (p1NetScore > p2NetScore) winner = 'p1';\r\n            else if (p2NetScore > p1NetScore) winner = 'p2';\r\n        }\r\n\r\n        return {\r\n            p1RawScore,\r\n            p2RawScore,\r\n            p1NetScore,\r\n            p2NetScore,\r\n            pointsRemaining,\r\n            winner\r\n        };\r\n    }, [state.p1Balls, state.p2Balls, state.p1FoulPoints, state.p2FoulPoints]);\r\n\r\n    return metrics;\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\rokat\\OneDrive\\Proyectos\\Akapoolco\\src\\hooks\\useTableSync.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":9,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":9,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[259,262],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[259,262],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":10,"column":10,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":10,"endColumn":13,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[330,333],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[330,333],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":25,"column":32,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":25,"endColumn":35,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[852,855],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[852,855],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport { useState, useEffect, useRef } from 'react';\r\nimport { getKioskState } from '@/app/lib/actions-kiosk';\r\n\r\n// Types for the hook return\r\nexport interface KioskState {\r\n    status: string; // AVAILABLE, OCCUPIED, etc.\r\n    sessionData: any | null; // Using any for agility, ideally strictly typed\r\n    ads: any[];\r\n}\r\n\r\nexport function useTableSync(tableId: string, initialData: KioskState) {\r\n    const [state, setState] = useState<KioskState>(initialData);\r\n    const [lastUpdated, setLastUpdated] = useState<Date>(new Date());\r\n    const errorCount = useRef(0);\r\n\r\n    useEffect(() => {\r\n        // Polling logic\r\n        const intervalMs = state.status === 'OCCUPIED' ? 5000 : 30000;\r\n\r\n        const interval = setInterval(async () => {\r\n            try {\r\n                // Fetch new state\r\n                const newData: any = await getKioskState(tableId);\r\n\r\n                if (newData.error) {\r\n                    errorCount.current++;\r\n                    console.warn(`Sync error (${errorCount.current}):`, newData.error);\r\n                    return;\r\n                }\r\n\r\n                errorCount.current = 0;\r\n\r\n                // Simple comparison to update state if needed\r\n                // Deep comparison would be better for performance to avoid re-renders\r\n                // but for now, we just update.\r\n                setState(prev => {\r\n                    // Check if status changed or important data changed\r\n                    if (JSON.stringify(prev) !== JSON.stringify(newData)) {\r\n                        setLastUpdated(new Date());\r\n                        return newData;\r\n                    }\r\n                    return prev;\r\n                });\r\n            } catch (err) {\r\n                console.error(\"Sync fetch exception\", err);\r\n            }\r\n        }, intervalMs);\r\n\r\n        return () => clearInterval(interval);\r\n    }, [tableId, state.status]);\r\n\r\n    return { ...state, lastUpdated };\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\rokat\\OneDrive\\Proyectos\\Akapoolco\\src\\lib\\permissions.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\rokat\\OneDrive\\Proyectos\\Akapoolco\\src\\lib\\prisma.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\rokat\\OneDrive\\Proyectos\\Akapoolco\\src\\lib\\store.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\rokat\\OneDrive\\Proyectos\\Akapoolco\\src\\lib\\types.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\rokat\\OneDrive\\Proyectos\\Akapoolco\\src\\lib\\utils.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\rokat\\OneDrive\\Proyectos\\Akapoolco\\src\\middleware.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\rokat\\OneDrive\\Proyectos\\Akapoolco\\src\\types\\game-state.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\rokat\\OneDrive\\Proyectos\\Akapoolco\\src\\types\\next-auth.d.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]}]